<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello New World</title>
    <url>/2022/08/22/hello-world/</url>
    <content><![CDATA[<blockquote>
<p>Be all you can be!</p>
</blockquote>
<p>Hello World æ˜¯ç¨‹åºå‘˜è¿›å…¥ç¼–ç¨‹ä¸–ç•Œåçœ‹åˆ°çš„ç¬¬ä¸€é“é£æ™¯ï¼Œæˆ‘ä¹Ÿååˆ†ä¹æ„è¿™ä½œä¸ºç¬¬ä¸€ç¯‡åšæ–‡çš„æ ‡é¢˜ï¼Œå¯¹æˆ‘æ¥è®²å¯èƒ½æ˜¯ï¼šä½ å¥½æ–°ä¸–ç•Œï¼</p>
<p>ç¬”è€…æ˜¯ä¸€ååµŒå…¥å¼è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œæœªæ¥æ›´å¤šçš„å†…å®¹å°†ä¼šæ˜¯å…³äºLinuxã€Androidç­‰ç›¸å…³å†…å®¹ï¼Œç¼–ç¨‹è¯­è¨€æ–¹é¢å°†ä¼šæ˜¯ä»¥C / C++ä¸ºä¸»ã€‚åšè¿™ä¸ªåšå®¢æœ‰ä¸‰ä¸ªç›®çš„ï¼š</p>
<ol>
<li>è®°å½•è‡ªå·±åœ¨å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜åŠç›¸å…³è§£å†³åŠæ³•ã€‚å¸®åŠ©è‡ªå·±ç§¯ç´¯è°ƒè¯•ç»éªŒåŒæ—¶å¸®åŠ©å…¶ä»–å¯èƒ½é‡åˆ°åŒæ ·é—®é¢˜çš„æœ‹å‹ï¼Œé¿å…è¸©å¾ˆå¤šå‘ï¼›</li>
<li>æ€»ç»“è‡ªå·±è¿‘æœŸå­¦åˆ°çš„æ–°çš„çŸ¥è¯†å’Œå†…å®¹ã€‚è¿™éƒ¨åˆ†ä¸ä¸€å®šæ˜¯æœ€å…¨é¢çš„ä½†å¯¹äºå¤„äºç›¸åŒé˜¶æ®µçš„æˆ‘ä»¬ä¸€å®šæ˜¯æœ€å®ç”¨çš„ï¼Œåé¢å†ä¸æ–­çš„å®Œå–„æ›´æ–°ï¼›</li>
<li>æœ€åå¯èƒ½å°±æ˜¯ç®€å•çš„è®°å½•å¹¶å®‰åˆ©ä¸€äº›å®ç”¨çš„å·¥å…·æˆ–è€…æ¯”è¾ƒå¥½çš„æ–‡ç« ï¼Œèƒ½å¤Ÿä»¥é€šä¿—çš„è¯­è¨€å¸®åŠ©æˆ‘ä»¬ç†è§£æŸä¸€ä¸ªç‚¹æˆ–è€…çœ‹æ¸…æ¥šæŸä¸€ä¸ªé¢ã€‚</li>
</ol>
<p>ç›®å‰æˆ‘åªæ­å»ºäº†ä¸»é¡µåŸºç¡€æ¨¡å—ï¼Œåé¢éšç€æ–‡ç« çš„ä¸æ–­è¾“å‡ºä¹Ÿä¼šæ·»ç –åŠ ç“¦çš„ã€‚æˆ‘ä¹Ÿå¸Œæœ›åç»­èƒ½å†™ä¸€äº›è¯»ä¹¦ç¬”è®°æˆ–è€…ç”Ÿæ´»ç»éªŒæ¥åšè®°å½•åšåˆ†äº«ï¼åšå®¢æ›´æ–°é¢‘ç‡æš‚å®š1~2å‘¨è‡³å°‘ä¸€ç¯‡å†…å®¹ä¹Ÿä¸€å®šæ˜¯å’Œå·¥ä½œç”Ÿæ´»ç›¸å…³çš„ã€‚å¦‚æœæœ‰é”™è¯¯è¿˜è¯·æŒ‡æ­£å…±åŒè¿›æ­¥å‘€<span class="github-emoji" style="display:inline;vertical-align:middle"><span>ğŸ˜ƒ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>!</p>
<p align="right">2022-8-22/23.38</p>

<p align="right">Lee</p>

]]></content>
      <categories>
        <category>Personal</category>
      </categories>
  </entry>
  <entry>
    <title>æ­å»ºUbuntuè™šæ‹Ÿæœº</title>
    <url>/2022/10/22/ubuntu-create/</url>
    <content><![CDATA[<h1 id="Linux-ç®€ä»‹"><a href="#Linux-ç®€ä»‹" class="headerlink" title="Linux ç®€ä»‹"></a>Linux ç®€ä»‹</h1><p>linusè‡ªä¼ ã€Šåªæ˜¯ä¸ºäº†å¥½ç©ã€‹ä¸­è¿™æ ·å®šä¹‰ï¼š</p>
<ul>
<li><p>ç±»Unixæ“ä½œç³»ç»Ÿ</p>
</li>
<li><p>å¼€æ”¾æºä»£ç æ–¹å¼åä½œå¼€å‘</p>
</li>
<li><p>é‡‡ç”¨GPLé€šç”¨è®¸å¯è¯ç»´æƒ</p>
</li>
<li><p>ä¸»è¦ç”¨äºè¶…çº§ç”µè„‘ã€ä¼ä¸šçº§æœåŠ¡å™¨ã€åµŒå…¥å¼è®¾å¤‡ç­‰</p>
</li>
</ul>
<h1 id="Ubuntu-ç®€ä»‹"><a href="#Ubuntu-ç®€ä»‹" class="headerlink" title="Ubuntu ç®€ä»‹"></a>Ubuntu ç®€ä»‹</h1><ul>
<li>æ¡Œé¢åº”ç”¨ä¸ºä¸»çš„Linuxæ“ä½œç³»ç»Ÿ</li>
<li>æ“ä½œç®€å•ã€æ–¹ä¾¿ä½¿ç”¨</li>
<li>ç³»ç»Ÿå®‰å…¨æ€§é«˜ï¼Œé»˜è®¤useræƒé™ç™»å½•</li>
<li>Ubuntuä¸­æ–‡ç½‘ç«™ï¼š<a href="http://www.wubantu.co/">http://www.wubantu.co</a></li>
<li>Ubuntuä¸­æ–‡ç¤¾åŒºï¼š<a href="http://www.ubuntu.org.cn/">http://www.ubuntu.org.cn</a></li>
<li>UbuntuæŠ€æœ¯ï¼š<a href="http://wiki.ubuntu.org.cn/">http://wiki.ubuntu.org.cn</a></li>
</ul>
<h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><ul>
<li>ç‰©ç†ä¸»æœº</li>
<li>isoé•œåƒ</li>
<li>vmware / VirtualBox</li>
</ul>
<p>ç½‘ç›˜ä¸­æˆ‘å‡†å¤‡äº†ubuntu20.04.4-isoã€ubuntu16.04.7-isoã€Vmware-16.2.3å®‰è£…åŒ…åŠå¯†é’¥å’Œä¸€ä»½linuxå‘½ä»¤å¤§å…¨ï¼</p>
<p>å¯†é’¥å¯¹äºä¸åŒç‰ˆæœ¬å¯èƒ½æœ‰å·®å¼‚å¯ä»¥éƒ½è¿›è¡Œå°è¯•ï¼Œå…¶åªæ˜¯å¯¹äºä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼Œå»ºè®®è´­ä¹°æ­£ç‰ˆï¼</p>
<p>åŒæ—¶é™„ä¸Šç›¸å…³å®˜ç½‘é“¾æ¥ï¼š</p>
<ul>
<li>ubuntuå„ç‰ˆæœ¬é•œåƒï¼š<a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/</a></li>
<li>vmwareå®˜ç½‘ï¼š<a href="https://www.vmware.com/cn/products/workstation-pro.html">https://www.vmware.com/cn/products/workstation-pro.html</a></li>
<li>VirtualBoxï¼š<a href="https://www.virtualbox.org/">https://www.virtualbox.org</a></li>
<li>èµ„æºç½‘ç›˜é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/18vxScuvFp2Vf4g28nRSC5w">https://pan.baidu.com/s/18vxScuvFp2Vf4g28nRSC5w</a><br>æå–ç ï¼šf8uo</li>
</ul>
<h1 id="å®‰è£…è¿‡ç¨‹"><a href="#å®‰è£…è¿‡ç¨‹" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h1><p>å‚è€ƒè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1hd4y127HY">https://www.bilibili.com/video/BV1hd4y127HY</a></p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>æ­å»ºè™šæ‹Ÿæœº</category>
      </categories>
  </entry>
  <entry>
    <title>ALSA</title>
    <url>/2023/04/11/Audio/Audio-Alsa/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>å®˜ç½‘ï¼š<a href="https://www.alsa-project.org/wiki/Main_Page">https://www.alsa-project.org/wiki/Main_Page</a></p>
</blockquote>
<p>ALSAï¼šAdvanced Linux Sound Architectureï¼Œé«˜çº§linuxå£°éŸ³ä½“ç³»ï¼Œå®ƒåœ¨Linuxæ“ä½œç³»ç»Ÿä¸Šæä¾›äº†éŸ³é¢‘å’ŒMIDIï¼ˆMusical Instrument Digital Interfaceï¼ŒéŸ³ä¹è®¾å¤‡æ•°å­—åŒ–æ¥å£ï¼‰çš„æ”¯æŒã€‚</p>
<h1 id="ALSAè®¾å¤‡æ–‡ä»¶ç»“æ„"><a href="#ALSAè®¾å¤‡æ–‡ä»¶ç»“æ„" class="headerlink" title="ALSAè®¾å¤‡æ–‡ä»¶ç»“æ„"></a>ALSAè®¾å¤‡æ–‡ä»¶ç»“æ„</h1><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta"># cd /dev/snd; ls -l;</span></span><br><span class="line"></span><br><span class="line">crw-rw----+ <span class="number">1</span> root audio <span class="number">116</span>, <span class="number">8</span> <span class="number">2011</span><span class="number">-02</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">38</span> controlC0	 ç”¨äºå£°å¡çš„æ§åˆ¶,ä¾‹å¦‚é€šé“é€‰æ‹©,æ··éŸ³,éº¦å…‹é£çš„æ§åˆ¶ç­‰ </span><br><span class="line">crw-rw----+ <span class="number">1</span> root audio <span class="number">116</span>, <span class="number">4</span> <span class="number">2011</span><span class="number">-02</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">38</span> midiC0D0	 ç”¨äºæ’­æ”¾midiéŸ³é¢‘ </span><br><span class="line">crw-rw----+ <span class="number">1</span> root audio <span class="number">116</span>, <span class="number">7</span> <span class="number">2011</span><span class="number">-02</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">39</span> pcmC0D0c	 ç”¨äºå½•éŸ³çš„pcmè®¾å¤‡ </span><br><span class="line">crw-rw----+ <span class="number">1</span> root audio <span class="number">116</span>, <span class="number">6</span> <span class="number">2011</span><span class="number">-02</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">56</span> pcmC0D0p	 ç”¨äºæ’­æ”¾çš„pcmè®¾å¤‡ </span><br><span class="line">crw-rw----+ <span class="number">1</span> root audio <span class="number">116</span>, <span class="number">3</span> <span class="number">2011</span><span class="number">-02</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">38</span> seq		 éŸ³åºå™¨ </span><br><span class="line">crw-rw----+ <span class="number">1</span> root audio <span class="number">116</span>, <span class="number">2</span> <span class="number">2011</span><span class="number">-02</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">38</span> timer	     å®šæ—¶å™¨</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶ä¸­,C0D0ä»£è¡¨çš„æ˜¯å£°å¡0ä¸­çš„è®¾å¤‡0 ; pcmC0D0cæœ€åä¸€ä¸ªcä»£è¡¨capture ; pcmC0D0pæœ€åä¸€ä¸ªpä»£è¡¨playbackã€‚</p>
<h2 id="alsaç›¸å…³å‡½æ•°åŠæ–‡ä»¶"><a href="#alsaç›¸å…³å‡½æ•°åŠæ–‡ä»¶" class="headerlink" title="alsaç›¸å…³å‡½æ•°åŠæ–‡ä»¶"></a>alsaç›¸å…³å‡½æ•°åŠæ–‡ä»¶</h2><h3 id="å‡½æ•°åŠç»“æ„ä½“"><a href="#å‡½æ•°åŠç»“æ„ä½“" class="headerlink" title="å‡½æ•°åŠç»“æ„ä½“"></a>å‡½æ•°åŠç»“æ„ä½“</h3><ul>
<li>AVFrame    iFrame           å­˜å‚¨éå‹ç¼©çš„æ•°æ®ï¼Œè¾“å…¥</li>
<li>AVFrame    swapFrame   å­˜å‚¨éå‹ç¼©çš„æ•°æ®ï¼Œé‡é‡‡æ ·</li>
<li>AVPack       oPacket          å‹ç¼©å³ç¼–ç åçš„è¾“å…¥ï¼Œè¾“å‡º</li>
</ul>
<ol>
<li><p>snd_pcm_hw_params_get_rate( )</p>
</li>
<li><p>snd_pcm_open( )</p>
<ul>
<li><p>snd_config_update_ref</p>
<p>è¿™ä¸ªå‡½æ•°ä½œç”¨æ˜¯æ£€æŸ¥alsaé…ç½®æ–‡ä»¶æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼ŒåŒ…æ‹¬æ–‡ä»¶åå­—å’Œå„ä¸ªé…ç½®æ–‡ä»¶çš„å†…å®¹æ˜¯å¦ä¿®æ”¹ï¼Œå¦‚æœæœ‰ä¿®æ”¹ï¼Œå°±é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶æ ‘ï¼Œåˆ·æ–°å…¨å±€å˜é‡snd_configå¹¶å¢åŠ ä¸€ä¸ªsnd_configçš„å¼•ç”¨è®¡æ•°ï¼Œè°ƒç”¨snd_config_update_refä¼ å…¥çš„topå°±æ˜¯æŒ‡å‘snd_configçš„æŒ‡é’ˆï¼Œè¿™ä¸ªtopå½“ä½œå‚æ•°ä¼ å…¥snd_pcm_open_noupdateå‡½æ•°ä¸­ã€‚snd_config_unrefæ¥ä¸‹æ¥ä¼šå‡å»snd_configçš„å¼•ç”¨è®¡æ•°ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºé¡¶å±‚é…ç½®èŠ‚ç‚¹ï¼Œç„¶åæ‰“å¼€/usr/share/alsa/alsa.confï¼ŒåŠ è½½æ–‡ä»¶å†…å®¹åˆ°é¡¶å±‚é…ç½®èŠ‚ç‚¹ä¸Šï¼Œç„¶åéå†æ‰€æœ‰çš„hooksï¼Œè°ƒç”¨snd_config_hooksåŠ è½½æ‰€æœ‰hooksï¼Œå¹¶è°ƒç”¨ç›¸å…³çš„hookså‡½æ•°æ‰“å¼€å¯¹åº”çš„pluginåŠ¨æ€åº“</p>
</li>
<li><p>snd_pcm_open_noupdate</p>
</li>
</ul>
</li>
<li><p>avcodec_open2( )</p>
<ul>
<li><p>æ£€æµ‹æŒ‡å®šçš„codecå’Œcontexté‡Œé¢çš„codecæ˜¯å¦åŒ¹é…ã€‚</p>
</li>
<li><p>åˆ†é…ç©ºé—´ã€‚</p>
</li>
<li><p>æ£€æµ‹codecå„ä¸ªå‚æ•°åˆæ³•æ€§ï¼Œå¹¶ç»™æŸäº›å­—æ®µèµ‹åˆå€¼ã€‚</p>
</li>
<li><p>è°ƒç”¨codecçš„initåˆå§‹åŒ–codecã€‚</p>
</li>
<li><p>é‡Šæ”¾èµ„æºï¼Œè¿”å›ã€‚</p>
</li>
</ul>
</li>
</ol>
<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><ol>
<li><p>å‚è€ƒç½‘å€ : <a href="https://www.cnblogs.com/lihaiping/p/alsaconfig.html">https://www.cnblogs.com/lihaiping/p/alsaconfig.html</a></p>
</li>
<li><p>é…ç½®æ–‡ä»¶çš„è°ƒç”¨è¿‡ç¨‹</p>
<p>alsa-libåº“  :  alsa-lib-1.2.1.2/src/pcm/pcm.c</p>
<p>snd_pcm_open( ) å‡½æ•°ä½œä¸ºæ‰“å¼€ä¸€ä¸ªpcmçš„æ¥å£.  å…·ä½“çš„è°ƒç”¨è¿‡ç¨‹æ˜¯ :  static snd_pcm_open_noupdate â€”-&gt;  static snd_pcm_open_conf( )</p>
<p>è§£æasound.confè¿‡ç¨‹ : <a href="https://www.xuebuyuan.com/1043778.html">https://www.xuebuyuan.com/1043778.html</a></p>
</li>
<li><p>snd_pcm_openå†…éƒ¨ç›´æ¥è§£æçš„æ˜¯usr/share/alsa/alsa.conf, åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å†³å®šäº†etc/asound.confå’Œ/.asoundrcè¿™ä¸¤ä¸ªæ–‡ä»¶è¦ä¸è¦è°ƒç”¨</p>
</li>
</ol>
<h3 id="3-3-éŸ³é¢‘è®¾å¤‡çš„å®šä¹‰"><a href="#3-3-éŸ³é¢‘è®¾å¤‡çš„å®šä¹‰" class="headerlink" title="3.3 éŸ³é¢‘è®¾å¤‡çš„å®šä¹‰"></a>3.3 éŸ³é¢‘è®¾å¤‡çš„å®šä¹‰</h3><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">#  æ–‡ä»¶å®šä¹‰ä½ç½® : /system/core/include/system/audio.h</span><br><span class="line">enum {</span><br><span class="line">    AUDIO_DEVICE_NONE                          = 0x0,</span><br><span class="line">    /* reserved bits */</span><br><span class="line">    AUDIO_DEVICE_BIT_IN                        = 0x80000000,</span><br><span class="line">    AUDIO_DEVICE_BIT_DEFAULT                   = 0x40000000,</span><br><span class="line">    /* output devices */</span><br><span class="line">    AUDIO_DEVICE_OUT_EARPIECE                  = 0x1,    // å¬ç­’</span><br><span class="line">    AUDIO_DEVICE_OUT_SPEAKER                   = 0x2,    // æ‰¬å£°å™¨</span><br><span class="line">    AUDIO_DEVICE_OUT_WIRED_HEADSET             = 0x4,    // çº¿æ§è€³æœºï¼Œå¯ä»¥é€šè¿‡è€³æœºæ§åˆ¶è¿œç«¯æ’­æ”¾ã€æš‚åœã€éŸ³é‡è°ƒèŠ‚ç­‰åŠŸèƒ½çš„è€³æœº</span><br><span class="line">    AUDIO_DEVICE_OUT_WIRED_HEADPHONE           = 0x8,    // æ™®é€šè€³æœºï¼Œåªèƒ½å¬ï¼Œä¸èƒ½æ“æ§æ’­æ”¾</span><br><span class="line">    AUDIO_DEVICE_OUT_BLUETOOTH_SCO             = 0x10,   // å•å£°é“è“ç‰™è€³æœºï¼Œåè¿›åˆ¶32</span><br><span class="line">    AUDIO_DEVICE_OUT_BLUETOOTH_SCO_HEADSET     = 0x20,   // è½¦è½½å…æè“ç‰™è®¾å¤‡ï¼Œåè¿›åˆ¶64</span><br><span class="line">    AUDIO_DEVICE_OUT_BLUETOOTH_SCO_CARKIT      = 0x40,   // ç«‹ä½“å£°è“ç‰™è€³æœº</span><br><span class="line">    AUDIO_DEVICE_OUT_BLUETOOTH_A2DP            = 0x80,   // åè¿›åˆ¶128</span><br><span class="line">    AUDIO_DEVICE_OUT_BLUETOOTH_A2DP_HEADPHONES = 0x100,  // åè¿›åˆ¶256</span><br><span class="line">    AUDIO_DEVICE_OUT_BLUETOOTH_A2DP_SPEAKER    = 0x200,  // åè¿›åˆ¶512</span><br><span class="line">    AUDIO_DEVICE_OUT_AUX_DIGITAL               = 0x400,  // åè¿›åˆ¶1024</span><br><span class="line">    AUDIO_DEVICE_OUT_ANLG_DOCK_HEADSET         = 0x800,  // åè¿›åˆ¶2048</span><br><span class="line">    AUDIO_DEVICE_OUT_DGTL_DOCK_HEADSET         = 0x1000, // åè¿›åˆ¶4096</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<h1 id="alsaæ’ä»¶"><a href="#alsaæ’ä»¶" class="headerlink" title="alsaæ’ä»¶"></a>alsaæ’ä»¶</h1><blockquote>
<p>asound.confé…ç½® <a href="https://www.alsa-project.org/main/index.php/Asoundrc">https://www.alsa-project.org/main/index.php/Asoundrc</a></p>
<p>æ’ä»¶è¯¦è§£å®˜ç½‘  <a href="https://www.alsa-project.org/alsa-doc/alsa-lib/pcm_plugins.html">https://www.alsa-project.org/alsa-doc/alsa-lib/pcm_plugins.html</a></p>
</blockquote>
<ol>
<li>ç”Ÿæˆalsaé…ç½®æ–‡ä»¶ : alsactl store -f a.conf</li>
<li>å¯¹äºè€³æœºçš„controlséœ€è¦æŒ‡å®š-c 1,é»˜è®¤èµ°çš„æ˜¯card 0</li>
<li>æ’­æ”¾éŸ³é¢‘çš„å‘½ä»¤ arecord -D usbheadsetC -d 5 -f cd -r 48000 -c 2 -t wav test.wav</li>
</ol>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æŸ¥çœ‹æ§ä»¶</span></span><br><span class="line"><span class="meta"># amixer -c 1 controls </span></span><br><span class="line">numid=<span class="number">3</span>,iface=MIXER,name=<span class="string">'PCM Playback Switch'</span></span><br><span class="line">numid=<span class="number">4</span>,iface=MIXER,name=<span class="string">'PCM Playback Volume'</span></span><br><span class="line">numid=<span class="number">6</span>,iface=MIXER,name=<span class="string">'usbCapture_vol'</span></span><br><span class="line">numid=<span class="number">5</span>,iface=MIXER,name=<span class="string">'usbPlay_vol'</span></span><br><span class="line">numid=<span class="number">1</span>,iface=PCM,name=<span class="string">'Capture Channel Map'</span></span><br><span class="line">numid=<span class="number">2</span>,iface=PCM,name=<span class="string">'Playback Channel Map'</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">//å¯¹æ§ä»¶è¿›è¡Œé…ç½®</span></span><br><span class="line"><span class="meta"># amixer -c 1 sget usbCapture_vol </span></span><br><span class="line">Simple mixer control <span class="string">'usbCapture_vol'</span>,<span class="number">0</span></span><br><span class="line">  Capabilities: volume</span><br><span class="line">  Playback channels: Front Left - Front Right</span><br><span class="line">  Capture channels: Front Left - Front Right</span><br><span class="line">  Limits: <span class="number">0</span> - <span class="number">255</span></span><br><span class="line">  Front Left: <span class="number">100</span> [<span class="number">39</span>%]</span><br><span class="line">  Front Right: <span class="number">100</span> [<span class="number">39</span>%]</span><br><span class="line"><span class="meta"># amixer -c 1 cget numid=5,iface=MIXER,name=<span class="string">'usbCapture_vol'</span></span></span><br><span class="line">numid=<span class="number">5</span>,iface=MIXER,name=<span class="string">'usbCapture_vol'</span></span><br><span class="line">  ; type=INTEGER,access=rw---RW-,values=<span class="number">2</span>,min=<span class="number">0</span>,max=<span class="number">255</span>,step=<span class="number">0</span></span><br><span class="line">  : values=<span class="number">100</span>,<span class="number">100</span></span><br><span class="line">  | dBscale-min=<span class="number">-20.00</span>dB,step=<span class="number">0.20</span>dB,mute=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># arecord -l</span></span><br><span class="line">**** List of CAPTURE Hardware Devices ****</span><br><span class="line">card <span class="number">0</span>: smartpenknot [smartpen_knot], device <span class="number">0</span>: i2s-ecodec nau8822-hifi<span class="number">-0</span> []</span><br><span class="line">  Subdevices: <span class="number">1</span>/<span class="number">1</span></span><br><span class="line">  Subdevice #<span class="number">0</span>: subdevice #<span class="number">0</span></span><br><span class="line">card <span class="number">0</span>: smartpenknot [smartpen_knot], device <span class="number">1</span>: dmic dmic-codec-hifi<span class="number">-1</span> []</span><br><span class="line">  Subdevices: <span class="number">1</span>/<span class="number">1</span></span><br><span class="line">  Subdevice #<span class="number">0</span>: subdevice #<span class="number">0</span></span><br><span class="line">card <span class="number">0</span>: smartpenknot [smartpen_knot], device <span class="number">2</span>: i2s-tloop pcm-dump<span class="number">-2</span> []</span><br><span class="line">  Subdevices: <span class="number">1</span>/<span class="number">1</span></span><br><span class="line">  Subdevice #<span class="number">0</span>: subdevice #<span class="number">0</span></span><br><span class="line">card <span class="number">1</span>: EP3C [Meizu EP3C], device <span class="number">0</span>: USB Audio [USB Audio]</span><br><span class="line">  Subdevices: <span class="number">1</span>/<span class="number">1</span></span><br><span class="line">  Subdevice #<span class="number">0</span>: subdevice #<span class="number">0</span></span><br><span class="line"># </span><br><span class="line"><span class="meta"># aplay -l</span></span><br><span class="line">**** List of PLAYBACK Hardware Devices ****</span><br><span class="line">card <span class="number">0</span>: smartpenknot [smartpen_knot], device <span class="number">0</span>: i2s-ecodec nau8822-hifi<span class="number">-0</span> []</span><br><span class="line">  Subdevices: <span class="number">1</span>/<span class="number">1</span></span><br><span class="line">  Subdevice #<span class="number">0</span>: subdevice #<span class="number">0</span></span><br><span class="line">card <span class="number">1</span>: EP3C [Meizu EP3C], device <span class="number">0</span>: USB Audio [USB Audio]</span><br><span class="line">  Subdevices: <span class="number">0</span>/<span class="number">1</span></span><br><span class="line">  Subdevice #<span class="number">0</span>: subdevice #<span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h1 id="ALSAéŸ³é¢‘å·¥å…·"><a href="#ALSAéŸ³é¢‘å·¥å…·" class="headerlink" title="ALSAéŸ³é¢‘å·¥å…·"></a>ALSAéŸ³é¢‘å·¥å…·</h1><p>å¯¹äºä»¥ä¸‹å·¥å…·çš„ä½¿ç”¨ï¼Œéƒ½å¯ä»¥ç›´æ¥è¾“å…¥â€œå·¥å…·åâ€æˆ–â€œå·¥å…·å â€“helpâ€ è·å¾—è¯¦ç»†ä½¿ç”¨æ–¹æ³•</p>
<h2 id="arecode-å½•éŸ³"><a href="#arecode-å½•éŸ³" class="headerlink" title="arecode å½•éŸ³"></a>arecode å½•éŸ³</h2><ol>
<li>æŸ¥çœ‹å½•éŸ³è®¾å¤‡ : arecode -l</li>
<li>å‘½ä»¤å®ä¾‹ :  arecord -D hw:0,1 -d 10 -f cd -r 44100 -c 2 -t wav test.wav</li>
<li>å‚æ•°è§£æ : <ul>
<li>-D æŒ‡å®šäº†å½•éŸ³è®¾å¤‡ï¼Œ0,1 æ˜¯card 0 device 1</li>
<li>-d æŒ‡å®šå½•éŸ³çš„æ—¶é•¿ï¼Œå•ä½ : ç§’</li>
<li>-f æŒ‡å®šé‡‡æ ·æ ¼å¼ï¼Œé€šè¿‡ä¸Šé¢çš„ä¿¡æ¯çŸ¥é“åªæ”¯æŒ cd cdr dat </li>
<li>-r æŒ‡å®šäº†é‡‡æ ·ç‡ï¼Œå•ä½ : Hz</li>
<li>-c æŒ‡å®šchannel ä¸ªæ•°</li>
<li>-t æŒ‡å®šç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼</li>
</ul>
</li>
</ol>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">lee@lee-virtual-machine:~$ arecord -l</span><br><span class="line">**** CAPTURE ç¡¬é«”è£ç½®æ¸…å–® ****</span><br><span class="line">card 0: AudioPCI [Ensoniq AudioPCI], device 0: ES1371/1 [ES1371 DAC2/ADC]</span><br><span class="line">  å­è®¾å¤‡: 1/1</span><br><span class="line">  å­è®¾å¤‡ #0: subdevice #0</span><br><span class="line">lee@lee-virtual-machine:~$ arecord -D hw:0,0 -d 10 -f cd -r 44100 -c 2 -t wav test.wav</span><br><span class="line">æ­£åœ¨å½•éŸ³ WAVE 'test.wav' : Signed 16 bit Little Endian, é¢‘ç‡44100Hzï¼Œ Stereo</span><br><span class="line">lee@lee-virtual-machine:~$ </span><br></pre></td></tr></tbody></table></figure>



<h2 id="aplay-æ”¾éŸ³"><a href="#aplay-æ”¾éŸ³" class="headerlink" title="aplay æ”¾éŸ³"></a>aplay æ”¾éŸ³</h2><ol>
<li><p>æŸ¥çœ‹æ”¾éŸ³è®¾å¤‡ : aplay -l</p>
</li>
<li><p>å‘½ä»¤å®ä¾‹ : aplay test.wav</p>
<blockquote>
<p>å¦‚æœæ˜¯ç›´æ¥æ’­æ”¾pcmæ•°æ®ï¼Œåˆ™éœ€è¦æŒ‡å®špcmæ ¼å¼ ã€é‡‡æ ·ç‡ã€channelä¸ªæ•°ç­‰ã€‚</p>
</blockquote>
</li>
</ol>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">lee@lee-virtual-machine:~$ aplay -l</span><br><span class="line">**** PLAYBACK ç¡¬é«”è£ç½®æ¸…å–® ****</span><br><span class="line">card 0: AudioPCI [Ensoniq AudioPCI], device 0: ES1371/1 [ES1371 DAC2/ADC]</span><br><span class="line">  å­è®¾å¤‡: 0/1</span><br><span class="line">  å­è®¾å¤‡ #0: subdevice #0</span><br><span class="line">card 0: AudioPCI [Ensoniq AudioPCI], device 1: ES1371/2 [ES1371 DAC1]</span><br><span class="line">  å­è®¾å¤‡: 1/1</span><br><span class="line">  å­è®¾å¤‡ #0: subdevice #0</span><br><span class="line">lee@lee-virtual-machine:~$ aplay test.wav </span><br><span class="line">æ­£åœ¨æ’­æ”¾ WAVE 'test.wav' : Signed 16 bit Little Endian, é¢‘ç‡44100Hzï¼Œ Stereo</span><br><span class="line">lee@lee-virtual-machine:~$ </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h2 id="amixer-é…å‚"><a href="#amixer-é…å‚" class="headerlink" title="amixer é…å‚"></a>amixer é…å‚</h2><p>amixerï¼Œæ˜¯alsamixerçš„æ–‡æœ¬æ¨¡å¼ï¼ˆå‘½ä»¤è¡Œæ¨¡å¼ï¼‰ç”¨äºé…ç½®éŸ³é¢‘çš„å„ä¸ªå‚æ•°</p>
<ol>
<li><p>ä½¿ç”¨æ–¹æ³• :</p>
<ol>
<li><p>ç”¨ # amixer controls åˆ—å‡ºæ‰€æœ‰æ§åˆ¶é¡¹ã€‚( æ˜¾ç¤ºæ¥å£å‡½æ•° )</p>
</li>
<li><p>å¦‚æœå¯¹æ§åˆ¶é¡¹ä¸ç†Ÿæ‚‰æˆ–è€…æƒ³æŸ¥çœ‹å½“å‰çš„æ‰€æœ‰é…ç½®å¯ä»¥ä½¿ç”¨ # amixer contents å‘½ä»¤ã€‚(æ˜¾ç¤ºå½“å‰é…ç½®)</p>
</li>
<li><p>æŸ¥çœ‹è·å–æŸä¸ªè®¾ç½®é¡¹çš„å€¼ç”¨ # amixer cget + æ§åˆ¶å‚æ•° å‘½ä»¤ã€‚ è¿™é‡Œæ§åˆ¶å‚æ•°ç›´æ¥å¤åˆ¶ # amixer controls æ‰“å°å‡ºæ¥çš„æ•°æ®å°±å¯ä»¥</p>
</li>
<li><p>æ ¹æ®æ§åˆ¶å‚æ•°ç±»å‹è®¾ç½®æ§åˆ¶å‚æ•°ä½¿ç”¨ # amixer cset + æ§åˆ¶å‚æ•° + è®¾ç½®å‚æ•° å‘½ä»¤ã€‚</p>
</li>
<li><p>values è¡¨ç¤ºæ•°å€¼å¯¹äº volume ä¹‹ç±»çš„æ˜¯å…·ä½“çš„æ•°å­—ï¼Œåœ¨ä¸Šä¸‹æ–‡èœå•ä¸­æœ‰æ˜¾ç¤ºæ•°å€¼çš„èŒƒå›´ï¼Œå¯¹äº switch ä¹‹ç±»çš„è¡¨ç¤ºå¼€å…³ä¸€èˆ¬æ˜¯ on æˆ– offã€‚</p>
<p>å¦å¤–ä¸€sget/ssetç³»åˆ—çš„å‘½ä»¤, ä¸cget/csetçš„ä½¿ç”¨ç›¸åŒ</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨ä¾‹å­:</span></span><br><span class="line"><span class="comment">//ç»™çš„å‚æ•°çœ‹valueéœ€è¦å‡ ä¸ª éœ€è¦ä»€ä¹ˆç±»å‹è¿›è¡Œç›¸åº”çš„é…ç½®å³å¯</span></span><br><span class="line">/ <span class="meta"># amixer cget numid=43,iface=MIXER,name=<span class="string">'Speaker Playback Volum'</span></span></span><br><span class="line">numid=<span class="number">43</span>,iface=MIXER,name=<span class="string">'Speaker Playback Volume'</span></span><br><span class="line">  ; type=INTEGER,access=rw---R--,values=<span class="number">2</span>,min=<span class="number">0</span>,max=<span class="number">63</span>,step=<span class="number">0</span></span><br><span class="line">  : values=<span class="number">63</span>,<span class="number">63</span></span><br><span class="line">  | dBscale-min=<span class="number">-57.00</span>dB,step=<span class="number">1.00</span>dB,mute=<span class="number">0</span></span><br><span class="line">/ # </span><br><span class="line">/ # </span><br><span class="line">/ # </span><br><span class="line">/ <span class="meta"># amixer cset numid=43,iface=MIXER,name=<span class="string">'Speaker Playback Volum'</span> 30 30 </span></span><br><span class="line">numid=<span class="number">43</span>,iface=MIXER,name=<span class="string">'Speaker Playback Volume'</span></span><br><span class="line">  ; type=INTEGER,access=rw---R--,values=<span class="number">2</span>,min=<span class="number">0</span>,max=<span class="number">63</span>,step=<span class="number">0</span></span><br><span class="line">  : values=<span class="number">30</span>,<span class="number">30</span></span><br><span class="line">  | dBscale-min=<span class="number">-57.00</span>dB,step=<span class="number">1.00</span>dB,mute=<span class="number">0</span></span><br><span class="line">/ # </span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
<li><p>ä¿å­˜åŠæ¢å¤æ–¹æ³•</p>
<p>å¯¹å£°å¡ä¿¡æ¯çŠ¶æ€è¿›è¡Œä¿å­˜ : alsactl store -f /var/lib/alsa/asound.state </p>
<p>å£°å¡çŠ¶æ€æ¢å¤å‘½ä»¤ : alsactl restore -f /var/lib/alsa/asound.state</p>
</li>
</ol>
<h2 id="LinuxéŸ³é¢‘åˆ†æå·¥å…·"><a href="#LinuxéŸ³é¢‘åˆ†æå·¥å…·" class="headerlink" title="LinuxéŸ³é¢‘åˆ†æå·¥å…·"></a>LinuxéŸ³é¢‘åˆ†æå·¥å…·</h2><ol>
<li><p>audacity</p>
<ul>
<li><p>åŠŸèƒ½ï¼šæŸ¥çœ‹å„ç§æ ¼å¼éŸ³é¢‘çš„æ³¢å½¢ï¼Œå¹¶æœ‰è£å‰ªã€è½¬æ¢æ ¼å¼ã€ç”Ÿæˆç‰¹å®šéŸ³é¢‘æ•°æ®ç­‰è¯¸å¤šåŠŸèƒ½</p>
</li>
<li><p>ä¸‹è½½æ–¹æ³• : sudo apt install audacity -o Acquire::http::proxy=â€<a href="http://192.168.4.15:8080/&quot;">http://192.168.4.15:8080/"</a>( -o å‚æ•°æŒ‡å®šä»£ç†)</p>
</li>
<li><p>ä½¿ç”¨æ–¹æ³•ï¼šå‘½ä»¤è¡Œè¾“å…¥audacityï¼Œæ·»åŠ éŸ³é¢‘æ–‡ä»¶å³å¯</p>
</li>
</ul>
</li>
<li><p>play</p>
<ul>
<li>ç”±äºaplayæ’­æ”¾æ•°æ®æ ¼å¼æœ‰é™ï¼Œplayå¯¹äºéŸ³é¢‘æ•°æ®æ ¼å¼è¿›è¡Œäº†è¾ƒå¤šçš„æ”¯æŒ</li>
<li>playæ’­æ”¾è£¸æ•°æ®å‘½ä»¤ : play -t raw -r 16000 -e signed-integer -b 16 -c 1 test.wav</li>
</ul>
</li>
</ol>
<h1 id="APIä½¿ç”¨"><a href="#APIä½¿ç”¨" class="headerlink" title="APIä½¿ç”¨"></a>APIä½¿ç”¨</h1><p>ä»£ç é“¾æ¥ï¼š<a href="https://github.com/yangLieee/audioplayer">https://github.com/yangLieee/audioplayer</a></p>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>Qï¼šæ•°æ®å­˜å‚¨å‡ºæ¥åªæœ‰78å­—èŠ‚ï¼Œä½†æ˜¯å†™å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Ÿ</p>
<p>Aï¼šè¿™åªæ˜¯å†™äº†ä¸€ä¸ªæ–‡ä»¶å¤´ï¼Œè€Œæœ€ç»ˆæ–‡ä»¶æ²¡æœ‰å†™å…¥ã€‚åŸå› æ˜¯ï¼šavio_openä¹‹åæ²¡æœ‰å…³é—­ï¼Œè°ƒç”¨closepå‡½æ•°ä¹‹åæ•°æ®æ­£å¸¸å†™å…¥;</p>
<p>â€‹		è°ƒè¯•æµç¨‹ï¼šé¦–å…ˆå®šä½é—®é¢˜ä½ç½®ã€‚åœ¨alsaå½•éŸ³å®Œæˆä¹‹åå°†æ•°æ®å†™å…¥bufferä¸­å­˜å‚¨æ¥çœ‹æ˜¯å¦æ˜¯alsaéƒ¨åˆ†çš„å½•éŸ³é—®é¢˜ã€‚ä¹‹åæ ¹æ®æµç¨‹è¿›è¡Œæ£€æŸ¥ã€‚ä¸€å®šè¦æ³¨æ„open close / new delete / ç­‰é…å¥—çš„ä½¿ç”¨</p>
</li>
<li><p>æ•°æ®å·²ç»å†™ç»“æŸ ä½†æ˜¯è¿˜æ˜¯ä¼šå†æ¬¡æ‰§è¡Œä¸€æ¬¡å…¶ä¸Šé¢çš„ç¨‹åº</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(fmtContext)                                                                    </span><br><span class="line">       av_write_trailer(fmtContext);</span><br><span class="line"><span class="keyword">if</span>(fmtContext != <span class="literal">NULL</span>){   </span><br><span class="line">   <span class="keyword">if</span>( avio_closep(&amp;fmtContext-&gt;pb) &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"avio_closep error!"</span>);</span><br><span class="line">   avformat_free_context(fmtContext);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">av_write_trailerçš„ä½œç”¨</span></span><br><span class="line"><span class="comment">	1. å¾ªç¯è°ƒç”¨interleave_packet()ä»¥åŠwrite_packet()ï¼Œå°†è¿˜æœªè¾“å‡ºçš„AVPacketè¾“å‡ºå‡ºæ¥ã€‚</span></span><br><span class="line"><span class="comment">	2. è°ƒç”¨AVOutputFormatçš„write_trailer()ï¼Œè¾“å‡ºæ–‡ä»¶å°¾ã€‚</span></span><br><span class="line"><span class="comment">avio_closepçš„ä½œç”¨</span></span><br><span class="line"><span class="comment">	å…³é—­è¾“å‡ºæ–‡ä»¶çš„ä¸Šä¸‹æ–‡,ä¸avio_openç›¸å¯¹åº”ä½¿ç”¨</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">è¿™ä¸¤ä¸ªçš„ä½¿ç”¨éœ€è¦ä¿è¯av_write_trailerå‡½æ•°è°ƒç”¨æ—©äºavio_closep</span></span><br><span class="line"><span class="comment">å¦‚æœä¸è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ä¼šå¯¼è‡´æœ€ç»ˆæ–‡ä»¶ä¸èƒ½å†™å‡º</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>Qï¼šé‡é‡‡æ ·æ—¶ channel å¯ä»¥æ­£å¸¸è½¬æ¢, sample_rateé‡‡æ ·ç‡å˜åŒ–ä¸èƒ½è½¬æ¢?</p>
<p>Aï¼šåœ¨åšé‡‡æ ·ç‡çš„é‡é‡‡æ ·æ—¶, å¯¹è¾“å‡ºçš„contexté…ç½®éœ€è¦å°†é‡‡æ ·ç‚¹ä¹Ÿåšä¸€ä¸‹è½¬æ¢,å¦åˆ™å·²ç»è½¬æ¢æˆåŠŸä½†æ˜¯ç”Ÿæˆçš„æ–‡ä»¶å¤§å°è¿˜æ˜¯æŒ‰ç…§ä»¥å‰çš„è¾“å‡ºè¿›è¡Œ.<br>  é‡‡æ ·ç‚¹è½¬æ¢å‡½æ•° : av_rescale_rnd(iFrame-&gt;nb_samples, oSampleRate, iSampleRate, AV_ROUND_UP);</p>
</li>
<li><p>Q : å½•éŸ³ä¹‹åå£°éŸ³å¤ªå°, ç”šè‡³æœ‰æ—¶å€™å¬ä¸åˆ°, éœ€è¦å¦‚ä½•è°ƒæ•´? </p>
<p>A : é€šè¿‡amixerå‚æ•°è¿›è¡Œç›¸åº”çš„é…ç½®</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">/storage/recode <span class="meta"># amixer cset numid=53,iface=MIXER,name=<span class="string">'DMIC GAIN'</span> 15</span></span><br><span class="line">numid=<span class="number">53</span>,iface=MIXER,name=<span class="string">'DMIC GAIN'</span></span><br><span class="line">  ; type=INTEGER,access=rw---R--,values=<span class="number">1</span>,min=<span class="number">0</span>,max=<span class="number">31</span>,step=<span class="number">0</span></span><br><span class="line">  : values=<span class="number">15</span></span><br><span class="line">  | dBscale-min=<span class="number">0.00</span>dB,step=<span class="number">3.00</span>dB,mute=<span class="number">0</span></span><br><span class="line"><span class="comment">//è¿™ä¸ªæ­¥éª¤çš„ä½œç”¨æ˜¯, å°†dmicçš„å¢ç›Šè°ƒæ•´ä¸º15 </span></span><br></pre></td></tr></tbody></table></figure>


</li>
<li><p>Q:  è€³æœºéŸ³é‡å°ä½†æ˜¯amixeræ²¡æœ‰ç›¸å…³å¯ä»¥é…ç½®çš„å‚æ•°?</p>
<p>A : é€šè¿‡asound.confé…ç½®æ–°çš„æ’ä»¶, </p>
<p><a href="https://alsa.opensrc.org/How_to_use_softvol_to_control_the_master_volume">https://alsa.opensrc.org/How_to_use_softvol_to_control_the_master_volume</a></p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™ï¼ˆåŒ…å«FFmpegï¼‰"><a href="#å‚è€ƒèµ„æ–™ï¼ˆåŒ…å«FFmpegï¼‰" class="headerlink" title="å‚è€ƒèµ„æ–™ï¼ˆåŒ…å«FFmpegï¼‰"></a>å‚è€ƒèµ„æ–™ï¼ˆåŒ…å«FFmpegï¼‰</h1><blockquote>
<p>æ³¨ï¼šå¦‚æœåç»­å¦‚æ¶‰åŠåˆ°FFmpegæ–‡ç« ï¼Œå†å°†è¯¥éƒ¨åˆ†å†…å®¹ç§»é™¤ï¼Œä»¥ä¸‹æ–‡ç« æ˜¯åœ¨å·¥ä½œçš„å¼€å‘ä¸­æœ‰å¸®åŠ©åˆ°è‡ªå·±</p>
</blockquote>
<ul>
<li><p><a href="https://mp.weixin.qq.com/s/1TJQc3Ktdw_Qz576iLjB1Q">ALSAï¼ˆé«˜çº§Linuxå£°éŸ³æ¶æ„ï¼‰æµ…æ</a></p>
</li>
<li><p><a href="https://wenku.baidu.com/view/dacb0922af45b307e87197a2.html">ALSAæ¡†æ¶ä»‹ç»â€”â€”éŸ³é¢‘é€šè·¯</a></p>
</li>
<li><p><a href="https://magodo.github.io/alsa-pcm/#0-pcm">ALSA - PCMæ¥å£</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/jason-lu/archive/2013/06/07/3123750.html">Linux ALSAæ¡†æ¶ä¹‹ä¸‰:PCMè®¾å¤‡çš„åˆ›å»º </a></p>
</li>
<li><p><a href="https://blog.csdn.net/leixiaohua1020/article/details/44116215">FFmpegæºä»£ç ç®€å•åˆ†æ</a></p>
</li>
<li><p><a href="https://blog.csdn.net/BrookIcv/article/details/53490799">FFmpeg ä¸­AVPacketçš„ä½¿ç”¨</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Audio</category>
      </categories>
      <tags>
        <tag>ALSA</tag>
      </tags>
  </entry>
  <entry>
    <title>Libmadè¯¦è§£</title>
    <url>/2022/11/05/Audio/Audio-libmad/</url>
    <content><![CDATA[<p>ç®€å•æ¥è®²ï¼Œlibmadå°±æ˜¯ä¸€ä¸ªMP3æ–‡ä»¶çš„è§£ç åº“ã€‚å¦‚æœæƒ³è¦æ·±å…¥ç†è§£å…¶ä¸­çš„å®ç°éœ€è¦å¯¹MP3æ–‡ä»¶æ ¼å¼æœ‰è¯¦ç»†çš„äº†è§£ï¼Œå…³äºMP3æ–‡ä»¶æ ¼å¼çš„å†…å®¹åœ¨è¿™é‡Œæˆ‘ä¸èµ˜è¿°ï¼Œä¹‹å‰çš„æ–‡ç« å½“ä¸­æœ‰è¿‡è¯¦ç»†çš„è®²è§£ <a href="https://yanglieee.com/2022/09/05/Audio-meet-1/">click here</a></p>
<h1 id="What"><a href="#What" class="headerlink" title="What"></a>What</h1><blockquote>
<p>Libmad è¯¦è§£ï¼š<a href="https://www.underbit.com/products/mad/">https://www.underbit.com/products/mad/</a></p>
</blockquote>
<p> libmad æ˜¯ä¸€ä¸ªé«˜è´¨é‡çš„ MPEG éŸ³é¢‘è§£ç å™¨ã€‚ç›®å‰æ”¯æŒ  MPEG-1 å’Œ MPEG-2 å¯¹è¾ƒä½é‡‡æ ·é¢‘ç‡çš„æ‰©å±•ï¼Œä»¥åŠæ‰€è°“çš„ MPEG 2.5 æ ¼å¼ï¼Œä¸‰ä¸ªéŸ³é¢‘å±‚éƒ½åœ¨ä»£ç ä¸Šåšäº†å®ç°ã€‚ä¼˜åŠ¿ï¼š</p>
<ul>
<li>24 ä½ PCM è¾“å‡º</li>
<li>100% å®šç‚¹ï¼ˆæ•´æ•°ï¼‰è®¡ç®—</li>
<li>åŸºäº ISO/IEC æ ‡å‡†çš„å…¨æ–°å®æ–½</li>
<li>æ ¹æ® GNU é€šç”¨å…¬å…±è®¸å¯è¯ (GPL) çš„æ¡æ¬¾åˆ†å‘</li>
</ul>
<h1 id="How"><a href="#How" class="headerlink" title="How"></a>How</h1><h2 id="ä»£ç ä¸‹è½½"><a href="#ä»£ç ä¸‹è½½" class="headerlink" title="ä»£ç ä¸‹è½½"></a>ä»£ç ä¸‹è½½</h2><p><a href="https://sourceforge.net/projects/mad/files/">https://sourceforge.net/projects/mad/files/</a></p>
<p><a href="https://www.linuxfromscratch.org/blfs/view/svn/multimedia/libmad.html">https://www.linuxfromscratch.org/blfs/view/svn/multimedia/libmad.html</a></p>
<h2 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><p>&lt; åŸºäº libmad-0.15.1b ç‰ˆæœ¬&gt;</p>
<table>
<thead>
<tr>
<th>æºæ–‡ä»¶</th>
<th>bit.c</th>
<th>decoder.c</th>
<th>fixed.c</th>
<th>frame.c</th>
<th>huffman.c</th>
<th>layer12.c</th>
<th>layer3.c</th>
<th>stream.c</th>
<th>synth.c</th>
<th>timer.c</th>
<th>version.c</th>
<th>minimad.c(demo)</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>å¤´æ–‡ä»¶</td>
<td>bit.h</td>
<td>decoder.h</td>
<td>fixed.h</td>
<td>frame.h</td>
<td>huffman.h</td>
<td>layer12.h</td>
<td>layer3.h</td>
<td>stream.h</td>
<td>synth.h</td>
<td>timer.h</td>
<td>version.h</td>
<td>global.h</td>
<td>mad.hï¼ˆAPIï¼‰</td>
</tr>
<tr>
<td>datæ–‡ä»¶</td>
<td>sf_table.dat</td>
<td>imdct_s.dat</td>
<td>qc_table.dat</td>
<td>D.dat</td>
<td>rq_table.dat</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>å…¶ä»–æ–‡ä»¶</td>
<td>Makefile</td>
<td>config</td>
<td>â€¦â€¦</td>
<td></td>
<td>å¤§éƒ¨åˆ†å†…å®¹ä¸å‚ä¸ç¼–è¯‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>å…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒminimad.cæ–‡ä»¶ï¼Œè¿™é‡Œé¢å¯¹apiçš„ä½¿ç”¨æœ‰è¿›ä¸€æ­¥çš„è¯´æ˜</p>
<p>åŒæ—¶ä¹Ÿå¯ä»¥å‚è€ƒæˆ‘åŸºäºLinux libmadå†™å‡ºæ¥çš„ä¸€ä¸ªéŸ³é¢‘æ’­æ”¾å™¨ï¼Œæºç é“¾æ¥ <a href="https://github.com/yangLieee/audioplayer">click here</a></p>
<h1 id="ç¼–è¯‘æ–¹æ³•"><a href="#ç¼–è¯‘æ–¹æ³•" class="headerlink" title="ç¼–è¯‘æ–¹æ³•"></a>ç¼–è¯‘æ–¹æ³•</h1><p>&lt; ä»…ä»‹ç»linuxç¯å¢ƒä¸‹ç¼–è¯‘æ–¹æ³• &gt; </p>
<ol>
<li>æ‰‹å†™Makefile / CMakeLists.txt</li>
<li>ç³»ç»Ÿæä¾›çš„config<ul>
<li>æ‰§è¡Œ <strong>sed -i â€˜/-fforce-mem/dâ€™ configure</strong> ï¼Œ è¿™æ¡å‘½ä»¤æ˜¯ä¸ºäº†é€‚é…é«˜ç‰ˆæœ¬çš„gccï¼Œå› ä¸ºé«˜ç‰ˆæœ¬çš„gccå·²ç»å°†-fforce-memå»é™¤äº†</li>
<li>æ‰§è¡Œ <strong>./configure ,</strong> æ–‡ä»¶å¤¹ä¸‹ä¼šç”ŸæˆMakefile</li>
<li>æ‰§è¡Œ <strong>sudo make; sudo install;</strong> </li>
<li>è‡³æ­¤é™æ€åº“å’ŒåŠ¨æ€åº“å·²ç»ç”Ÿæˆï¼Œç›®å½•åœ¨/usr/local/lib</li>
</ul>
</li>
</ol>
<h1 id="æ ¸å¿ƒAPI"><a href="#æ ¸å¿ƒAPI" class="headerlink" title="æ ¸å¿ƒAPI"></a>æ ¸å¿ƒAPI</h1><ol>
<li><p>mad_decoder_init( )</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//mad.h</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">mad_decoder_init</span><span class="params">(<span class="keyword">struct</span> mad_decoder *, <span class="type">void</span> *,   </span></span><br><span class="line"><span class="params">           <span class="comment">/* input func  */</span>  <span class="keyword">enum</span> mad_flow (*)(<span class="type">void</span> *, <span class="keyword">struct</span> mad_stream *), </span></span><br><span class="line"><span class="params">           <span class="comment">/* header func */</span>  <span class="keyword">enum</span> mad_flow (*)(<span class="type">void</span> *, <span class="keyword">struct</span> mad_header <span class="type">const</span> *),                   </span></span><br><span class="line"><span class="params">           <span class="comment">/* filter func */</span>  <span class="keyword">enum</span> mad_flow (*)(<span class="type">void</span> *, <span class="keyword">struct</span> mad_stream <span class="type">const</span> *, <span class="keyword">struct</span> mad_frame *), </span></span><br><span class="line"><span class="params">           <span class="comment">/* output func */</span>  <span class="keyword">enum</span> mad_flow (*)(<span class="type">void</span> *, <span class="keyword">struct</span> mad_header <span class="type">const</span> *, <span class="keyword">struct</span> mad_pcm *), </span></span><br><span class="line"><span class="params">           <span class="comment">/* error func  */</span>  <span class="keyword">enum</span> mad_flow (*)(<span class="type">void</span> *, <span class="keyword">struct</span> mad_stream *, <span class="keyword">struct</span> mad_frame *), </span></span><br><span class="line"><span class="params">           <span class="comment">/* message func*/</span>  <span class="keyword">enum</span> mad_flow (*)(<span class="type">void</span> *, <span class="type">void</span> *, <span class="type">unsigned</span> <span class="type">int</span> *))</span>; </span><br></pre></td></tr></tbody></table></figure>

<p>mad_decoder_init( )æ˜¯libmadä¸­æœ€ç»ˆé‡è¦çš„å‡½æ•°ä¹‹ä¸€ï¼Œå…¶ä½œç”¨æ˜¯å°†line3~line8çš„å…­ä¸ªå›è°ƒå‡½æ•°æ³¨å†Œåˆ°mad_decoderå®ä¾‹å‡ºæ¥çš„decoderä¸­ã€‚</p>
<ul>
<li><p><strong>å¿…é¡»è‡ªå®šä¹‰çš„å‚æ•°ï¼š</strong>å‚æ•°1ï¼šç”¨æˆ·è‡ªå·±å®ä¾‹çš„ä¸€ä¸ªè§£ç å™¨ç»“æ„ä½“ï¼›å‚æ•°2ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå°†ç”¨äºæ•´ä¸ªè§£ç çš„è¿‡ç¨‹åœ¨å›è°ƒå‡½æ•°ä¹‹é—´è¿›è¡Œæ•°æ®çš„ä¼ è¾“ï¼›å‚æ•°3ï¼šè¾“å…¥çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒç”¨äºç”¨æˆ·è‡ªå®šä¹‰å°†æ•°æ®è¾“å…¥ç¼–ç å™¨çš„é€»è¾‘ï¼›å‚æ•°6ï¼šè¾“å‡ºçš„å›è°ƒå‡½æ•°ï¼ŒåŒinput callback funcã€‚è‡ªå®šä¹‰è¾“å‡ºçš„åˆ†è¾¨ç‡å§ï¼š24bit / 16bitï¼Œå¯ä»¥å­˜æˆæ–‡ä»¶äº¦å¯ä»¥ç›´æ¥é€šè¿‡pcmæ¥å£æ’­æ”¾ã€‚Outputå›è°ƒå‡½æ•°åœ¨madlibæ¯è§£ç å®Œæˆä¸€ä¸ªå¸§åè¢«è°ƒç”¨ï¼Œç›´åˆ°å…¨éƒ¨è§£ç å®Œæˆæˆ–å‡ºé”™ã€‚å‚æ•°8ï¼ˆå¼‚æ­¥å·¥ä½œæ¨¡å¼ä¸‹å¿…é€‰ï¼‰ï¼šè¾“å‡ºä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>é€‰æ‹©æ€§å®šä¹‰å‚æ•°ï¼š</strong>å…¶ä»–å‚æ•°å±äºè‡ªå®šä¹‰å‚æ•°æ¯”å¦‚è¿›è¡Œå¤´è§£æã€è¿‡æ»¤ç­›é€‰çš„å›è°ƒå‡½æ•°ç­‰ç­‰ï¼Œå¦‚æœè‡ªå·±æ²¡æœ‰éœ€æ±‚ç½®0å³å¯ã€‚</p>
</li>
</ul>
</li>
<li><p>mad_decoder_run( )</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//mad.h</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mad_decoder_run</span><span class="params">(<span class="keyword">struct</span> mad_decoder *, <span class="keyword">enum</span> mad_decoder_mode)</span>; </span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥å‡½æ•°æ˜¯è§£ç çš„ä¸»æµç¨‹å‡½æ•°ï¼Œå³è§£ç å™¨çš„å…¥å£å‡½æ•°ï¼Œå¦‚æœè¦è¿½ä»£ç å¯ä»¥ä»æ­¤å¤„å¼€å§‹è¿›è¡Œå‰–æã€‚</p>
<ul>
<li>å‚æ•°1ï¼šç”¨æˆ·è‡ªå®šä¹‰å®ä¾‹åŒ–å¹¶åˆå§‹åŒ–çš„è§£ç å™¨decoderï¼›</li>
<li>å‚æ•°2ï¼šé€‰æ‹©è§£ç æ¨¡å¼ï¼ˆSYNC / ASYNCï¼‰æ·±å…¥ä»£ç å¯ä»¥å‘ç°è¿™ä¸ªé€‰æ‹©ä½¿å¾—è§£ç å™¨è¿›å…¥ä¸åŒçš„å‡½æ•°è¿›è¡Œå·¥ä½œã€‚</li>
</ul>
<p>æ‰€è°“åŒæ­¥æ–¹å¼æ˜¯æŒ‡è§£ç å‡½æ•°åœ¨è§£ç å®Œä¸€å¸§åæ‰è¿”å›å¹¶å¸¦å›å‡ºé”™ä¿¡æ¯ï¼Œå¼‚æ­¥æ–¹å¼æ˜¯æŒ‡è§£ç å‡½æ•°åœ¨è°ƒç”¨åç«‹å³è¿”å›ï¼Œé€šè¿‡æ¶ˆæ¯ä¼ é€’è§£ç çŠ¶æ€ä¿¡æ¯ã€‚(æ•…å¼‚æ­¥æ–¹å¼å¿…é¡»å®šä¹‰messageå›è°ƒå‡½æ•°)</p>
</li>
<li><p>mad_decoder_finish( )</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//mad.h</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mad_decoder_finish</span><span class="params">(<span class="keyword">struct</span> mad_decoder *)</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>è§£ç ç»“æŸï¼Œç”¨äºæ¸…ç†å·¥ä½œï¼Œé‡Šæ”¾ä¸æµç›¸å…³çš„ä»»ä½•åŠ¨æ€å†…å­˜ã€‚</p>
</li>
<li><p>mad_stream_buffer( )</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//mad.h</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">mad_stream_buffer</span><span class="params">(<span class="keyword">struct</span> mad_stream *, <span class="type">unsigned</span> <span class="type">char</span> <span class="type">const</span> *, <span class="type">unsigned</span> <span class="type">long</span>)</span>; </span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥å‡½æ•°æ˜¯inputå›è°ƒå‡½æ•°ä¸­æœ€é‡è¦çš„å‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯æŒ‰ç…§å‚æ•°2ã€å‚æ•°3å³MP3æ–‡ä»¶åœ¨å†…å­˜æ˜ åƒçš„èµ·å§‹åœ°å€å’Œæœ¬æ¬¡è¦ä¼ é€’çš„æ–‡ä»¶é•¿åº¦ä¸mad_streamè¿›è¡Œå…³è”ï¼Œå½¢æˆlibmadå¯è¯†åˆ«çš„streamæµ</p>
<p>éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œä¼ é€’å¤šå°‘æ•°æ®å®Œå…¨æ˜¯è‡ªå®šä¹‰çš„ã€‚å¦‚æœä¸€æ¬¡æ€§é€å…¥åˆ™æ•´ä¸ªè§£ç è¿‡ç¨‹è°ƒç”¨ä¸€æ¬¡inputï¼›å¦‚æœä¸€æ¬¡æ€§ä¼ é€’è‹¥å¹²ï¼Œoutputæ ¹æ®ä¼ é€’çš„æ•°æ®è¿›è¡Œè§£ç ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®å¯è§£ç»§ç»­è°ƒç”¨inputã€‚æ‰€ä»¥è‡ªå·±å®šä¹‰å¥½è¾“å…¥é€»è¾‘å³å¯ã€‚</p>
</li>
</ol>
<h1 id="é‡ç‚¹æ•°æ®ç»“æ„"><a href="#é‡ç‚¹æ•°æ®ç»“æ„" class="headerlink" title="é‡ç‚¹æ•°æ®ç»“æ„"></a>é‡ç‚¹æ•°æ®ç»“æ„</h1><ol>
<li><p>mad_stream</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//mad.h &amp;&amp; stream.h</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mad_stream</span> {</span>           </span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> <span class="type">const</span> *buffer;          <span class="comment">/* input bitstream buffer */</span>                                       <span class="type">unsigned</span> <span class="type">char</span> <span class="type">const</span> *bufend;          <span class="comment">/* end of buffer */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> skiplen;                <span class="comment">/* bytes to skip before next frame */</span></span><br><span class="line">  <span class="type">int</span> sync;                             <span class="comment">/* stream sync found */</span>        </span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> freerate;               <span class="comment">/* free bitrate (fixed) */</span>     </span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> <span class="type">const</span> *this_frame;      <span class="comment">/* start of current frame */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> <span class="type">const</span> *next_frame;      <span class="comment">/* start of next frame */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">mad_bitptr</span> <span class="title">ptr</span>;</span>                <span class="comment">/* current processing bit pointer */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">mad_bitptr</span> <span class="title">anc_ptr</span>;</span>            <span class="comment">/* ancillary bits pointer */</span>   </span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> anc_bitlen;              <span class="comment">/* number of ancillary bits */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="title function_">char</span> <span class="params">(*main_data)</span>[MAD_BUFFER_MDLEN];                  <span class="comment">/* Layer III main_data() */</span>    </span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> md_len;                  <span class="comment">/* bytes in main_data */</span>  </span><br><span class="line">  <span class="type">int</span> options;                          <span class="comment">/* decoding options (see below) */</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">mad_error</span> <span class="title">error</span>;</span>                 <span class="comment">/* error code (see above) */</span>   </span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥ç»“æ„ä½“è®°å½•äº†æ–‡ä»¶çš„åœ°å€ã€å½“å‰æ‰€å¤„ç†çš„ä½ç½®å’Œè§£ç å‰çš„Bitstreamæ•°æ®</p>
<p>mad_stream.bufend â€“ mad_stream.next_frameå°±æ˜¯å‰©ä½™çš„æœªè¢«è§£ç çš„ MPEG å¸§çš„æ•°æ®çš„å­—èŠ‚æ•°é‡ï¼ˆå‡è®¾æ­¤å¸§åœ¨ç¼“å†²åŒºä¸­ä¸å®Œæ•´)</p>
</li>
<li><p>mad_header</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mad_header</span> {</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">mad_layer</span> <span class="title">layer</span>;</span>             <span class="comment">/* audio layer (1, 2, or 3) */</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">mad_mode</span> <span class="title">mode</span>;</span>               <span class="comment">/* channel mode (see above) */</span></span><br><span class="line">  <span class="type">int</span> mode_extension;               <span class="comment">/* additional mode info */</span>                                             <span class="class"><span class="keyword">enum</span> <span class="title">mad_emphasis</span> <span class="title">emphasis</span>;</span>       <span class="comment">/* de-emphasis to use (see above) */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> bitrate;            <span class="comment">/* stream bitrate (bps) */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> samplerate;          <span class="comment">/* sampling frequency (Hz) */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> crc_check;         <span class="comment">/* frame CRC accumulator */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> crc_target;        <span class="comment">/* final target CRC checksum */</span></span><br><span class="line">  <span class="type">int</span> flags;                        <span class="comment">/* flags (see below) */</span></span><br><span class="line">  <span class="type">int</span> private_bits;                 <span class="comment">/* private bits (see below) */</span></span><br><span class="line">  <span class="type">mad_timer_t</span> duration;             <span class="comment">/* audio playing time of frame */</span></span><br><span class="line">};    </span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡æ³¨é‡Šå¾ˆå®¹æ˜“çœ‹å‡ºï¼Œè¯¥ç»“æ„ä½“è®°å½•äº†MPEG å¸§çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚MPEG å±‚æ•°ã€å£°é“æ¨¡å¼ã€æµæ¯”ç‰¹ç‡ã€é‡‡æ ·ç‡ã€æ¯”ç‰¹ç‡ä»¥åŠæŸäº›æ ¡éªŒä½ç­‰ç­‰ã€‚</p>
<blockquote>
<p>Tipsï¼šï¼ˆbitrate % 32ï¼‰ å¦‚æœæ˜¯æ•´æ•°è¯´æ˜è¯¥æ–‡ä»¶æ ¼å¼æ˜¯CBRï¼ˆconstant bitrateï¼Œæ’å®šæ¯”ç‰¹ç‡ï¼‰ï¼Œå¦åˆ™æ˜¯VBRï¼ˆvariable bitrateï¼Œå¯å˜æ¯”ç‰¹ç‡ï¼‰ï¼Œè¿™å¯¹æ–‡ä»¶æ’­æ”¾æ—¶é•¿æ˜¯æœ‰å½±å“çš„ã€‚</p>
</blockquote>
</li>
<li><p>mad_pcm</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mad_pcm</span> {</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> samplerate;          <span class="comment">/* sampling frequency (Hz) */</span>                                           <span class="type">unsigned</span> <span class="type">short</span> channels;          <span class="comment">/* number of channels */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> length;            <span class="comment">/* number of samples per channel */</span></span><br><span class="line">  <span class="type">mad_fixed_t</span> samples[<span class="number">2</span>][<span class="number">1152</span>];     <span class="comment">/* PCM output samples [ch][sample] */</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>madlibè§£ç å™¨æ˜¯ä»¥å¸§ä¸ºå•ä½è¿›è¡Œè§£ç çš„ï¼Œmad_pcmæ¯æ¬¡æœ€å¤šè§£ç å‡ºï¼ˆ1152 * channelsï¼‰ä¸ªPCMæ•°æ®ï¼Œæ¯ä¸ªé‡‡æ ·ç‚¹ç”¨intï¼ˆ32bitï¼‰è¡¨å¾ä½†æ˜¯åªç”¨äº†å…¶ä¸­çš„24bitï¼Œè‡³æ­¤å¯ä»¥ç›´æ¥è¾“å‡ºæ•°æ®ä¿å­˜æ–‡ä»¶æˆ–è€…ç›´æ¥è°ƒç”¨éŸ³é¢‘æ’­æ”¾çš„APIè¿›è¡Œæ’­æ”¾ã€‚ä½†ç›®å‰å¤§å¤šæ•°codecæ”¯æŒçš„æ˜¯16bité‡åŒ–åˆ†è¾¨ç‡ï¼Œæ‰€ä»¥åœ¨è¾“å‡ºæ—¶å°†æ•°æ®é¥±å’Œåˆ°16bitè¿›è¡Œè¾“å‡ºã€‚</p>
</li>
<li><p>mad_flow</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">mad_flow</span> {</span></span><br><span class="line">  MAD_FLOW_CONTINUE = <span class="number">0x0000</span>,   <span class="comment">/* continue normally */</span>                                                     MAD_FLOW_STOP     = <span class="number">0x0010</span>,   <span class="comment">/* stop decoding normally */</span></span><br><span class="line">  MAD_FLOW_BREAK    = <span class="number">0x0011</span>,   <span class="comment">/* stop decoding and signal an error */</span></span><br><span class="line">  MAD_FLOW_IGNORE   = <span class="number">0x0020</span>    <span class="comment">/* ignore the current frame */</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰€æœ‰å›è°ƒå‡½æ•°çš„è¿”å›å€¼å‡ä¸ºè¯¥æšä¸¾ç±»å‹ï¼Œåœ¨è§£ç çš„ä¸»æµç¨‹ä¸­ä¼šé€šè¿‡ä¸æ–­åˆ¤æ–­è§£ç å™¨æ‰€è°ƒç”¨çš„å›è°ƒå‡½æ•°çš„çŠ¶æ€æ¥ç¡®è®¤ä¸‹ä¸€æ­¥çš„åŠ¨ä½œ</p>
</li>
</ol>
<h1 id="ç›¸å…³è°ƒè¯•ç»éªŒ"><a href="#ç›¸å…³è°ƒè¯•ç»éªŒ" class="headerlink" title="ç›¸å…³è°ƒè¯•ç»éªŒ"></a>ç›¸å…³è°ƒè¯•ç»éªŒ</h1><ol>
<li><p>é…ç½®å‚æ•°æœªé€‰æ‹©</p>
<p>Qï¼šç¼–è¯‘æ­£å¸¸é€šè¿‡ï¼Œæµç¨‹æ­£ç¡®ï¼Œä½†æ˜¯è¾“å‡ºçš„å£°éŸ³èƒ½å¬å‡ºæ˜¯æ‰€éœ€è¦çš„éŸ³é¢‘ä½†æ˜¯æ•´ä½“æ•°æ®å¹¶ä¸æ­£ç¡®ï¼Ÿ</p>
<p>Aï¼šåœ¨mad.hä¸­æœ‰è‹¥å¹²çš„å‡½æ•°æ˜¯æ ¹æ®å¹³å°çš„ä¸åŒæœ‰ä¸åŒçš„å®ç°ï¼Œç”±äºç¼–è¯‘è¿‡ç¨‹ä¸­æ²¡æœ‰æ³¨æ„è­¦å‘Šç›´æ¥å°†å…¶æ³¨é‡Šå¯¼è‡´æ²¡æœ‰é€‰æ‹©æ­£ç¡®å‡½æ•°å®ç°ï¼Œå¯¼è‡´æœ€ç»ˆçš„æ•°æ®éƒ½æ˜¯é”™è¯¯çš„ã€‚ç¼–è¯‘æ—¶æ·»åŠ ç›¸åº”çš„å¹³å°çš„å‚æ•°å³å¯ï¼Œå¦‚æœæ‰‹åŠ¨å†™cmakeï¼Œå‚è€ƒç»™å‡ºçš„Makefileåšå‚æ•°é€‰æ‹©ï¼</p>
</li>
<li><p>çº¿ç¨‹æ ˆç©ºé—´å¤§å°åˆ†é…ä¸è¶³</p>
<p>Qï¼šåœ¨PCä¸Šæµ‹è¯•æ­£å¸¸æ’­æ”¾ï¼Œä½†æ˜¯ç§»æ¤åˆ°å°ç³»ç»Ÿä¸­ç»å¸¸å‡ºç°stack overflowï¼Ÿ</p>
<p>Aï¼šç”±äºMP3ä¸€å¸§æ•°æ®çš„é‡‡æ ·ç‚¹æ•°ä¸º1152ï¼Œä½¿ç”¨ int ç±»å‹è¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥æ ¸å¿ƒå‡½æ•° â€œ â…¢_decodeâ€ è‡³å°‘éœ€è¦6kçš„æ ˆç©ºé—´ï¼Œå¦‚æœæ˜¯å•ç‹¬ä¸€ä¸ªçº¿ç¨‹çš„è¯å†åŠ ä¸Šå…¶ä»–çš„å±€éƒ¨å˜é‡ã€å‡½æ•°è·³è½¬ç­‰ç­‰å¯èƒ½å°±è¶…è¿‡8kã€‚</p>
<p>â€‹	  å½“æ—¶ä½¿ç”¨c++ çš„threadè¿›è¡Œçš„çº¿ç¨‹åˆ›å»ºå¹¶ä¸èƒ½é…ç½®æ ˆç©ºé—´å¤§å°ï¼Œç»è¿‡ä¸¤å¤©å·¦å³çš„debugæŸ¥åˆ°æ˜¯æ ¸å¿ƒå‡½æ•°æ ˆç©ºé—´çš„æº¢å‡ºï¼Œæœ€ç»ˆä½¿ç”¨pthreadåŠ å¤§æ ˆç©ºé—´çš„å¤§å°è¿è¡Œå³å¯ã€‚</p>
</li>
<li><p>åŠ¨æ€è§£ç çš„å®ç°</p>
<p>Qï¼šåˆšå¼€å§‹ç™¾åº¦libmadçš„åº“ï¼Œå¾ˆå¤šåšå®¢è¯´åªèƒ½è°ƒç”¨ä¸€æ¬¡inputå›è°ƒå‡½æ•°å³ä¸€æ¬¡åŠ è½½æ‰€æœ‰çš„æºæ•°æ®ï¼Œè¿™å¯¹äºå®æ—¶æ§åˆ¶é€ æˆä¸ä¾¿ï¼Ÿ</p>
<p>Aï¼š æ·±å…¥æºç å¯ä»¥çœ‹å‡ºè¾“å…¥çš„çš„æ•°æ®è§£ç å®Œæˆåªè¦ä¸è¿”å›STOPæ˜¯å¯ä»¥ç»§ç»­å¡«å……æ•°æ®çš„ï¼Œè¿™æ ·ä¸´æ—¶çš„bufferå°±å°ä¸€äº›å¹¶ä¸”å¯ä»¥è¯•è¯•æ§åˆ¶å®Œæˆæ’­æ”¾å™¨çš„åŠŸèƒ½ã€‚ï¼ˆéœ€è¦æ³¨æ„å¦‚æœä¸€æ¬¡è¾“å…¥çš„æ•°æ®æ˜¯å‡ å¸§å¤šä¸€ç‚¹ï¼Œè€Œå¤šå‡ºæ¥çš„éœ€è¦æ”¾ä¿å­˜ä¸‹æ¬¡å†æ­¤è¿›è¡Œè§£ç ï¼‰</p>
</li>
<li><p>è·å¾—éŸ³é¢‘å‚æ•°</p>
<p>Qï¼šèƒ½å¤Ÿå¾ˆå¿«çš„è·å¾—éŸ³é¢‘ä¿¡æ¯ï¼Ÿ</p>
<p>Aï¼š å¯¹äºwavå¤´å¾ˆå®¹æ˜“çš„å¯ä»¥æ‰¾åˆ°éŸ³é¢‘çš„å‚æ•°ï¼Œä½†æ˜¯MP3æ–‡ä»¶çš„ä¿¡æ¯ä¿å­˜åœ¨å¸§å¤´ä¸­ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œä¸€æ­¥é¢„è§£ç ã€‚å³è¯»å…¥è‹¥å¹²ï¼ˆ512å³å¯ï¼‰byteæ•°æ®è§£ä¸€å¸§çš„å¤´å°±å¯ä»¥è·å¾—å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šé‡‡æ ·ç‡ã€æ¯”ç‰¹ç‡ã€å£°é“ã€éŸ³é¢‘æ—¶é•¿ç­‰ç­‰ã€‚</p>
</li>
<li><p>è·å¾—æ’­æ”¾è¿›åº¦ / æ—¶é•¿å‡ºç°å¼‚å¸¸</p>
<p>Qï¼šä½¿ç”¨å…¬å¼ï¼šå½“å‰æ–‡ä»¶ä½ç½® / æ–‡ä»¶å¤§å° Ã— æ–‡ä»¶æ€»æ—¶é•¿ï¼Œè·å¾—å½“å‰æ’­æ”¾æ—¶é—´å‡ºç°å¼‚å¸¸ï¼Ÿ</p>
<p>Aï¼š å¯¹äºduration å’Œ fposæ˜¯ç”¨intçš„æ•°æ®ç±»å‹è¿›è¡Œä¿å­˜çš„ï¼Œä½†æ˜¯å¯¹äºwavæ–‡ä»¶ä¸€èˆ¬æ¯”è¾ƒå¤§åœ¨è®¡ç®—çš„æ—¶å€™è¶…å‡ºäº†æ•°æ®ç±»å‹æ‰€èƒ½å­˜å‚¨çš„æœ€å¤§é•¿åº¦ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Audio</category>
      </categories>
      <tags>
        <tag>libmad</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠGoogleå·¥ä½œæ³•ã€‹</title>
    <url>/2023/02/06/Reading/Google%E5%B7%A5%E4%BD%9C%E6%B3%95/</url>
    <content><![CDATA[<p><img src="/images/reading/GoogleWork.jpg" alt="img"></p>
<p>ã€Šgoogleå·¥ä½œæ³•ã€‹ä½œè€…æ˜¯å½¼å¾—Â·è´¹åˆ©å…‹æ–¯Â·æ ¼æ—¥ç“¦å¥‡ï¼Œé’ˆå¯¹googleçš„ä¸€äº›å·¥ä½œæ–¹æ³•è®ºå’Œä¸ªäººç»éªŒçš„è¿›è¡Œè‘—ä¹¦ã€‚æˆ‘è®¤ä¸ºå¯¹äºè¿™ç±»ä¹¦ç±çš„æ­£ç¡®ä½¿ç”¨æ˜¯é€šè¯»å…¨ç¯‡ï¼ŒäºŒæ¬¡é˜…è¯»é’ˆå¯¹éƒ¨åˆ†å†…å®¹è‡ªå·±è¿›è¡Œåœºæ™¯çš„å¸¦å…¥ï¼Œæ­¤ç±»å·¥å…·ä¹¦ç±å¯ä»¥ç»å¸¸æ¥è¿›è¡Œç¿»çœ‹å¯¹è‡ªå·±æ—¥å¸¸ç”Ÿæ´»å·¥ä½œæ–¹å¼çš„åˆ¤æ–­</p>
<p>é’ˆå¯¹æ¯ä¸ªç»†åˆ†ç« èŠ‚ï¼Œæ€»ç»“å¹¶è¿›è¡Œè‡ªå·±çš„æ€è€ƒ</p>
<h1 id="Fasterï¼ˆâ€»ï¼‰"><a href="#Fasterï¼ˆâ€»ï¼‰" class="headerlink" title="Fasterï¼ˆâ€»ï¼‰"></a>Fasterï¼ˆâ€»ï¼‰</h1><h2 id="ä¸€æ¬¡ç»“æŸï¼Œå½“åœºåšå®Œ"><a href="#ä¸€æ¬¡ç»“æŸï¼Œå½“åœºåšå®Œ" class="headerlink" title="ä¸€æ¬¡ç»“æŸï¼Œå½“åœºåšå®Œ"></a>ä¸€æ¬¡ç»“æŸï¼Œå½“åœºåšå®Œ</h2><p>ä½œè€…è®¤ä¸ºå†³å®šå·¥ä½œæ•ˆç‡çš„å…³é”®åœ¨äºå¯¹ ç°åœ¨ çš„ä½¿ç”¨æ–¹æ³•ã€‚å¯¹äºä¸€ä»¶äº‹æƒ…å¦‚æœèƒ½å¤Ÿå½“åœºåšå®Œå°±ä¸è¦æ¨è¿Ÿåˆ°ä»¥åï¼Œå¯¹äºä¸€é¡¹å†³å®šå¦‚æœå½“åœºç¡®å®šå°±ä¸è¦æ¨è¿Ÿåˆ°æœªæ¥ã€‚å¦‚æœå½“æ—¶æ²¡æœ‰è¿›è¡Œå°±è§£å†³æˆ–å†³å®šå°±éœ€è¦åšå‡ºç›¸åº”çš„è®¡åˆ’ï¼šè¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦æ”¶é›†å“ªäº›å¿…è¦çš„èµ„æºã€‚å…·ä½“ç­–ç•¥å¦‚ä¸‹ï¼š</p>
<p><img src="/images/reading/google-0.jpg" alt="img"></p>
<p>å¯¹è‡ªå·±æ¥è®²ï¼Œæˆ‘æ›¾ç»è´Ÿè´£æŸä¸ªé¡¹ç›®ï¼Œå®¢æˆ·åœ¨é—®æˆ‘ä¸€ä¸ªæŠ€æœ¯ç›¸å…³çš„é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘å½“æ—¶çš„åšæ³•å¯èƒ½å°±æ²¡æœ‰å¾ˆæ°å½“ã€‚ç°åœ¨æ¥çœ‹æˆ‘è®¤ä¸ºæ­£ç¡®çš„æµç¨‹åº”è¯¥æ˜¯ï¼šå°†æˆ‘è‡ªå·±å·²çŸ¥çš„å†…å®¹å¯¹å®¢æˆ·è¿›è¡Œåé¦ˆï¼›å°†è‡ªå·±ä¸çŸ¥é“çš„å†…å®¹å¦‚å®å‘Šè¯‰å®¢æˆ·å¹¶è¯¢é—®ä»–ç›®å‰æ˜¯å¦æœ‰ç©ºæˆ‘å»æ‰¾ä¸€ä¸‹ç›¸å…³è´Ÿè´£äººæ¥è§£ç­”ä»–è¿™ä¸ªé—®é¢˜ï¼ˆ<strong>å¦‚æœç°åœ¨æœ‰å¿…è¦çš„è¯ï¼Œç°åœ¨å°±è”ç³»ï¼›å¦‚æœç°åœ¨åº”è¯¥å†³å®šçš„è¯ï¼Œç°åœ¨å°±å†³å®š</strong>ï¼‰ï¼Œå¦‚æœä¸­é€”é‡åˆ°å…¶å®ƒé—®é¢˜ä¸çŸ¥é“è°æ˜¯è´Ÿè´£äººæˆ–è€…è´Ÿè´£äººä¸åœ¨ï¼Œä¹Ÿå¿…é¡»åšåˆ°ç›¸å…³è§£å†³æ–¹æ¡ˆåšåˆ°æœ‰åˆ‡å®è¿›å±•ï¼ˆæ´»ç”¨èº«è¾¹çš„äºº/å›æ¥ä¹‹åç¬¬ä¸€æ—¶é—´åé¦ˆç­‰ç­‰ï¼‰ï¼Œåœ¨ç¬¬ä¸€æ—¶é—´å†…å°†é—®é¢˜è¿›è¡Œè§£å†³ï¼Œä¸æ‹–å»¶ï¼ï¼ï¼</p>
<h2 id="è®¾ç½®deadline"><a href="#è®¾ç½®deadline" class="headerlink" title="è®¾ç½®deadline"></a>è®¾ç½®deadline</h2><p>èƒ½å½“åœºè§£å†³çš„é—®é¢˜ä¸€å®šè¦ä¸€æ¬¡è§£å†³ï¼Œè€Œä¸èƒ½è§£å†³çš„é—®é¢˜ä¸€å®šè¦è®¾ç½®deadlineï¼Œè¦æœ‰ä¸€ç§ å¦‚æœç°åœ¨ä¸åšé‚£è¦ä»€ä¹ˆæ—¶å€™åš çš„è§‚å¿µã€‚å¯¹äºçº·æ‚çš„å·¥ä½œéœ€è¦æ˜ç¡®ä¼˜å…ˆçº§ã€ç²¾ç»†ç¨‹åº¦ç­‰å› ç´ ã€‚å°†è‡ªå·±çš„æœŸé™æå‰æ˜¯æé«˜æ•ˆç‡çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p>
<p>å¯¹äºè‡ªå·±æ¥è®²ï¼Œå¦‚æœé¢†å¯¼è¦æ±‚ä¸€é¡¹å·¥ä½œå‘¨äº”ä¹‹å‰å®Œæˆã€‚é‚£è‡ªå·±çš„deadlineè¦è®¾ç½®åœ¨å‘¨ä¸‰å‘¨å››åšå¥½ä¸€ä¸ªdemoç»™é¢†å¯¼æŸ¥çœ‹ã€‚åœ¨å·¥ä½œè¿›è¡Œä¹‹å‰éœ€è¦æ˜ç¡®äº‹æƒ…çš„ç´§æ€¥ç¨‹åº¦ã€å®ŒæˆéªŒæ”¶çš„æ ‡å‡†ã€æ˜¯å¦æœ‰å…¶å®ƒæ³¨æ„äº‹é¡¹ç­‰ç­‰</p>
<h2 id="é›†ä¸­ç²¾åŠ›äºæ­¤æ—¶æ­¤åˆ»"><a href="#é›†ä¸­ç²¾åŠ›äºæ­¤æ—¶æ­¤åˆ»" class="headerlink" title="é›†ä¸­ç²¾åŠ›äºæ­¤æ—¶æ­¤åˆ»"></a>é›†ä¸­ç²¾åŠ›äºæ­¤æ—¶æ­¤åˆ»</h2><p>æ­£å¿µï¼ˆMindfulnessï¼‰çš„æ„æ€å°±æ˜¯å°†æ„è¯†é›†ä¸­äºæ­¤æ—¶æ­¤åˆ»ï¼Œè¿™ä¸€è¯åŒæ ·è¢«è°·æ­Œæ‰€é‡‡ç”¨ã€‚å¤§è„‘å°±åƒæ˜¯ä¸€ä¸ªCPUåº”å°½å¯èƒ½çš„å‡å°‘å¤§è„‘èµ„æºçš„æµªè´¹ï¼Œå¯¹äºä»»ä½•ä¸€ä»¶äº‹æƒ…å°½å¯èƒ½è¦æå‰åšå‡†å¤‡ã€‚æ¯”å¦‚ï¼šå‰ä¸€å¤©æ™šä¸Šå°±å‡†å¤‡å¥½ç¬¬äºŒå¤©éœ€è¦ç©¿çš„è¡£æœï¼›ä¼šè®®å‰æ¢³ç†ä¼šè®®çš„ç›®çš„æˆå‘˜ç»„ç»‡ç­‰ç­‰ï¼›ä»»ä½•ä¸€ä»¶äº‹æƒ…å¯èƒ½å‘ç”Ÿçš„åæœåŠç›¸åº”çš„è§£å†³åŠæ³•</p>
<p>åˆ†æçœ¼å‰ä»»åŠ¡çš„æ­£ç¡®æ–¹å¼ï¼šææ¸…æ¥šâ€ä¸ºä»€ä¹ˆéœ€è¦è§£å†³è¿™ä¸ªé—®é¢˜â€œï¼Œâ€åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰å¿…é¡»å¾—å‡ºç­”æ¡ˆâ€œï¼Œè®¾å®šå¥½â€ç›®çš„ä¸ç›®æ ‡â€œä¹‹åå…¨åŠ›ä»¥èµ´ã€‚æ¯”å¦‚ä¼šè®®ä¹‹å‰çš„å‡†å¤‡åˆ—è¡¨ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆå°†å¤§å®¶å¬é›†åˆ°ä¸€èµ·</li>
<li>è¦åšå‡ºä»€ä¹ˆå†³å®š</li>
<li>è¦å–å¾—ä»€ä¹ˆæˆæœ</li>
<li>é€šè¿‡ä¼šè®®åè¦å¾—åˆ°ä»€ä¹ˆæ”¶è·</li>
</ul>
<h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><ol>
<li><p>å¢åŠ ç°åœ¨çš„å¯†åº¦</p>
<p>é’ˆå¯¹è‡ªå·±æ¥è®²å¯ä»¥ä½“ç°åœ¨ï¼šé€šå‹¤è·¯ä¸Šè¿›è¡Œä¹¦ç±çš„é˜…è¯»è‹±è¯­çš„å­¦ä¹ ç­‰ç­‰ï¼Œå¹¶è¡Œä¸€äº›ä»»åŠ¡</p>
</li>
<li><p>å‡å°‘é‚®ä»¶çš„ä½¿ç”¨ï¼Œç›´æ¥è§é¢æœ€æœ‰æ•ˆç‡</p>
</li>
<li><p>åˆç†ä½¿ç”¨å·¥å…·</p>
<p>æ—¶é—´/æ—¶é—´ç®¡ç†å·¥å…·ï¼ˆå¯¹äºnotionçš„ä½¿ç”¨æ²¡æœ‰æŒç»­ï¼‰ï¼›æ•´ç†çš„æ–‡æ¡£ä¼ è‡³äº‘ç«¯ï¼Œéšæ—¶æŸ¥çœ‹ä¿®æ”¹</p>
</li>
<li><p>å­¦ä¹ è‹±è¯­</p>
<p>ç›®å‰å¾ˆå¤šç¬¬ä¸€æ‰‹èµ„æ–™éƒ½æ˜¯è‹±æ–‡çš„ï¼Œä¸ºäº†æé«˜æ•ˆç‡å¿…é¡»å­¦ä¼šè‹±æ–‡ã€‚å¦åˆ™å†…å®¹çš„å‡†ç¡®æ€§æ’é™¤åœ¨å¤–ï¼Œä¹Ÿæ˜¯æ—¶é—´å’Œæˆæœ¬çš„äºŒæ¬¡æµªè´¹</p>
</li>
</ol>
<h1 id="Sense-VS-sensibility"><a href="#Sense-VS-sensibility" class="headerlink" title="Sense VS sensibility"></a>Sense VS sensibility</h1><h2 id="åˆ›æ„æ€ç»´çš„äº§ç”Ÿ"><a href="#åˆ›æ„æ€ç»´çš„äº§ç”Ÿ" class="headerlink" title="åˆ›æ„æ€ç»´çš„äº§ç”Ÿ"></a>åˆ›æ„æ€ç»´çš„äº§ç”Ÿ</h2><p>ä¸é€»è¾‘å’Œåˆ†æç›¸æ¯”â€œ çµæ„Ÿï¼ˆåˆ›æ„æ€ç»´ï¼‰ â€æ›´é‡è¦</p>
<p>é€šè¿‡äººä¸ºåœ°åˆ¶é€ æ··ä¹±ï¼Œå¯ä»¥ä½¿æ½œæ„è¯†æ´»æ€§åŒ–ï¼Œä»è€Œæ›´å®¹æ˜“åˆ›é€ å‡ºæ–°çš„åˆ›æ„ã€‚å…·ä½“æ–¹æ¡ˆï¼šå‡†å¤‡å‡ ä¸ªé€æ˜æ–‡ä»¶è¢‹ï¼Œå°†å„ç§å›¾ç‰‡ã€æ‚å¿—ã€æŠ¥çº¸å‰ªä¸‹æ¥çš„å†…å®¹æˆ–å†™åœ¨çº¸ä¸Šçš„å…³é”®è¯æ”¾åœ¨é‡Œé¢ï¼Œé€šè¿‡ä»»æ„ç‰©å“çš„ç»„åˆäº§ç”Ÿæ–°çš„åˆ›æ„ã€‚ä¸ºäº†å¼•å‘è¿™ç§â€œçªç„¶å‡ºç°çš„åˆ›æ„ç¬é—´â€ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯å¤šå‡†å¤‡ä¸€äº›èƒ½å¤Ÿæ¿€å‘çµæ„Ÿçš„èµ„æ–™</p>
<h2 id="ç›´è§‰-x2F-é€»è¾‘åœºæ™¯"><a href="#ç›´è§‰-x2F-é€»è¾‘åœºæ™¯" class="headerlink" title="ç›´è§‰/é€»è¾‘åœºæ™¯"></a>ç›´è§‰/é€»è¾‘åœºæ™¯</h2><p>ç»éªŒçš„ç›´è§‰å’Œé€»è¾‘æ€è€ƒæœ¬èº«ä¹‹é—´å¹¶æ²¡æœ‰å­°ä¼˜å­°åŠ£ï¼Œä¸¤è€…å„è‡ªé€‚ç”¨äºä¸åŒçš„æƒ…å†µï¼Œå…·æœ‰ä¸åŒçš„ä½œç”¨ã€‚å¯¹äºæ›´é‡è§†æ„Ÿæ€§çš„é¢†åŸŸæ¥è¯´ï¼Œç›´è§‰æ¯”é€»è¾‘æ›´èƒ½å¤Ÿå‘æŒ¥ä½œç”¨ã€‚</p>
<h2 id="å…¶å®ƒ-1"><a href="#å…¶å®ƒ-1" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><ol>
<li><p>ä¸é€»è¾‘å’Œåˆ†æç›¸æ¯”â€çµæ„Ÿâ€œæ›´é‡è¦</p>
</li>
<li><p>ä¸€å‘³çš„æ¨¡ä»¿ä¸å¯èƒ½å®ç°å·®å¼‚åŒ–ã€‚</p>
<p>åªå¯¹ç«äº‰å¯¹æ‰‹çš„å•†å“è¿›è¡Œåˆ†ææ— æ³•å®ç°å·®å¼‚åŒ–ã€‚è¦æƒ³åšå‡ºä¸ä¼—ä¸åŒçš„å•†å“ï¼Œå¿…é¡»åšåˆ°å…¶å®ƒå…¬å¸æ²¡æœ‰åšåˆ°çš„äº‹æƒ…ã€‚</p>
</li>
<li><p>ä¼åˆ’ä¼šè®®ä¸éœ€è¦æ€»ç»“å¼æŠ¥å‘Šã€‚åªç¡®å®šä¸€ä¸ªä¼šè®®è®®é¢˜ï¼Œç„¶åå¤§å®¶å½“åœºè®¨è®º</p>
</li>
<li><p>ç§¯æå¬å–å…¶å®ƒéƒ¨é—¨æˆ–è€…å…¶å®ƒé¢†åŸŸçš„äººçš„æ„è§</p>
</li>
</ol>
<h1 id="Efficiently"><a href="#Efficiently" class="headerlink" title="Efficiently"></a>Efficiently</h1><h2 id="å°†ç›®æ ‡å®šä¸ºåŸæ¥çš„10å€"><a href="#å°†ç›®æ ‡å®šä¸ºåŸæ¥çš„10å€" class="headerlink" title="å°†ç›®æ ‡å®šä¸ºåŸæ¥çš„10å€"></a>å°†ç›®æ ‡å®šä¸ºåŸæ¥çš„10å€</h2><p>å·¥ä½œç”Ÿæ´»ä¸­æˆ‘ä»¬å¯¹äºè‡ªå·±çš„è¦æ±‚å¾€å¾€æ˜¯å®Œæˆä»»åŠ¡å³å¯ï¼Œä½†æ˜¯æœ€ç»ˆçš„æ•ˆæœå¾€å¾€ä¸å°½å¦‚äººæ„ï¼Œå¯èƒ½åªå®Œæˆäº†ä¸ƒå…«æˆã€‚å› æ­¤åœ¨æˆ‘ä»¬è®¾ç½®ç›®æ ‡çš„æ—¶å€™ä¸å¦¨å°†ç›®æ ‡è®¾ç½®çš„æ›´å¤§ä¸€ç‚¹ï¼Œæ—¢å®šç›®æ ‡çš„10å€ã€‚è¿™ä¸ªç›®æ ‡ä¼šå€’é€¼è‡ªå·±æ‰“ç ´æŸç¼šè‡ªå·±çš„æ¡æ¡æ¡†æ¡†å’Œå›ºæœ‰è§‚å¿µ ï¼Œå¦ä¸€æ–¹é¢ï¼Œè¦æƒ³æ”¹å˜å·¥ä½œæ–¹æ³•ï¼Œå¿…é¡»æ•¢äºæ‰¿æ‹…é£é™©ã€æ‰“ç ´è§„åˆ™ã€‚æœ€ç»ˆå³ä½¿å®Œæˆä¸ƒå…«æˆä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»“æœäº†</p>
<h2 id="Think-like-an-owner"><a href="#Think-like-an-owner" class="headerlink" title="Think like an owner"></a>Think like an owner</h2><p>åƒå…¬å¸æ‰€æœ‰è€…ä¸€æ ·æ€è€ƒã€‚é’ˆå¯¹è‡ªå·±çš„å·¥ä½œå²—ä½ï¼Œä»¥æˆ‘çš„å¹´æ”¶å…¥åº”è¯¥å–å¾—å¤šå°‘çš„æˆæœï¼Œæƒ³è¦å–å¾—è¿™äº›æˆæœéœ€è¦åšå“ªäº›å·¥ä½œï¼Œè€Œæ¯é¡¹å·¥ä½œåº”è¯¥æœ‰æ€æ ·çš„ç»“æœã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­åŠ¿å¿…è¦ä¼˜åŒ–è‡ªå·±çš„å·¥ä½œï¼Œç€çœ¼äºé‡ç‚¹å·¥ä½œå†…å®¹å‡å°‘å·¥ä½œä¸­çš„æ— ç”¨åŠŸï¼Œå¸å–ä»–äººçš„ç»éªŒå¯»æ±‚ä»–äººçš„å¸®åŠ©ã€‚åŒæ ·ä¹Ÿå¯ä»¥å‡è®¾è‡ªå·±å³å°†å¤±ä¸šï¼Œå¦‚æœæ²¡æœ‰å·¥ä½œæ²¡æœ‰äº†æ€ä¹ˆåŠï¼Ÿæƒ³åˆ°è¿™é‡Œè‡ªå·±çš„ç´§è¿«æ„Ÿæ²¹ç„¶è€Œç”Ÿ</p>
<h2 id="æ´»ç”¨20-åŸåˆ™"><a href="#æ´»ç”¨20-åŸåˆ™" class="headerlink" title="æ´»ç”¨20%åŸåˆ™"></a>æ´»ç”¨20%åŸåˆ™</h2><p>åœ¨æ€è€ƒå·¥ä½œçš„æœ‰é™é¡ºåºçš„æ—¶å€™ï¼Œåº”è¯¥ä¼˜å…ˆå°†æ—¶é—´æ”¾åœ¨ <strong>èƒ½å­¦åˆ°å¾ˆå¤šä¸œè¥¿è€Œä¸”å½±å“åŠ›æ¯”è¾ƒå¤§</strong>çš„å·¥ä½œä¸Šã€‚è€Œå…¶å®ƒç±»å‹çš„å·¥ä½œå¯ä»¥è¿›è¡Œåˆ†é…ç­‰ç­‰ã€‚å¯ä»¥è¿›ä¸€æ­¥å¯¹äºŒå…«å®šå¾‹è¿›è¡Œäº†è§£å­¦ä¹ </p>
<h2 id="å¿…è¦çš„å·¥ä½œç´ å…»ï¼ˆâ€»ï¼‰"><a href="#å¿…è¦çš„å·¥ä½œç´ å…»ï¼ˆâ€»ï¼‰" class="headerlink" title="å¿…è¦çš„å·¥ä½œç´ å…»ï¼ˆâ€»ï¼‰"></a>å¿…è¦çš„å·¥ä½œç´ å…»ï¼ˆâ€»ï¼‰</h2><ol>
<li><p>æ‹¥æœ‰é¢„è§æ€§</p>
<ul>
<li>é¢„è§æœºä¼šä¸å¨èƒ</li>
<li>å¯»æ‰¾å‘¨æœŸã€è¶‹åŠ¿ä»¥åŠè§„å¾‹</li>
<li>çŸ­æœŸã€ä¸­æœŸä¸é•¿æœŸæ€è€ƒã€‚è€ƒè™‘<strong>â€œ5/5/5è§„åˆ™â€</strong>ï¼Œå³5å‘¨ä»¥åã€5ä¸ªæœˆä»¥åã€5å¹´ä»¥åä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…è¿›è¡Œæ€è€ƒ</li>
</ul>
</li>
<li><p>æ¢ä½æ€è€ƒ</p>
</li>
<li><p>æ•¢äºæå‡ºè‡ªå·±çš„è§è§£</p>
</li>
<li><p>æ•¢è¯´çœŸè¯ï¼ˆä¸ªäººè®¤ä¸ºè¿™ä¸€ç‚¹è¿˜æ˜¯å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼‰</p>
</li>
<li><p>ä¸»åŠ¨æ‰¿æ‹…è´£ä»»</p>
</li>
<li><p>ç§¯æå‚ä¸äº¤æµ</p>
</li>
<li><p>æ‰“ç ´å¸¸è§„</p>
</li>
<li><p>ä¸å®³æ€•å¤±è´¥</p>
</li>
<li><p>å‹¤äºæ€è€ƒã€ä¿æŒè´¨ç–‘</p>
<p>é‡åˆ°ä¸æ˜ç™½çš„äº‹æƒ…å¤šé—®ä¸€ä¸ªä¸ºä»€ä¹ˆ</p>
</li>
<li><p>æ”¹å˜è§†è§’</p>
<p>æ•´ä½“è§†è§’ï¼›å±€éƒ¨è§†è§’ï¼›åé¢è§†è§’ï¼›æœªæ¥è§†è§’ï¼›é¡¾å®¢è§†è§’ï¼›ç«äº‰å¯¹æ‰‹è§†è§’ï¼›ç‰¹æ®Šè§†è§’</p>
</li>
</ol>
<h1 id="Interpersonal-relationship"><a href="#Interpersonal-relationship" class="headerlink" title="Interpersonal relationship"></a>Interpersonal relationship</h1><h2 id="å…·è±¡åŒ–æ€è€ƒ"><a href="#å…·è±¡åŒ–æ€è€ƒ" class="headerlink" title="å…·è±¡åŒ–æ€è€ƒ"></a>å…·è±¡åŒ–æ€è€ƒ</h2><p>å®ç‰©æ€è€ƒæˆ‘å°†å…¶æ€»ç»“ä¸ºå…·è±¡åŒ–æ€è€ƒã€‚å·¥ä½œç”Ÿæ´»ä¸­åˆ«äººæœ‰æŸé¡¹éœ€æ±‚æ—¶ï¼Œå¯ä»¥é€šè¿‡æŸç§ç±»æ¯”æˆ–å®ç‰©æ¥ä¸å¯¹æ–¹ç¡®è®¤è¡¨è¾¾æ˜¯å¦ä¸€è‡´ã€‚å…·ä½“æ–¹æ¡ˆï¼šå¯ä»¥æ˜¯åœ¨ä¸€å¼ è‰å›¾ä¸Šç”»å‡ºæ¥å‘åˆ«äººç¡®è®¤â€œæ‚¨è¯´çš„æ˜¯è¿™ç§ç±»å‹å—ï¼Ÿâ€ï¼›æˆ–è€…åœ¨è®¨è®ºé—®é¢˜ä¹‹å‰å°†è®¨è®ºçš„å†…å®¹æ€»ç»“åˆ°A4çº¸ä¸Šï¼Œå°†æ¯”è¾ƒæŠ½è±¡çš„äº‹æƒ…å…·è±¡åŒ–å¯ä»¥å®æ“ã€‚è¿™æ ·æ˜¯å¯ä»¥å¤§å¹…åº¦çš„å‡å°‘äº¤æµçš„æˆæœ¬é™ä½åæœŸçš„æ— ç”¨åŠŸ</p>
<h2 id="æå‡å¿ƒç†å®‰å…¨"><a href="#æå‡å¿ƒç†å®‰å…¨" class="headerlink" title="æå‡å¿ƒç†å®‰å…¨"></a>æå‡å¿ƒç†å®‰å…¨</h2><ul>
<li>å¿ƒç†å®‰å…¨ï¼šé¢å¯¹ æˆ‘å¯ä»¥ä¿¡èµ–ä½ å— æˆ–è€… æˆ‘èƒ½å°Šé‡ä½ å— è¿™æ ·çš„é—®é¢˜çš„æ—¶å€™èƒ½å¤Ÿç»™å‡ºè‚¯å®šçš„ç­”æ¡ˆ</li>
</ul>
<p>å¾—åˆ°ä»–äººçš„ä¿¡èµ–å’Œå°Šé‡ä¹Ÿä¼šä½¿è‡ªå·±äº§ç”Ÿå®‰å…¨æ„Ÿã€‚ä¸€æ—¦æ„ç­‘èµ·ä¿¡èµ–å…³ç³»ï¼Œäº¤æµåŒæ–¹å°±ä¼šåƒæœ‹å‹ä¸€æ ·ï¼Œæ›´å®¹æ˜“çš„äº’ç›¸æå‡ºæ„è§æˆ–å»ºè®®ï¼Œå·¥ä½œç°åœºçš„æ°”æ°›ä¹Ÿä¼šæ›´åŠ æ´»è·ƒã€‚</p>
<h2 id="å€¾å¬ï¼ˆâ€»ï¼‰"><a href="#å€¾å¬ï¼ˆâ€»ï¼‰" class="headerlink" title="å€¾å¬ï¼ˆâ€»ï¼‰"></a>å€¾å¬ï¼ˆâ€»ï¼‰</h2><p>äº¤æµTipsï¼šå»ºç«‹ä¿¡èµ–å…³ç³»æœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯å€¾å¬ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯è®©è‡ªå·±å¯¹å¯¹æ–¹äº§ç”Ÿå…´è¶£å¹¶å°†è¿™ç§æƒ…ç»ªä¼ é€’ç»™å¯¹æ–¹ã€‚å¦å¤–ï¼Œå¥½ä¸å®¹æ˜“è®©å¯¹æ–¹è¯´å‡ºè‡ªå·±çš„æ„è§ï¼Œç»å¯¹ä¸èƒ½å°†å¯¹æ–¹çš„æ„è§å®Œå…¨å¦å®šï¼Œä¸èƒ½è®©å¯¹æ–¹è§‰å¾—â€œæˆ‘è¯´äº†ä¹Ÿæ²¡ç”¨â€çš„æƒ³æ³•ï¼ï¼ï¼</p>
<p>è‰¾ç±³Â·åŸƒå¾·è’™é¡¿æ•™æˆæŒ‡å‡ºï¼šä¸è¦å°†é—®é¢˜å•çº¯åœ°çœ‹æˆâ€œéœ€è¦è§£å†³çš„é—®é¢˜â€ï¼Œè€Œæ˜¯è¦å°†å…¶çœ‹ä½œâ€œéœ€è¦å­¦ä¹ çš„é—®é¢˜â€æ¥è¿›è¡Œè®¨è®ºï¼Œè¿™æ ·ä¸æ¸…æ¥šçš„éƒ¨åˆ†å°±ä¼šè‡ªç„¶è€Œç„¶çš„æµ®ç°ï¼Œä¹Ÿæ›´å®¹æ˜“è®©å›¢é˜Ÿæˆå‘˜ç§¯ææ€è€ƒ</p>
<h2 id="å»ºç«‹è‰¯å¥½äººé™…å…³ç³»"><a href="#å»ºç«‹è‰¯å¥½äººé™…å…³ç³»" class="headerlink" title="å»ºç«‹è‰¯å¥½äººé™…å…³ç³»"></a>å»ºç«‹è‰¯å¥½äººé™…å…³ç³»</h2><p>è‰¯å¥½çš„äººé™…å…³ç³»æ˜¯å¿«é€Ÿè§£å†³é—®é¢˜çš„åŸºçŸ³</p>
<p>ç¤¾ä¼šå„è¡Œå„ä¸šå“ªæ€•åªè¦æœ‰ä¸€ç‚¹ç‚¹äº¤é›†éƒ½è¶³å¯ä»¥è®©å¯¹æ–¹å’Œè‡ªå·±äº§ç”Ÿè”ç³»ã€‚è€Œè§åˆ°å…³é”®çš„äººçš„æ—¶å€™æ­£ç¡®çš„æ–¹å¼åº”è¯¥æ˜¯ï¼šæå‰äº†è§£è®¾æƒ³å¯¹æ–¹çš„è¯¾é¢˜ï¼Œç„¶åå¼€é—¨è§å±±çš„æ ¹æ®è¯¾é¢˜å†…å®¹è¿›è¡Œæé—®ï¼Œäº¤æµè¿‡ç¨‹ä¸­è¡¨ç°å‡ºçƒ­æƒ…ã€å¹³ç­‰çš„æ€åº¦å°±å¯ä»¥å¿ƒæƒ…èˆ’ç•…çš„è¿›è¡Œäº¤æµã€‚åœ¨äº¤æµè¿‡ç¨‹ä¸­è¿˜è¦éœ€è¦æ³¨æ„ <strong>ä¸è¦takeè€Œè¦give</strong>ï¼Œè¦è®©åˆ«äººçœ‹åˆ°è‡ªå·±çš„ä»·å€¼</p>
<p><strong>äººé™…å…³ç³»çš„ä¼˜å…ˆé¡ºåº</strong>ï¼šæ–°è®¤è¯†çš„äºº &gt; ç†Ÿè¯†çš„äººï¼›æ–°è®¤è¯†å¹¶ä¸”ä¸æ–­æ”¹å˜è‡ªå·±çš„äºº &gt; æ–°è®¤è¯†ä½†å˜åŒ–ä¸å¤šçš„äºº</p>
<h1 id="Skill"><a href="#Skill" class="headerlink" title="Skill"></a>Skill</h1><h2 id="å­¦ä¹ çš„æ­£ç¡®æ–¹æ³•"><a href="#å­¦ä¹ çš„æ­£ç¡®æ–¹æ³•" class="headerlink" title="å­¦ä¹ çš„æ­£ç¡®æ–¹æ³•"></a>å­¦ä¹ çš„æ­£ç¡®æ–¹æ³•</h2><p>æ£€ç´¢ + è¯¢é—®ä¸“ä¸šäººå£«Â·è¯¢é—®ä»–äººÂ·è¯¢é—®åŒäº‹</p>
<ul>
<li>æ£€ç´¢ï¼šè¯¢é—®äº’è”ç½‘è¿™ä¸ªè€å¸ˆ</li>
<li>è¯¢é—®ä»–äººï¼š<ol>
<li>æ‰¾æœ€æ“…é•¿è¿™é¡¹å·¥ä½œçš„äººè¯¢é—®</li>
<li>è¯¢é—®ä¹‹å‰è¦æœ‰è‡ªå·±çš„æ€è€ƒã€‚å¸¦ç€å‡è®¾å¸¦ç€æ€è€ƒå»æé—®ã€‚å…·ä½“å¯ä»¥æœ‰å››è¦ç´ ï¼šå…·ä½“æ¥è¯´ï¼›è¦åœ¨ä»€ä¹ˆåœ°æ–¹ï¼›æ”¹å˜ä»€ä¹ˆï¼›æ€ä¹ˆåšæ‰èƒ½è®©å·¥ä½œæ›´é¡ºåˆ©</li>
</ol>
</li>
</ul>
<h2 id="å‰é¦ˆä¸åé¦ˆ"><a href="#å‰é¦ˆä¸åé¦ˆ" class="headerlink" title="å‰é¦ˆä¸åé¦ˆ"></a>å‰é¦ˆä¸åé¦ˆ</h2><ul>
<li>å‰é¦ˆï¼šæ‰¾åˆ«äººè¯¢é—®â€œæˆ‘æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåº”è¯¥æ€ä¹ˆåŠæ‰å¥½å‘¢ï¼Ÿâ€</li>
<li>åé¦ˆï¼šäº‹åçš„åæ€ä¸ç»éªŒæ€»ç»“</li>
</ul>
<p>è¦æƒ³è·å–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæé—®çš„</p>
<p><img src="/images/reading/google-1.jpg" alt="img"></p>
<h2 id="å¤šå‚åŠ äº¤æµä¼š"><a href="#å¤šå‚åŠ äº¤æµä¼š" class="headerlink" title="å¤šå‚åŠ äº¤æµä¼š"></a>å¤šå‚åŠ äº¤æµä¼š</h2><p>ä¸ºäº†ä¿è¯è‡ªå·±çš„ç”Ÿå­˜ï¼Œæœ€å¥½å¤šå‚åŠ äº¤æµï¼Œä¸è®ºæ˜¯éæ­£å¼èšä¼šã€å…¬å¸å¤–éƒ¨ä¼šè®®ç­‰ç­‰ï¼Œç»™è‡ªå·±å¤šåˆ›é€ å‡ ä¸ªç«‹è¶³ç‚¹ã€‚</p>
<p>åŒè¡Œä¸šã€åŒå¹´é¾„çš„äººå‘†åœ¨ä¸€èµ·ï¼Œè°ˆè®ºçš„äº‹æƒ…éƒ½æ˜¯ç›¸ä¼¼çš„è¯é¢˜ï¼Œæ— æ³•ä»ä¸­è·å–åˆ°è·Ÿå¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚åœ¨äº¤æµè¿‡ç¨‹ä¸­ï¼Œä¹Ÿè¦æ—¶åˆ»æ€è€ƒâ€œæˆ‘åº”è¯¥ç»™å¯¹æ–¹æä¾›ä»€ä¹ˆæ ·çš„ä¿¡æ¯â€ï¼Œè¾“å‡ºè‡ªå·±çš„ä»·å€¼</p>
<h1 id="Relax-Work"><a href="#Relax-Work" class="headerlink" title="Relax Work"></a>Relax Work</h1><h2 id="ä¸€åˆ†é’Ÿå†¥æƒ³"><a href="#ä¸€åˆ†é’Ÿå†¥æƒ³" class="headerlink" title="ä¸€åˆ†é’Ÿå†¥æƒ³"></a>ä¸€åˆ†é’Ÿå†¥æƒ³</h2><p>å…³é—­ç”µè„‘ï¼Œå°†æ‰€æœ‰æ³¨æ„åŠ›éƒ½é›†ä¸­åœ¨è‡ªå·±çš„å‘¼å¸ä¸Šï¼Œå®‰é™çš„ååœ¨åº§ä½ä¸Š</p>
<h2 id="å¹¶è¡Œä»»åŠ¡ä¸ä¸²è¡Œä»»åŠ¡åˆ†ç±»"><a href="#å¹¶è¡Œä»»åŠ¡ä¸ä¸²è¡Œä»»åŠ¡åˆ†ç±»" class="headerlink" title="å¹¶è¡Œä»»åŠ¡ä¸ä¸²è¡Œä»»åŠ¡åˆ†ç±»"></a>å¹¶è¡Œä»»åŠ¡ä¸ä¸²è¡Œä»»åŠ¡åˆ†ç±»</h2><p>æ¯”å¦‚é€šå‹¤è¿‡ç¨‹ä¸­è¿›è¡Œä¹¦ç±çš„é˜…è¯»ã€å¬éŸ³é¢‘ç­‰ç­‰</p>
<p>è€Œä¸€æ—¦ä¸“æ³¨äºæŸé¡¹å·¥ä½œå°±å°½å¯èƒ½æ’é™¤å¤–éƒ¨çš„å¹²æ‰°ï¼Œå¯ä»¥å°è¯•å°†æ‰‹æœºé™éŸ³ã€æ”¾è¿œä¸€ç‚¹ç­‰ç­‰æ“ä½œ</p>
<h2 id="ç¡åˆè§‰ã€åƒé›¶é£Ÿã€æ”¾æ¾æ˜¯è‡ªå·±çš„è´£ä»»"><a href="#ç¡åˆè§‰ã€åƒé›¶é£Ÿã€æ”¾æ¾æ˜¯è‡ªå·±çš„è´£ä»»" class="headerlink" title="ç¡åˆè§‰ã€åƒé›¶é£Ÿã€æ”¾æ¾æ˜¯è‡ªå·±çš„è´£ä»»"></a>ç¡åˆè§‰ã€åƒé›¶é£Ÿã€æ”¾æ¾æ˜¯è‡ªå·±çš„è´£ä»»</h2><h1 id="Final-Innovation"><a href="#Final-Innovation" class="headerlink" title="Final Innovation"></a>Final Innovation</h1><ol>
<li>æ€è€ƒå¦‚ä½•ä½¿ç”¨AIæ›¿ä»£è‡ªå·±çš„å·¥ä½œ</li>
<li>ç«™åœ¨é©æ–°ä¸€ä¾§ä¸è¢–æ‰‹æ—è§‚ï¼Œæ”¹å˜è‡ªå·±åšæŒä½†ä¸å¥½çš„ä¹ æƒ¯ï¼Œåˆç†ä½¿ç”¨ç°ä»£åŒ–å·¥å…·</li>
<li>å°±ç®—å¯¹æŠ€æœ¯ç»†èŠ‚ä¸äº†è§£ï¼Œä¹Ÿè¦è·Ÿä¸Šè¶‹åŠ¿</li>
<li>å·¥ä½œä¸èƒ½å’Œæ˜¨å¤©ä¸€æ ·</li>
</ol>
<h1 id="æ‘˜æŠ„"><a href="#æ‘˜æŠ„" class="headerlink" title="æ‘˜æŠ„"></a>æ‘˜æŠ„</h1><ol>
<li><p>ä¸è¦è®¤ä¸ºâ€œå…¬å¸å°±æ˜¯è‡ªå·±çš„åŠå…¬å®¤â€ï¼Œè€Œè¦æ—¶åˆ»è®°ä½â€œè‡ªå·±åœ¨å“ªå“ªé‡Œå°±æ˜¯åŠå…¬å®¤â€</p>
</li>
<li><p>ä¼šè®®çš„ç›®çš„ä¸æ˜¯å°†æ‰€æœ‰äººå¬é›†åˆ°ä¸€èµ·ï¼Œè€Œæ˜¯å–å¾—ç»“æœï¼Œæ‰€ä»¥åªéœ€è¦å¬é›†å¯¹å–å¾—ç»“æœæœ‰å¸®åŠ©çš„æˆå‘˜å³å¯</p>
</li>
<li><p>é‚®ä»¶æ˜¯â€œç­‰å¾…æ–‡åŒ–â€ï¼Œå³æ—¶é€šä¿¡æ˜¯â€œå®æ—¶æ–‡åŒ–â€</p>
</li>
<li><p>å·¥ç¨‹é¡¹ç›®çš„å†²åˆºé˜¶æ®µä¸€èˆ¬éƒ½ä¼šé‡‡ç”¨â€œè§„å®šæœŸé™ï¼Œé›†ä¸­ç²¾ç¥â€çš„å·¥ä½œæ–¹æ³•</p>
</li>
<li><p>æ˜ç¡®å·¥ä½œçš„ä¼˜å…ˆé¡ºåºå’Œå“è´¨è¦æ±‚æ˜¯ä¸“ä¸šäººå£«çš„åŸºæœ¬ç´ å…»</p>
</li>
<li><p>å·¥ä½œçš„ç›®çš„å¹¶ä¸æ˜¯â€œä»æ—©9ç‚¹åˆ°æ™š6ç‚¹ååœ¨åŒä¸€ä¸ªåœ°æ–¹â€œï¼Œè€Œæ˜¯å–å¾—ä»¤äººæ»¡æ„çš„æˆæœï¼ˆèˆ’é€‚çš„å·¥ä½œç¯å¢ƒè‡³å…³é‡è¦ï¼‰</p>
</li>
<li><p>æ²¡æœ‰ç»“è®ºçš„åˆ†ææ¯«æ— æ„ä¹‰</p>
</li>
<li><p>åˆ›æ„æ€ç»´éœ€è¦çš„æ˜¯çµæ„Ÿä»¥åŠä¸°å¯Œç»éªŒçš„ç›´è§‰</p>
</li>
<li><p>åªæœ‰æ•¢äºèµ°å‡ºèˆ’é€‚åŒºæ‰èƒ½å–å¾—æ›´å¤§çš„æˆæœ</p>
</li>
<li><p>å…¬å¸ä¹‹æ‰€ä»¥ç»™ä½ é«˜é¢è–ªæ°´ï¼Œæ˜¯å› ä¸ºä½ èƒ½åšåˆ°åˆ«äººæ— æ³•åšåˆ°çš„å›°éš¾å·¥ä½œ</p>
</li>
<li><p>äº¤æµæœ€å¤§çš„ç›®çš„æ˜¯æ„ç­‘ä¿¡èµ–å…³ç³» </p>
</li>
<li><p>å½“äººæ„Ÿè§‰åˆ°è‡ªå·±å—åˆ°äº†å°Šé‡æˆ–è€…åˆ«äººå¾ˆé‡è§†æˆ‘çš„æ—¶å€™ï¼Œå°±ä¼šå°†è‡ªå·±çš„å†…å¿ƒä»é˜²å¤‡ä¸­è§£æ”¾å‡ºæ¥</p>
</li>
<li><p>åœ¨å¥½å¥‡å¿ƒé©±ä½¿ä¸‹ä¸æ–­çš„è¿½æ±‚è‡ªå·±æ„Ÿå…´è¶£çš„ä¸œè¥¿ï¼Œè¿™å°†æˆä¸ºä½ èŒåœºä¸­çš„é€šè¡Œè¯</p>
</li>
<li><p>åº”è¯¥å­¦ä¹ çš„ä¸æ˜¯çŸ¥è¯†è€Œæ˜¯ç»éªŒ</p>
</li>
<li><p>äººçš„æˆé•¿å°±åƒæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæ˜¨å¤©çš„è‡ªå·±åŠ ä¸Šå‰å¤©çš„è‡ªå·±æ‰æ˜¯ä»Šå¤©çš„è‡ªå·±</p>
</li>
<li><p>å¤šæ¬¡å®è·µä¸ä½†æœ‰åŠ©äºæé«˜è‡ªä¿¡ï¼Œæ›´èƒ½åŠ å¿«æŒæ¡é€Ÿåº¦</p>
</li>
<li><p>æ‹¥æœ‰çš„â€œé€‰é¡¹â€è¶Šå¤šï¼Œåœ¨ç«äº‰ä¸­ç”Ÿå­˜çš„å¯èƒ½æ€§å°±è¶Šå¤§</p>
</li>
<li><p>ç©¶ç«Ÿæ˜¯é€‰æ‹©ç«™åœ¨é©æ–°çš„ä¸€ä¾§è¿˜æ˜¯é€‰æ‹©è¢–æ‰‹æ—è§‚ï¼Œä¸åŒçš„é€‰æ‹©å¸¦æ¥çš„ç»“æœå¯è°“æ˜¯å¤©å£¤ä¹‹åˆ« </p>
</li>
<li><p>æ‰¾åˆ°åœ¨å·¨å˜æ´ªæµä¸­å‘æŒ¥è‡ªå·±èƒ½åŠ›å¹¶ä¸”èµšå–åˆ©æ¶¦çš„æ–¹æ³•</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Reading</category>
      </categories>
      <tags>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>Audio-åˆè¯†</title>
    <url>/2022/08/31/Audio/Audio-meet/</url>
    <content><![CDATA[<p>è·³åŠ¨çš„éŸ³ç¬¦ï¼Œå©‰è½¬çš„èŠ‚å¥ï¼Œæ‚ æ‰¬çš„æ­Œå£°â€¦â€¦</p>
<p>éŸ³ä¹æ— ç–‘æ˜¯æœ€èƒ½æ„‰æ‚¦èº«å¿ƒçš„æ–¹å¼ä¹‹ä¸€ï¼Œé‚£ä¹ˆæ­Œæ‰‹çš„éŸ³è°ƒã€éŸ³è‰²æ˜¯å¦‚ä½•å­˜å‚¨åˆ°æ‰‹æœºä¸­ï¼Œåˆæ˜¯å¦‚ä½•é€šè¿‡å–‡å­æ’­æ”¾å‡ºæ¥çš„å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢æˆ‘å°†é€šè¿‡å‡ ç¯‡åšå®¢é˜è¿°æˆ‘å¯¹éŸ³é¢‘çš„ç†è§£åŠéƒ¨åˆ†è°ƒè¯•ç»éªŒï¼Œæœ¬ç« ä¸»è¦ä»‹ç»éŸ³é¢‘çš„çš„åŸºç¡€çŸ¥è¯†</p>
<h1 id="ä¿¡å·åˆ†ç±»"><a href="#ä¿¡å·åˆ†ç±»" class="headerlink" title="ä¿¡å·åˆ†ç±»"></a>ä¿¡å·åˆ†ç±»</h1><p>å£°éŸ³ä¸¥æ ¼æ„ä¹‰æ¥è®²åº”è¯¥è¢«å«åšå£°éŸ³ä¿¡å·ï¼Œè€Œåœ¨ç»´åŸºç™¾ç§‘ä¸­å¯¹äº<strong>ä¿¡å·</strong>çš„å®šä¹‰æ˜¯<a href="https://baike.baidu.com/item/%E7%89%A9%E7%90%86%E9%87%8F/9984692">è¡¨ç¤ºæ¶ˆæ¯çš„ç‰©ç†é‡</a>ï¼Œè¿™æ ·å°±å¾ˆå¥½ç†è§£äº†å£°éŸ³ä¿¡å·å°±æ˜¯ä»¥å£°éŸ³ä¸ºè½½ä½“çš„ä¸€ä¸ªç‰©ç†é‡ã€‚è€Œè‡ªç„¶ç•Œä¸­ä¿¡å·å¯ä»¥æœ‰å¦‚ä¸‹çš„åˆ†ç±»</p>
<p><img src="/images/linux/Audio/Audio-meet-1.png" alt="signal"></p>
<p>å› æ­¤ï¼ŒæŒ‰ç…§ä¿¡å·å˜åŒ–åˆ†ç±»å£°éŸ³ä¿¡å·å±äºéšæœºä¿¡å·ï¼›æŒ‰ç…§ä¿¡å·ç‰¹å¾åˆ†ç±»å£°éŸ³ä¿¡å·å±äºæ¨¡æ‹Ÿä¿¡å·</p>
<h1 id="æ¨¡æ•°è½¬æ¢"><a href="#æ¨¡æ•°è½¬æ¢" class="headerlink" title="æ¨¡æ•°è½¬æ¢"></a>æ¨¡æ•°è½¬æ¢</h1><p>ä¸Šä¸€éƒ¨åˆ†äº†è§£åˆ°å£°éŸ³æ˜¯æ¨¡æ‹Ÿä¿¡å·ï¼Œè€Œå¯¹äºè®¡ç®—æœºæ¥è®²å…¶åªèƒ½å¤„ç†æ•°å­—ä¿¡å·å³0å’Œ1ï¼Œæ‰€ä»¥å¿…é¡»éœ€è¦å°†å£°éŸ³æ¨¡æ‹Ÿä¿¡å·è½¬æ¢æˆæ•°å­—ä¿¡å·ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹å«åšæ¨¡æ•°è½¬æ¢ï¼ˆAnalog Digital Conversionï¼‰ï¼Œç›¸åº”çš„å®Œæˆè¯¥åŠŸèƒ½çš„ç¡¬ä»¶å•å…ƒå°±å«åšæ¨¡æ•°è½¬æ¢å™¨(ADC)</p>
<p>å®Œæˆè¯¥è¿‡ç¨‹éœ€è¦ä¸‰éƒ¨æ›²åˆ†åˆ«æ˜¯ï¼šé‡‡æ ·ã€é‡åŒ–ã€ç¼–ç ï¼Œæ•´ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/images/linux/Audio/Audio-meet-2.png" alt="ADC"></p>
<h2 id="é‡‡æ ·"><a href="#é‡‡æ ·" class="headerlink" title="é‡‡æ ·"></a>é‡‡æ ·</h2><p><em>é‡è¦å‚æ•°ï¼šé‡‡æ ·ç‡</em></p>
<ul>
<li>å®šä¹‰ï¼šåœ¨æ—¶é—´è½´ä¸Šå¯¹ä¿¡å·è¿›è¡Œç¦»æ•£åŒ–</li>
<li>åŸç†ï¼šæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡å¯¹æ¨¡æ‹Ÿä¿¡å·çš„ç¬æ—¶æ—¶åˆ»è¿›è¡Œæ ·æœ¬é‡‡é›†</li>
</ul>
<p>å…¶å®é‡‡æ ·ä½œç”¨é€šä¿—ç†è§£å°±æ˜¯æ˜¯é‡‡é›†æ ·æœ¬ã€‚ç”±äºæ¨¡æ‹Ÿä¿¡å·æ˜¯è¿ç»­çš„ï¼Œç†è®ºä¸Šæˆ‘ä»¬éœ€è¦é‡‡é›†æ— æ•°ä¸ªç‚¹æ‰èƒ½å®Œæ•´çš„è¿˜åŸè¯¥ä¿¡å·ï¼Œä½†æ˜¯ä¸€æ¥æ— ç©·çš„æ¦‚å¿µæ˜¯ä¸å¯èƒ½æ»¡è¶³çš„ï¼ŒäºŒæ¥æˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦è¿™ä¹ˆé«˜çš„é‡‡æ ·ç‡ã€‚æˆ‘ä»¬å¬è§‰æ˜¯æœ‰å»¶è¿Ÿçš„å°±å’Œè§†é¢‘å¸§ä¸åœçš„åˆ·æ–°æ¬ºéª—æˆ‘ä»¬çš„çœ¼ç›æ˜¯ç”»é¢è¿ç»­çš„æ˜¯ä¸€ä¸ªé“ç†ã€‚</p>
<p>æ‰€ä»¥é‡‡æ ·ç‡è¶Šé«˜ï¼Œå£°éŸ³çš„è¿˜åŸå°±è¶ŠçœŸå®è¶Šè‡ªç„¶ï¼Œäººå¯¹é¢‘ç‡çš„è¯†åˆ«èŒƒå›´æ˜¯ 20HZ - 22000HZ, å¦‚æœæ¯ç§’é’Ÿèƒ½å¯¹å£°éŸ³åš 22000 ä¸ªé‡‡æ ·, å›æ”¾æ—¶å°±è¶³å¯ä»¥æ»¡è¶³äººè€³çš„éœ€æ±‚. æ‰€ä»¥ 22050 çš„é‡‡æ ·é¢‘ç‡æ˜¯å¸¸ç”¨çš„, 44100å·²æ˜¯CDéŸ³è´¨, è¶…è¿‡48000çš„é‡‡æ ·å¯¹äººè€³å·²ç»æ²¡æœ‰æ„ä¹‰ã€‚è¿™å’Œç”µå½±çš„æ¯ç§’ 24 å¸§å›¾ç‰‡çš„é“ç†å·®ä¸å¤šã€‚</p>
<h2 id="é‡åŒ–"><a href="#é‡åŒ–" class="headerlink" title="é‡åŒ–"></a>é‡åŒ–</h2><p><em>ç›¸å…³å‚æ•°ï¼šé‡‡æ ·ä½æ•°</em></p>
<ul>
<li><p>å®šä¹‰ï¼šåœ¨å¹…åº¦è½´ä¸Šå¯¹ä¿¡å·è¿›è¡Œæ•°å­—åŒ–</p>
</li>
<li><p>åŸç†ï¼šå¯¹é‡‡æ ·ç‚¹çš„å¹…åº¦èµ‹äºˆå…·ä½“çš„æ•°å€¼ï¼Œè¯¥æ•°å€¼ç”±nä½äºŒè¿›åˆ¶è¡¨å¾ï¼ˆn = 8 / 16 / 32ï¼‰</p>
</li>
</ul>
<p>é‡‡æ ·ä½æ•°è¶Šé«˜è¯´æ˜åˆ’åˆ†çš„ç­‰çº§è¶Šç²¾ç»†ã€‚è¾ƒä½çš„é‡‡æ ·ä½æ•°æŸå¤±ç²¾åº¦ï¼Œè¾ƒé«˜çš„é‡‡æ ·ä½æ•°å¯èƒ½é€ æˆè½¯ç¡¬ä»¶èµ„æºçš„æµªè´¹</p>
<blockquote>
<p>å°å¸¸è¯†ï¼šæ ‡å‡†CDéŸ³ä¹çš„è´¨é‡å°±æ˜¯16bitã€44.1KHzé‡‡æ ·</p>
</blockquote>
<h2 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h2><p>å®šä¹‰ï¼šæŒ‰ç…§ä¸€å®šçš„æ ¼å¼è®°å½• é‡‡æ · å’Œ é‡åŒ– åçš„æ•°æ®ã€‚åç»­ä¼šå¯¹éƒ¨åˆ†æ ¼å¼çš„å­˜å‚¨æ ¼å¼è¿›è¡Œåˆ†æ</p>
<h3 id="ç¼–ç åˆ†ç±»"><a href="#ç¼–ç åˆ†ç±»" class="headerlink" title="ç¼–ç åˆ†ç±»"></a>ç¼–ç åˆ†ç±»</h3><blockquote>
<p> è¯¥éƒ¨åˆ†å†…å®¹è½¬è‡ª <a href="https://www.jianshu.com/p/28d3f108ef63">https://www.jianshu.com/p/28d3f108ef63</a></p>
</blockquote>
<h4 id="æ³¢å½¢ç¼–ç "><a href="#æ³¢å½¢ç¼–ç " class="headerlink" title="æ³¢å½¢ç¼–ç "></a>æ³¢å½¢ç¼–ç </h4><ul>
<li>å®šä¹‰ï¼šä¸åˆ©ç”¨ç”ŸæˆéŸ³é¢‘ä¿¡å·çš„ä»»ä½•å‚æ•°ï¼Œç›´æ¥å°† <strong>æ—¶é—´åŸŸä¿¡å·</strong> å˜æ¢ä¸º <strong>æ•°å­—ä»£ç </strong>ï¼Œä½¿é‡æ„çš„è¯­éŸ³æ³¢å½¢å°½å¯èƒ½åœ°ä¸åŸå§‹è¯­éŸ³ä¿¡å·çš„ æ³¢å½¢å½¢çŠ¶ ä¿æŒä¸€è‡´ã€‚</li>
<li>åŸç†ï¼šåœ¨ <strong>æ—¶é—´è½´</strong> ä¸Šå¯¹æ¨¡æ‹Ÿè¯­éŸ³ä¿¡å·æŒ‰ä¸€å®šçš„é€Ÿç‡æŠ½æ ·ï¼Œç„¶åå°†å¹…åº¦æ ·æœ¬åˆ†å±‚é‡åŒ–ï¼Œå¹¶ç”¨ä»£ç è¡¨ç¤ºã€‚</li>
</ul>
<h4 id="å‚æ•°ç¼–ç "><a href="#å‚æ•°ç¼–ç " class="headerlink" title="å‚æ•°ç¼–ç "></a>å‚æ•°ç¼–ç </h4><p>ä»è¯­éŸ³ <strong>æ³¢å½¢ä¿¡å·</strong> ä¸­æå–ç”Ÿæˆè¯­éŸ³çš„å‚æ•°ï¼Œä½¿ç”¨è¿™äº›å‚æ•°é€šè¿‡è¯­éŸ³ç”Ÿæˆæ¨¡å‹é‡æ„å‡ºè¯­éŸ³ï¼Œä½¿é‡æ„çš„è¯­éŸ³ä¿¡å·å°½å¯èƒ½åœ°ä¿æŒåŸå§‹è¯­éŸ³ä¿¡å·çš„è¯­æ„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‚æ•°ç¼–ç æ˜¯æŠŠè¯­éŸ³ä¿¡å·äº§ç”Ÿçš„æ•°å­—æ¨¡å‹ä½œä¸ºåŸºç¡€ï¼Œç„¶åæ±‚å‡ºæ•°å­—æ¨¡å‹çš„æ¨¡å‹å‚æ•°ï¼Œå†æŒ‰ç…§è¿™äº›å‚æ•°è¿˜åŸæ•°å­—æ¨¡å‹ï¼Œè¿›è€Œåˆæˆè¯­éŸ³ã€‚</p>
<h4 id="æ··åˆç¼–ç "><a href="#æ··åˆç¼–ç " class="headerlink" title="æ··åˆç¼–ç "></a>æ··åˆç¼–ç </h4><p>æ··åˆç¼–ç æ˜¯æŒ‡åŒæ—¶ä½¿ç”¨ä¸¤ç§æˆ–ä¸¤ç§ä»¥ä¸Šçš„ç¼–ç æ–¹æ³•è¿›è¡Œç¼–ç ã€‚è¿™ç§ç¼–ç æ–¹æ³•å…‹æœäº†æ³¢å½¢ç¼–ç å’Œå‚æ•°ç¼–ç çš„å¼±ç‚¹ï¼Œå¹¶ç»“åˆäº†æ³¢å½¢ç¼–ç é«˜è´¨é‡å’Œå‚æ•°ç¼–ç çš„ä½ç¼–ç ç‡ï¼Œèƒ½å¤Ÿå–å¾—æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚</p>
<ul>
<li><p>WAVç¼–ç ï¼ˆæ³¢å½¢ç¼–ç ï¼‰</p>
<p>WAVæ˜¯ç¼–ç çš„ä¸€ç§å®ç°æ–¹å¼ï¼ˆå…¶å®å®ƒæœ‰éå¸¸å¤šå®ç°æ–¹å¼ï¼Œä½†éƒ½æ˜¯ä¸ä¼šè¿›è¡Œå‹ç¼©æ“ä½œï¼‰ã€‚å°±æ˜¯åœ¨æº <strong>PCM</strong> æ•°æ®æ ¼å¼çš„å‰é¢åŠ ä¸Š44ä¸ªå­—èŠ‚ã€‚åˆ†åˆ«ç”¨æ¥æè¿° <strong>PCM</strong> çš„é‡‡æ ·ç‡ã€å£°é“æ•°ã€æ•°æ®æ ¼å¼ç­‰ä¿¡æ¯ã€‚</p>
</li>
<li><p>MP3ç¼–ç </p>
<p>MP3ç¼–ç å…·æœ‰ä¸é”™çš„å‹ç¼©æ¯”ï¼Œè€Œä¸”å¬æ„Ÿä¹Ÿæ¥è¿‘äºWAVæ–‡ä»¶ï¼Œå½“ç„¶åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ï¼Œåº”è¯¥è°ƒæ•´åˆé€‚çš„å‚æ•°æ¥è¾¾åˆ°æ›´å¥½çš„æ•ˆæœã€‚</p>
</li>
<li><p>AACç¼–ç </p>
</li>
</ul>
<p>  AACæ˜¯ç›®å‰æ¯”è¾ƒçƒ­é—¨çš„æœ‰æŸå‹ç¼©ç¼–ç æŠ€æœ¯ï¼Œå¹¶ä¸”è¡ç”Ÿäº†LC-AACã€HE-AACã€HE-AAC v2 ä¸‰ç§ä¸»è¦ç¼–ç æ ¼å¼ã€‚</p>
<p>  <strong>LC-AACï¼š</strong>æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„AAC,ä¸»è¦åº”ç”¨äºä¸­é«˜ç ç‡çš„åœºæ™¯ç¼–ç (&gt;= 80Kbit/s)<br>   <strong>HE-AACï¼š</strong> ä¸»è¦åº”ç”¨äºä½ç ç‡åœºæ™¯çš„ç¼–ç (&lt;= 48Kbit/s)</p>
<ul>
<li><p>Oggç¼–ç ï¼ˆæœ‰æŸï¼‰</p>
<p>Oggç¼–ç æ˜¯ä¸€ç§éå¸¸æœ‰æ½œåŠ›çš„ç¼–ç ï¼Œåœ¨å„ç§ç ç‡ä¸‹éƒ½æœ‰æ¯”è¾ƒä¼˜ç§€çš„è¡¨ç°ã€‚å°¤å…¶åœ¨ä½ç ç‡åœºæ™¯ä¸‹ã€‚Oggé™¤äº†éŸ³è´¨å¥½ä¹‹å¤–ï¼ŒOggçš„ç¼–ç ç®—æ³•ä¹Ÿæ˜¯éå¸¸å‡ºè‰²ã€‚å¯ä»¥ç”¨æ›´å°çš„ç ç‡è¾¾åˆ°æ›´å¥½çš„éŸ³è´¨ã€‚128Kbit/sçš„Oggæ¯”192Kbit/sç”šè‡³æ›´é«˜ç ç‡çš„MP3æ›´ä¼˜è´¨.ä½†ç›®å‰ç”±è½¯ä»¶è¿˜æ˜¯ç¡¬ä»¶æ”¯æŒé—®é¢˜,éƒ½æ²¡æ³•è¾¾åˆ°ä¸MP3çš„ä½¿ç”¨å¹¿åº¦.</p>
</li>
</ul>
<h1 id="éŸ³é¢‘å‚æ•°"><a href="#éŸ³é¢‘å‚æ•°" class="headerlink" title="éŸ³é¢‘å‚æ•°"></a>éŸ³é¢‘å‚æ•°</h1><p>ä¸€æ®µæ‚ æ‰¬çš„éŸ³ä¹ç»è¿‡é‡‡æ ·ã€é‡åŒ–ã€ç¼–ç å°±ä¿å­˜æ•°å­—ä¿¡å·æ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„ä¸€å®šä¸æ˜¯åªå­˜æˆæ–‡ä»¶è€Œæ˜¯é€šè¿‡æ–‡ä»¶å½¢å¼ä¼ æ’­è®©æ›´å¤šäººå¬åˆ°è¯¥éŸ³ä¹ï¼Œå› æ­¤ä¸€å®šå­˜åœ¨DAè½¬æ¢ï¼Œå³è¿˜åŸæ•°å­—ä¿¡å·ä¸ºæ¨¡æ‹Ÿä¿¡å·çš„è¿‡ç¨‹ã€‚é‚£ä¹ˆåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­æœ‰å“ªäº›å‚æ•°è¡¨å¾äº†éŸ³é¢‘é‡è¦çš„ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>ä¸ä»…é™äºwebrtcã€ffmpegã€libmadç­‰ç­‰éŸ³é¢‘ç¼–è§£ç åº“ï¼Œå¯¹äºæ‰€æœ‰ç¼–è§£ç å™¨å’Œcodecæ¥è®²ï¼ŒéŸ³é¢‘æºæ•°æ®çš„ä¸‰ä¸ªå‚æ•°è‡³å…³é‡è¦ï¼š<strong>å£°é“channelã€é‡‡æ ·ç‡sampleRateã€é‡‡æ ·ä½æ•°sampleBit</strong>ã€‚è¿™ä¸‰ä¸ªå‚æ•°ä¹‹æ‰€ä»¥é‡è¦æ˜¯å› ä¸ºæœ‰è¿™å‡ ä¸ªå‚æ•°å°±å¯ä»¥å‡†ç¡®çš„çŸ¥é“ä¸€ä¸ªè£¸çš„éŸ³é¢‘æ•°æ®ï¼ˆPCMï¼‰çš„å…¨éƒ¨ä¿¡æ¯äº†ã€‚</p>
<h2 id="å£°é“"><a href="#å£°é“" class="headerlink" title="å£°é“"></a>å£°é“</h2><p>å£°é“æ˜¯æŒ‡éŸ³é¢‘æ–‡ä»¶åœ¨å½•åˆ¶æ—¶éŸ³æºçš„æ•°é‡ä½ç½®å’Œæ’­æ”¾æ—¶ç›¸åº”çš„æ‰¬å£°å™¨çš„æ•°é‡ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰ã€‚æ‰€ä»¥å¯æƒ³è€ŒçŸ¥ï¼Œå…¶ä»–å‚æ•°ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå£°é“æ•°è¶Šå¤šå®šä½è¶Šç²¾å‡†ï¼ŒåŒæ ·æ‰€éœ€æ‰¬å£°å™¨å’ŒåŠŸæ”¾ç»„ä»¶è¶Šå¤šã€‚</p>
<ul>
<li>å•å£°é“ï¼ˆmonoï¼‰</li>
<li>åŒå£°é“ï¼ˆstereo ç«‹ä½“å£°ï¼‰ï¼šå·¦å£°é“ + å³å£°é“ï¼Œä½éŸ³ä¸åˆ†ç¦»ï¼Œåº”ç”¨äºéŸ³ä¹æ’­æ”¾è¾ƒå¤š</li>
<li>2.1å£°é“ ï¼šå·¦å£°é“ + å³å£°é“ï¼Œ ä½éŸ³åˆ†ç¦»</li>
<li>5.1å£°é“ ï¼šå·¦å£°é“ + å³å£°é“ + ä½éŸ³å£°é“ + ä¸­å¤®å£°é“ + å·¦ç¯ç»• + å³ç¯ç»•ï¼Œåº”ç”¨äºç±»ä¼ ç»Ÿå½±é™¢å’Œå®¶åº­å½±é™¢ä¸­</li>
<li>7.1å£°é“ ï¼šå·¦å£°é“ + å³å£°é“ + ä½éŸ³å£°é“ + ä¸­å¤®å£°é“ + å·¦ç¯ç»• + å³ç¯ç»• + å·¦åç¯ + å³åç¯ï¼Œå¸¸è§çš„åŒ…æ‹¬ï¼šDolby Surround 7.1æœæ¯”7.1ç¯ç»•å£°</li>
</ul>
<h2 id="é‡‡æ ·ç‡"><a href="#é‡‡æ ·ç‡" class="headerlink" title="é‡‡æ ·ç‡"></a>é‡‡æ ·ç‡</h2><p>é‡‡æ ·ç‡å¯ä»¥ç†è§£ä¸ºé‡‡é›†æ ·æœ¬çš„é€Ÿç‡ï¼ˆæ•…ä¹Ÿå¯ä»¥ç§°ä¸ºé‡‡æ ·é€Ÿåº¦æˆ–è€…é‡‡æ ·é¢‘ç‡ï¼‰ï¼Œå®ƒå®šä¹‰äº†æ¯ç§’ä»è¿ç»­ä¿¡å·ä¸­æå–å¹¶ç»„æˆç¦»æ•£ä¿¡å·çš„é‡‡æ ·ä¸ªæ•°ï¼Œå®ƒç”¨èµ«å…¹ï¼ˆHzï¼‰æ¥è¡¨ç¤ºã€‚</p>
<p>ä¾‹å¦‚ï¼šé‡‡æ ·ç‡ä¸º44100ï¼Œæ„å‘³ç€æ¯ç§’é’Ÿå¯¹è¿ç»­çš„å£°éŸ³ä¿¡å·é‡‡é›†44100æ¬¡ï¼ŒåŒæ ·å¯¹åº”å¾—åˆ°çš„æ•°å­—ä¿¡å·æ¯ç§’çš„æ ·æœ¬æ•°é‡ï¼ˆå…·ä½“å¯ä»¥å‚è€ƒé‡‡æ ·è¿‡ç¨‹ï¼‰</p>
<h2 id="é‡‡æ ·ä½æ•°"><a href="#é‡‡æ ·ä½æ•°" class="headerlink" title="é‡‡æ ·ä½æ•°"></a>é‡‡æ ·ä½æ•°</h2><p>é‡‡æ ·ä½æ•°å°±æ˜¯æŒ‡æŸä¸€ç¬æ—¶æ—¶åˆ»ï¼Œé‡åŒ–å£°éŸ³å¤§å°ï¼ˆç²¾ç»†ç¨‹åº¦ï¼‰çš„è®¡é‡å•ä½</p>
<ul>
<li>8bit ( 1Byte ) å¯¹åº”0~255ï¼Œå°†æŒ¯å¹…åˆ’åˆ†ä¸º256ä¸ªç­‰çº§</li>
<li>16bit (2Byte) å¯¹åº”0~65535ï¼Œå°†æŒ¯å¹…åˆ’åˆ†ä¸º65536ä¸ªç­‰çº§</li>
</ul>
<h2 id="æ ·æœ¬æ ¼å¼"><a href="#æ ·æœ¬æ ¼å¼" class="headerlink" title="æ ·æœ¬æ ¼å¼"></a>æ ·æœ¬æ ¼å¼</h2><h3 id="æ ·æœ¬ç»„åˆå½¢å¼"><a href="#æ ·æœ¬ç»„åˆå½¢å¼" class="headerlink" title="æ ·æœ¬ç»„åˆå½¢å¼"></a>æ ·æœ¬ç»„åˆå½¢å¼</h3><ul>
<li>äº¤é”™æ¨¡å¼ï¼šæ¯ä¸ªå£°é“çš„æ ·æœ¬æ•°æ®äº¤é”™å­˜å‚¨æ’å¸ƒ</li>
<li>å¹³é¢æ¨¡å¼ï¼šæ¯ä¸ªå£°é“çš„æ ·æœ¬æ•°æ®åˆ†å¼€å­˜å‚¨</li>
</ul>
<p>ä¸‹é¢ä»¥stereoæ¨¡å¼è¿›è¡Œå›¾ç¤ºè§£é‡Šï¼ˆCä»£è¡¨Channelï¼‰ï¼š</p>
<p>â€‹    <img src="/images/linux/Audio/Audio-meet-3.png" alt="sample"></p>
<h3 id="FFmpeg-æ ·æœ¬ç»„ç»‡å½¢å¼ä»‹ç»"><a href="#FFmpeg-æ ·æœ¬ç»„ç»‡å½¢å¼ä»‹ç»" class="headerlink" title="FFmpeg æ ·æœ¬ç»„ç»‡å½¢å¼ä»‹ç»"></a>FFmpeg æ ·æœ¬ç»„ç»‡å½¢å¼ä»‹ç»</h3><ul>
<li>Packedæ ¼å¼ï¼Œframe.data[0]åŒ…å«æ‰€æœ‰çš„éŸ³é¢‘æ•°æ®ã€‚</li>
<li>Planaræ ¼å¼ï¼Œframe.data[i]è¡¨ç¤ºç¬¬iä¸ªå£°é“çš„æ•°æ®ï¼ˆå‡è®¾å£°é“0æ˜¯ç¬¬ä¸€ä¸ªï¼‰</li>
</ul>
<h3 id="FFmpeg-ä¸»è¦æ ·æœ¬æ ¼å¼"><a href="#FFmpeg-ä¸»è¦æ ·æœ¬æ ¼å¼" class="headerlink" title="FFmpeg ä¸»è¦æ ·æœ¬æ ¼å¼"></a>FFmpeg ä¸»è¦æ ·æœ¬æ ¼å¼</h3><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">AVSampleFormat</span> {</span></span><br><span class="line">    AV_SAMPLE_FMT_NONE = <span class="number">-1</span>,</span><br><span class="line">    AV_SAMPLE_FMT_U8,          <span class="comment">///&lt; unsigned 8 bits</span></span><br><span class="line">    AV_SAMPLE_FMT_S16,         <span class="comment">///&lt; signed 16 bits</span></span><br><span class="line">    AV_SAMPLE_FMT_S32,         <span class="comment">///&lt; signed 32 bits</span></span><br><span class="line">    AV_SAMPLE_FMT_FLT,         <span class="comment">///&lt; float</span></span><br><span class="line">    AV_SAMPLE_FMT_DBL,         <span class="comment">///&lt; double</span></span><br><span class="line"> </span><br><span class="line">    AV_SAMPLE_FMT_U8P,         <span class="comment">///&lt; unsigned 8 bits, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_S16P,        <span class="comment">///&lt; signed 16 bits, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_S32P,        <span class="comment">///&lt; signed 32 bits, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_FLTP,        <span class="comment">///&lt; float, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_DBLP,        <span class="comment">///&lt; double, planar</span></span><br><span class="line">    AV_SAMPLE_FMT_S64,         <span class="comment">///&lt; signed 64 bits</span></span><br><span class="line">    AV_SAMPLE_FMT_S64P,        <span class="comment">///&lt; signed 64 bits, planar</span></span><br><span class="line"> </span><br><span class="line">    AV_SAMPLE_FMT_NB           <span class="comment">///&lt; Number of sample formats. DO NOT USE if linking dynamically</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>è¯´æ˜ï¼šä»¥Pä¸ºç»“å°¾çš„æ˜¯planarç»“æ„ï¼›Planaræ¨¡å¼æ˜¯FFmpegå†…éƒ¨å­˜å‚¨æ¨¡å¼ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨çš„éŸ³é¢‘æ–‡ä»¶éƒ½æ˜¯Packedæ¨¡å¼çš„ã€‚</p>
<h2 id="æ¯”ç‰¹ç‡"><a href="#æ¯”ç‰¹ç‡" class="headerlink" title="æ¯”ç‰¹ç‡"></a>æ¯”ç‰¹ç‡</h2><p>æ¯”ç‰¹ç‡æŒ‡çš„æ˜¯å•ä½æ—¶é—´æ’­æ”¾è¿ç»­çš„åª’ä½“å¦‚å‹ç¼©åçš„éŸ³é¢‘æˆ–è§†é¢‘çš„æ¯”ç‰¹æ•°é‡ï¼Œåœ¨è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œå®ƒç›¸å½“äºæœ¯è¯­æ•°å­—å¸¦å®½æ¶ˆè€—é‡ï¼Œæˆ–ååé‡ã€‚å•ä½bps / Kbpsï¼ˆbit per secondï¼‰è¿™é‡Œæ˜¯bitè€Œä¸æ˜¯Byteï¼ˆ1Byte = 8bitï¼‰</p>
<p>è™½ç„¶ç»å¸¸ä½œä¸ºâ€œé€Ÿåº¦â€çš„å‚è€ƒï¼Œæ¯”ç‰¹ç‡å¹¶ä¸æµ‹é‡â€œâ€˜è·ç¦»â€™/æ—¶é—´â€ï¼Œè€Œæ˜¯è¢«ä¼ è¾“æˆ–è€…è¢«å¤„ç†çš„â€œâ€˜äºŒè¿›åˆ¶ç æ•°é‡â€™/æ—¶é—´â€ï¼Œæ‰€ä»¥åº”è¯¥æŠŠå®ƒå’Œä¼ æ’­é€Ÿåº¦åŒºåˆ†å¼€æ¥ï¼Œä¼ æ’­é€Ÿåº¦ä¾èµ–äºä¼ è¾“çš„ä»‹è´¨å¹¶ä¸”æœ‰é€šå¸¸çš„ç‰©ç†æ„ä¹‰ã€‚ï¼ˆæ¥è‡ªç»´åŸºç™¾ç§‘ï¼‰</p>
<h2 id="å‚æ•°å…³ç³»"><a href="#å‚æ•°å…³ç³»" class="headerlink" title="å‚æ•°å…³ç³»"></a>å‚æ•°å…³ç³»</h2><p>å¯¹äºPCMè£¸æ•°æ®ï¼š æ–‡ä»¶æ—¶é•¿ â‰ˆï¼ˆæ–‡ä»¶æ€»å¤§å° - å¤´ä¿¡æ¯ï¼‰/ (é‡‡æ ·ç‡ * é‡‡æ ·ä½æ•° * é€šé“æ•° / 8) [ä¹Ÿå°±æ˜¯æ¯”ç‰¹ç‡]</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Audio</category>
      </categories>
  </entry>
  <entry>
    <title>ã€Šäººç±»ç¾¤æ˜Ÿé—ªè€€æ—¶ã€‹</title>
    <url>/2023/03/18/Reading/%E4%BA%BA%E7%B1%BB%E7%BE%A4%E6%98%9F%E9%97%AA%E8%80%80%E6%97%B6/</url>
    <content><![CDATA[<p><img src="/images/reading/RenLeiQunXing.jpg" alt="img"></p>
<h1 id="å¯¼è¯­"><a href="#å¯¼è¯­" class="headerlink" title="å¯¼è¯­"></a>å¯¼è¯­</h1><p>å’Œè¿™æœ¬ä¹¦çš„æ¸Šæºåº”è¯¥è¿˜æ˜¯åœ¨é€šå‹¤è·¯ä¸Šä½¿ç”¨å¾—åˆ°APPå¬åˆ°çš„å¯¹è¯¥ä¹¦çš„è§£è¯»ã€‚è´¾è¡Œå®¶è€å¸ˆçš„è§£è¯»é£æ ¼ä¸€ç›´æ˜¯æˆ‘æ‰€å–œæ¬¢çš„ï¼Œé€šè¿‡ä»–çš„è¯­è¨€æˆ‘å¤§è‡´äº†è§£åˆ°è¿™æœ¬ä¹¦è®²è¿°çš„æ˜¯14ä¸ªå†å²çš„å†³å®šæ€§ç¬é—´ï¼Œå½“ç„¶ä¸€å®šæ˜¯é’ˆå¯¹ä¸–ç•Œçš„ï¼Œè€Œå…¶å®ä½œè€…é»˜è®¤å°†è¥¿æ–¹ä¸–ç•Œç­‰åŒäºä¸–ç•Œã€‚æˆ‘è‡ªå·±å…¶å®å¯¹äºè¥¿æ–¹å†å²çš„äº†è§£ç¨‹åº¦ä¸€ç›´åœç•™åœ¨åˆä¸­å†å²ä¹¦çš„å±‚é¢ã€‚å½“å¬åˆ°è¿™åå››ä¸ªå†å²çš„å†³å®šæ€§ç¬é—´åŒ…å«äº†æ»‘é“å¢æˆ˜å½¹ã€é©¬èµ›æ›²ã€æ‹œå åº­å¸å›½ç­‰ç­‰ç›¸å…³å†…å®¹ï¼Œæˆ‘ä¸€ä¸‹å­ä¾¿æèµ·äº†å…´è¶£ï¼Œè¿™äº›è€³ç†Ÿèƒ½è¯¦çš„æ•…äº‹åé¢ç©¶ç«Ÿæœ‰ä»€ä¹ˆæ•…äº‹ï¼Œå¸¦ç€å¥½å¥‡å¼€å§‹äº†è¿™æœ¬ä¹¦çš„é˜…è¯»ã€‚</p>
<p>å°æ³¨ï¼šç”±äºè¿™æœ¬ä¹¦çš„ä¸­æ–‡è¯‘æœ¬é«˜è¾¾å‡ åç§ï¼Œæˆ‘åœ¨ä¹°ä¹¦çš„æ—¶å€™ä¹Ÿæ²¡æœ‰çœ‹å¥½ï¼Œä¹°çš„ä¹¦åªåŒ…å«åä¸ªç¬é—´ã€‚å…¶å®ƒç¼ºå¤±çš„åº”è¯¥åŒ…å«ï¼šåˆ—å¤«æ‰˜å°”æ–¯æ³°ã€è²å°”å¾·ï¼ˆå»ºç«‹ç¬¬ä¸€æ¡è·¨æ´‹ç”µç¼†ï¼‰ã€å¨å°”é€Šï¼ˆç¾å›½ç¬¬äºŒåå…«ä»»æ€»ç»Ÿï¼‰ã€å·´å¡ç½—ã€‚æœ‰æœºä¼šçš„è¯è¿™å‡ ä¸ªä¹Ÿè¦è¡¥å›æ¥ã€‚</p>
<h1 id="å…³äºä½œè€…"><a href="#å…³äºä½œè€…" class="headerlink" title="å…³äºä½œè€…"></a>å…³äºä½œè€…</h1><p>è¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯æ–¯è’‚èŠ¬Â·èŒ¨å¨æ ¼ï¼Œè¢«èª‰ä¸ºâ€å†å²ä¸Šæœ€å¥½çš„ä¼ è®°ä½œå®¶â€œã€‚èŒ¨å¨æ ¼1881å¹´å‡ºç”Ÿåœ¨å¥¥åœ°åˆ©çŠ¹å¤ªçš„å¯Œå•†å®¶åº­ï¼Œè¿™ä¸ªæ—¶é—´å’Œèº«ä»½æ³¨å®šä»–çš„å‘½è¿ä¸å¹³å‡¡ã€‚äºŒæˆ˜æ—¶æœŸï¼ŒèŒ¨å¨æ ¼å› ä¸ºåæˆ˜çº³ç²¹è¢«é©±é€ï¼Œéšåæµäº¡è‹±å›½ã€ç¾å›½ã€å·´è¥¿ï¼Œä»–çš„ä»£è¡¨ä½œåŒ…æ‹¬&lt;&lt;è±¡æ£‹çš„æ•…äº‹&gt;&gt;ã€ã€Šæ˜¨æ—¥çš„ä¸–ç•Œã€‹ã€ã€Šä¸‰å¤§å¸ˆä¼ ã€‹ç­‰ç­‰</p>
<h1 id="ä¹¦è¯„"><a href="#ä¹¦è¯„" class="headerlink" title="ä¹¦è¯„"></a>ä¹¦è¯„</h1><p>èƒ½å¤Ÿè¯»å®Œæ•´æœ¬ä¹¦å°±å·²ç»è¯´æ˜è¶³å¤Ÿå¸å¼•äººäº†ã€‚æ•´ä½“ä¸Šè¿™æœ¬ä¹¦çš„è·¨åº¦å¾ˆå¤§ï¼ŒåŒ…æ‹¬æ—¶é—´è·¨åº¦ã€äººç‰©ç±»å‹è·¨åº¦ç­‰ç­‰ï¼Œæœ€è¿œçš„è®²åˆ°å…¬å…ƒå‰1å®é™…çš„å¤ç½—é©¬æ”¿æ²»å±æœºï¼ˆç©†ç½•é»˜å¾·äºŒä¸–ï¼‰ï¼Œè¿‘çš„å¯ä»¥åˆ°ä¸€æˆ˜åçš„å·´é»å’Œä¼šï¼ˆå¨å°”é€Šï¼‰ï¼›è€Œåœ¨ç±»å‹ä¸Šæœ‰å†å²ä¸Šä¼Ÿå¤§çš„æ”¿æ²»å®¶æ‹¿ç ´ä»‘ã€ä¼Ÿå¤§çš„éŸ³ä¹å®¶äº¨å¾·å°”ã€ç”šè‡³åŒ…æ‹¬æˆ‘ä»¬å¯èƒ½å®Œå…¨ä¸ç†Ÿæ‚‰çš„é©¬èµ›æ›²çš„ä½œè€…é²çƒ­â€¦â€¦</p>
<p>åœ¨è¯­è¨€é£æ ¼ä¸Šï¼Œç”¨è´¾è¡Œå®¶çš„è€å¸ˆè¯å¯ä»¥è¯´æ˜¯ï¼ŒèŒ¨å¨æ ¼é«˜è´µçš„æ°”è´¨ã€ä¼˜é›…çš„æ–‡é£å’Œç†æƒ³ä¸»ä¹‰çš„ç¬”è°ƒå°½æ˜¾æ— ç–‘ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™æœ¬ä¹¦ç»™æˆ‘çš„å¦ä¸€ä¸ªæ„Ÿå—å°±æ˜¯ç»†èŠ‚åˆ»ç”»éå¸¸åˆ°ä½ï¼Œä½†æ˜¯å‘¢è¿™äº›ç»†èŠ‚æ›´åƒæ˜¯ä½œè€…æœ¬äººè®¾èº«å¤„åœ°çš„ç†è§£äººç‰©åœ¨æŸä¸ªæ—¶åˆ»æŸä¸ªåœºæ™¯ä¸‹çš„å¿ƒç†æ´»åŠ¨ã€‚è¿™å¯¹äºå†å²çºªå®å¯èƒ½å¹¶ä¸å‹å¥½ä½†æ˜¯æˆ‘è§‰å¾—å¯¹äºæˆ‘ä»¬è¯»è€…ç†è§£äººç‰©çš„å½¢è±¡å¯ä»¥è¯´éå¸¸åˆ°ä½äº†ï¼</p>
<p>ä¾‹å­ï¼š</p>
<ol>
<li>äººæ°‘ä¹Ÿè®¸æ°¸è¿œä¸ä¼šçŸ¥é“ï¼Œé‚£æ‰‡å› ä¸ºç–å¿½æ•å¼€çš„å‡¯å°”å¡é—¨åœ¨é‚£æ¬¡å‘½è¿æ”¸å…³çš„æ—¶åˆ»ï¼Œä¸ºäººç±»å¸¦æ¥äº†å¤šä¹ˆå¤§çš„ç¾éš¾</li>
<li>ä¹Ÿè®¸æ ¼é²å¸Œè‡ªå·±æ ¹æœ¬æ²¡æœ‰æƒ³åˆ°çš„æ˜¯åœ¨ä»–æ€è€ƒçš„è¿™ä¸€ç§’é’Ÿï¼Œå´å†³å®šäº†æ‹¿ç ´ä»‘å’Œä»–è‡ªå·±çš„å‘½è¿ï¼Œç”šè‡³ä¸–ç•Œå‘½è¿çš„ä¸€ç§’é’Ÿ</li>
<li>åˆ½å­æ‰‹é“¡åˆ€ä¸€é—ªï¼Œè¿™ä¸ªäººç±»ç¬¬ä¸€åŒåŒæ—¶è§è¿‡ä¸¤å¤§æµ·æ´‹çš„çœ¼ç›ï¼Œæ°¸è¿œç†„ç­äº†ç¥é‡‡ï¼ˆå·´å°”æ²ƒäºšï¼‰</li>
</ol>
<h1 id="è®°å¿†ç‚¹åŠæ„Ÿå—"><a href="#è®°å¿†ç‚¹åŠæ„Ÿå—" class="headerlink" title="è®°å¿†ç‚¹åŠæ„Ÿå—"></a>è®°å¿†ç‚¹åŠæ„Ÿå—</h1><p>æˆ‘åœ¨é˜…è¯»è¥¿æ–¹å†å²çš„æ—¶å€™çš„æˆ‘é¦–å…ˆå…³æ³¨çš„å˜é‡å°±æ˜¯æ—¶é—´èŠ‚ç‚¹ï¼Œåœ¨ä»€ä¹ˆæ—¶åˆ»å‘ç”Ÿäº†è¿™ä¸ªäº‹ä»¶ï¼Œè€Œæ¥ä¸‹æ¥æˆ‘è¦äº†è§£çš„å°±æ˜¯åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ä¸Šæˆ‘ä»¬è‡ªå·±çš„è¿™ç‰‡åœŸåœ°å¤„äºå“ªä¸ªæœä»£å‘ç”Ÿç€ä»€ä¹ˆæ ·çš„æ•…äº‹ã€‚å¤ä»£çš„ä¸­å›½å„æ–¹é¢è¿˜æ˜¯å¤„äºå…ˆè¿›æ°´å¹³ï¼Œä½†æ˜¯åˆ°äº†æ˜æ¸…æ—¶æœŸå¾ˆæ˜æ˜¾çš„æ„Ÿå—åˆ°è¥¿æ–¹å„ç§ç§‘æŠ€ã€ç¿çƒ‚æ–‡åŒ–æ¶Œç°ï¼Œè€Œæˆ‘ä»¬è‡ªå·±çš„å›½å®¶å§‹ç»ˆåœ¨ä¸€ä¸ªå†…å¿§å¤–æ‚£çš„é˜¶æ®µï¼Œç§‘æŠ€æ–‡åŒ–çš„ç§¯ç´¯ä¹Ÿåœ¨è¿™ä¸ªæ—¶æœŸè½åäºä¸–ç•Œ</p>
<p>æˆ‘è‡ªå·±å¹¶å¯¹äºæ–‡å­¦æ²¡æœ‰å¯ä»¥è¯´æ²¡å•¥å¤©èµ‹å¯¹äºå°¼é‡‡å•Šã€å·´å°”æ²ƒäºšç­‰äººæ•…äº‹ä¹Ÿæ²¡æœ‰æèµ·å¾ˆå¤§çš„å…´è¶£ï¼Œç›¸åå¯¹äºæ‹¿ç ´ä»‘ã€é²çƒ­ç­‰äººè¿˜æ˜¯è›®æ„Ÿå…´è¶£çš„ã€‚å¯¹äºä¸æ˜ç™½æ»‘é“å¢æˆ˜å½¹å…¨è¿‡ç¨‹çš„äººæ¥è®²ï¼ˆä¹‹å‰çš„æˆ‘ï¼‰å¤§å¤šæ•°éƒ½ä¼šå½’å’äºæ‹¿ç ´ä»‘ï¼Œä½†æ˜¯ç©¶ç«Ÿå¦‚ä½•å¤±è´¥å“ªé‡Œå¤±è´¥å´è¯´ä¸å‡ºæ‰€ä»¥ç„¶ã€‚è¯»å®Œè¿™ä¸€éƒ¨åˆ†æˆ‘åå€’è§‰å¾—æ²¡æœ‰ä»»ä½•äººè¯¥æ‰¿æ‹…è¿™ä¸€è´£ä»»ï¼Œä½†æŒ‰ç…§ä¹¦ç±çš„ç†è®ºï¼Œç”±äºæ ¼é²å¸Œå°†å†›çš„ä¸ä¼šå˜é€šå¯¼è‡´äº†æ»‘é“å¢æˆ˜å½¹çš„æœ€ç»ˆèƒœåˆ©ã€‚å†å²æ˜¯ç”±èƒœåˆ©è€…æ¥ä¹¦å†™çš„ï¼Œå¤±è´¥è€…å´è¿ç‹¡è¾©çš„æœºä¼šéƒ½æ²¡æœ‰ã€‚æˆ‘ä»¬ç°åœ¨çŸ¥é“ç»“æœæ˜¯è¿™ä¸ªæ ·å­ï¼Œå‡è®¾å½“æ—¶æˆ˜äº‰çš„ç»†èŠ‚æ˜¯å¦å¤–ä¸€ç§æ ·å­è€Œæ ¼é²å¸Œå°†å†›é€‰æ‹©é©°æ´æ»‘é“å¢æˆ‘ä»¬å¯èƒ½åˆä¼šè®¤ä¸ºæ˜¯ä»–çš„ä¸»åŠ¨æ€§å¤ªå¼ºå¯¼è‡´äº†æœ€ç»ˆçš„å¤±è´¥ã€‚æ‰€ä»¥ç»ˆç©¶è¿˜æ˜¯æˆ˜äº‰çš„æ®‹é…·æ€§å’Œä¸ç¡®å®šæ€§å¯¼è‡´äº†æœ€ç»ˆçš„ç»“æœã€‚å°½äººäº‹å¬å¤©å‘½ï¼Œå¤§æ¦‚è¯´çš„å°±æ˜¯è¿™ä¸ªå«ä¹‰å§ï¼ŒæŠŠæ¡æˆ‘ä»¬æ‰€èƒ½æŠŠæ¡çš„ï¼Œå‰©ä¸‹çš„å°±çœ‹å¤©æ„ã€‚</p>
<h1 id="ä¹¦æ‘˜"><a href="#ä¹¦æ‘˜" class="headerlink" title="ä¹¦æ‘˜"></a>ä¹¦æ‘˜</h1><p>ç©†ç½•é»˜å¾·äºŒä¸–â€”-æ‹œå åº­çš„æ²¦é™·</p>
<ul>
<li>å†å²ä¸Šæ‰€æœ‰ä»¥ç†æ™ºæ¢æ¥çš„å’Œå¹³éƒ½æ˜¯è½¬ç¬å³é€çš„</li>
<li>å‡ºå¥‡åˆ¶èƒœå¾€å¾€æ˜¯æ‰€æœ‰ä¼Ÿå¤§å†›äº‹è¡ŒåŠ¨ä¸­å–å¾—èƒœåˆ©çš„å…³é”®</li>
<li>äººä¸–é—´ç©ºå‰å›¢ç»“çš„åœºé¢æ€»æ˜¯åœ¨æœ€å±æ€¥çš„å…³å¤´æ‰ä¼šå‡ºç°</li>
<li>äººç±»çš„å†å²å’Œä¸€ä¸ªäººçš„ä¸€ç”Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸€å¤±è¶³æˆåƒå¤æ¨</li>
</ul>
<p>å·´å°”æ²ƒäºšâ€”-åœ¨ä¸æœ½çš„äº‹ä¸šé‡Œå¯»æ±‚ä¿æŠ¤</p>
<ul>
<li>èƒ½å¤Ÿåœ¨ç”Ÿå‘½çš„ä¸­é€”ï¼Œä¹Ÿå°±æ˜¯å¹´è½»åŠ›å£®çš„æ—¶å€™æ‰¾åˆ°è‡ªå·±è‚©è´Ÿçš„ä½¿å‘½ï¼Œè¿™çœŸçš„æ˜¯äººç”Ÿæœ€ç¾å¥½çš„äº‹æƒ…</li>
</ul>
<p>é²çƒ­â€”-ä¸€ä¸ªæµæ˜Ÿèˆ¬çš„å¤©æ‰</p>
<ul>
<li>åœ¨è¿™ä¸ªä¸–ç•Œä¸Šï¼Œä»æ¥å°±ä¸ä¼šæœ‰å“ªä¸€éƒ¨è•´å«å¼ºå¤§èƒ½é‡çš„ä½œå“è¢«åŸ‹æ²¡æˆ–è€…é•¿ä¹…çš„è¢«å°å­˜ï¼Œä¹Ÿä¸ä¼šæœ‰å“ªä¸€ä»¶ä¼˜ç§€çš„è‰ºæœ¯å“éšç€æ—¶é—´çš„æµé€è€Œè¢«é—å¿˜ï¼Œè™½ç„¶æœ‰æš‚æ—¶è¢«ç¦é”¢æˆ–è€…åŸ‹æ²¡çš„å¯èƒ½ï¼Œä½†ç»ˆç©¶è¿˜æ˜¯ç”Ÿå‘½åŠ›çš„ï¼Œä»–ä¼šå†²ç ´æ‰€æœ‰é˜»ç¢ï¼Œè„±é¢–è€Œå‡º</li>
</ul>
<p>æ‹¿ç ´ä»‘â€”-å†³å®šå‘½è¿çš„ä¸€åˆ†é’Ÿ</p>
<ul>
<li>å‘½è¿åªæ„¿æ„æˆå°±é‚£äº›å‹‡æ•¢è€…ã€‚å½“é‡ä»»é™ä¸´åˆ°å¹³åº¸ä¹‹è¾ˆèº«ä¸Šæ—¶ï¼Œä»–ä»¬ä¸æ˜¯æ„Ÿåˆ°åº†å¹¸ï¼Œè€Œæ˜¯å®³æ€•ã€‚ä»–ä»¬æŠŠè¿™ä¸ªæˆä¸ºå‘½è¿ä¸»äººçš„æœºä¼šï¼Œå“†å“†å—¦å—¦åœ°å¤±æ‰äº†</li>
<li>å‘½è¿â€”â€”è¿™æŒç®¡ä¸–é—´ä¸–ç•Œçš„å¦ä¸€ä¸ªç¥ï¼Œä»–å¼ºæœ‰åŠ›çš„åŒè‡‚åªæ„¿é«˜é«˜ä¸¾èµ·å‹‡æ•¢è€…ï¼Œå°†ä»–ä»¬é€ä¸Šè‹±é›„çš„æ®¿å ‚</li>
</ul>
<p>å°¼é‡‡â€”-å‘å®‡å®™é«˜å³°èµ°å»</p>
<ul>
<li>æ— æ³•å°†æˆ‘ç½®ä¹‹æ­»åœ°çš„ï¼Œæ›´ä»¤æˆ‘åšå¼º</li>
</ul>
<p>æ–¯ç§‘ç‰¹â€”-äº‰å¤ºå—æä¹‹æˆ˜</p>
<ul>
<li>ç›¸è¾ƒäºä½œå“ä¸­çš„æ‚²å‰§ï¼Œç”Ÿæ´»æœ¬èº«åˆ›é€ å‡ºçš„æ‚²å‰§è¦å¤šä¸€åƒå€</li>
<li>æ‚²å£®çš„å¤±è´¥ä¾ç„¶å…‰è£ï¼Œè¿™æ ·çš„å¤±è´¥èƒ½å¤Ÿæ¿€èµ·äººä»¬ç»§ç»­æŒ‘æˆ˜é™©å¢ƒçš„å‹‡æ°”ï¼Œå› ä¸ºåªæœ‰é›„å¿ƒå£®å¿—æ‰èƒ½å°†æ»¡æ€€çš„æ¿€æƒ…ç‚¹ç‡ƒï¼Œå»å®Œæˆé‚£å†ç»åƒéš¾ä¸‡é™©æ‰èƒ½å®Œæˆçš„äº‹</li>
</ul>
]]></content>
      <categories>
        <category>Reading</category>
      </categories>
      <tags>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>Opus Oggè¯¦è§£</title>
    <url>/2023/01/04/Audio/Audio-opus/</url>
    <content><![CDATA[<h1 id="opusæ˜¯ä»€ä¹ˆ"><a href="#opusæ˜¯ä»€ä¹ˆ" class="headerlink" title="opusæ˜¯ä»€ä¹ˆ"></a>opusæ˜¯ä»€ä¹ˆ</h1><blockquote>
<p>ä»¥ä¸‹å†…å®¹å–è‡ªopuså®˜ç½‘ï¼š<a href="https://www.opus-codec.org/">https://www.opus-codec.org</a></p>
</blockquote>
<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>Opus æ˜¯ä¸€ç§å®Œå…¨å¼€æ”¾ã€å…ç‰ˆç¨ã€ç”¨é€”å¹¿æ³›çš„éŸ³é¢‘ç¼–è§£ç å™¨ã€‚ Opus åœ¨ Internet ä¸Šçš„äº¤äº’å¼è¯­éŸ³å’ŒéŸ³ä¹ä¼ è¾“æ–¹é¢æ— ä¸ä¼¦æ¯”ï¼Œä½†ä¹Ÿé€‚ç”¨äºå­˜å‚¨å’Œæµåª’ä½“åº”ç”¨ã€‚å®ƒè¢«äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ (IETF) æ ‡å‡†åŒ–ä¸º RFC 6716ï¼Œå®ƒç»“åˆäº† Skype çš„ SILK ç¼–è§£ç å™¨å’Œ Xiph.Org çš„ CELT ç¼–è§£ç å™¨çš„æŠ€æœ¯ã€‚</p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p>Opus å¯ä»¥å¤„ç†èŒƒå›´å¹¿æ³›çš„éŸ³é¢‘åº”ç”¨ï¼ŒåŒ…æ‹¬ IP è¯­éŸ³ã€è§†é¢‘ä¼šè®®ã€æ¸¸æˆå†…èŠå¤©ï¼Œç”šè‡³è¿œç¨‹ç°åœºéŸ³ä¹è¡¨æ¼”ã€‚å®ƒå¯ä»¥ä»ä½æ¯”ç‰¹ç‡çª„å¸¦è¯­éŸ³æ‰©å±•åˆ°éå¸¸é«˜è´¨é‡çš„ç«‹ä½“å£°éŸ³ä¹ã€‚æ”¯æŒçš„åŠŸèƒ½æœ‰ï¼š</p>
<ul>
<li>æ¯”ç‰¹ç‡ä» 6 kb/s åˆ° 510 kb/s</li>
<li>é‡‡æ ·ç‡ä» 8 kHzï¼ˆçª„å¸¦ï¼‰åˆ° 48 kHzï¼ˆå…¨å¸¦ï¼‰</li>
<li>å¸§å¤§å°ä» 2.5 ms åˆ° 60 ms</li>
<li>æ”¯æŒæ’å®šæ¯”ç‰¹ç‡ (CBR) å’Œå¯å˜æ¯”ç‰¹ç‡ (VBR)</li>
<li>ä»çª„å¸¦åˆ°å…¨å¸¦çš„éŸ³é¢‘å¸¦å®½</li>
<li>æ”¯æŒè¯­éŸ³å’ŒéŸ³ä¹</li>
<li>æ”¯æŒå•å£°é“å’Œç«‹ä½“å£°</li>
<li>æ”¯æŒå¤šè¾¾ 255 ä¸ªé€šé“ï¼ˆå¤šæµå¸§ï¼‰</li>
<li>åŠ¨æ€å¯è°ƒæ¯”ç‰¹ç‡ã€éŸ³é¢‘å¸¦å®½å’Œå¸§å¤§å°</li>
<li>è‰¯å¥½çš„ä¸¢åŒ…é²æ£’æ€§å’Œä¸¢åŒ…éšè— (PLC)</li>
<li>æµ®ç‚¹å’Œå®šç‚¹å®ç°</li>
</ul>
<h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul>
<li><p>éŸ³é¢‘å¸¦å®½ã€‚Opusç¼–ç å™¨è¦†ç›–äº†ä½é¢‘æ®µåˆ°é«˜é¢‘æ®µçš„å…¨å¸¦éŸ³é¢‘</p>
</li>
<li><p>ä½å»¶è¿Ÿã€‚å»¶è¿Ÿä¾èµ–äºå¸§è§„æ ¼ï¼ŒOpusæœ€ä½å¸§è§„æ ¼2.5msï¼Œéå¸¸é€‚åˆå®æ—¶éŸ³è§†é¢‘åœºæ™¯</p>
</li>
</ul>
<h1 id="opusåº“"><a href="#opusåº“" class="headerlink" title="opusåº“"></a>opusåº“</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><blockquote>
<p>ç¼–è§£ç å™¨libopus: <a href="https://www.opus-codec.org/docs/opus_api-1.2/index.html">https://www.opus-codec.org/docs/opus_api-1.2/index.html</a></p>
<p>å°è£…å™¨opusfileï¼š<a href="https://www.opus-codec.org/docs/opusfile_api-0.7/index.html">https://www.opus-codec.org/docs/opusfile_api-0.7/index.html</a></p>
</blockquote>
<p>opusåº“åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šlibopusã€opus-toolsã€opusfile</p>
<ul>
<li>libopusï¼šopusç¼–è§£ç çš„æºç å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ³¨æ„ï¼šè¿™é‡Œç¼–ç å‡ºæ¥çš„opusæ–‡ä»¶æ˜¯æ’­æ”¾ä¸äº†çš„ï¼Œå¹¶ä¸”è§£ç ä¹Ÿå¿…é¡»ç”¨é‚£ç§æ’­æ”¾ä¸äº†çš„opusæ–‡ä»¶,åé¢è§£é‡Šä¸ºä»€ä¹ˆï¼‰</li>
<li>opus-toolsï¼šå·¥å…·åŒ…ï¼Œå…¶ä¸­åŒ…å«äº†liboggï¼ˆ.wav2.opus  /  .opus2.wavï¼‰</li>
<li>opusfileï¼šå°†å¯æ’­æ”¾çš„opusæ–‡ä»¶è§£ç æˆwavçš„å·¥å…·ï¼Œå¯åˆ†æå‡ºè¿™ä¸ªå¯æ’­æ”¾çš„opusæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†libogg</li>
</ul>
<h2 id="å¯æ’­æ”¾opusä¸ä¸å¯æ’­æ”¾opusæ–‡ä»¶"><a href="#å¯æ’­æ”¾opusä¸ä¸å¯æ’­æ”¾opusæ–‡ä»¶" class="headerlink" title="å¯æ’­æ”¾opusä¸ä¸å¯æ’­æ”¾opusæ–‡ä»¶"></a>å¯æ’­æ”¾opusä¸ä¸å¯æ’­æ”¾opusæ–‡ä»¶</h2><p>oggæ–‡ä»¶é‡Œé¢åŒ…å«äº†opusç¼–ç çš„éŸ³é¢‘ï¼Œç›¸å½“äºMP4æ–‡ä»¶ä¸­åŒ…å«äº†aac</p>
<ul>
<li>ä¸å¯æ’­æ”¾opusï¼šåªæœ‰ç¼–ç å±‚opusæ•°æ®çš„éŸ³é¢‘ï¼ˆæ²¡æœ‰oggçš„å°è£…åªç»è¿‡libopusç¼–ç ï¼‰ï¼Œåç¼€åæ˜¯.opus</li>
<li>å¯æ’­æ”¾çš„opusï¼šopusç¼–ç çš„éŸ³é¢‘å¤–éƒ¨å¥—ç”¨äº†ä¸€å±‚oggçš„å°è£…ï¼ˆç»è¿‡oggçš„å°è£…ï¼Œopus-toolsç¼–ç çš„æ–‡ä»¶ï¼‰ï¼Œåç¼€åå¯ä»¥æ˜¯.opusä¹Ÿå¯ä»¥æ˜¯.ogg</li>
</ul>
<h1 id="opusç»“æ„"><a href="#opusç»“æ„" class="headerlink" title="opusç»“æ„"></a>opusç»“æ„</h1><p>æ¯ä¸ª Opus åŒ…ä»¥ä¸€ä¸ª TOC ï¼ˆTable of Contentsï¼‰å­—èŠ‚å¼€å¤´</p>
<table>
<thead>
<tr>
<th>é…ç½®æ•°ï¼ˆconfigï¼‰</th>
<th>ç¼–ç æ¨¡å¼</th>
<th>éŸ³é¢‘å¸¦å®½</th>
<th>å¸§é•¿åº¦</th>
</tr>
</thead>
<tbody><tr>
<td>0â€¦3</td>
<td>SILK-only</td>
<td>NB</td>
<td>10, 20, 40, 60 ms</td>
</tr>
<tr>
<td>4â€¦7</td>
<td>SILK-only</td>
<td>MB</td>
<td>10, 20, 40, 60 ms</td>
</tr>
<tr>
<td>8â€¦11</td>
<td>SILK-only</td>
<td>WB</td>
<td>10, 20, 40, 60 ms</td>
</tr>
<tr>
<td>12â€¦13</td>
<td>Hybrid</td>
<td>SWB</td>
<td>10, 20 ms</td>
</tr>
<tr>
<td>14â€¦15</td>
<td>Hybrid</td>
<td>FB</td>
<td>10, 20 ms</td>
</tr>
<tr>
<td>16â€¦19</td>
<td>CELT-only</td>
<td>NB</td>
<td>2.5, 5, 10, 20 ms</td>
</tr>
<tr>
<td>20â€¦23</td>
<td>CELT-only</td>
<td>WB</td>
<td>2.5, 5, 10, 20 ms</td>
</tr>
<tr>
<td>24â€¦27</td>
<td>CELT-only</td>
<td>SWB</td>
<td>2.5, 5, 10, 20 ms</td>
</tr>
<tr>
<td>28â€¦31</td>
<td>CELT-only</td>
<td>FB</td>
<td>2.5, 5, 10, 20 ms</td>
</tr>
</tbody></table>
<p>ç«‹ä½“å£°æ ‡å¿—ä½ï¼ˆsï¼‰å–å€¼ 0 è¡¨ç¤ºå•å£°é“ï¼Œ1 è¡¨ç¤ºå¤šå£°é“ç«‹ä½“å£°ã€‚</p>
<p>TOC ä¸­æœ€åä¸¤ä½ï¼ˆcï¼‰è¡¨ç¤ºï¼š</p>
<ul>
<li>0ï¼šä¸€ä¸ªåŒ…ä¸­åªæœ‰ä¸€å¸§éŸ³é¢‘ã€‚</li>
<li>1ï¼šä¸€ä¸ªåŒ…ä¸­æœ‰ä¸¤å¸§éŸ³é¢‘ï¼Œå¹¶ä¸”å¤§å°ç›¸åŒã€‚</li>
<li>2ï¼šä¸€ä¸ªåŒ…ä¸­æœ‰ä¸¤å¸§éŸ³é¢‘ï¼Œä½†æ˜¯å¤§å°ä¸åŒã€‚</li>
</ul>
<h1 id="opusfile-API"><a href="#opusfile-API" class="headerlink" title="opusfile API"></a>opusfile API</h1><blockquote>
<p>opusfileé«˜çº§APIå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://opus-codec.org/docs/opusfile_api-0.12/">https://opus-codec.org/docs/opusfile_api-0.12/</a></p>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<p>â€‹	<a href="https://juejin.cn/post/6844903998831460360">https://juejin.cn/post/6844903998831460360</a></p>
<p>â€‹	<a href="https://chenliang.org/2020/04/17/ogg-encapsulation-for-opus/">https://chenliang.org/2020/04/17/ogg-encapsulation-for-opus/</a></p>
</blockquote>
<ol>
<li><p><strong>op_open_file() / op_free()</strong></p>
<p>æ‰“å¼€/å…³é—­ä¸€ä¸ªè§£ç å™¨</p>
</li>
<li><p><strong>op_head() / op_tags()</strong></p>
</li>
</ol>
<ul>
<li><p>op_headå‡½æ•°å¯ç”¨äºè·å–channelsã€samplerateç­‰å‚æ•°</p>
</li>
<li><p>op_tagså‡½æ•°å¯è·å¾—ç”¨æˆ·è‡ªå®šä¹‰å‚æ•°ï¼Œä¾‹å¦‚ï¼šæ ‡é¢˜ã€æ­Œæ‰‹ã€ç¼–ç æ–¹å¼æ ‡å‡†ç­‰ç­‰ï¼Œå…¶ä¸­tags-&gt;user_comments[i]å¯è·å–ç”¨æˆ·è‡ªå®šä¹‰çš„ä¿¡æ¯</p>
</li>
</ul>
<ol start="3">
<li><strong>op_pcm_total() / op_pcm_tell() / op_pcm_seek()</strong></li>
</ol>
<ul>
<li>op_pcm_total å¯ä»¥è¿”å›è¯¥opusæ–‡ä»¶è½¬æ¢æˆpcmæ–‡ä»¶åçš„æ€»çš„pcmé•¿åº¦</li>
<li>op_pcm_tell å¯ä»¥æ”¾å›ç›®å‰æ–‡ä»¶å·²ç»æ’­æ”¾çš„pcmçš„é•¿åº¦</li>
<li>op_pcm_seek å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šè®©éŸ³é¢‘è¿›è¡Œè·³è½¬æ’­æ”¾</li>
</ul>
<ol start="4">
<li><strong>op_pcm_read()</strong></li>
</ol>
<p>   ä»op_open_fileæ‰“å¼€çš„æ–‡ä»¶æµä¸­è¯»å–pcmæ•°æ®è¿›è¡Œæ’­æ”¾ã€‚æ³¨æ„è§£ç çš„æ•°é‡å¹¶ä¸ç­‰äºä¼ å…¥bufferçš„å¤§å°ï¼Œéœ€è¦ä½¿ç”¨åˆ°è¯¥å‡½æ•°çš„è¿”å›å€¼</p>
<h1 id="Ogg"><a href="#Ogg" class="headerlink" title="Ogg"></a>Ogg</h1><blockquote>
<p> å‚è€ƒ : <a href="https://juejin.cn/post/6844904016254599175">https://juejin.cn/post/6844904016254599175</a></p>
</blockquote>
<p>å…¨ç§°ï¼šOGGVobis(oggVorbis) ä¸€ä¸ªè‡ªç”±ä¸”å¼€æ”¾æ ‡å‡†çš„å®¹å™¨æ ¼å¼ï¼Œâ€œ.oggâ€ç»“å°¾å‘½å</p>
<p>OGGæ˜¯ä»¥é¡µï¼ˆpageï¼‰ä¸ºå•ä½å°†é€»è¾‘æµç»„ç»‡é“¾æ¥èµ·æ¥ï¼Œæ¯ä¸ªé¡µéƒ½æœ‰pageheaderå’Œpagedataã€‚</p>
<ol>
<li>capture_patterné¡µæ ‡è¯†ï¼šASCIIå­—ç¬¦ï¼Œ0x4f â€˜Oâ€™ 0x67 â€˜gâ€™ 0x67 â€˜gâ€™ 0x53 â€˜Sâ€™ï¼Œ4ä¸ªå­—èŠ‚å¤§å°ï¼Œå®ƒæ ‡è¯†ç€ä¸€ä¸ªé¡µçš„å¼€å§‹ã€‚</li>
<li>stream_structure_versionç‰ˆæœ¬idï¼šä¸€èˆ¬å½“å‰ç‰ˆæœ¬é»˜è®¤ä¸º0ï¼Œ1ä¸ªå­—èŠ‚ã€‚</li>
<li>header_type_flagç±»å‹æ ‡è¯†ï¼šæ ‡è¯†å½“å‰çš„é¡µçš„ç±»å‹ï¼Œ1ä¸ªå­—èŠ‚ï¼Œ - 0x01ï¼šæœ¬é¡µåª’ä½“ç¼–ç æ•°æ®ä¸å‰ä¸€é¡µå±äºåŒä¸€ä¸ªé€»è¾‘æµçš„åŒä¸€ä¸ªpacketï¼Œè‹¥æ­¤ä½æ²¡æœ‰è®¾ï¼Œè¡¨ç¤ºæœ¬é¡µæ˜¯ä»¥ä¸€ä¸ªæ–°çš„packetå¼€å§‹çš„ï¼› - 0x02ï¼šè¡¨ç¤ºè¯¥é¡µä¸ºé€»è¾‘æµçš„ç¬¬ä¸€é¡µï¼Œbosæ ‡è¯†ï¼Œå¦‚æœæ­¤ä½æœªè®¾ç½®ï¼Œé‚£è¡¨ç¤ºä¸æ˜¯ç¬¬ä¸€é¡µï¼› - 0x04ï¼šè¡¨ç¤ºè¯¥é¡µä½é€»è¾‘æµçš„æœ€åä¸€é¡µï¼Œeosæ ‡è¯†ï¼Œå¦‚æœæ­¤ä½æœªè®¾ç½®ï¼Œé‚£è¡¨ç¤ºæœ¬é¡µä¸æ˜¯æœ€åä¸€é¡µã€‚</li>
<li>granule_positionï¼šåª’ä½“ç¼–ç ç›¸å…³çš„å‚æ•°ä¿¡æ¯ï¼Œ8ä¸ªå­—èŠ‚ï¼Œå¯¹äºéŸ³é¢‘æµæ¥è¯´ï¼Œå®ƒå­˜å‚¨ç€åˆ°æœ¬é¡µä¸ºæ­¢é€»è¾‘æµåœ¨PCMè¾“å‡ºä¸­é‡‡æ ·ç çš„æ•°ç›®ï¼Œå¯ä»¥ç”±å®ƒæ¥ç®—å¾—æ—¶é—´æˆ³ã€‚å¯¹äºè§†é¢‘æµæ¥è¯´ï¼Œå®ƒå­˜å‚¨ç€åˆ°æœ¬é¡µä¸ºæ­¢è§†é¢‘å¸§ç¼–ç çš„æ•°ç›®ã€‚è‹¥æ­¤å€¼ä¸º-1ï¼Œé‚£è¡¨ç¤ºæˆªæ­¢åˆ°æœ¬é¡µï¼Œé€»è¾‘æµçš„packetæœªç»“æŸã€‚(å°ç«¯)</li>
<li>serial_numberï¼šå½“å‰é¡µä¸­çš„æµçš„idï¼Œ4ä¸ªå­—èŠ‚ï¼Œå®ƒæ˜¯åŒºåˆ†æœ¬é¡µæ‰€å±é€»è¾‘æµä¸å…¶ä»–é€»è¾‘æµçš„åºå·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå€¼æ¥åˆ’åˆ†æµã€‚(å°ç«¯)</li>
<li>page_seguence_numberï¼šæœ¬é¡µåœ¨é€»è¾‘æµçš„åºå·ï¼Œ4ä¸ªå­—èŠ‚ã€‚</li>
<li>CRC_cbecksumï¼šå¾ªç¯å†—ä½™æ•ˆéªŒç æ•ˆéªŒï¼Œ4ä¸ªå­—èŠ‚ï¼Œç”¨æ¥æ•ˆéªŒæ¯é¡µçš„æœ‰æ•ˆæ€§ã€‚</li>
<li>number_page_segmentsï¼šç»™å®šæœ¬é¡µåœ¨segment_tableåŸŸä¸­å‡ºç°çš„segementä¸ªæ•°ï¼Œ1ä¸ªå­—èŠ‚ã€‚</li>
<li>segment_tableï¼šä»å­—é¢çœ‹å®ƒå°±æ˜¯ä¸€ä¸ªè¡¨ï¼Œè¡¨ç¤ºç€æ¯ä¸ªsegmentçš„é•¿åº¦ï¼Œå–å€¼èŒƒå›´æ˜¯0~255ã€‚ç”±segmentï¼ˆ1ä¸ªsegmentå°±æ˜¯1ä¸ªå­—èŠ‚ï¼‰å¯ä»¥å¾—åˆ°packetçš„å€¼ï¼Œæ¯ä¸ªpacketçš„å¤§å°æ˜¯ä»¥æœ€åä¸€ä¸ªä¸ç­‰äº255çš„segmentç»“æŸçš„ï¼Œä»é¡µå¤´ä¸­çš„segment_tableå¯ä»¥å¾—åˆ°æ¯ä¸ªpacketé•¿åº¦ï¼Œä¸¾ä¾‹ï¼šå¦‚æœä¸€ç»„segmentä¾æ¬¡é¡ºåºä¸ºFF 45 FF FF FF 40FF 05FF FF FF 66ï¼ˆå…±4ä¸ªpacketï¼Œå«12ä¸ªsegmentï¼Œæ¯ä¸ªpacketçš„é•¿åº¦æ˜¯ï¼šFF 45ã€324ã€‘ï¼›FF FF FF 40ã€829ã€‘ï¼›FF 05ã€260ã€‘ï¼›FF FF FF 66ã€847ã€‘ï¼‰ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªpacketçš„é•¿åº¦ä¸º255+69 = 324,ç¬¬äºŒä¸ªpacketå¤§å°829ï¼ŒåŒç†ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Audio</category>
      </categories>
      <tags>
        <tag>opus</tag>
      </tags>
  </entry>
  <entry>
    <title>Audio-å†é‡</title>
    <url>/2022/09/05/Audio/Audio-meet-1/</url>
    <content><![CDATA[<p>æœ¬ç¯‡å†…å®¹å¯¹ä¸€èŠ‚æåˆ°çš„ç¼–ç è¿›è¡Œæ‰©å±•ï¼Œå°†é‡ç‚¹å¯¹PCMæ ¼å¼ã€WAVEæ ¼å¼ã€MP3æ ¼å¼è¿›è¡Œè¯¦ç»†è§£æã€‚</p>
<h1 id="PCM"><a href="#PCM" class="headerlink" title="PCM"></a>PCM</h1><p>PCM : Pulse-Code Modulation è„‰å†²è°ƒåˆ¶ç¼–ç </p>
<p>PCM æœ¬æ˜¯ä¸€ç§è°ƒåˆ¶æ–¹æ³•çš„åç§°ï¼Œè¿›è€Œé€šè¿‡è¯¥æ–¹æ³•å¾—åˆ°çš„éŸ³é¢‘æ•°æ®ä¹Ÿç§°ä½œPCMæ•°æ®ï¼Œå³è£¸æ•°æ®ã€‚è¯¥æ•°æ®æ˜¯æˆ‘ä»¬é€šè¿‡codecå¾—åˆ°çš„æœ€åŸå§‹çš„æ•°æ®ï¼</p>
<p>â€‹    <img src="/images/linux/Audio/Audio-remeet-1.png" alt="pic"></p>
<h1 id="WAVE"><a href="#WAVE" class="headerlink" title="WAVE"></a>WAVE</h1><p>WAVE : Waveform Audio File Format æ³¢å½¢éŸ³é¢‘æ–‡ä»¶æ ¼å¼, å³æˆ‘ä»¬å¹³æ—¶æ‰€è¯´çš„waveæ–‡ä»¶</p>
<p>å¾ˆç®€å•ï¼ŒWAVæ–‡ä»¶æ ¼å¼ç»“æ„ä½“é€šå¸¸æ˜¯ç”¨æ¥ä¿å­˜PCMæ ¼å¼çš„åŸå§‹æ•°æ®ï¼ŒåŸºäºæ­¤æ·»åŠ ä¸€ä¸ªæ–‡ä»¶å¤´æ„æˆäº†WAVæ–‡ä»¶ï¼Œå³wave = waveå¤´ + PCMæ•°æ®ã€‚å› æ­¤å®ƒé€šå¸¸ä¹Ÿè¢«ç§°ä¸ºæ— æŸéŸ³é¢‘ï¼Œä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è®²ï¼ŒWAVä¹Ÿå¯ä»¥å­˜å‚¨å…¶å®ƒå‹ç¼©æ ¼å¼çš„éŸ³é¢‘æ•°æ®ã€‚</p>
<h2 id="wavå¤´"><a href="#wavå¤´" class="headerlink" title="wavå¤´"></a>wavå¤´</h2><table>
<thead>
<tr>
<th><strong>åç§»åœ°å€</strong></th>
<th><strong>æ•°æ®ç±»å‹</strong></th>
<th><strong>å¤§å°</strong></th>
<th><strong>åç§°</strong></th>
<th><strong>å†…å®¹</strong></th>
</tr>
</thead>
<tbody><tr>
<td>00H~03H</td>
<td>char</td>
<td>4</td>
<td>èµ„æºäº¤æ¢æ–‡ä»¶æ ‡å¿— ( RIFF )</td>
<td>52 49 46 46 å›ºå®šå†™æ³•</td>
</tr>
<tr>
<td>04H~07H</td>
<td>long int ï¼ˆ4ï¼‰</td>
<td>1</td>
<td>æ–‡ä»¶å¤§å°size</td>
<td>ä»ä¸‹ä¸ªåœ°å€ (08) å¼€å§‹åˆ° WAV æ–‡ä»¶ç»“å°¾çš„æ€»å­—èŠ‚æ•°æ•´ä¸ª WAV æ–‡ä»¶çš„å¤§å°å°±æ˜¯è¯¥æ•°å€¼ + 8</td>
</tr>
<tr>
<td>08H~0BH</td>
<td>char</td>
<td>4</td>
<td>WAVæ–‡ä»¶æ ‡å¿— WAVE</td>
<td>57 41 56 45 , æ˜¯ WAVE å››ä¸ªå­—æ¯çš„ ASCII ç ï¼Œå›ºå®šå†™æ³•</td>
</tr>
<tr>
<td>0CH~0FH</td>
<td>char</td>
<td>4</td>
<td>æ³¢å½¢æ ¼å¼æ ‡å¿—ï¼ˆfmt ï¼‰</td>
<td>æœ€åä¸€ä½0x20 å¯¹åº”çš„å­—ç¬¦æ˜¯ç©ºæ ¼</td>
</tr>
<tr>
<td>10H~13H</td>
<td>int</td>
<td>1</td>
<td>è¿‡æ»¤å­—èŠ‚</td>
<td>ä¸€èˆ¬ä¸º00000010H</td>
</tr>
<tr>
<td>14H~15H</td>
<td>short int ï¼ˆ2ï¼‰</td>
<td>1</td>
<td><strong>æ ¼å¼ç§ç±»audioformat</strong></td>
<td>å€¼ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ•°æ®ä¸ºçº¿æ€§PCMç¼–ç </td>
</tr>
<tr>
<td>16H~17H</td>
<td>short int</td>
<td>1</td>
<td><strong>é€šé“æ•° channnels</strong></td>
<td>1 è¡¨ç¤ºå•å£°é“ , 2 è¡¨ç¤ºç«‹ä½“å£°</td>
</tr>
<tr>
<td>18H~1BH</td>
<td>long int</td>
<td>1</td>
<td><strong>é‡‡æ ·é¢‘ç‡ sampleRate</strong></td>
<td>80 BB 00 00 â€“ &gt; 48000 Hz ;</td>
</tr>
<tr>
<td>1CH~1FH</td>
<td>long int</td>
<td>1</td>
<td>æ³¢å½¢æ•°æ®ä¼ è¾“é€Ÿç‡ï¼ˆæ¯ç§’å¹³å‡å­—èŠ‚æ•°ï¼‰</td>
<td>é‡‡æ ·ç‡Ã—é€šé“æ•°Ã—é‡‡æ ·ä½æ•° / 8</td>
</tr>
<tr>
<td>20H~21H</td>
<td>short int</td>
<td>1</td>
<td>DATAæ•°æ®å—è°ƒæ•´é•¿åº¦ï¼Œå­—èŠ‚ã€‚</td>
<td>é€šé“æ•°Ã—æ ·æœ¬æ•°æ®ä½æ•° / 8</td>
</tr>
<tr>
<td>22H~23H</td>
<td>short int</td>
<td>1</td>
<td>PCMä½å®½</td>
<td>10 00 â€”-&gt; 16 ä½, 2 å­—èŠ‚</td>
</tr>
<tr>
<td>24H~27H</td>
<td>char</td>
<td>4</td>
<td>æ•°æ®æ ‡è®°</td>
<td>64 61 74 61 dataçš„ASCIIçš„å€¼</td>
</tr>
<tr>
<td>28H~2BH</td>
<td>long int</td>
<td>1</td>
<td>PCM æ•°æ®æ€»é•¿åº¦</td>
<td></td>
</tr>
</tbody></table>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>Qï¼šwaveæ–‡ä»¶çš„æ–‡ä»¶å¤´ä¸€å®šæ˜¯44Byteså—ï¼Ÿ</p>
<p>Aï¼šä¸ä¸€å®šï¼ä»¥ä¸Šæ ¼å¼åªæ˜¯waveæ–‡ä»¶çš„æ ‡å‡†ï¼Œå±äºé€šç”¨æ ‡å‡†ã€‚ä½†æ˜¯å°†å…¶ä»–æ ¼å¼æ–‡ä»¶é€šè¿‡ffmpegè½¬ç ä¹‹åçš„wavæ–‡ä»¶å¤´ä¼šå¤§äº44ä¸ªå­—èŠ‚ï¼ˆ115Bytesï¼‰ï¼Œåœ¨æ–‡ä»¶å¤´å’Œæ•°æ®å—ä¹‹é—´æ·»åŠ äº†ä¸€äº›ffmpegçš„ä¿¡æ¯ï¼Œéƒ¨åˆ†è¡¨å¾çš„æ„ä¹‰ä¸åŒï¼ç½‘ä¸Šå¾ˆå¤šæ ¼å¼è½¬æ¢å·¥å…·éƒ½æ˜¯è°ƒç”¨çš„ffmpegè½¬ç çš„ï¼Œå¯¼è‡´æ–‡ä»¶å¤´å¤§å°ä¸å®Œå…¨ç›¸åŒã€‚</p>
<blockquote>
<p>â€‹     -map_metadata -1 -fflags +bitexact å¯ä»¥å»é™¤æ ‡æ³¨ä¿¡æ¯ï¼Œä½¿æ–‡ä»¶å¤´ç¬¦åˆæ ‡å‡†</p>
<p>â€‹     ffmpeg -y -i music.mp3 -map_metadata -1 -fflags +bitexact -f wav -ac 1 -ar 16000 -ab 16k music.wav</p>
</blockquote>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>Ffmpegä¸å»æ ‡å‡†ä¿¡æ¯è½¬ç waveä¹‹åçš„æ–‡ä»¶æ ¼å¼ï¼š</p>
<table>
<thead>
<tr>
<th>åç§»åœ°å€</th>
<th>å­—èŠ‚æ•°</th>
<th>æ•°æ®ç±»å‹</th>
<th>å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td>00H ~ 23H</td>
<td>36</td>
<td>åŒä¸Šè¡¨çš„00H~23Hä¸€è‡´</td>
<td></td>
</tr>
<tr>
<td>24H ~ 27H</td>
<td>4</td>
<td>char</td>
<td>â€œLISTâ€, LISTå—æ ‡å¿—ï¼Œå›ºå®šä¸å˜</td>
</tr>
<tr>
<td>28H ~ 2BH</td>
<td>4</td>
<td>long</td>
<td>LISTå—å ç”¨çš„å­—èŠ‚æ•°ï¼Œåœ¨è¿™é‡Œä¸º26å­—èŠ‚</td>
</tr>
<tr>
<td>2CH ~ 45H</td>
<td>26</td>
<td>char</td>
<td>LISTå—å†…å®¹</td>
</tr>
<tr>
<td>46H ~ 49H</td>
<td>4</td>
<td>char</td>
<td>â€œdataâ€, dataæ•°æ®å—æ ‡å¿—ï¼Œå›ºå®šä¸å˜</td>
</tr>
<tr>
<td>4AH ~ 4DH</td>
<td>4</td>
<td>long</td>
<td>wavæ–‡ä»¶éŸ³é¢‘æ•°æ®æ‰€å å¤§å°</td>
</tr>
</tbody></table>
<h1 id="MP3"><a href="#MP3" class="headerlink" title="MP3"></a>MP3</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>MP3ï¼šMoving Picture Experts Group Audio Layer III, åŠ¨æ€å½±åƒä¸“å®¶å‹ç¼©æ ‡å‡†éŸ³é¢‘å±‚é¢3</p>
<p>é¦–å…ˆç§‘æ™®ä¸‹éƒ¨åˆ†æ¦‚å¿µï¼šMPEGï¼ˆMoving Pictures Experts Group ï¼ŒåŠ¨æ€å›¾åƒä¸“å®¶ç»„ï¼‰ï¼Œç®€å•ç†è§£å°±æ˜¯ä¸€äº›ç ”ç©¶éŸ³è§†é¢‘çš„ä¸“å®¶å‘å¸ƒçš„ç›¸å…³æ ‡å‡†ï¼Œå…¶å‘½åä¸ºMPEG-*ï¼ˆå…¶ä¸­*ä»£è¡¨æ•°å­—æˆ–å­—æ¯ï¼‰ï¼Œä¾‹å¦‚MPEG-1ã€MPEG-2.5ã€MPEG-Eç­‰ç­‰ã€‚</p>
<p>å¯èƒ½æœ‰äººä¼šæƒ³MPEG-3æ˜¯ä¸æ˜¯å°±æ˜¯MP3å‘¢ï¼ŸMPEGæ˜¯é’ˆå¯¹éŸ³è§†é¢‘åŠç³»ç»Ÿæµ‹è¯•çš„ä¸€æ•´å¥—çš„æ ‡å‡†è§„èŒƒï¼Œå…¶ä¸­å¯¹äºMPEG1æ¥è®²ï¼Œå…¶part3éŸ³é¢‘éƒ¨åˆ†è§„å®šäº†3ä¸ªç‹¬ç«‹åˆ†å±‚çš„éŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œåˆ†åˆ«ä¸ºlayer â… ã€layer â…¡ã€layer â…¢ï¼Œè€Œlayer â…¢ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„MP3ï¼ˆMEPEG1 Layer â…¢ï¼‰ï¼Œè¿™ä¸‰å±‚çš„åŒºåˆ«ä¸»è¦åœ¨äºç¼–ç çš„ç®—æ³•åŠè¾“å‡ºé€Ÿç‡çš„åŒºåˆ«ã€‚åŒæ ·çºµå‘æ¥çœ‹ï¼ŒMPEG2ã€MPEG2.5åŒæ ·æœ‰ä¸‰ä¸ªç‹¬ç«‹çš„layerï¼ŒåŒºåˆ«åœ¨äºå®ƒä»¬æ‰€ä½¿ç”¨çš„é‡‡æ ·ç‡æ›´ä½äº†ã€‚</p>
<h2 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h2><p>ç›®å‰å¤§å¤šæ•°æ ‡å‡†MP3æ–‡ä»¶éƒ½æ”¯æŒID3V2æ ‡å‡†ã€‚å…·ä½“ç»„æˆæ ¼å¼ä¸ºï¼šID3V2.3æ ‡ç­¾å¸§ï¼ˆ1ä¸ªï¼‰+ æ•°æ®å¸§ï¼ˆè‹¥å¹²ï¼‰+ ID3V1å¸§ï¼ˆ1ä¸ªï¼‰ï¼Œå…¶ä¸­ID3V2.3 = æ ‡ç­¾å¤´ï¼ˆ1ä¸ªï¼Œå¿…é¡»ï¼‰ + æ ‡ç­¾å¸§ï¼ˆè‹¥å¹²ï¼Œä¸å¿…é¡»ï¼‰ + æ‰©å±•æ ‡ç­¾å¤´ï¼ˆä¸å¿…é¡»ï¼‰</p>
<p>ç»„æˆéƒ¨åˆ†æˆ‘ç”»äº†ä¸€å¼ ç¤ºæ„å›¾å¯ä»¥å‚è€ƒï¼Œæ¯ä¸€éƒ¨åˆ†ä¸‹é¢å°†åšè¯¦ç»†è§£æ</p>
<p>â€‹    <img src="/images/linux/Audio/Audio-remeet-2.png" alt="pic"></p>
<h2 id="ID3æ ‡å‡†"><a href="#ID3æ ‡å‡†" class="headerlink" title="ID3æ ‡å‡†"></a>ID3æ ‡å‡†</h2><p>MP3å¸§å¤´ä¸­é™¤äº†å­˜å‚¨ä¸€äº›è±¡privateã€copyrightã€originalçš„ç®€å•éŸ³ä¹è¯´æ˜ä¿¡æ¯ä»¥å¤–ï¼Œæ²¡æœ‰è€ƒè™‘å­˜æ”¾æ­Œåã€ä½œè€…ã€ä¸“è¾‘åã€å¹´ä»½ ç­‰å¤æ‚ä¿¡æ¯ï¼Œè€Œè¿™äº›ä¿¡æ¯åœ¨MP3åº”ç”¨ä¸­éå¸¸å¿…è¦ã€‚1996å¹´ï¼ŒFricKempåœ¨â€œStudio 3â€é¡¹ç›®ä¸­æå‡ºäº†åœ¨MP3æ–‡ä»¶å°¾å¢åŠ ä¸€å—ç”¨äºå­˜æ”¾æ­Œæ›²çš„è¯´æ˜ä¿¡æ¯ï¼Œå½¢æˆäº†ID3æ ‡å‡†</p>
<h2 id="æ ‡ç­¾å¤´"><a href="#æ ‡ç­¾å¤´" class="headerlink" title="æ ‡ç­¾å¤´"></a>æ ‡ç­¾å¤´</h2><p>æ ‡ç­¾å¤´æ˜¯ç”±10Byteç»„æˆçš„ï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th>å®šä¹‰</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>char Header[3];</td>
<td>å¿…é¡»ä¸ºâ€ID3â€å¦åˆ™è®¤ä¸ºæ ‡ç­¾ä¸å­˜åœ¨ï¼Œå¦‚ä¸Šå›¾åœ°å€00â€”02éƒ¨åˆ†ä¸ºâ€49 44 33â€ï¼Œæ–‡æœ¬ä¸ºâ€œID3â€</td>
</tr>
<tr>
<td>char Ver;</td>
<td>ç‰ˆæœ¬å· ID3V2.3 å°±è®°å½• 3ï¼Œå¦‚ä¸Šå›¾åœ°å€03å¤„è®°å½•ä¸ºâ€03â€</td>
</tr>
<tr>
<td>char Revision;</td>
<td>å‰¯ç‰ˆæœ¬å·æ­¤ç‰ˆæœ¬è®°å½•ä¸º 0</td>
</tr>
<tr>
<td>char Flag;</td>
<td>æ”¾æ ‡å¿—çš„å­—èŠ‚ï¼Œä¸€èˆ¬ä¸º00abc00000a â€“ è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨ Unsynchronisationb â€“ è¡¨ç¤ºæ˜¯å¦æœ‰æ‰©å±•å¤´éƒ¨,ä¸€èˆ¬æ²¡æœ‰(è‡³å°‘ Winamp æ²¡æœ‰è®°å½•),æ‰€ä»¥ä¸€èˆ¬ä¹Ÿä¸è®¾ç½®c â€“ è¡¨ç¤ºæ˜¯å¦ä¸ºæµ‹è¯•æ ‡ç­¾(99.99%çš„æ ‡ç­¾éƒ½ä¸æ˜¯æµ‹è¯•ç”¨çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿä¸è®¾ç½®)</td>
</tr>
<tr>
<td>char Size[4];</td>
<td>æ ‡ç­¾å¤§å°,åŒ…æ‹¬æ ‡ç­¾å¤´çš„ 10 ä¸ªå­—èŠ‚å’Œæ‰€æœ‰çš„æ ‡ç­¾å¸§çš„å¤§å°</td>
</tr>
</tbody></table>
<p>æ•´ä¸ªæ ‡ç­¾å¤§å° :</p>
<p>ID3V2_frame_size = (int)(Size[0] &amp; 0x7F) &lt;&lt; 21 | (int)(Size[1] &amp; 0x7F) &lt;&lt; 14 | (int)(Size[2] &amp; 0x7F) &lt;&lt; 7 | (int)(Size[3] &amp; 0x7F) + 10;</p>
<h2 id="æ ‡ç­¾å¸§"><a href="#æ ‡ç­¾å¸§" class="headerlink" title="æ ‡ç­¾å¸§"></a>æ ‡ç­¾å¸§</h2><p>æ¯ä¸ªæ ‡ç­¾å¸§éƒ½æœ‰ä¸€ä¸ª 10 ä¸ªå­—èŠ‚çš„å¸§å¤´ï¼ˆè™½ç„¶éƒ½æ˜¯10å­—èŠ‚ï¼Œä½†æ˜¯ä¸æ ‡ç­¾å¤´ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚æ ‡ç­¾å¤´æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œè€Œæ ‡ç­¾å¤´æ¯ä¸€ä¸ªæ ‡ç­¾å¸§éƒ½æœ‰ä¸€ä¸ªå¸§å¤´ï¼‰å’Œè‡³å°‘ä¸€ä¸ªå­—èŠ‚çš„ä¸å›ºå®šé•¿åº¦çš„å†…å®¹ç»„æˆã€‚</p>
<table>
<thead>
<tr>
<th>å®šä¹‰</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>char FrameID[4]</td>
<td>ç”¨å››ä¸ªå­—ç¬¦æ ‡è¯†ä¸€ä¸ªå¸§ï¼Œè¯´æ˜å…¶å†…å®¹</td>
</tr>
<tr>
<td>char Size[4]</td>
<td>å¸§å†…å®¹çš„å¤§å°ï¼Œä¸åŒ…æ‹¬å¸§å¤´ï¼Œä¸å¾—å°äº1</td>
</tr>
<tr>
<td>char Flags[2]</td>
<td>å­˜æ”¾æ ‡å¿—ï¼Œåªå®šä¹‰äº†6 ä½ï¼Œæ­¤å¤„ä¸å†è¯´æ˜</td>
</tr>
</tbody></table>
<p>å¸¸ç”¨å¸§æ ‡è¯†ï¼š</p>
<p>TIT2ï¼šæ ‡é¢˜<br>TPE1ï¼šä½œè€…<br>TALBï¼šä¸“è¾‘<br>TRCKï¼š éŸ³è½¨ï¼Œæ ¼å¼ï¼šN/Mï¼ŒNè¡¨ç¤ºä¸“è¾‘ä¸­ç¬¬å‡ é¦–ï¼ŒMä¸ºä¸“è¾‘ä¸­æ­Œæ›²æ€»æ•°<br>TYERï¼šå¹´ä»½<br>TCONï¼šç±»å‹<br>COMMï¼šå¤‡æ³¨ï¼Œæ ¼å¼ï¼šâ€œeng\0å¤‡æ³¨å†…å®¹â€ï¼Œå…¶ä¸­engè¡¨ç¤ºæ‰€ä½¿ç”¨çš„è¯­è¨€<br>å¸§å¤§å°ä¸ºå››ä¸ªå­—èŠ‚æ‰€è¡¨ç¤ºçš„æ•´æ•°å¤§å°ã€‚</p>
<h2 id="æ•°æ®å¸§"><a href="#æ•°æ®å¸§" class="headerlink" title="æ•°æ®å¸§"></a>æ•°æ®å¸§</h2><p>æ•°æ®å¸§ç”±å¸§å¤´å’Œæ•°æ®å¸§ç»„æˆï¼Œå¯¹äºæ¯ä¸€å¸§æ•°æ®éƒ½æœ‰ä¸€ä¸ªå¸§å¤´ã€‚</p>
<p>å¸§å¤´é•¿4å­—èŠ‚ï¼Œå¯¹äºå›ºå®šä½ç‡çš„MP3æ–‡ä»¶ï¼Œæ‰€æœ‰å¸§çš„å¸§å¤´æ ¼å¼ä¸€æ ·å…¶æ•°æ®ç»“æ„å¦‚ä¸‹</p>
<p>typedef struct frameHeader<br>{<br>unsigned int sync1:8; //åŒæ­¥ä¿¡æ¯ 1<br>unsigned int error_protection:1; //CRC æ ¡éªŒ<br>unsigned int layer:2; //å±‚<br>unsigned int version:2; //ç‰ˆæœ¬<br>unsigned int sync2:3; //åŒæ­¥ä¿¡æ¯ 2<br>unsigned int extension:1; //ç‰ˆæƒ<br>unsigned int padding:1; //å¡«å……ç©ºç™½å­—<br>unsigned int sample_rate_index:2; //é‡‡æ ·ç‡ç´¢å¼•<br>unsigned int bit_rate_index:4; //ä½ç‡ç´¢å¼•<br>unsigned int emphasis:2; //å¼ºè°ƒæ–¹å¼<br>unsigned int original:1; //åŸå§‹åª’ä½“<br>unsigned int copyright:1; //ç‰ˆæƒæ ‡å¿—<br>unsigned int mode_extension:2; //æ‰©å±•æ¨¡å¼,ä»…ç”¨äºè”åˆç«‹ä½“å£°<br>unsigned int channel_mode:2; //å£°é“æ¨¡å¼<br>}FHEADER;</p>
<p>æ¯”ç‰¹ç‡ä¸º32çš„æ•´æ•°å€ä¸€èˆ¬å°±æ˜¯æ’å®šç¼–ç ï¼Œå¦åˆ™å°±æ˜¯å¯å˜ç¼–ç ï¼›å¯å˜ç¼–ç å¸§å¤´ä¸€èˆ¬ä¼šæœ‰ä¸åŒ</p>
<h2 id="ID3V1æ ‡ç­¾å¸§"><a href="#ID3V1æ ‡ç­¾å¸§" class="headerlink" title="ID3V1æ ‡ç­¾å¸§"></a>ID3V1æ ‡ç­¾å¸§</h2><p>æ ‡ç­¾å¤´æ˜¯ç”±128Byteç»„æˆçš„ï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th>å®šä¹‰</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>char Header[3]</td>
<td>æ ‡ç­¾å¤´å¿…é¡»æ˜¯â€TAGâ€å¦åˆ™è®¤ä¸ºæ²¡æœ‰æ ‡ç­¾</td>
</tr>
<tr>
<td>char Title[30]</td>
<td>æ ‡é¢˜</td>
</tr>
<tr>
<td>char Artist[30]</td>
<td>ä½œè€…</td>
</tr>
<tr>
<td>char Album[30]</td>
<td>ä¸“é›†</td>
</tr>
<tr>
<td>char Year[4]</td>
<td>å‡ºå“å¹´ä»£</td>
</tr>
<tr>
<td>char Comment[28]</td>
<td>å¤‡æ³¨</td>
</tr>
<tr>
<td>char reserve</td>
<td>ä¿ç•™</td>
</tr>
<tr>
<td>char track</td>
<td>éŸ³è½¨</td>
</tr>
<tr>
<td>char Genre;</td>
<td>ç±»å‹</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Audio</category>
      </categories>
  </entry>
  <entry>
    <title>ã€ŠåµŒå…¥å¼Cè¯­è¨€è‡ªæˆ‘ä¿®å…»ã€‹ç¬”è®°</title>
    <url>/2023/03/13/Reading/%E5%B5%8C%E5%85%A5%E5%BC%8FC%E8%AF%AD%E8%A8%80%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/</url>
    <content><![CDATA[<p><img src="/images/reading/QianRuShiC.jpg" alt="img"></p>
<h1 id="GNU-Cç¼–è¯‘å™¨æ‰©å±•è¯­æ³•ç²¾è®²ï¼ˆå…­ï¼‰"><a href="#GNU-Cç¼–è¯‘å™¨æ‰©å±•è¯­æ³•ç²¾è®²ï¼ˆå…­ï¼‰" class="headerlink" title="GNU Cç¼–è¯‘å™¨æ‰©å±•è¯­æ³•ç²¾è®²ï¼ˆå…­ï¼‰"></a>GNU Cç¼–è¯‘å™¨æ‰©å±•è¯­æ³•ç²¾è®²ï¼ˆå…­ï¼‰</h1><p>github Demoï¼š<a href="https://github.com/yangLieee/codebackup/blob/master/book_%E5%B5%8C%E5%85%A5%E5%BC%8FC%E8%AF%AD%E8%A8%80%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/gnuc.c">click here</a></p>
<h2 id="æŒ‡å®šåˆå§‹åŒ–"><a href="#æŒ‡å®šåˆå§‹åŒ–" class="headerlink" title="æŒ‡å®šåˆå§‹åŒ–"></a>æŒ‡å®šåˆå§‹åŒ–</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1.</span> æ•°ç»„åˆå§‹åŒ–</span><br><span class="line"><span class="type">int</span> <span class="built_in">array</span>[<span class="number">100</span>] = { [<span class="number">10</span>] = <span class="number">1</span>, [<span class="number">20</span>] = <span class="number">3</span> };</span><br><span class="line"></span><br><span class="line"># ... å‰åéƒ½éœ€è¦ç©ºæ ¼ï¼Œå¹¶ä¸”è¯¥ç‰¹æ€§ä¹Ÿå¯ä»¥ç”¨åœ¨<span class="keyword">switch</span>-<span class="keyword">case</span>è¯­å¥ä¸­</span><br><span class="line"><span class="type">int</span> <span class="built_in">array</span>[<span class="number">100</span>] = { [<span class="number">10</span> ... <span class="number">20</span>] = <span class="number">1</span>, [<span class="number">40</span> ... <span class="number">50</span>] = <span class="number">2</span> };</span><br><span class="line"><span class="keyword">switch</span>(i) {</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span> ... <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ç»“æ„ä½“æˆå‘˜åˆå§‹åŒ–  (é€šè¿‡ç»“æ„åŸŸå)</span><br><span class="line">ä¾‹å¦‚linuxå†…æ ¸ï¼š</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">const</span> <span class="title">file_opt</span> <span class="title">codec_opt</span> =</span> {</span><br><span class="line">    .open = codec_open,</span><br><span class="line">    .read = codec_read,</span><br><span class="line">    .write = codec_write,</span><br><span class="line">} </span><br><span class="line">å¥½å¤„ï¼šçµæ´»ï¼Œä»£ç æ˜“äºç»´æŠ¤</span><br></pre></td></tr></tbody></table></figure>

<h2 id="è¯­å¥è¡¨è¾¾å¼"><a href="#è¯­å¥è¡¨è¾¾å¼" class="headerlink" title="è¯­å¥è¡¨è¾¾å¼"></a>è¯­å¥è¡¨è¾¾å¼</h2><ul>
<li>ç›®çš„ï¼šæ„é€ å¤æ‚å®</li>
<li>ç»“æ„ï¼šï¼ˆ {  è¡¨è¾¾å¼1; è¡¨è¾¾å¼2;  è¡¨è¾¾å¼3  } ï¼‰ è¯­å¥è¡¨è¾¾å¼ç”¨ï¼ˆï¼‰å°æ‹¬å·æ‹¬èµ·æ¥ï¼Œä»£ç å—ç”¨ { } å¤§æ‹¬å·æ‹¬èµ·æ¥ï¼Œè¯­å¥è¡¨è¾¾å¼çš„å€¼ç­‰äºæœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼</li>
</ul>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><ol>
<li><p>æ±‚å’Œ</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">sum = ( {</span><br><span class="line">     <span class="type">int</span> s = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++&gt;) </span><br><span class="line">        s = s +i;</span><br><span class="line">     s;</span><br><span class="line">} )</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å®šä¹‰ä¸€ä¸ªå®ï¼Œæ±‚ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼ï¼Ÿ</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> my_max(x,y)   ({    \</span></span><br><span class="line"><span class="meta">    typeof(x) _x = (x);     \</span></span><br><span class="line"><span class="meta">    typeof(y) _y = (y);     \</span></span><br><span class="line"><span class="meta">    (void) (&amp;_x == &amp;_y);    \</span></span><br><span class="line"><span class="meta">    _x &gt; _y ? _x : _y;      \</span></span><br><span class="line"><span class="meta">})</span></span><br><span class="line"><span class="comment">// ç¬¬å…­è¡Œçš„ä½œç”¨ï¼šä¸åŒç±»å‹çš„æŒ‡é’ˆæ¯”è¾ƒä¼šç»™å‡ºè­¦å‘Šï¼ŒåŠ voidæ¶ˆé™¤æ²¡æœ‰ç”¨åˆ°æ¯”è¾ƒç»“æœå¸¦æ¥çš„è­¦å‘Š</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h2 id="container-ofå®"><a href="#container-ofå®" class="headerlink" title="container_ofå®"></a>container_ofå®</h2><ul>
<li><p>ä½œç”¨ï¼šæ ¹æ®ç»“æ„ä½“æŸä¸€æˆå‘˜åœ°å€ï¼Œè·å–è¿™ä¸ªç»“æ„ä½“çš„é¦–åœ°å€</p>
</li>
<li><p>åœºæ™¯ï¼šä¼ ç»™æŸä¸ªå‡½æ•°çš„å‚æ•°æ˜¯æŸä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­è¿˜å¯èƒ½ç”¨åˆ°è¿™ä¸ªç»“æ„ä½“å…¶å®ƒå˜é‡</p>
</li>
<li><p>åŸºç¡€ï¼šå¸¸é‡æŒ‡é’ˆçš„å€¼å³ä¸ºå¸¸é‡æœ¬èº«çš„å€¼ã€‚0å¼ºè½¬ä¸ºç»“æ„ä½“æŒ‡é’ˆï¼Œç»“æ„ä½“çš„é¦–åœ°å€ä¸º0ï¼Œæ¯ä¸ªæˆå‘˜å˜é‡éƒ½æ˜¯é¦–åœ°å€çš„ç›¸å¯¹åç§»</p>
</li>
<li><p>å®ç°</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> offset( TYPE , MEMBER ) ((size_t) &amp; (((TYPE*)0)-&gt;MEMBER))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> container_of(ptr, type, member) ({                    \                    </span></span><br><span class="line">            <span class="type">const</span> <span class="title function_">typeof</span><span class="params">(((type*)<span class="number">0</span>)-&gt;member)</span>* _ptr = (ptr);   \</span><br><span class="line">            (type*) ((<span class="type">char</span>*)_ptr - offset(type, member));     \                              </span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h2 id="é›¶é•¿æ•°ç»„"><a href="#é›¶é•¿æ•°ç»„" class="headerlink" title="é›¶é•¿æ•°ç»„"></a>é›¶é•¿æ•°ç»„</h2><ul>
<li>å®šä¹‰ï¼šé•¿åº¦ä¸º0çš„æ•°ç»„</li>
<li>ä¼˜ç‚¹ï¼šä¸å ç”¨å†…å­˜å­˜å‚¨ç©ºé—´</li>
<li>å…¶å®ƒï¼šC99æ”¯æŒå˜é•¿æ•°ç»„ï¼Œå³é•¿åº¦ç¼–è¯‘æ—¶æœŸæ˜¯ä¸èƒ½ç¡®å®šï¼Œåœ¨è¿è¡Œæ—¶æ‰å¯ä»¥ç¡®å®š</li>
<li>åº”ç”¨ï¼šå˜é•¿ç»“æ„ä½“</li>
<li>æ•°ç»„ä¸æŒ‡é’ˆåŒºåˆ«ï¼šæ•°ç»„åç”¨æ¥è¡¨å¾ä¸€å—è¿ç»­çš„å†…å­˜åœ°å€ç©ºé—´ï¼Œä»…ä»…æ˜¯ç¬¦å·ä¸åˆ†é…ç©ºé—´ï¼›æŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œç¼–è¯‘å™¨éœ€è¦å•ç‹¬ç»™å®ƒåˆ†é…ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œç”¨æ¥å­˜æ”¾ä»–æŒ‡å‘çš„å˜é‡çš„åœ°å€ã€‚</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">buffer</span> {</span></span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">  <span class="type">int</span> ptr[<span class="number">0</span>];  <span class="comment">// ä¸å å¤§å°</span></span><br><span class="line">};</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">buffer</span>* <span class="title">buf</span>;</span></span><br><span class="line">buf = (<span class="keyword">struct</span> buffer*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> buffer) + <span class="number">100</span>);</span><br><span class="line">buf-&gt;len = <span class="number">100</span>;</span><br></pre></td></tr></tbody></table></figure>



<h2 id="å±æ€§å£°æ˜"><a href="#å±æ€§å£°æ˜" class="headerlink" title="å±æ€§å£°æ˜"></a>å±æ€§å£°æ˜</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>__attribute__</p>
<ul>
<li>ä½œç”¨ï¼šæŒ‡å¯¼ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ç¨‹åºçš„æ—¶å€™è¿›è¡Œç‰¹å®šæ–¹é¢ä¼˜åŒ–æˆ–ä»£ç æ£€æŸ¥</li>
<li>æ ¼å¼ï¼š<strong>attribute</strong>(( ))ï¼Œåé¢éœ€è¦å†™ä¸¤å¯¹å°æ‹¬å·ï¼Œå¤šä¸ªå±æ€§ä¹‹é—´é€—å·éš”å¼€</li>
<li>æ”¯æŒçš„å±æ€§å£°æ˜ï¼šsectionã€alignedã€packedã€formatã€weakã€aliasã€noinlineã€always_inilne</li>
</ul>
<h3 id="section"><a href="#section" class="headerlink" title="section"></a>section</h3><ul>
<li><p>ä½œç”¨ï¼šå°†ä¸€ä¸ªå‡½æ•°æˆ–å˜é‡æ”¾åˆ°æŒ‡å®šçš„æ®µï¼Œå³æ”¾åˆ°æŒ‡å®šçš„section</p>
</li>
<li><p>ä½¿ç”¨ï¼š<strong>attribute</strong>(( section(â€œ.dataâ€) ))</p>
</li>
<li><p>å¯é€‰é¡¹ï¼š</p>
<ul>
<li><p>.textï¼šå‡½æ•°å®šä¹‰ã€ç¨‹åºè¯­å¥</p>
</li>
<li><p>.dataï¼šåˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€åˆå§‹åŒ–çš„é™æ€å±€éƒ¨å˜é‡</p>
</li>
<li><p>.bssï¼šæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€æœªåˆå§‹åŒ–çš„é™æ€å±€éƒ¨å˜é‡</p>
</li>
</ul>
</li>
</ul>
<h3 id="aligned"><a href="#aligned" class="headerlink" title="aligned"></a>aligned</h3><ul>
<li>ä½œç”¨ï¼šåœ°å€å¯¹é½ï¼Œåœ¨ç»™å˜é‡åˆ†é…å­˜å‚¨ç©ºé—´çš„æ—¶å€™ï¼Œéœ€è¦æŒ‰ç…§åˆ¶å®šçš„åœ°å€å¯¹é½æ–¹å¼ç»™å˜é‡åˆ†é…åœ°å€</li>
<li>æ³¨æ„ï¼šåœ°å€å¯¹é½çš„å­—èŠ‚æ•°å¿…é¡»æ˜¯2çš„å¹‚æ¬¡æ–¹</li>
<li>ä½¿ç”¨ï¼š<strong>attribute</strong>(( (aligned(4) ))</li>
<li>å¯¹é½çš„å¥½å¤„ï¼šç®€åŒ–CPUä¸RAMä¹‹é—´çš„æ¥å£å’Œç¡¬ä»¶è®¾è®¡ã€‚cpuè®¿å­˜ç¡¬ä»¶è®¾è®¡å¯èƒ½åªæ”¯æŒ4å­—èŠ‚æˆ–4å­—èŠ‚æ•´æ•°å€å¯¹é½çš„åœ°å€è®¿é—®ï¼Œå¯¹é½åcpuå¯ä»¥ä¸€æ¬¡è¯»å®Œ</li>
<li>æ³¨æ„ï¼šè¿™ä¸ªå±æ€§å£°æ˜åªæ˜¯å»ºè®®ç¼–è¯‘å™¨æŒ‰ç…§è¿™ç§æ–¹å¼å¯¹é½ï¼Œå½“è¶…è¿‡ç¼–è¯‘å™¨å…è®¸çš„æœ€å¤§å€¼åªèƒ½æŒ‰ç…§æœ€å¤§å¯¹é½å­—èŠ‚æ•°è¿›è¡Œåœ°å€åˆ†é…</li>
</ul>
<h3 id="packed"><a href="#packed" class="headerlink" title="packed"></a>packed</h3><ul>
<li>ä½œç”¨ï¼šå‡å°‘åœ°å€å¯¹é½</li>
<li>ä½¿ç”¨ï¼š <strong>attribute</strong>(( packed ))</li>
<li>é€šå¸¸alignedä¸packedä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·æ—¢é¿å…äº†ç»“æ„ä½“å„ä¸ªæˆå‘˜å˜é‡åœ°å€å¯¹é½äº§ç”Ÿçš„å†…å­˜ç©ºæ´åˆæŒ‡å®šäº†æ•´ä¸ªç»“æ„ä½“å¯¹é½æ–¹å¼ï¼š<strong>attribute</strong>(( packed, aligned(8) ))</li>
</ul>
<h3 id="format"><a href="#format" class="headerlink" title="format"></a>format</h3><ul>
<li>ä½œç”¨ï¼šæŒ‡å®šå˜å‚å‡½æ•°çš„å‚æ•°æ ¼å¼æ£€æŸ¥</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LOG</span><span class="params">(<span class="type">int</span> num, <span class="type">char</span>* fmt, ...)</span> __<span class="title function_">attribute__</span><span class="params">((format(<span class="built_in">printf</span>,<span class="number">2</span>,<span class="number">3</span>)))</span>)</span><br><span class="line"><span class="comment">// LOGå‡½æ•°çš„å‚æ•°ï¼Œä¸ªæ•°å­—ç¬¦ä¸²çš„ä½ç½®åœ¨æ‰€æœ‰å‚æ•°åˆ—è¡¨çš„ç´¢å¼•æ˜¯2,å³å‰ä¸¤ä¸ªå‚æ•°ï¼›è¦ç¼–è¾‘å™¨å¸®å¿™æ£€æŸ¥çš„å‚æ•°åœ¨æ‰€æœ‰å‚æ•°åˆ—è¡¨é‡Œçš„ç´¢å¼•æ˜¯3</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="weak"><a href="#weak" class="headerlink" title="weak"></a>weak</h3><ul>
<li>ä½œç”¨ï¼šå¯ä»¥å°†ä¸€ä¸ªå¼ºç¬¦å·è½¬æ¢ä¸ºå¼±ç¬¦å·</li>
<li>ä½¿ç”¨ï¼švoid _<em>attribute</em>(( weak )) func(void);</li>
<li>å¥½å¤„ï¼šå½“ä¸€ä¸ªå‡½æ•°è¢«å£°æ˜ä¸ºä¸€ä¸ªå¼±ç¬¦å·ä¹‹åï¼Œé“¾æ¥é˜¶æ®µæ‰¾ä¸åˆ°å‡½æ•°å®šä¹‰ä¸ä¼šæŠ¥é”™ä¼šå°†è¿™ä¸ªå¼±ç¬¦å·è®¾ç½®ä¸º0æˆ–è€…ç‰¹æ®Šå€¼ã€‚å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œè°ƒç”¨è¿™ä¸ªè¿™ä¸ªå‡½æ•°è·³è½¬åˆ°é›¶åœ°å€æˆ–ç‰¹æ®Šåœ°å€æ‰ä¼šäº§ç”Ÿä¸€ä¸ªå†…å­˜é”™è¯¯</li>
</ul>
<h3 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h3><ul>
<li>ä½œç”¨ï¼šç»™å‡½æ•°å®šä¹‰ä¸€ä¸ªåˆ«å</li>
<li>ä½¿ç”¨ï¼švoid f() <strong>attribute</strong>((alias(â€œ_f â€œ)));</li>
<li>é€šå¸¸åœ¨linuxå†…æ ¸ä¸­weakå’Œaliasä¸€èµ·ä½¿ç”¨ï¼Œéšç€ç‰ˆæœ¬å‡çº§å¯ä»¥å°è£…æ—§åå­—èµ·ä¸€ä¸ªæ–°åå­—</li>
</ul>
<h2 id="å†…è”å‡½æ•°"><a href="#å†…è”å‡½æ•°" class="headerlink" title="å†…è”å‡½æ•°"></a>å†…è”å‡½æ•°</h2><ul>
<li><p>ç‰¹å¾ï¼šç”¨inlineä¿®é¥°çš„å‡½æ•°è¢«ç§°ä¸ºå†…è”å‡½æ•°ï¼Œé€šå¸¸ç”¨static æˆ– extern ä¿®é¥°</p>
</li>
<li><p>å†…è”å‡½æ•°ç‰¹å¾ï¼š</p>
</li>
<li><ul>
<li>å‡½æ•°ä½“ç§¯å°</li>
<li>å‡½æ•°ä½“å†…æ— æŒ‡é’ˆèµ‹å€¼ã€é€’å½’ã€å¾ªç¯ç­‰è¯­å¥</li>
<li>è°ƒç”¨é¢‘ç¹</li>
</ul>
</li>
<li><p>ä¸å®ç›¸æ¯”ï¼Œå†…è”å‡½æ•°çš„ä¼˜ç‚¹ï¼š</p>
</li>
<li><ul>
<li>å‚æ•°ç±»å‹æ£€æŸ¥ï¼Œæœ¬è´¨ä»ç„¶æ˜¯å‡½æ•°</li>
<li>ä¾¿äºè°ƒè¯•ã€‚å¯ä»¥å•æ­¥ã€æ–­ç‚¹è°ƒè¯•</li>
<li>æœ‰è¿”å›å€¼ï¼ˆå®ä¹Ÿå¯ä»¥ï¼Œè¯­å¥è¡¨è¾¾å¼ç»“æ„ï¼‰</li>
<li>æ¥å£å°è£…</li>
</ul>
</li>
<li><p>ä½¿ç”¨ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ˜¾å¼å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å±•å¼€</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> __attribute((noinline)) <span class="type">int</span> <span class="title function_">func</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// æ˜¾å¼å‘Šè¯‰ç¼–è¯‘å™¨è¦å†…è”å±•å¼€</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> __attribute((always_inline)) <span class="type">int</span> <span class="title function_">func</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// å¦åˆ™ç¼–è¯‘å™¨çš„è¡Œä¸ºä¸å›ºå®šï¼Œè€ƒè™‘è¯¸å¤šå› ç´ å†³å®šæ˜¯å¦å±•å¼€</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h2 id="å†…å»ºå‡½æ•°"><a href="#å†…å»ºå‡½æ•°" class="headerlink" title="å†…å»ºå‡½æ•°"></a>å†…å»ºå‡½æ•°</h2><ul>
<li>å«ä¹‰ï¼šç¼–è¯‘å™¨å†…éƒ¨å®ç°çš„å‡½æ•°</li>
<li>ç‰¹å¾ï¼šé€šå¸¸ä»¥ __builtin å¼€å¤´</li>
<li>è¯´æ˜ï¼šæ²¡æœ‰æ–‡æ¡£ï¼Œå˜åŠ¨é¢‘ç¹ï¼Œä¸å»ºè®®åº”ç”¨ç¨‹åºå·¥ç¨‹å¸ˆä½¿ç”¨</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//  __builtin_return_addressï¼ˆLEVELï¼‰    è¿”å›å½“å‰å‡½æ•°æˆ–è€…è°ƒç”¨è€…çš„è¿”å›åœ°å€</span></span><br><span class="line"><span class="comment">// LEVEL 0: è·å–å½“å‰å‡½æ•°è¿”å›åœ°å€</span></span><br><span class="line"><span class="comment">// LEVEL 1: è·å–ä¸Šä¸€çº§å‡½æ•°è¿”å›åœ°å€</span></span><br><span class="line"><span class="comment">// LEVEL 2: è·å–ä¸Šä¸¤çº§å‡½æ•°è¿”å›åœ°å€</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// __builtin_frame_address(LEVEL)        æŸ¥çœ‹å‡½æ•°çš„æ ˆå¸§åœ°å€</span></span><br><span class="line"><span class="comment">// LEVEL 0: è·å–å½“å‰å‡½æ•°æ ˆå¸§åœ°å€</span></span><br><span class="line"><span class="comment">// LEVEL 1: è·å–ä¸Šä¸€çº§å‡½æ•°æ ˆå¸§åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// __builtin_constant_p(n)               åˆ¤æ–­å‚æ•°nåœ¨ç¼–è¯‘æ—¶æ˜¯å¦æ˜¯å¸¸é‡ï¼Œæ˜¯å¸¸é‡è¿”å›1,å¦åˆ™0</span></span><br><span class="line"><span class="comment">// å†…æ ¸ä¸­åˆ¤æ–­å®çš„å‚æ•°æ˜¯å¦æ˜¯å¸¸æ•°ï¼Œåˆ™æœ‰æ›´ä¼˜åŒ–çš„å®ç°æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// __builtin_expect(exp,c)        </span></span><br><span class="line"><span class="comment">// å‘Šè¯‰ç¼–è¯‘å™¨å‚æ•°expçš„å€¼ä¸ºcçš„å¯èƒ½æ€§å¾ˆå¤§ï¼Œç”¨äºåˆ†æ”¯é¢„æµ‹ï¼Œå‚æ•°cä¸è¿”å›å€¼æ— å…³ï¼Œè¿”å›å€¼ä¸€å®šæ˜¯exp</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> likely(x) __builtin_expect(!!(x),1)) </span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> unlikely(x) __builtin_expect(!!(x),0)</span></span><br><span class="line"><span class="comment">// å‘Šè¯‰ç¼–è¯‘å™¨æŸä¸€ä¸ªåˆ†æ”¯å‘ç”Ÿçš„æ¦‚ç‡å¾ˆé«˜ï¼Œè‡ªå·±åšä¼˜åŒ–</span></span><br><span class="line"><span class="comment">// ä¸¤æ¬¡å–éæ˜¯ä¸ºäº†å°†å‚æ•°xè½¬æ¢ä¸ºboolç±»å‹ï¼Œä¸1/0æ¯”è¾ƒ</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="å¯å˜å‚æ•°å®"><a href="#å¯å˜å‚æ•°å®" class="headerlink" title="å¯å˜å‚æ•°å®"></a>å¯å˜å‚æ•°å®</h2><ul>
<li>ç”¨ â€¦ è¡¨ç¤ºå˜å‚åˆ—è¡¨ï¼Œå˜å‚åˆ—è¡¨ç”±ä¸ç¡®å®šçš„å‚æ•°ç»„æˆï¼Œç”¨  <strong>VA_ARGS</strong>  æ ‡è¯†ç¬¦è¡¨ç¤ºå˜å‚å‡½æ•°åˆ—è¡¨</li>
<li>C99è§„å®šï¼Œå¯ä»¥ä½¿ç”¨ argsâ€¦  è¡¨ç¤ºå˜å‚åˆ—è¡¨ï¼Œç”¨ args ä»£è¡¨å˜å‚åˆ—è¡¨å³å¯</li>
<li>å®è¿æ¥ç¬¦  ##  çš„ä½œç”¨æ˜¯è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</li>
<li>åœ¨å®šä¹‰å®çš„æ—¶å€™é€šå¸¸ä½¿ç”¨ do { } while(0);çš„ç»“æ„ï¼Œè¿™æ ·æ˜¯ä¸ºäº†é˜²æ­¢å®åœ¨é€‰æ‹©ã€æ¡ç­‰åˆ†æ”¯è¯­å¥ä¸­å±•å¼€åï¼Œäº§ç”Ÿå®æ­§ä¹‰</li>
</ul>
<p>ä¸¤ç§æ–¹æ³•å®ç°è‡ªå®šä¹‰ç­‰çº§å®æ‰“å°ï¼š<a href="https://github.com/yangLieee/codebackup/blob/master/book_%E5%B5%8C%E5%85%A5%E5%BC%8FC%E8%AF%AD%E8%A8%80%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/mlog.h">click here</a></p>
<h2 id="Ubooté•œåƒè‡ªå¤åˆ¶"><a href="#Ubooté•œåƒè‡ªå¤åˆ¶" class="headerlink" title="Ubooté•œåƒè‡ªå¤åˆ¶"></a>Ubooté•œåƒè‡ªå¤åˆ¶</h2><ul>
<li>ä½œç”¨ï¼šåŠ è½½linuxå†…æ ¸é•œåƒåˆ°å†…å­˜ï¼Œç»™å†…æ ¸ä¼ é€’å¯åŠ¨å‚æ•°ï¼Œç„¶åå¼•å¯¼linuxæ“ä½œç³»ç»Ÿå¯åŠ¨</li>
<li>è¿‡ç¨‹ï¼šé€šè¿‡å®šä¹‰ä¸¤ä¸ªé›¶é•¿åº¦æ•°ç»„ï¼Œåˆ†åˆ«è¡¨ç¤ºè¦å¤åˆ¶è‡ªèº«é•œåƒçš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ï¼Œå¹¶æ”¾åœ¨ç‰¹å®šçš„sectionä¸Šï¼Œè€Œè¿™ä¸¤ä¸ªsectionåˆ†åˆ«æ”¾åœ¨ä»£ç æ®µå‰å’Œæ•°æ®æ®µåã€‚æ•°ç»„åæœ¬èº«å°±ä»£è¡¨ä¸€ä¸ªåœ°å€ï¼Œé€šè¿‡arm ldrä¼ªæŒ‡ä»¤ç›´æ¥è·å–è¦å¤åˆ¶çš„é•œåƒé¦–åœ°å€ä¿å­˜åœ¨æŸä¸ªå¯„å­˜å™¨ä¸­ï¼Œä»flashå¤åˆ¶è‡ªèº«é•œåƒåˆ°å†…å­˜ä¸­ï¼Œç„¶åé‡å®šä½ï¼Œæœ€ç»ˆè·³è½¬åˆ°å†…å­˜ä¸­æ‰§è¡Œã€‚ï¼ˆè‡ªä¸¾ï¼‰</li>
</ul>
<h1 id="Cè¯­è¨€é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼ˆå…«ï¼‰"><a href="#Cè¯­è¨€é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼ˆå…«ï¼‰" class="headerlink" title="Cè¯­è¨€é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼ˆå…«ï¼‰"></a>Cè¯­è¨€é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼ˆå…«ï¼‰</h1><h2 id="ä»£ç å¤ç”¨ä¸åˆ†å±‚"><a href="#ä»£ç å¤ç”¨ä¸åˆ†å±‚" class="headerlink" title="ä»£ç å¤ç”¨ä¸åˆ†å±‚"></a>ä»£ç å¤ç”¨ä¸åˆ†å±‚</h2><p>å¤ç”¨ï¼š</p>
<ul>
<li>å‡½æ•°çº§å¤ç”¨</li>
<li>åº“çº§å¤ç”¨</li>
<li>æ¡†æ¶çº§å¤ç”¨</li>
<li>æ“ä½œç³»ç»Ÿçº§å¤ç”¨</li>
</ul>
<p>åˆ†å±‚ï¼š</p>
<ul>
<li>åº”ç”¨å±‚</li>
<li>Frameworkå±‚</li>
<li>åº“</li>
<li>Linuxå†…æ ¸</li>
</ul>
<h2 id="é¢å‘å¯¹è±¡ä¸»è¦ç‰¹å¾"><a href="#é¢å‘å¯¹è±¡ä¸»è¦ç‰¹å¾" class="headerlink" title="é¢å‘å¯¹è±¡ä¸»è¦ç‰¹å¾"></a>é¢å‘å¯¹è±¡ä¸»è¦ç‰¹å¾</h2><p>ç»§æ‰¿ã€å¤šæ€ã€çº¯è™šå‡½æ•°ç‰¹å¾ï¼ˆæŠ½è±¡ç±»ï¼‰</p>
<h1 id="æ¨¡å—åŒ–ï¼ˆä¹ï¼‰"><a href="#æ¨¡å—åŒ–ï¼ˆä¹ï¼‰" class="headerlink" title="æ¨¡å—åŒ–ï¼ˆä¹ï¼‰"></a>æ¨¡å—åŒ–ï¼ˆä¹ï¼‰</h1><p>æ¨¡å—åŒ–çš„æ€æƒ³å†…æ ¸æ˜¯åˆ†è€Œæ²»ä¹‹ï¼Œé‡ç‚¹åœ¨äºæŠ½è±¡çš„å¯¹è±¡ä¹‹é—´çš„å…³è”ï¼Œè€Œä¸æ˜¯å†…å®¹</p>
<p>é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³ä¸»è¦æ˜¯ä¸ºäº†ä»£ç å¤ç”¨ï¼Œé‡ç‚¹åœ¨äºå†…å®¹çš„å®ç°</p>
]]></content>
      <categories>
        <category>Reading</category>
      </categories>
      <tags>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šæ›¾å›½è—©ä¼ ã€‹</title>
    <url>/2022/12/11/Reading/%E6%9B%BE%E5%9B%BD%E8%97%A9%E4%BC%A0/</url>
    <content><![CDATA[<p><img src="/images/reading/zengGuoFan.jpg" alt="img"></p>
<p>è¿‘å‡ å¹´ï¼Œæ›¾å›½è—©å€å—æˆåŠŸå­¦çš„æ¨å´‡ï¼Œå…³äºä»–çš„ä¹¦ä¹Ÿæ˜¯é“ºå¤©ç›–åœ°ã€‚å¶ç„¶é—´çœ‹åˆ°è€ä¿ï¼ˆä¿æ•æ´ªï¼‰åœ¨æ¨èè¿™æœ¬ä¹¦ï¼Œå¸¦ç€æµ“åšçš„å…´è¶£å¼€å§‹å¯¹è¿™æœ¬ä¹¦çš„æ¢ç´¢ã€‚ã€Šæ›¾å›½è—©ä¼ ã€‹æ˜¯ä¸­å›½çŸ¥åå†å²å­¦å®¶å¼ å®æ°å…ˆç”Ÿçš„ä½œå“ï¼Œé™¤äº†è¿™æœ¬ã€Šæ›¾å›½è—©ä¼ ã€‹ä»–è¿˜è‘—æœ‰ã€Šæ›¾å›½è—©çš„æ­£é¢ä¸ä¾§é¢ã€‹ã€Šé¥¥é¥¿çš„ç››ä¸–ã€‹ã€Šå¤§æ˜ç‹æœçš„ä¸ƒå¼ é¢å­”ã€‹ç­‰ç­‰ã€‚æ•´æœ¬ä¹¦é€šè¯»ä¸‹æ¥ï¼Œä½œè€…æŒ‰ç…§æ—¶é—´é¡ºåºï¼Œä»¥æ›¾å›½è—©æ—¥è®°åŠå„ç§å†å²å‚è€ƒæ–‡çŒ®ä¸ºå²å®åŸºç¡€è¿›è¡Œäº†æ·±åº¦è§£è¯»ï¼Œå°†æ›¾å›½è—©å›½ä¹‹é‡è‡£çš„å½¢è±¡ç«‹ä½“çš„å±•ç°åœ¨äº†æˆ‘ä»¬çš„çœ¼å‰ã€‚</p>
<p>æœ¬ç¯‡ä¹Ÿæ— æ‰€è°“æ˜¯è¯»ä¹¦ç¬”è®°ã€è¯»åæ„Ÿäº¦æˆ–è€…æ˜¯ä¹¦è¯„äº†ï¼Œä¾¿æƒ³åˆ°å“ªé‡Œå†™åˆ°å“ªé‡Œå§ã€‚</p>
<h1 id="æ•…äº‹è‡ªè¿°"><a href="#æ•…äº‹è‡ªè¿°" class="headerlink" title="æ•…äº‹è‡ªè¿°"></a>æ•…äº‹è‡ªè¿°</h1><p>æ›¾å›½è—©å†ä»»æ™šæ¸…å››æœï¼Œç”Ÿäºå˜‰åº†ã€æ–‡äºé“å…‰ã€æ­¦äºå’¸ä¸°ã€å’äºåŒæ²»ï¼Œæˆ‘è¿™é‡Œçš„æ–‡ã€æ­¦åˆ†åˆ«æŒ‡å…¶äº¬å®˜æ—¶ä»£å’Œé¢†å¯¼æ¹˜å†›é˜¶æ®µã€‚</p>
<p>è€æ›¾å®¶æœ¬æ˜¯ä¸€ä¸ªæ®·å®çš„å°åœ°ä¸»å®¶åº­ï¼Œå¥ˆä½•ç¥–åŸä¸€ç›´æ²¡å†’é’çƒŸï¼Œç¥–è¾ˆä¸Šæ²¡æœ‰ä¸€ä¸ªè¯»ä¹¦äººã€‚åœ¨çˆ·çˆ·æ›¾ç‰å±çš„å½±å“ä¸‹ï¼Œå°å°çš„æ›¾å­åŸï¼ˆè¯¥æ—¶æœŸæ›¾å›½è—©æœªæ”¹åï¼‰å¼€å¯äº†ä»–çš„è¯»ä¹¦ç”Ÿæ¶¯ã€‚å±¡æˆ˜å±¡è´¥ã€å±¡è´¥å±¡æˆ˜ï¼Œè½æ¦œå…­æ¬¡ä¹‹åï¼Œé™¢è¯•ä¸­ç§€æ‰ã€ä¹¡è¯•ä¸­ä¸¾äººã€ä¼šè¯•ä¸­è¿›å£«ï¼Œä¹Ÿå°±æ˜¯åœ¨æ­¤æ­£å¼æ›´åä¸ºæ›¾å›½è—©ï¼Œå¯„ä»¥â€œå›½ä¹‹è—©ç¯±â€œä¹‹æ„ï¼Œæ­¤æ—¶ä»–æ‰äºŒåå…«å²ã€‚åœ¨æ­¤ä¹‹ååœ¨äº¬åå¹´ä¸­ï¼Œæ›¾å›½è—©ç«‹ä¸‹å­¦åšåœ£äººçš„å®æ„¿å¹¶åšéŸ§ä¸æ‹”åœ°æ²¿ç€è¿™æ¡ä»•é€”ä¹‹é“å‰è¿›ï¼Œæ­¥æ­¥å‡è¿åˆ°äºŒå“å®˜ä½ã€‚åå¹´ä¸ƒè¿ï¼Œè¿è·ƒåçº§ã€‚ç›´è‡³1852å¹´å……ä»»æ±Ÿè¥¿ä¹¡è¯•æ­£è€ƒå®˜æ‰ç»“æŸäº†ä»–çš„äº¬å®˜ç”Ÿæ¶¯ã€‚</p>
<p>åœ¨æ›¾å›½è—©æ˜¥é£å¾—æ„ä¹‹é™…ï¼Œå´çªç„¶æ”¶åˆ°æ¯äº²å»ä¸–çš„å™©è€—ï¼Œè‡´ä½¿ä»–ä¸å¾—ä¸æ”¹å˜è‡ªå·±çš„è¡Œç¨‹å›å®¶å®ˆå­ã€‚æ­¤æ—¶å¤ªå¹³å¤©å›½è¿åŠ¨è½°è½°çƒˆçƒˆå¸­å·åŠä¸ªä¸­å›½ï¼Œè€Œæ¸…å†›ä¸»åŠ›å…«æ——å’Œç»¿è¥æ—©å·²è…è´¥ä¸å ªï¼Œå’¸ä¸°çš‡å¸ä¸å¾—ä¸é¢å¸ƒå…´åŠå›¢ç»ƒçš„è¯ä¹¦ã€‚æ›¾å›½è—©èµ·åˆå†…å¿ƒæ˜¯æ‹’ç»çš„ï¼Œä½†æ˜¯å¿ƒç³»å›½å®¶çš„ä»–æœ€ç»ˆè¿˜æ˜¯å†³å®šåº”è¯ï¼Œä»¥å›¢ä¸ºè¡¨ï¼Œä»¥å†›ä¸ºé‡Œç»„å»ºèµ·äº†æ¹˜å†›ï¼Œæ®Šä¸çŸ¥è¿™æ”¯å†›é˜Ÿæˆäº†æ—¥åæŠµæŠ—å¤ªå¹³å†›çš„ä¸»åŠ›ã€‚æ²¡æœ‰ä»»ä½•å†›äº‹ç»éªŒã€åˆæ¥ä¹åˆ°å†åŠ ä¸Šæ›¾å›½è—©æ­¤æ—¶ç›´ç‡çš„æ€§æ ¼ç‰¹å¾ï¼Œç»„å»ºä¸€æ”¯åƒæ ·ä¸”æœ‰æˆ˜æ–—åŠ›çš„å†›é˜Ÿçš„éš¾åº¦å¯æƒ³è€ŒçŸ¥ï¼Œå…‹æœé‡é‡å›°éš¾æ¹˜å†›ç®—æ˜¯å»ºç«‹èµ·æ¥äº†ã€‚æŠ±ç€é¦–æˆ˜å¿…èƒœçš„å¿ƒç†æ›¾å›½è—©å†³å®šå‡ºå…µé–æ¸¯ï¼Œæœªæ›¾å¯çŸ¥è¿æ¥ä¸€åœºå¤§è´¥ï¼Œè¿™ä¹Ÿè®©ä»–çš„ä¿¡å¿ƒè·Œè½è°·åº•ä¸€åº¦è·³æ±Ÿè‡ªæ€ï¼Œå¹¸è¢«æ•‘ä¸‹ã€‚éšåå¤§å¤§å°å°æˆ˜æ–—ç»å†æ— æ•°ï¼Œæ¹˜æ½­å¤§æ·ã€ä¹æ±Ÿå¤§è´¥â€¦â€¦ 1857å¹´çˆ¶äº²å»ä¸–ï¼Œä»–å‘çš‡å¸è¯·æ±‚å›å®¶å¥”ä¸§ä¸‰ä¸ªæœˆï¼Œæœªæ›¾æƒ³å†æƒ³å¤å‡ºå´è¢«çš‡å¸è§£é™¤äº†å…µæƒã€‚</p>
<p>å¡ç¿å¤±é©¬ç„‰çŸ¥éç¦ï¼Ÿä¹Ÿæ­£æ˜¯æ¥ä¸‹æ¥ä¸¤å¹´çš„è›°ä¼è®©æ›¾å›½è—©å®Œæˆäº†è„±èƒæ¢éª¨çš„å˜åŒ–ï¼Œä»–å¼€å§‹å˜å¾—é€šäººæƒ…ä¸–æ•…ï¼Œé€‚åº”æ™šæ¸…å®˜åœºçš„ç¯å¢ƒï¼Œä½†é¢å¯¹è‡ªå·±æ—¶ä»ç„¶é€‰æ‹©åšåœ£äººã€‚è¶ç€å¤ªå¹³å†›å†…è®§çŸ³è¾¾å¼€çš„å‡ºèµ°ï¼Œå¥½å…„å¼Ÿèƒ¡æ—ç¿¼ç»™æ›¾å›½è—©äº‰å–æ¥äº†å†åº¦å‡ºå±±çš„æœºä¼šï¼Œä¹‹åä¸¤äººè”æ‰‹æ”»å…‹äº†å®‰åº†ï¼ŒæœŸé—´ä½•æ¡‚æ¸…å¼ƒåŸé€ƒè·‘ä¹Ÿæˆå°±äº†æ›¾å›½è—©å¾—åˆ°äº†æ¢¦å¯ä»¥æ±‚çš„ä¸¤æ±Ÿæ€»ç£çš„èŒä½ã€‚æ°´åˆ°æ¸ æˆåœ°1864å¹´æ­£æœˆï¼Œæ”»ç ´å¤©äº¬ï¼Œç»“æŸå›ä¹±ã€‚</p>
<p>æ­¤æ—¶æ›¾å›½è—©ä»»ä¸¤æ±Ÿæ€»ç£ï¼Œåé¢åº”è¯¥å°±æ˜¯è¢«å¤§ä¼—æ‰€ç†ŸçŸ¥çš„éƒ¨åˆ†â€”â€”ä¸»åŠæ´‹åŠ¡ã€‚é¦–å…ˆä»–å’Œè‡ªå·±çš„æ¥ç­äººæé¸¿ç« è”æ‰‹å‰¿ç­äº†åŒ—æ–¹é»„æ·®ä¸€å¸¦çš„æ»å†›èµ·ä¹‰ï¼Œéšåä¾¿æ˜¯å…´åŠæ´‹åŠ¡ï¼Œå»ºç«‹å®‰åº†å†›æ¢°æ‰€ã€æ±Ÿå—åˆ¶é€ æ€»å±€ï¼Œç¿»è¯‘å¤§é‡å¤–æ–‡ä¹¦ç±ç­‰ç­‰ã€‚1868å¹´å‡ä»»ç›´éš¶æ€»ç£å¤„ç†å®Œå¤©æ´¥æ•™æ¡ˆäº‹ä»¶å› å¤‡å—æŒ‡è´£å†æ¬¡æ‹…ä»»ä¸¤æ±Ÿæ€»ç£ï¼Œå››å¹´åä¸­å›½ä¼ ç»Ÿæ–‡åŒ–æœ€åä¸€ä¸ªå¶åƒæ›¾å›½è—©å»ä¸–ã€‚</p>
<h1 id="æ„Ÿæ‚Ÿ"><a href="#æ„Ÿæ‚Ÿ" class="headerlink" title="æ„Ÿæ‚Ÿ"></a>æ„Ÿæ‚Ÿ</h1><h2 id="è¶ŠåŠªåŠ›è¶Šå¹¸è¿"><a href="#è¶ŠåŠªåŠ›è¶Šå¹¸è¿" class="headerlink" title="è¶ŠåŠªåŠ›è¶Šå¹¸è¿"></a>è¶ŠåŠªåŠ›è¶Šå¹¸è¿</h2><p>æ›¾å›½è—©ä¸èƒ½è¯´æ˜¯å¤©èµ„å“è¶Šçš„äººï¼Œä»ä»–è¯»ä¹¦ã€æ²»å†›ç»å†ä¸éš¾çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚å…³äºè¿™ä¸€ç‚¹è¿˜æœ‰ä¸€ä¸ªå¹¿ä¸ºæµä¼ çš„å°æ•…äº‹ï¼Œä¸€æ—¥é»„æ˜ï¼Œä»–åœ¨ä¹¦æ¡Œå‰èƒŒè¯µã€Šå²³é˜³æ¥¼è®°ã€‹ï¼Œä¸€ä¸ªå°å·å·å·æ½œå…¥ä»–å®¶çˆ¬åˆ°æˆ¿æ¢ä¸Šï¼Œç­‰å¾…è¿™ä¸€å®¶äººéƒ½å…¥ç¡åå·ä¸œè¥¿ã€‚å¥ˆä½•å°å·ç¡äº†å¥½å‡ è§‰ï¼Œæ›¾å›½è—©è¿˜æ²¡æœ‰èƒŒä¸‹æ¥ï¼Œå°å·æ°”æ€¥è´¥åè·³ä¸‹æˆ¿æ¢è¯´ï¼šå°±ä½ è¿™ä¸ªç¬¨æ ·è¯»ä»€ä¹ˆä¹¦ï¼Ÿéšåä»–å®Œå®Œæ•´æ•´èƒŒäº†ä¸€éï¼Œç”©é—¨è€Œå»ï¼Œç•™ä¸‹çš„æ›¾å›½è—©ç›®çªå£å‘†ä¸€äººå‡Œä¹±ã€‚çœŸå®æ€§æ— ä»è€ƒè¯ï¼Œä½†æ˜¯ç”±æ­¤å¯è§ä»–æ˜¯çœŸæŒºç¬¨çš„ï¼Œè€Œä»–æœªæ¥çš„æˆå°±æ›´å¤šæ¥è‡ªäºåŠªåŠ›ã€‚ä»–çš„äººç”Ÿå“²å­¦ä¾¿æ˜¯â€å°šæ‹™â€œï¼Œå´‡å°šç¬¨æ‹™ã€‚æ›¾å›½è—©æ›¾è¯´ï¼šâ€œå¤©ä¸‹ä¹‹è‡³æ‹™ï¼Œèƒ½èƒœå¤©ä¸‹ä¹‹ä¹‹å·§â€ã€‚ä¸€å‘³çš„è¿½æ±‚é«˜æ•ˆç‡è€Œä¸æ‹©æ‰‹æ®µã€æŠ•æœºå–å·§ç»ˆä¸èƒ½æˆå¤§æ‰ã€‚å¤©èµ‹ä¸å¤Ÿï¼ŒåŠªåŠ›æ¥å‡‘ï¼Œè€Œè¶ŠåŠªåŠ›æ‰ä¼šè¶Šå¹¸è¿ã€‚</p>
<h2 id="å†å²æ€»æ˜¯æœ‰è¿¹å¯å¾ª"><a href="#å†å²æ€»æ˜¯æœ‰è¿¹å¯å¾ª" class="headerlink" title="å†å²æ€»æ˜¯æœ‰è¿¹å¯å¾ª"></a>å†å²æ€»æ˜¯æœ‰è¿¹å¯å¾ª</h2><p>åœ¨æœ¬ä¹¦ä¸­æ›¾æœ‰è¿‡è¿™æ ·ä¸¤ä¸ªç‰‡æ®µã€‚</p>
<p>å…¶ä¸€ï¼Œåœ¨æ›¾å›½è—©å®ˆåˆ¶æœŸé—´å¤§å½»å¤§æ‚Ÿå®Œæˆèœ•å˜ï¼Œä»–çªç„¶æ„è¯†åˆ°æ‰€è°“â€å¤©ä¸‹ä¹‹è‡³æŸ”ï¼Œé©°éª‹å¤©ä¸‹ä¹‹å¿—åšâ€œã€â€å¤§æŸ”éæŸ”ï¼Œè‡³åˆšæ— åˆšâ€œçœŸæ­£çš„å«ä¹‰ã€‚è¡Œäº‹è¿‡äºæ–¹åˆšè€…ï¼Œè¡¨é¢ä¼¼ä¹æ˜¯å¼ºè€…ï¼Œå®é™…ä¸Šç¡®æ˜¯å¼±è€…ã€‚è€Œä»–ä¹‹å‰çœ‹ä¸èµ·çš„éº»æœ¨ã€åœ†æ»‘ã€æœºè¯ˆæœ‰æ—¶å€™æ‰æ˜¯è§£å†³é—®é¢˜çš„æœ€å¥½æ–¹æ³•ã€‚</p>
<p>å…¶äºŒï¼Œåœ¨æ”»æ‰“å®‰åº†æœŸé—´ï¼Œèƒ¡æ—ç¿¼åˆ›é€ å‡ºâ€å›´åŸæ‰“æ´â€œçš„æˆ˜æœ¯ï¼Œç»™åœ¨æ¹–åŒ—ä½œæˆ˜çš„æ¹˜å†›ç»Ÿå¸…å¤šéš†é˜¿çš„ä¿¡ä¸­è¯´é“ï¼Œæˆ˜äº‰çš„ç›®çš„ä¸åœ¨äºä¸€åŸä¸€æ± çš„å¾—å¤±ï¼Œè€Œåœ¨äºæ¶ˆç­å¯¹æ–¹çš„æœ‰ç”ŸåŠ›é‡ã€‚</p>
<p>è¯»åˆ°ç¬¬ä¸€ä¸ªç‰‡æ®µï¼Œè„‘æµ·ä¸­ä¸ç”±å¾—æµ®ç°å‡ºè€å­â€ä»¥æŸ”å…‹åˆšâ€œçš„æ€æƒ³ï¼Œè€Œæ›¾å›½è—©å¤§å½»å¤§æ‚Ÿåçš„æ€æƒ³ä½•å°ä¸æ˜¯å¯¹å…ˆè´¤æ€æƒ³çš„è¿›ä¸€æ­¥é˜è¿°å’Œå‡åã€‚è€Œè¯»åˆ°ç¬¬äºŒä¸ªç‰‡æ®µæ—¶ï¼Œè„‘æµ·é‡Œæµ®ç°çš„æ˜¯è§£æ”¾æˆ˜äº‰æœŸé—´ï¼Œæ¯›ä¸»å¸­åœ¨å»¶å®‰é¢å¯¹èƒ¡å®—å—äºŒåäº”ä¸‡å¤§å†›ä¸»åŠ¨æ’¤ç¦»ï¼Œå†³å®šâ€æ‹¿ä¸€ä¸ªå»¶å®‰æ¢å–ä¸€ä¸ªå…¨ä¸­å›½â€œã€‚å½“æ—¶ä¾¿æå‡ºï¼šå­˜åœ°å¤±äººï¼Œäººåœ°çš†å¤±ï¼›å­˜äººå¤±åœ°ï¼Œäººåœ°çš†å­˜ã€‚è¿™ä¸èƒ¡æ—ç¿¼è®²è¿°çš„æˆ˜äº‰ç›®çš„å¯è°“æ˜¯å¦‚å‡ºä¸€è¾™ã€‚</p>
<h2 id="å°½äººäº‹ï¼Œå¬å¤©å‘½"><a href="#å°½äººäº‹ï¼Œå¬å¤©å‘½" class="headerlink" title="å°½äººäº‹ï¼Œå¬å¤©å‘½"></a>å°½äººäº‹ï¼Œå¬å¤©å‘½</h2><p>åœ¨æ›¾å›½è—©èµ‹é—²åœ¨å®¶ä¸ºçˆ¶äº²æ²»ä¸§ä¸‰ä¸ªæœˆæœŸæ»¡ä¹‹æ—¶ï¼Œä»–å‘çš‡å¸ç”³è¯·ç»§ç»­å®ˆåˆ¶ä¸‰å¹´ï¼Œå¤ªå¹³å¤©å›½æœªç­çš‡å¸å½“ç„¶ä¸ä¼šæ‰¹å‡†è¿™ä¸ªè¯·æ±‚ã€‚äºæ˜¯æ›¾å›½è—©è¯´å‡ºäº†å®æƒ…ï¼šå“­è¯‰äº†ä¸€ç•ªè‡ªå·±çš„å§”å±ˆå’Œå›°éš¾ï¼Œå¹¶å¯¹çš‡å¸è¯´å¦‚æœä½ ä¸ç»™æˆ‘ç£æŠšå¤§æƒï¼Œæˆ‘å°±åªèƒ½åœ¨ç±ç»ˆåˆ¶ã€‚è¿™æ˜æ˜¾æ˜¯èµ¤è£¸è£¸çš„è¦æŒŸï¼Œå‡ºä¹æ›¾å›½è—©çš„é¢„æ–™ï¼Œå’¸ä¸°çš‡å¸å±…ç„¶ç­”åº”äº†ä»–çš„å®ˆåˆ¶è¯·æ±‚ï¼Œå½»å½»åº•åº•æ²¡æ”¶äº†å†›æƒã€‚è€Œåœ¨ä¸å¤ªå¹³å¤©å›½çš„å†³æˆ˜å½“ä¸­ï¼Œä½•æ¡‚æ¸…å¼ƒåŸé€ƒè·‘ï¼Œæ›¾å›½è—©æ²¡æœ‰ç´¢è¦çš‡å¸ä¾¿æŠŠä½•æ¡‚æ¸…ä¸¤æ±Ÿæ€»ç£èŒä½ç»™åˆ°äº†ä»–ã€‚</p>
<p>ä¸€æ—¦åœ¨åšä¸€ä»¶äº‹æƒ…æ—¶æœ‰äº†æå¼ºçš„åŠŸåˆ©å¿ƒï¼Œå®ç°çš„è¿‡ç¨‹å¯èƒ½å°†ä¸æ‹©æ‰‹æ®µï¼Œç›®æ ‡ä¹Ÿå¯èƒ½ä¼šèƒŒé“è€Œé©°ï¼Œæœ€ç»ˆä¸€å®šä¸ä¼šè¾¾åˆ°æœ€å®Œç¾çš„çŠ¶æ€ã€‚è€Œæœ€å¥½çš„æ–¹å¼åˆ™æ˜¯åšåˆ°â€å°½äººäº‹å¬å¤©å‘½â€œï¼Œå°½å¿ƒå°½åŠ›çš„å»åšäº‹æƒ…ï¼Œè€Œèƒ½å¦æˆåŠŸï¼Œåˆ™éœ€è¦é¡ºå…¶è‡ªç„¶ã€‚</p>
<h2 id="è„šè¸å®åœ°ï¼Œå¸¸äºåæ€"><a href="#è„šè¸å®åœ°ï¼Œå¸¸äºåæ€" class="headerlink" title="è„šè¸å®åœ°ï¼Œå¸¸äºåæ€"></a>è„šè¸å®åœ°ï¼Œå¸¸äºåæ€</h2><p>åœ¨å…«æ——å…µå’Œç»¿è¥å…µæˆ˜æ–—åŠ›å¦‚æ­¤ä½ä¸‹çš„æƒ…å†µä¸‹ï¼Œä¸€ä»‹ä¹¦ç”Ÿæ›¾å›½è—©ä¸ºä»€ä¹ˆåˆ›å»ºå‡ºæˆ˜æ–—åŠ›æ»¡æ»¡çš„æ¹˜å†›å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯åæ€çš„åŠ›é‡ï¼Œä»–è¿½æ ¹æº¯æºæ‰¾åˆ°å…«æ——ç»¿è¥çœŸæ­£ç—‡ç»“æ‰€åœ¨å¹¶åœ¨æ¹˜å†›ä¸­åŠæ—¶è°ƒæ•´å®ŒæˆåŠŸä¸šã€‚è€Œå»ºç«‹èµ·æ¥çš„æ¹˜å†›åœ¨æˆ˜æ–—æ—¶å¥‰è¡Œçš„æ—¶æ›¾å›½è—©â€ç»“ç¡¬å¯¨ï¼Œæ‰“å‘†ä»—â€œçš„æˆ˜æœ¯ï¼Œå…·ä½“æ¥è®²å°±æ˜¯â€ä»¥é™åˆ¶åŠ¨ï¼Œåå®¢ä¸ºä¸»â€œï¼ŒæŠŠè‡ªå·±çš„è¥å¯¨ç›˜ç»“å®ç­‰å¾…æ•Œäººå‰æ¥è¿›æ”»ï¼Œç­‰å¾…ä»–ä»¬éœ²å‡ºé©¬è„šæ¹˜å†›å†åæ”»ï¼Œè¿™ä¾¿æ˜¯æ•´ä¸ªé€»è¾‘ã€‚</p>
<p>ç»†ç»†çœ‹ä¸‹æ¥æ›¾å›½è—©çš„æˆ˜æœ¯ä¸€å®šä¸æ˜¯æœ€å…ˆè¿›çš„ä½†ä¸€å®šæ˜¯æœ€ç¨³å¦¥çš„ã€‚ä¸è®ºèµ°å¤šè¿œçš„è·¯ï¼Œä½†ä¸€å®šè¦ç¡®ä¿èµ°è¿‡çš„æ¯ä¸€æ­¥è·¯éƒ½æœ‰è‡ªå·±çš„è„šå°ã€‚</p>
<h2 id="ä¿æŒå¿§æ‚£æ„è¯†"><a href="#ä¿æŒå¿§æ‚£æ„è¯†" class="headerlink" title="ä¿æŒå¿§æ‚£æ„è¯†"></a>ä¿æŒå¿§æ‚£æ„è¯†</h2><p>åœ¨å¤ªå¹³å¤©å›½è¿åŠ¨è¢«å¹³å®šä¹‹åï¼Œæ¹˜å†›æ— ç–‘æˆäº†æ•´ä¸ªæ¸…ç‹æœæœ€å¼ºå¤§çš„æˆ˜æ–—åŠ›ã€‚æ›¾å›½è—©ç†Ÿè¯»å²ä¹¦ï¼Œã€Šæ˜“ä¼ ã€‹ä¸­è®²ï¼šæ—¥ä¸­åˆ™æ˜ƒï¼Œæœˆç›ˆåˆ™äºã€‚è¶Šæ˜¯è¾‰ç…Œçš„æ—¶å€™è¶Šåº”è¯¥ä¿æŒæ¸…é†’çš„å¤´è„‘ï¼Œæ‡‚å¾—è¶‹ç¦é¿ç¥¸ã€‚ä»–æ€ä¹ˆèƒ½ä¸æ˜ç™½æœå»·çš„å¿ƒæ€å‘¢ï¼Œä¸ºäº†ä¸è®©æœå»·çŒœå¿Œå†³å®šè‡ªå‰ªç¾½æ¯›è£æ’¤æ¹˜å†›ã€‚ä¸æ­¤åŒæ—¶ï¼Œä»–é»˜é»˜çš„å°†éƒ¨åˆ†ä¸»åŠ›äº¤ç»™æé¸¿ç« çš„æ·®å†›å½“ä¸­ã€‚è¿™ä¸€æ‰‹â€è£æ¹˜ç•™æ·®â€œçš„æ“ä½œå¯è°“çœŸçš„æ˜¯ç²—ä¸­æœ‰ç»†ï¼Œè¿™ä¹Ÿä¿è¯äº†å®ƒåé¢å®˜åœºç”Ÿæ¶¯çš„å»¶ç»­ã€‚</p>
<h2 id="è¯»ä¹¦æ°¸è¿œå¯ä»¥ä¿æŒç«äº‰åŠ›"><a href="#è¯»ä¹¦æ°¸è¿œå¯ä»¥ä¿æŒç«äº‰åŠ›" class="headerlink" title="è¯»ä¹¦æ°¸è¿œå¯ä»¥ä¿æŒç«äº‰åŠ›"></a>è¯»ä¹¦æ°¸è¿œå¯ä»¥ä¿æŒç«äº‰åŠ›</h2><p>é€‰å£«äººï¼Œé¢†å±±å†œã€‚æ¹˜å†›å¤§éƒ¨åˆ†äººéƒ½æ˜¯å±±å†œå³å†œæ°‘å‡ºèº«ã€‚ä½†æ˜¯æ¹˜å†›é‡è§†æ”¿æ²»æ•™è‚²ï¼Œç½—æ³½å—éƒ¨åˆ™ç´¢æ€§ç™½å¤©æ‰“ä»—ï¼Œæ™šä¸ŠæŠŠéƒ¨ä¸‹å¬é›†åˆ°ä¸€èµ·ï¼Œæ•™ä»–ä»¬è¯»ä¹¦ï¼Œå­¦ä¹ ç†å­¦ã€‚æµæ°“ä¸å¯æ€•ï¼Œå°±æ€•æµæ°“æœ‰æ–‡åŒ–ï¼Œè¿™å¥è¯å¯èƒ½ä¸æ˜¯å¾ˆæ°å½“ï¼Œä½†æ˜¯æœ‰äº†çŸ¥è¯†çš„å†œæ°‘éƒ¨é˜Ÿæˆ˜æ–—åŠ›ã€æˆ˜æ–—ç´ å…»æå‡äº†å¯ä¸æ˜¯ä¸€ä¸ªç­‰çº§ã€‚</p>
<h2 id="æ¡ƒææ»¡å¤©ä¸‹"><a href="#æ¡ƒææ»¡å¤©ä¸‹" class="headerlink" title="æ¡ƒææ»¡å¤©ä¸‹"></a>æ¡ƒææ»¡å¤©ä¸‹</h2><p>è¿™ä¸€é¡¹ä¸èƒ½ç®—ä½œæ˜¯æ„Ÿæ‚Ÿï¼Œç§°å¾—ä¸Šæ˜¯æ›¾å›½è—©çš„æˆå°±ã€‚æ™šæ¸…å¤§å¤šæ•°é‡è‡£éƒ½å¤šå¤šå°‘å°‘éƒ½å—åˆ°è¿‡æ›¾å›½è—©çš„æç‚¹ï¼Œæé¸¿ç« ã€å·¦å®—æ£ ã€æ²ˆè‘†æ¡¢ã€å½­ç‰éºŸã€èƒ¡æ—ç¿¼ç­‰ç­‰ï¼Œå°¤å…¶æ˜¯æé¸¿ç« å¯è°“æ˜¯ä¸€æ‰‹ææ‹”èµ·æ¥çš„ã€‚è‹±å›½ä¸€ä½å†å²å­¦å®¶è¯´ï¼šæ›¾å›½è—©æ˜¯ä¸­å›½æœ€æœ‰åŠ¿åŠ›çš„äººï¼Œä½†ä»–æ­»å»çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„æ€»ç£ï¼ˆç±»ä¼¼äºç°åœ¨çš„çœå§”ä¹¦è®°ï¼‰éƒ½æ›¾åšè¿‡ä»–çš„éƒ¨ä¸‹ï¼Œå¹¶ä¸”éƒ½æ˜¯ç”±ä»–æåçš„ã€‚å¦‚æœä»–å¸Œå†€ï¼Œä»–å¯èƒ½å·²ç»æˆä¸ºçš‡å¸ã€‚çœŸå®æ€§æ— ä»è€ƒè¯ï¼Œä½†ç”±æ­¤ä¹Ÿå¯çœ‹å‡ºä»–çš„å½±å“åŠ›ä¹‹å¤§</p>
<h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>æ›¾å›½è—©è¿™ä¸€ç”Ÿæ˜¯å¤±è´¥çš„ã€‚ä¸ºå¤©åœ°ç«‹å¿ƒã€ä¸ºç”Ÿæ°‘ç«‹å‘½ã€ä¸ºå¾€åœ£ç»§ç»å­¦ã€ä¸ºä¸‡ä¸–å¼€å¤ªå¹³ã€‚æ›¾å›½è—©ç”¨ä»–çš„ä¸€ç”Ÿæ¥è·µè¡Œå¼ è½½çš„æ¨ªæ¸ å››å¥ï¼Œä½†å¯æƒœç”Ÿä¸é€¢æ—¶ç»ˆç©¶æ˜¯æ²¡æœ‰å®Œæˆå…¨éƒ¨çš„ç†æƒ³ï¼Œæ— å¥ˆæˆä¸ºè¿½æ—¥çš„å¤¸çˆ¶ã€å¡«æµ·çš„ç²¾å«ã€‚åœ¨è¿™é‡Œå¼•ç”¨ä¸€ä¸‹æ¨è€€åœ¨â€å¾—åˆ°â€œAPPè§£è¯»æé¸¿ç« ä¸€ä¹¦ä¸­æåˆ°çš„ï¼šæ—¶åŠ¿èƒ½å¤Ÿé€ è‹±é›„ï¼Œè€Œè‹±é›„ä¹Ÿå¯ä»¥æ”¹å˜æ—¶åŠ¿ã€‚è€Œæ˜¾ç„¶ä¼ ç»Ÿä¿å®ˆçš„æ€æƒ³è®©æ›¾å›½è—©æ³¨å®šåªèƒ½æˆä¸ºæ—¶åŠ¿é€ çš„è‹±é›„ï¼Œè€Œä¸èƒ½æˆä¸ºæ”¹å˜æ—¶åŠ¿çš„è‹±é›„ã€‚è¿™ä¸æ˜¯ä»–ä¸€ä¸ªäººçš„å¤±è´¥ï¼Œè€Œæ˜¯æ•´ä¸ªè…æœ½æ”¿æƒçš„å¤±è´¥ï¼</p>
<p>æ›¾å›½è—©è¿™ä¸€ç”Ÿåˆæ˜¯æˆåŠŸçš„ã€‚ç«‹åŠŸã€ç«‹å¾·ã€ç«‹è¨€ä¸‰ä¸æœ½çš„å¢ƒç•Œä»–å…¨éƒ¨åšåˆ°äº†ã€‚ç«‹åŠŸè€Œè¨€ï¼Œä»–ä»ä¸€ä»‹ä¹¦ç”Ÿèµ·å®¶ï¼Œåˆ›å»ºå†›é˜Ÿï¼ŒæŒ½ç‹‚æ¾œäºæ—¢å€’ï¼Œæ‰¶å¤§å¦ä¹‹å°†å€¾ï¼Œä½¿ä¸­å›½ä¼ ç»Ÿæ–‡åŒ–å…é­æ¯ç­ä¹‹ç¾ï¼Œè®©æ¸…æœåˆå¯ä»¥åœ¨å†å²ä¸Šæµ“å¢¨é‡å½©çš„å¤šå†™å‡ ç¬”ï¼›ç«‹å¾·è€Œè¨€ï¼Œä»–ä»¥åœ£è´¤ä¸ºæ ‡å‡†è¦æ±‚è‡ªå·±ï¼Œé“å¾·ä¿®å…»è¿‘ä¹çº¯ç²¹ï¼›ç«‹è¨€è€Œè¨€ï¼Œæˆ‘ä¸€ä¸ªæ™®é€šäººèƒ½åœ¨è¿™é‡Œå†™è¿™ç¯‡æ–‡ç« æ„Ÿå—æ›¾å›½è—©çš„é£é‡‡ï¼Œå…¶å½±å“åŠ›ä¾¿ä¸è¨€è€Œå–»ï¼Œæ´‹æ´‹æ´’æ´’æ•°ç™¾ä¸‡å­—å…¨é›†è®©äººå—ç›ŠåŒªæµ…ã€‚</p>
<p>ä¸€ä¸‡ä¸ªäººæœ‰ä¸€ä¸‡ä¸ªå“ˆå§†é›·ç‰¹ï¼ŒåŒæ ·ä¹Ÿä¼šæœ‰ä¸€ä¸‡ä¸ªæ›¾å›½è—©ï¼Œæ¯ä¸ªäººåˆ‡å…¥è§’åº¦ä¸åŒè¯»å‡ºçš„äººç‰©è‡ªç„¶ä¸åŒï¼Œä½†å¸¦ç»™æˆ‘ä»¬æ¯ä¸ªäººçš„åŠ›é‡å´æ˜¯æ°¸æ’ä¸”ç›¸åŒçš„ï¼</p>
]]></content>
      <categories>
        <category>Reading</category>
      </categories>
      <tags>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šæ ¼å±€ã€‹</title>
    <url>/2023/01/04/Reading/%E6%A0%BC%E5%B1%80/</url>
    <content><![CDATA[<p><img src="/images/reading/GeJu.jpg" alt="img"></p>
<h1 id="å¯¼è¯­"><a href="#å¯¼è¯­" class="headerlink" title="å¯¼è¯­"></a>å¯¼è¯­</h1><p>ã€Šæ ¼å±€ã€‹ä¸€ä¹¦æ˜¯å´å†›åšå£«2019å¹´å‡ºç‰ˆçš„ã€‚å´å†›åšå£«å¤´è¡”å¯è°“ä¼—å¤šï¼Œâ€œæ–‡æ´¥å›¾ä¹¦å¥–â€å¾—ä¸»ã€ç¡…è°·æŠ•èµ„äººã€çº¦ç¿°Â·éœæ™®é‡‘æ–¯å¤§å­¦å·¥å­¦é™¢è‘£äº‹ã€åŸè…¾è®¯å‰¯æ€»è£ï¼Œå‡ºç‰ˆè¿‡ã€Šæ•°å­¦ä¹‹ç¾ã€‹ã€Šæµªæ½®ä¹‹å·…ã€‹ã€Šæ–‡æ˜ä¹‹å…‰ã€‹ã€Šç¡…è°·ä¹‹è°œã€‹ç­‰ç­‰ä¸åŒå“ç±»çš„ä¹¦ç±ã€‚</p>
<p>æˆ‘è‡ªå·±å¯¹äºâ€æ ¼å±€â€œä¸€è¯çš„ç†è§£æ˜¯ä¸€ä¸ªäººå¯¹äºä¸–ç•Œè®¤çŸ¥çš„è¾¹ç•Œä»¥åŠå¯¹äº‹ç‰©è®¤çŸ¥çš„èŒƒå›´ã€‚æ•´ä¹¦é€šè¯»ä¸‹æ¥ç»™æˆ‘çš„æ„Ÿè§‰æ›´åƒæ˜¯å´å†›åšå£«å¯¹äºè‡ªå·±ç”Ÿæ´»ç»éªŒåŠåŸºäºæŸäº›å†å²äº‹ä»¶çš„è§„å¾‹æ€»ç»“ï¼Œç”šè‡³æœ‰äº›ç« èŠ‚çš„å†…å®¹å‰åéƒ½æ²¡æœ‰å¾ˆå…³è”ï¼Œå¯¹äºæœ¬ä¹¦å¤§éƒ¨åˆ†å†…å®¹æ— æ„Ÿçš„æœ¬è´¨åŸå› æˆ‘è®¤ä¸ºæ˜¯è‡ªå·±çš„ç»å†æ²¡æœ‰é‚£ä¹ˆä¸°å¯Œæ— æ³•åšåˆ°æ„ŸåŒèº«å—äº¦æˆ–è€…æ˜¯è‡ªå·±å¯¹äºè¿™æœ¬ä¹¦æ²¡æœ‰å®Œå…¨è¯»æ‡‚ã€‚é‚£ä¾¿å†™ä¸‹è‡ªå·±æ„Ÿå…´è¶£çš„éƒ¨åˆ†çš„å¿ƒå¾—å§</p>
<h1 id="æ„Ÿæ‚Ÿ"><a href="#æ„Ÿæ‚Ÿ" class="headerlink" title="æ„Ÿæ‚Ÿ"></a>æ„Ÿæ‚Ÿ</h1><h2 id="æŠ€æœ¯æ˜¯æ‰‹æ®µ-ä¸æ˜¯ç›®çš„"><a href="#æŠ€æœ¯æ˜¯æ‰‹æ®µ-ä¸æ˜¯ç›®çš„" class="headerlink" title="æŠ€æœ¯æ˜¯æ‰‹æ®µ ä¸æ˜¯ç›®çš„"></a>æŠ€æœ¯æ˜¯æ‰‹æ®µ ä¸æ˜¯ç›®çš„</h2><p>äº’è”ç½‘é£é€Ÿå‘å±•ï¼Œæ–°çš„æŠ€æœ¯ç†è®ºå¾—åˆ°è¿…é€Ÿä¸”å¹¿æ³›çš„ä¼ æ’­ã€‚å¯¹äºä¸€åæŠ€æœ¯ä»ä¸šè€…æ¥è®²ï¼Œè¦æƒ³åœ¨èŒåœºè¡Œä¸šå†…å§‹ç»ˆä¿æŒç«äº‰åŠ›ï¼Œéœ€è¦ä¸æ–­çš„å»å­¦ä¹ æ–°çš„å†…å®¹æ¥ä¿è¯è‡ªå·±ä¸ä¼šè¢«æ—¶ä»£æ‰€æ·˜æ±°ã€‚ä½†å®é™…ä¸Šï¼ŒæŠ€æœ¯ä»æ¥éƒ½æ˜¯æ‰‹æ®µè€Œä¸æ˜¯ç›®çš„ï¼Œå¦‚æœæä¸æ¸…æ¥šè¿™ä¸€ç‚¹ï¼Œå°±ä¼šä¸ºäº†æŠ€æœ¯è€Œç ”å‘æŠ€æœ¯ã€‚2022å¹´AIã€IOTå¯èƒ½æ˜¯æ—¶ä»£çš„æ½®æµï¼Œä½†10å¹´åä¸€åˆ‡éƒ½æœªæ›¾å¯çŸ¥è€Œå¯ä»¥è‚¯å®šçš„æ˜¯è®¡ç®—æœºçš„åº•å±‚åŸç†åŠçŸ¥è¯†ä»ç„¶ä¸ä¼šè½ä¼ã€‚å¯è§æ´å¯Ÿä¸€ä»¶äº‹æƒ…çš„æœ¬è´¨å¹¶å»å­¦ä¹ æ¢ç´¢æ‰æ˜¯çœŸæ­£çš„ç¡¬é“ç†ã€‚</p>
<h2 id="æœªæ¥çš„ç‰¹å¾"><a href="#æœªæ¥çš„ç‰¹å¾" class="headerlink" title="æœªæ¥çš„ç‰¹å¾"></a>æœªæ¥çš„ç‰¹å¾</h2><ul>
<li>ä¸å¯¹ç§°æ€§ã€‚æ–°æŠ€æœ¯çš„äº§ç”Ÿï¼Œæœ€æ—©æŒæ¡æ–°æŠ€æœ¯çš„å°‘æ•°äººå¯ä»¥åˆ©ç”¨æ–°æŠ€æœ¯é¢ è¦†è¿‡å»åœ¨ç›¸å…³é¢†åŸŸä¸­å æ®ç»Ÿæ²»åœ°ä½çš„ç»„ç»‡æˆ–æœºæ„ï¼›</li>
<li>å¤æ‚æ€§ã€‚å½“ä¸‹çš„çŸ¥è¯†ä½“ç³»éå¸¸å¤æ‚ï¼Œé€šå¸¸éƒ½æ˜¯è·¨å­¦ç§‘çš„è€Œä¸æ˜¯å•ä¸€ç»´åº¦çš„ï¼›</li>
<li>ä¸ç¡®å®šæ€§ã€‚æ²¡æœ‰äººèƒ½å¤Ÿé¢„æµ‹æœªæ¥</li>
</ul>
<ol>
<li>ä¸è¿‡åº¦ä¾èµ–è¿‡å»çš„æƒå¨</li>
<li>æ‹‰åŠ›ç”±äºæ¨åŠ›ï¼ˆä¸»åŠ¨è·å–è€Œä¸æ˜¯è¢«åŠ¨æ¥æ”¶ï¼‰</li>
<li>æŒ‡å—é’ˆä¼˜äºåœ°å›¾ï¼ˆæ”¹å˜ä¸€ç›´å­˜åœ¨ï¼ŒæŒæ¡æœ¬è´¨ï¼Œæ±‚æ¸”ä¸æ±‚é±¼ï¼‰</li>
<li>æ‹¥æŠ±é£é™©</li>
<li>å›é€†ç²¾ç¥ï¼ˆæ‰“ç ´è§„åˆ™ï¼‰</li>
<li>é€šæ‰èƒœäºä¸“æ‰ï¼ˆå‰æä¸€å®šæ˜¯å·²ç»åœ¨æŸä¸€æ–¹é¢å·²ç»æ˜¯ä¸“æ‰ï¼‰</li>
<li>éŸ§æ€§ä¼˜äºåŠ›é‡</li>
<li>å¼ºè°ƒæ•´ä½“æ€§</li>
</ol>
<h2 id="ä»¥æ­£å’Œï¼Œä»¥å¥‡èƒœ"><a href="#ä»¥æ­£å’Œï¼Œä»¥å¥‡èƒœ" class="headerlink" title="ä»¥æ­£å’Œï¼Œä»¥å¥‡èƒœ"></a>ä»¥æ­£å’Œï¼Œä»¥å¥‡èƒœ</h2><p>é¢å¯¹ä¸æ–­å˜åŒ–çš„æœªæ¥ï¼ŒæŠŠæ¡å¥½å¸¸æ€æ˜¯å…³é”®ï¼Œè€Œæ­£æ˜¯å¸¸æ€ï¼Œå¥‡æ˜¯éå¸¸æ€ã€‚ã€Šå­™å­å…µæ³• å…µåŠ¿ç¯‡ã€‹ä¸­å†™åˆ°ï¼šå‡¡æˆ˜è€…ï¼Œä»¥æ­£å’Œï¼Œä»¥å¥‡èƒœã€‚è¿™å¥è¯çš„æ„æ€æ˜¯ï¼šä½œæˆ˜ï¼Œè¦å…ˆæŠŠæ­£é¢çš„å…µæ’å¥½ï¼Œæ’çš„ä¸åæ–œåˆä¹æ³•åˆ™ï¼Œæ­¤ä¸ºæ­£ï¼›å¦‚æœè¿™æ—¶å€™è¿˜æœ‰å¤šä½™çš„å…µåŠ›ä½ å°±èµ¢äº†ï¼Œåœ¨ç°ä»£æ±‰è¯­å­—å…¸ä¸­ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼šå‡ºå¥‡åˆ¶èƒœã€‚â€ä»¥æ­£å’Œï¼Œä»¥å¥‡èƒœâ€æ›´åº”è¯¥æ˜¯ä¸€ä¸ªäººåšäº‹çš„å‡†åˆ™ï¼Œåœ¨åšå¥½æ­£çš„åŸºç¡€ä¸Šå‡ºå¥‡åˆ¶èƒœï¼Œä¸è¦ç›¸ä¿¡æ‰€è°“çš„å¼¯é“è¶…è½¦ï¼Œè¿™ä¸€å®šæ˜¯ä¸ç¨³å®šçš„ã€‚</p>
<h2 id="è¢«ä¿¡æ¯æ”¾å¤§çš„æ‚²è§‚"><a href="#è¢«ä¿¡æ¯æ”¾å¤§çš„æ‚²è§‚" class="headerlink" title="è¢«ä¿¡æ¯æ”¾å¤§çš„æ‚²è§‚"></a>è¢«ä¿¡æ¯æ”¾å¤§çš„æ‚²è§‚</h2><p>æˆ‘ä»¬æ˜æ˜¾èƒ½å¤Ÿæ„Ÿè§‰åˆ°ç°åœ¨çš„å¹´è½»äººæ™®éä¼šæ›´ç„¦è™‘ï¼Œä»–ä»¬ä»¿ä½›å¯¹è¿™ä¸ªä¸–ç•Œå……æ»¡æ‚²è§‚æƒ…ç»ªã€‚xxxé£æœºå¤±äº‹ã€xxxå…¬å¸å¤§è§„æ¨¡è£å‘˜ã€xxxåœ°åŒºæ´ªæ°´æˆ–ç«å±±çˆ†å‘ï¼Œè¿™äº›æ–°é—»åœ¨ç°åœ¨çœŸçš„æ˜¯å±¡è§ä¸é²œï¼Œä¹Ÿæ­£æ˜¯è¿™äº›æ–°é—»çš„å¹¿æ³›ä¼ æ’­ç»™æˆ‘ä»¬é€ æˆäº†å¾ˆå¤§çš„ç„¦è™‘æƒ…ç»ªã€‚ä½†å®é™…ä¸Šé£æœºå…¶å®æ˜¯æ¯”æ±½è½¦æ›´å®‰å…¨ã€åœ¨å¤§èŒƒå›´å†…å°±ä¸šå½¢å¼æ˜¯å‘å¥½çš„ã€ç«å±±å–·å‘åœ°æ­£æ˜¯å¤„äºæ¿å—äº¤ç•Œåœ°å¸¦ã€‚å¯ä»¥å‘ç°çœŸæ­£å¹¿æ³›ä¼ æ’­çš„è¨€è®ºå®é™…ä¸Šå¤§å¤šæ˜¯æ‚²è§‚çš„ï¼Œä»ä¿¡æ¯è®ºçš„è§’åº¦æ¥è®²ï¼Œè¶Šæ˜¯ä¸ä¼—ä¸åŒçš„è¯´æ³•ä¿¡æ¯é‡è¶Šå¤§ã€‚ç›¸åå®£ä¼ ä¹è§‚ä¸»ä¹‰çš„è§‚ç‚¹è®ºæ–‡ä¸ä»…æ²¡æœ‰äººçœ‹ç”šè‡³æ˜¯æ— æ³•å‘è¡¨çš„ã€‚å› ä¸ºæ²¡æœ‰äººä¼šå…³å¿ƒä¸€ç¯‡â€ä»Šå¹´ç»æµæŒç»­å‘å¥½â€œçš„æ–‡ç« ï¼Œå¤§å®¶éƒ½çŸ¥é“ä¹Ÿè‡ªç„¶å°±ä¸ä¼šè¿‡å¤šå…³æ³¨ã€‚é¢å¯¹å„ç§å„æ ·çš„æ–°é—»ï¼Œé€‚å½“ä¿æŒå¿§æ‚£æ„è¯†æ˜¯å¿…è¦çš„ï¼Œä½†è¯·ä¸åº”è¿‡åº¦çš„æ‚²è§‚ï¼</p>
<h2 id="äººç«‹äºå¤©åœ°ä¹‹é—´å¿…æœ‰å‡ºè·¯"><a href="#äººç«‹äºå¤©åœ°ä¹‹é—´å¿…æœ‰å‡ºè·¯" class="headerlink" title="äººç«‹äºå¤©åœ°ä¹‹é—´å¿…æœ‰å‡ºè·¯"></a>äººç«‹äºå¤©åœ°ä¹‹é—´å¿…æœ‰å‡ºè·¯</h2><p>é¢å¯¹ç”Ÿæ´»ã€å·¥ä½œã€å®¶åº­çš„å‹åŠ›ï¼Œæˆ‘ä»¬æ€»æ˜¯ä½¿è‡ªå·±å¤„äºä¸€ä¸ªå¾ˆå¿™ç¢Œçš„çŠ¶æ€ä¹‹ä¸­ï¼Œé¢å¯¹æœªæ¥å¯èƒ½å‘ç”Ÿçš„é—®é¢˜æˆ‘ä»¬ä¹Ÿå¸¸è¯´ï¼šè½¦åˆ°å±±å‰å¿…æœ‰è·¯ã€èˆ¹åˆ°æ¡¥å¤´è‡ªç„¶ç›´ã€‚ç¡®å®ï¼Œå¯¹äºæœªæ¥çš„ä¸ç¡®å®šæ€§ï¼Œæˆ‘ä»¬å§‹ç»ˆè¦åšä¿¡äººç«‹ä¸å¤©åœ°ä¹‹å‰å¿…æœ‰å‡ºè·¯ã€‚</p>
<h1 id="è¯­å½•"><a href="#è¯­å½•" class="headerlink" title="è¯­å½•"></a>è¯­å½•</h1><p>è‡ªå·±èŠ±äº†ç²¾åŠ›åšçš„äº‹æƒ…è¦å°½å¯èƒ½çš„å¯¹è‡ªå·±æœªæ¥æœ‰å¸®åŠ©ã€‚</p>
<p>è¿‡åˆ†è¿½æ±‚ç‰©è´¨å¯èƒ½ä¼šæˆä¸ºç”Ÿæ´»çš„è´Ÿæ‹…ã€‚</p>
]]></content>
      <categories>
        <category>Reading</category>
      </categories>
      <tags>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>è€³æœºæ’æ‹”æ£€æµ‹</title>
    <url>/2023/08/04/andriod/HPDetect/</url>
    <content><![CDATA[<h1 id="è€³æœºåˆ†ç±»"><a href="#è€³æœºåˆ†ç±»" class="headerlink" title="è€³æœºåˆ†ç±»"></a>è€³æœºåˆ†ç±»</h1><p>ç›®å‰å¸‚åœºä¸Šçš„è€³æœºç§ç±»ç¹å¤šæ¯ä¸€ç§è€³æœºéƒ½æœ‰å…¶è¾ƒä¸ºåŒ¹é…çš„åº”ç”¨åœºæ™¯ã€‚æŒ‰ç…§ä½©æˆ´æ–¹å¼å¯ä»¥åˆ’åˆ†ä¸ºï¼šå…¥è€³å¼ã€å¤–è€³å¼ã€å¤´æˆ´å¼ç­‰ç­‰ï¼›æŒ‰ç…§æ•°æ®ä¼ è¾“æ–¹å¼å¯ä»¥åˆ’åˆ†ä¸ºï¼šæœ‰çº¿è€³æœºã€æ— çº¿è€³æœºï¼›æŒ‰ç…§è¿›å…¥è€³æœºçš„æ•°æ®ç±»å‹åˆ†ç±»å¯ä»¥åˆ’åˆ†ä¸ºï¼šæ¨¡æ‹Ÿè€³æœºã€æ•°å­—è€³æœºï¼›æœ¬æ–‡ä¸»è¦æ˜¯æ ¹æ®åµŒå…¥å¼äº§å“ä¸Šåº”ç”¨è¾ƒå¤šçš„ä¸¤ç§ä¸åŒçš„æ¥å£è€³æœºè¿›è¡Œè¯´æ˜ï¼štype-cè€³æœºå’Œ3.5mméŸ³é¢‘æ¥å£è€³æœºï¼ˆtype-cè€³æœºä¸ä¸€å®šæ˜¯æ•°å­—è€³æœºï¼Œ3.5mmåœ†å­”è€³æœºä¸€å®šæ˜¯æ¨¡æ‹Ÿè€³æœºï¼‰</p>
<h2 id="3-5mméŸ³é¢‘æ¥å£è€³æœº"><a href="#3-5mméŸ³é¢‘æ¥å£è€³æœº" class="headerlink" title="3.5mméŸ³é¢‘æ¥å£è€³æœº"></a>3.5mméŸ³é¢‘æ¥å£è€³æœº</h2><p><img src="/images/andriod/hp_detect.png" alt="image"></p>
<ul>
<li>3-poleï¼ˆHeadphoneï¼‰</li>
<li>4-poleï¼ˆHeadsetï¼‰<ul>
<li>OMTPï¼ˆOpen Mobile Terminal Platformï¼‰ï¼Œå¯¹åº”æ’å¤´ä¸Šçš„å¡‘æ–™ç¯ä¸€èˆ¬æ˜¯é»‘è‰²ï¼Œå›½æ ‡ / æ¬§æ ‡ï¼›</li>
<li>CITAï¼ˆCellular Telecommunications and Internet Associationï¼‰ï¼Œå¯¹åº”æ’å¤´ä¸Šçš„å¡‘æ–™ç¯ä¸€èˆ¬æ˜¯ç™½è‰²ï¼Œç¾æ ‡ï¼›</li>
</ul>
</li>
</ul>
<h1 id="ç¡¬ä»¶æ£€æµ‹åŸç†"><a href="#ç¡¬ä»¶æ£€æµ‹åŸç†" class="headerlink" title="ç¡¬ä»¶æ£€æµ‹åŸç†"></a>ç¡¬ä»¶æ£€æµ‹åŸç†</h1><p>ä¸€èˆ¬çš„è€³æœºæ£€æµ‹åŒ…å«æ™®é€šçš„è€³æœºï¼ˆHeadphoneï¼‰æ£€æµ‹å’Œå¸¦micçš„è€³æœºï¼ˆHeadsetï¼‰æ£€æµ‹ä¸¤ç§ï¼Œè¿™ä¸¤ç§è€³æœºç»Ÿç§°ä¸ºHeadsetã€‚</p>
<p>å¯¹äºè€³æœºè£…ç½®çš„æ’æ‹”æ£€æµ‹ï¼Œä¸€èˆ¬é€šè¿‡Jackå³è€³æœºæ’åº§æ¥å®Œæˆï¼Œå¤§è‡´çš„åŸç†æ˜¯ä½¿ç”¨å¸¦æ£€æµ‹æœºæ¢°ç»“æ„çš„è€³æœºæ’åº§ï¼Œå°†æ£€æµ‹è„šè¿åˆ°å¯GPIOä¸­æ–­ä¸Šï¼Œå½“è€³æœºæ’å…¥æ—¶ï¼Œè€³æœºæ’å¤´çš„é‡‘å±ä¼šç¢°åˆ°æ£€æµ‹è„šï¼Œä½¿å¾—æ£€æµ‹è„šçš„ç”µå¹³äº§ç”Ÿå˜åŒ–ï¼Œä»è€Œå¼•èµ·ä¸­æ–­ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ä¸­æ–­å¤„ç†å‡½æ•°ä¸­è¯»å–GPIOçš„çš„å€¼ï¼Œè¿›ä¸€æ­¥åˆ¤æ–­å‡ºè€³æœºæ˜¯æ’å…¥è¿˜æ˜¯æ‹”å‡ºã€‚è€Œå¯¹äºè€³æœºæ˜¯å¦å¸¦micçš„æ£€æµ‹ï¼Œéœ€è¦é€šè¿‡codecé™„åŠ çš„micbiasç”µæµçš„åŠŸèƒ½</p>
<h1 id="æ£€æµ‹æœºåˆ¶"><a href="#æ£€æµ‹æœºåˆ¶" class="headerlink" title="æ£€æµ‹æœºåˆ¶"></a>æ£€æµ‹æœºåˆ¶</h1><h2 id="InputEvent"><a href="#InputEvent" class="headerlink" title="InputEvent"></a>InputEvent</h2><p>åœ¨ Linux å†…æ ¸ä¸­ï¼ŒInput Event æ˜¯ç”¨äºå¤„ç†è¾“å…¥è®¾å¤‡äº‹ä»¶çš„æœºåˆ¶ï¼Œå®ƒå…è®¸å†…æ ¸æ•è·å’Œå¤„ç†å„ç§è¾“å…¥è®¾å¤‡çš„äº‹ä»¶ã€‚å†…æ ¸ä¸­çš„ Input Event æœºåˆ¶é€šè¿‡ struct input_event ç»“æ„ä½“æ¥è¡¨ç¤ºè¾“å…¥äº‹ä»¶çš„ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨éŸ³é¢‘éƒ¨åˆ†ASOCå·²ç»ä¸ºæˆ‘ä»¬å°è£…å¥½äº†ç›¸åº”Jackæ¥å£å‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">input_event</span> {</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">time</span>;</span> <span class="comment">// æ—¶é—´æˆ³ï¼Œè®°å½•äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´</span></span><br><span class="line">    __u16 type;          <span class="comment">// äº‹ä»¶ç±»å‹ï¼Œå¦‚ EV_KEY (é”®ç›˜æŒ‰é”®äº‹ä»¶)ã€EV_REL (ç›¸å¯¹åæ ‡äº‹ä»¶)ã€EV_ABS (ç»å¯¹åæ ‡äº‹ä»¶) ç­‰</span></span><br><span class="line">    __u16 code;          <span class="comment">// äº‹ä»¶ç ï¼Œè¡¨ç¤ºäº‹ä»¶çš„å…·ä½“ç±»å‹æˆ–é”®ç </span></span><br><span class="line">    __s32 value;         <span class="comment">// äº‹ä»¶çš„å€¼ï¼Œè¡¨ç¤ºäº‹ä»¶çŠ¶æ€ï¼Œä¾‹å¦‚æŒ‰é”®çš„æŒ‰ä¸‹ (1) æˆ–é‡Šæ”¾ (0)ï¼Œåæ ‡äº‹ä»¶çš„ä½ç½®å€¼ç­‰</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ASoc-Jackå‡½æ•°"><a href="#ASoc-Jackå‡½æ•°" class="headerlink" title="ASoc Jackå‡½æ•°"></a>ASoc Jackå‡½æ•°</h3><ol>
<li><p>åˆ›å»ºç”Ÿæˆjackå¯¹è±¡</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">snd_soc_jack_new</span> <span class="params">(<span class="keyword">struct</span> snd_soc_codec *codec, <span class="type">const</span> <span class="type">char</span> *id, <span class="type">int</span> type, <span class="keyword">struct</span> snd_soc_jack *jack)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// id: åå­—</span></span><br><span class="line"><span class="comment">// type: è¢«æ£€æµ‹çš„ç±»å‹ï¼Œå³å¯èƒ½æ’å…¥çš„è®¾å¤‡, SND_JACK_HEADPHONE / SND_JACK_HEADSETæˆ–è€…å…¶ä»–</span></span><br></pre></td></tr></tbody></table></figure>

<p>å‡½æ•°è°ƒç”¨å…³ç³»ï¼šsnd_jack_new  â€“&gt;  input_allocate_device  ç”³è¯·input deviceç©ºé—´ï¼Œæ³¨å†Œæˆè¾“å…¥è®¾å¤‡</p>
</li>
<li><p>å°†å®šä¹‰å¥½çš„pinsåŠ å…¥dapm widgetsè¿›è¡Œç”µæºç®¡ç†ã€‚è¿™ä¸€æ­¥å’ŒInputEventæ²¡æœ‰ä¸€å®šè”ç³»ï¼Œä¹Ÿå¯ä»¥ä¸è°ƒç”¨ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span>	<span class="title function_">snd_soc_jack_add_pins</span> <span class="params">(<span class="keyword">struct</span> snd_soc_jack *jack, <span class="type">int</span> count, <span class="keyword">struct</span> snd_soc_jack_pin *pins)</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">snd_soc_jack_pin</span> {</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">list</span>;</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *pin;		<span class="comment">// è€³æœºæ£€æµ‹å¼•è„šçš„åç§°æˆ–æ ‡è¯†ç¬¦</span></span><br><span class="line">    <span class="type">int</span> mask;				<span class="comment">// éœ€è¦æŠ¥å‘Šçš„æ’æ‹”äº‹ä»¶ç±»å‹</span></span><br><span class="line">    <span class="type">bool</span> invert;</span><br><span class="line">}; </span><br></pre></td></tr></tbody></table></figure>

<p>è¿™é‡Œè¯´ä¹‹å‰å®šä¹‰å¥½çš„pinsæŒ‡çš„æ˜¯ï¼šä½¿ç”¨ç±»ä¼¼äºSND_SOC_DAPM_MIC / SND_SOC_DAPM_HPç­‰ç­‰å®å£°æ˜è¿‡çš„æ§ä»¶åç§°ï¼Œå¦åˆ™åœ¨add_pinsçš„è¿‡ç¨‹ä¸­å°±ä¼šå¤±è´¥ã€‚åœ¨ä½¿ç”¨å®å£°æ˜è¿‡åè¿˜éœ€è¦å°†å…¶å®šä¹‰ä¸ºsnd_soc_jack_pinç»“æ„ä½“ç±»å‹ï¼Œå…¶ä¸­ä¸¤ä¸ªé‡è¦çš„ä¸¤ä¸ªå‚æ•°å°±æ˜¯pinã€maskä¸¤ä¸ªå­—æ®µéœ€è¦å£°æ˜ã€‚</p>
<p>æœ¬è´¨ä¸Šè¿˜æ˜¯å¯¹æ§ä»¶çš„ç®¡ç†ï¼Œå½“jackæœ‰åŠ¨ä½œå…¶ç¬¦åˆmaskæ‰€æ ‡è¯†çš„æ—¶å€™ï¼Œå°±ä¼šå°†å¯¹åº”çš„æ§ä»¶è¿›è¡Œæ§åˆ¶ã€‚</p>
</li>
<li><p>å‘ç”¨æˆ·ç©ºé—´ä¸ŠæŠ¥äº‹ä»¶</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">snd_soc_jack_report</span> <span class="params">(<span class="keyword">struct</span> snd_soc_jack *jack, <span class="type">int</span> status, <span class="type">int</span> mask)</span></span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><p>åˆ¤æ–­æ­¤æ—¶çš„statuså’Œmaskäº‹ä»¶æ˜¯å¦å¯¹åº” ä½¿ç”¨snd_soc_jack_add_pinså‡½æ•°æ³¨å†Œçš„dapm pinçŠ¶æ€ï¼Œå¹¶è¿›è¡Œç”µæºç®¡ç†</p>
</li>
<li><p>é€šè¿‡è°ƒç”¨ â€“&gt;  snd_jack_report  â€“&gt; input_report_key/input_report_switchå‡½æ•°æ¥å‘ä¸Šå±‚æ±‡æŠ¥input event</p>
</li>
</ol>
</li>
<li><p>å°†GPIOå¼•è„šçŠ¶æ€å˜åŒ–ä¸éŸ³é¢‘æ—¶é—´å…³è”èµ·æ¥ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">snd_soc_jack_add_gpios</span><span class="params">(<span class="keyword">struct</span> snd_soc_jack *jack, <span class="type">int</span> count,  <span class="keyword">struct</span> snd_soc_jack_gpio *gpios)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> snd_soc_jack_gpio {</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> gpio;			<span class="comment">//GPIO å¼•è„šçš„ç¼–å·</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> idx; </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device</span> *<span class="title">gpiod_dev</span>;</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *name;		<span class="comment">// è¿™ä¸ªjackç»“æ„ä½“æ ‡è¯†ç¬¦</span></span><br><span class="line">    <span class="type">int</span> report;				<span class="comment">// è¡¨ç¤ºæ’æ‹”äº‹ä»¶çš„æŠ¥å‘Šç±»å‹æˆ–æ ‡å¿—ä½ã€‚</span></span><br><span class="line">    <span class="type">int</span> invert;</span><br><span class="line">    <span class="type">int</span> debounce_time;		<span class="comment">// GPIO å¼•è„šçš„å»æŠ–åŠ¨æ—¶é—´ï¼Œç”¨äºåœ¨æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–åå»¶è¿Ÿä¸€æ®µæ—¶é—´å†å¤„ç†äº‹ä»¶ï¼Œä»¥é¿å…æŠ–åŠ¨ç°è±¡ã€‚</span></span><br><span class="line">    <span class="type">bool</span> wake;				<span class="comment">// ç”¨äºè¡¨ç¤ºæ˜¯å¦åœ¨æ£€æµ‹åˆ°æ’æ‹”äº‹ä»¶åå”¤é†’ç³»ç»Ÿã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* private: */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">snd_soc_jack</span> *<span class="title">jack</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">delayed_work</span> <span class="title">work</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">gpio_desc</span> *<span class="title">desc</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> *data;</span><br><span class="line">    <span class="comment">/* public: */</span></span><br><span class="line">    <span class="type">int</span> (*jack_status_check)(<span class="type">void</span> *data);	<span class="comment">//æ£€æŸ¥è€³æœºæ’æ‹”çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line">};  </span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥å‡½æ•°é€šè¿‡æ ‡å‡†GPIOé©±åŠ¨ç”³è¯·GPIOåŠGPIOå¯¹åº”ä¸­æ–­ï¼Œå¹¶æä¾›äº†ç»Ÿä¸€çš„ä¸­æ–­å¤„ç†å‡½æ•°æ¥æ±‡æŠ¥äº‹ä»¶ã€‚æ­¤å‡½æ•°åªé€‚ç”¨äºè€³æœºä¸­æ–­æ¥è‡³GPIOä¸”GPIOé©±åŠ¨ä¸ºLinuxæ ‡å‡†é©±åŠ¨çš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸”ä¸æ”¯æŒmicæ£€æµ‹ã€‚</p>
</li>
</ol>
<h3 id="æ“ä½œæµç¨‹"><a href="#æ“ä½œæµç¨‹" class="headerlink" title="æ“ä½œæµç¨‹"></a>æ“ä½œæµç¨‹</h3><ol>
<li><p>snd_soc_jack_new åˆ›å»ºjackå¯¹è±¡</p>
</li>
<li><p>snd_soc_jack_add_pinså°†å…¶åŠ å…¥åˆ°dapm wigetsä¸­ï¼ˆå¯ä¸è°ƒç”¨ï¼‰</p>
</li>
<li><p>å°†è€³æœºdetect_pin GPIOæ³¨å†Œæˆä¸­æ–­ï¼Œå¹¶åœ¨ä¸­æ–­å¤„ç†å‡½æ•°ä¸­è¿›ä¸€æ­¥è¯»å–codecç›¸å…³å¯„å­˜å™¨åˆ¤æ–­æ˜¯headsetè¿˜æ˜¯headphoneï¼ˆè¿™ä¸€æ­¥éª¤éœ€è¦æ³¨æ„hp_detect pinéœ€è¦è¿æ¥åˆ°codecï¼Œå¹¶ä¸”codecæ˜¯æ”¯æŒè¯¥åŠŸèƒ½çš„ï¼‰</p>
</li>
<li><p>æ ¹æ®åˆ¤æ–­ç»“æœè°ƒç”¨snd_soc_jack_reportå‘é€InputEvent</p>
</li>
</ol>
<h3 id="Interrupt"><a href="#Interrupt" class="headerlink" title="Interrupt"></a>Interrupt</h3><p>å¯¹äºInputEventçš„æ–¹å¼æœ¬è´¨ä¸Šè¿˜æ˜¯Jackå’ŒIRQæ–¹å¼çš„ç»“åˆï¼Œä½†æ˜¯å¦‚æœcodecä¸æ”¯æŒheadset / headphoneçš„æ£€æµ‹ï¼Œå°±åªèƒ½ä½¿ç”¨snd_soc_jack_add_gpiosè¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œå‘åº”ç”¨å±‚é€šçŸ¥æ’æ‹”äº‹ä»¶ã€‚</p>
<p>å½“ç„¶å¦‚æœç”¨æˆ·å±‚ä¸éœ€è¦æ„ŸçŸ¥HPæ’æ‹”äº‹ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä¸­æ–­å¤„ç†å‡½æ•°ä¸­æ“ä½œcodecå¯„å­˜å™¨è¿›è¡Œå½•æ”¾éŸ³çš„åˆ‡æ¢å³å¯ï¼Œè¿™æ ·åªæ˜¯ç”¨æˆ·å±‚å°†æ‹¿ä¸åˆ°çŠ¶æ€ä¿¡æ¯ã€‚</p>
<h2 id="UEvent"><a href="#UEvent" class="headerlink" title="UEvent"></a>UEvent</h2><blockquote>
<p>æºç ä½ç½®ï¼š<a href="http://androidxref.com/kernel_3.18/xref/drivers/switch/switch_class.c">andriod-kernel_3.18</a></p>
</blockquote>
<p>UEvent æ˜¯ Linux å†…æ ¸å¯¹è®¾å¤‡æ’æ‹”ç­‰äº‹ä»¶çš„é€šçŸ¥æœºåˆ¶ï¼Œå½“è®¾å¤‡æ’å…¥æˆ–æ‹”å‡ºæ—¶ï¼Œå†…æ ¸ä¼šç”Ÿæˆç›¸åº”çš„ UEventï¼Œå¹¶å‘é€ç»™ç”¨æˆ·ç©ºé—´ï¼Œä»¥ä¾¿ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºå¯ä»¥å¯¹äº‹ä»¶ä½œå‡ºå“åº”ã€‚UEventæ˜¯Androidç³»ç»Ÿé»˜è®¤çš„è€³æœºæ’æ‹”æœºåˆ¶ï¼Œè€ŒUEventæœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œå®ƒåŸºäºswitch driverã€‚switch driverçš„ç›®å½•åœ¨Linux kernelçš„drivers/staging/android/switchç›®å½•ä¸‹ï¼Œswitch_class.cæ˜¯switch driverçš„å†…éƒ¨å®ç°ï¼Œå®ƒæä¾›äº†switch driveræ‰€éœ€çš„ä¸€äº›APIï¼›switch_gpio.cæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®ƒå®ç°äº†ä¸€ä¸ªåŸºäºGPIOä¸­æ–­çš„switch driverã€‚ä¸‹é¢ç€é‡å¯¹switch_class.cè¿›è¡Œåˆ†æã€‚ï¼ˆåªåˆ†ækernelå±‚ï¼Œä¸å…³æ³¨frameworkå’Œapp Layerï¼‰</p>
<h3 id="switchåŸç†"><a href="#switchåŸç†" class="headerlink" title="switchåŸç†"></a>switchåŸç†</h3><p>Switchæ˜¯Androidå¼•è¿›çš„æ–°çš„é©±åŠ¨ï¼Œç›®çš„æ˜¯ç”¨äºæ£€æµ‹ä¸€äº›å¼€å…³é‡ï¼Œæ¯”å¦‚æ£€æµ‹è€³æœºæ’å…¥ã€æ£€æµ‹ USB è®¾å¤‡æ’å…¥ç­‰ã€‚Switchåœ¨sysfsæ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºç›¸åº”entryï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡sysfsä¸ä¹‹äº¤äº’ï¼› æ­¤å¤–è¿˜å¯ä»¥é€šè¿‡UEventæœºåˆ¶ä¸ä¹‹äº¤äº’ï¼Œ ä»è€Œæ£€æµ‹switchçŠ¶æ€ã€‚ </p>
<h3 id="switchå‡½æ•°å®ç°"><a href="#switchå‡½æ•°å®ç°" class="headerlink" title="switchå‡½æ•°å®ç°"></a>switchå‡½æ•°å®ç°</h3><p>Switch classåœ¨Androidä¸­å®ç°ä¸ºä¸€ä¸ªmoduleï¼Œå¯åŠ¨æ€åŠ è½½ã€‚switch_class.cæ–‡ä»¶åˆ›å»ºäº†ä¸€ä¸ªswitch_classï¼Œå®ç°äº†å†…æ ¸çš„switchæœºåˆ¶ï¼Œæä¾›æ”¯æŒå‡½æ•°ä¾›å…¶ä»–switch deviceé©±åŠ¨è°ƒç”¨ã€‚ </p>
<ol>
<li><p>åˆ›å»ºswitch_class</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">create_switch_class</span><span class="params">(<span class="type">void</span>)</span></span><br></pre></td></tr></tbody></table></figure>

<p>é©±åŠ¨æ³¨å†Œå…¥å£å‡½æ•° module_init()  ä¸­è°ƒç”¨ create_switch_class() å‡½æ•°ã€‚è€Œè¯¥å‡½æ•°ä¸»è¦åŠŸèƒ½æ˜¯è°ƒç”¨ class_create() å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>switch</code> çš„class</p>
</li>
<li><p>æ³¨å†Œ / æ³¨é”€switchè®¾å¤‡</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">switch_dev_register</span><span class="params">(<span class="keyword">struct</span> switch_dev *sdev)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">switch_dev_unregister</span><span class="params">(<span class="keyword">struct</span> switch_dev *sdev)</span>;</span><br></pre></td></tr></tbody></table></figure>


</li>
<li><p>æ˜¾ç¤ºè®¾å¤‡åå­—å’ŒçŠ¶æ€</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">state_show</span><span class="params">(<span class="keyword">struct</span> device *dev, <span class="keyword">struct</span> device_attribute *attr, <span class="type">char</span> *buf)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">name_show</span><span class="params">(<span class="keyword">struct</span> device *dev, <span class="keyword">struct</span> device_attribute *attr, <span class="type">char</span> *buf)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="title function_">DEVICE_ATTR</span><span class="params">(state, S_IRUGO, state_show, <span class="literal">NULL</span>)</span>;</span><br><span class="line"><span class="type">static</span> <span class="title function_">DEVICE_ATTR</span><span class="params">(name, S_IRUGO, name_show, <span class="literal">NULL</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// #define DEVICE_ATTR(_name, _mode, _show, _store)</span></span><br><span class="line"><span class="comment">// sysfsï¼ˆsystem file systemï¼‰æ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸å°†è®¾å¤‡çš„çŠ¶æ€ä¿¡æ¯ä»¥æ–‡ä»¶çš„å½¢å¼æš´éœ²ç»™ç”¨æˆ·ç©ºé—´ï¼Œä½¿ç”¨æˆ·ç©ºé—´å¯ä»¥é€šè¿‡è¯»å†™è¿™äº›æ–‡ä»¶æ¥ä¸è®¾å¤‡è¿›è¡Œäº¤äº’å’Œé…ç½®ã€‚</span></span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸¤ä¸ªsysfsæ“ä½œå‡½æ•°åˆ†åˆ«ç”¨äºè¾“å‡ºswitch deviceçš„nameå’Œstateã€‚å½“ç”¨æˆ·è¯»å–sysfsä¸­å¯¹åº”çš„switch entryï¼ˆ/sys/class/switch/<dev_name>/nameå’Œ/sys/class/switch/<dev_name>/stateï¼‰æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°å‘ç”¨æˆ·è¿”å›switchè®¾å¤‡çš„åç§°å’ŒçŠ¶æ€ã€‚</dev_name></dev_name></p>
</li>
<li><p>æ”¹å˜å¹¶é€šçŸ¥ç”¨æˆ·swtichçŠ¶æ€</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">switch_set_state</span><span class="params">(<span class="keyword">struct</span> switch_dev *sdev, <span class="type">int</span> state)</span></span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>è°ƒç”¨name_showå’Œstate_showè¾“å‡ºswitchè®¾å¤‡åç§°å’ŒçŠ¶æ€è‡³sysfsæ–‡ä»¶ç³»ç»Ÿï¼›</li>
<li>è°ƒç”¨ kobject_uevent_env() å‡½æ•°å‘é€UEventé€šçŸ¥ç”¨æˆ·switch deviceçš„ä¿¡æ¯(åç§°å’ŒçŠ¶æ€)</li>
</ol>
</li>
</ol>
<h3 id="ç”¨æˆ·å±‚ä½¿ç”¨"><a href="#ç”¨æˆ·å±‚ä½¿ç”¨" class="headerlink" title="ç”¨æˆ·å±‚ä½¿ç”¨"></a>ç”¨æˆ·å±‚ä½¿ç”¨</h3><p>UEventæœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œå®ƒåŸºäºswitch driverï¼Œswitch driverä¼šåœ¨Androidå»ºç«‹è€³æœºæ’æ‹”çš„ç›®å½•/sys/devices/virtual/switch/h2wï¼Œåœ¨æ­¤ç›®å½•ä¸‹æœ‰ä¸ªè®¾å¤‡ç»“ç‚¹åä¸ºstateï¼Œdriveré€šè¿‡æ›´æ–°stateçš„å€¼ï¼Œä»è€Œé€šçŸ¥Androidä¸Šå±‚è€³æœºçŠ¶æ€çš„æ”¹å˜ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><p><a href="https://blog.csdn.net/Qidi_Huang/article/details/51969396">3.5mm éŸ³é¢‘æ¥å£ç±»å‹è¯´æ˜</a></p>
</li>
<li><p><a href="https://blog.csdn.net/fengying765/article/details/38301483/">Android4.Ã—è€³æœºæ’æ‹”æ£€æµ‹</a></p>
</li>
<li><p><a href="https://blog.csdn.net/zhgn2/article/details/7422095">Android è€³æœºç³»ç»Ÿç»¼è¿°</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Andriod</category>
      </categories>
      <tags>
        <tag>HP Detect</tag>
        <tag>android</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>init.rcè¯­æ³•åŠè§£æ</title>
    <url>/2022/11/16/andriod/init.rc/</url>
    <content><![CDATA[<p>åœ¨linuxè®¾å¤‡ä¸Šè¾“å…¥â€œpstreeâ€å‘½ä»¤æˆ‘ä»¬ä¾¿ä¼šçœ‹åˆ°ä¸€æ£µè¿›ç¨‹æ ‘ï¼Œä¸åŒçŠ¶æ€ä¸åŒè®¾å¤‡æ ‘ä¸Šè¿›ç¨‹åå­—è¿›ç¨‹å·å¯èƒ½ä¸å®Œå…¨ä¸€è‡´ï¼Œä½†è¿›ç¨‹å·pid=1çš„è¿›ç¨‹ä¸€å®šæ˜¯initè¿›ç¨‹ï¼å¯¹äºAndroidç³»ç»Ÿæ¥è®²ï¼Œå…¶å®é™…æ˜¯è¿è¡ŒäºLinuxå†…æ ¸ä¹‹ä¸Šçš„ä¸€ç³»åˆ—â€œæœåŠ¡è¿›ç¨‹â€ï¼Œè€Œè¿™äº›æœåŠ¡è¿›ç¨‹çš„â€œè€ç¥–å®—â€å°±æ˜¯initï¼Œå®ƒæ˜¯Androidä¸­ç¬¬ä¸€ä¸ªè¢«å¯åŠ¨çš„è¿›ç¨‹ï¼Œæ‰€æœ‰æœåŠ¡éƒ½æ˜¯é€šè¿‡è§£æinit.rcæ–‡ä»¶å¾—åˆ°çš„ï¼ˆéƒ¨åˆ†å¯ä»¥æ‰§è¡Œç¨‹åºé€šè¿‡init.d/æ–‡ä»¶å¤¹ä¸‹çš„è„šæœ¬å¯åŠ¨ï¼‰</p>
<p>æœ¬ç¯‡æ–‡ç« å°†å¯¹init.rcæ–‡ä»¶è¯­æ³•è¿›è¡Œè§£æ</p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>æŸ¥çœ‹andriodæºç ï¼š<a href="http://androidxref.com/">http://androidxref.com/</a></p>
</blockquote>
<p>init.rcæ˜¯ç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€ä¸ªç¨‹åºæ‰€åŠ è½½çš„è¯­æ³•æ–‡ä»¶ã€‚init.rcæ–‡ä»¶æ˜¯ä»¥â€œå—â€(section)ä¸ºå•ä½æœåŠ¡çš„ï¼Œä¸€ä¸ªâ€œå—â€(section)å¯ä»¥åŒ…å«å¤šè¡Œï¼Œè€Œä¸€è¡Œä¸­åŒ…å«å¤šä¸ªtokens(ç¬¦å·)ã€‚â€œå—â€(section)åˆ†æˆä¸¤å¤§ç±»ï¼šä¸€ç±»ç§°ä¸ºâ€åŠ¨ä½œ(action)â€ï¼Œå¦ä¸€ç±»ç§°ä¸ºâ€œæœåŠ¡(service)â€ã€‚è€Œä¸€ä¸ªinit.rcè„šæœ¬ç”±å››ä¸ªç±»å‹çš„å£°æ˜ç»„æˆï¼š</p>
<ol>
<li>åŠ¨ä½œ ï¼šActionsï¼Œä»¥å…³é”®å­—â€œonâ€å¼€å§‹</li>
<li>å‘½ä»¤ ï¼šCommandsï¼Œä»¥å…³é”®å­—â€œstartâ€â€œrestartâ€â€œstopâ€å¼€å§‹</li>
<li>æœåŠ¡ ï¼šServices</li>
<li>é€‰é¡¹ ï¼šOptions</li>
</ol>
<h1 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h1><p>Actionså°±æ˜¯å“åº”æŸä¸ªäº‹ä»¶çš„è¿‡ç¨‹ã€‚å¦‚ä¸‹æ‰€ç¤ºå½“æ»¡è¶³triggerè§¦å‘æ¡ä»¶æ—¶ä¾æ¬¡æ‰§è¡ŒCommandså‘½ä»¤ã€‚æºç ä¼šä¾æ¬¡å°†è¿™äº›å‘½ä»¤æ·»åŠ åˆ°â€œå‘½ä»¤æ‰§è¡Œé˜Ÿåˆ—å°¾éƒ¨â€ï¼Œç³»ç»Ÿå¯¹è¿™äº›å‘½ä»¤é¡ºåºæ‰§è¡Œã€‚æ‰€ä»¥æœåŠ¡å¯åŠ¨çš„æ ¹æœ¬å°±æ˜¯onç±»å‹çš„sectionè¢«æ‰§è¡Œçš„è¿‡ç¨‹</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">on &lt;trigger&gt;        //è§¦å‘æ¡ä»¶</span><br><span class="line">    &lt;command1&gt;      //å‘½ä»¤1</span><br><span class="line">    &lt;command2&gt;      //å‘½ä»¤2</span><br><span class="line">    &lt;command3&gt;      //å‘½ä»¤3</span><br></pre></td></tr></tbody></table></figure>

<p>å¯¹äºtriggerï¼ˆè§¦å‘å™¨ï¼‰æ¥è®²ï¼Œå¸¸è§çš„æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<ol>
<li>å•çº¯çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼šon boot</li>
<li>é”®å€¼åŒ¹é…ï¼Œæ ¼å¼ä¸ºâ€œ on property <key> = <value> â€ã€‚ä¾‹å¦‚ï¼šon property:init.svc.wifi = stopped</value></key></li>
</ol>
<p>æ­¤å¤–è¿˜æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<ol>
<li>device-added/removed-<patch> å½“è®¾å¤‡èŠ‚ç‚¹æ·»åŠ /åˆ é™¤æ—¶è§¦å‘æ­¤äº‹ä»¶</patch></li>
<li>sevice-exited-<name> å½“æŒ‡å®šæœåŠ¡<name> å­˜åœ¨æ—¶è§¦å‘</name></name></li>
</ol>
<h2 id="Actionsè§£æåæ‰§è¡Œé¡ºåº"><a href="#Actionsè§£æåæ‰§è¡Œé¡ºåº" class="headerlink" title="Actionsè§£æåæ‰§è¡Œé¡ºåº"></a>Actionsè§£æåæ‰§è¡Œé¡ºåº</h2><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">on early-init           #åœ¨åˆå§‹åŒ–æ—©æœŸé˜¶æ®µè§¦å‘</span><br><span class="line">on init                 #åˆå§‹åŒ–é˜¶æ®µè§¦å‘ã€‚è¿™é‡Œä¼šæ‰§è¡Œå®Œå±æ€§æœåŠ¡ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è®¾ç½®å±æ€§äº†</span><br><span class="line">on late-init            #åœ¨åˆå§‹åŒ–æ™šæœŸè§¦å‘ã€‚åœ¨è¿™é‡Œä¼šé€šè¿‡triggeræ¥æ‰§è¡Œå…¶ä»–çš„action,ä»¥ä¸‹å‡æ˜¯</span><br><span class="line">on early-fs</span><br><span class="line">on fs</span><br><span class="line">on post-fs</span><br><span class="line">on post-fs-data</span><br><span class="line">on firmware_mounts_complete</span><br><span class="line">on early-boot</span><br><span class="line">on boot`</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h1><table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>start <service></service></td>
<td>å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚æœå®ƒæ²¡æœ‰å¤„äºè¿è¡ŒçŠ¶æ€çš„è¯</td>
</tr>
<tr>
<td>stop <service></service></td>
<td>åœæ­¢ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚æœå½“å‰å®ƒå¤„äºè¿è¡ŒçŠ¶æ€çš„è¯</td>
</tr>
<tr>
<td>restart <service></service></td>
<td></td>
</tr>
<tr>
<td>setprop <name> <value></value></name></td>
<td>è®¾ç½®<name>çš„å±æ€§å€¼ä¸º<value></value></name></td>
</tr>
<tr>
<td>trigger <event></event></td>
<td>è§¦å‘ä¸€ä¸ªäº‹ä»¶</td>
</tr>
<tr>
<td>export <name> <value></value></name></td>
<td>è®¾ç½®<name>ç¯å¢ƒå˜é‡çš„å€¼ä¸º<value>ï¼Œå…¨å±€æœ‰æ•ˆ</value></name></td>
</tr>
<tr>
<td>mount <type> <device> <dir> [<mountoption>]*</mountoption></dir></device></type></td>
<td>å°è¯•åœ¨æŒ‡å®šè·¯å¾„ä¸ŠæŒ‚è½½ä¸€ä¸ªè®¾å¤‡</td>
</tr>
</tbody></table>
<h1 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h1><p>å®é™…ä¸Šæ¯ä¸€ä¸ªserviceå°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œå®ƒä»¬åœ¨ç‰¹å®šé€‰é¡¹çš„çº¦æŸä¸‹æ˜¯è¢«initç¨‹åºè¿è¡Œæˆ–è€…é‡å¯(serviceå¯ä»¥åœ¨é…ç½®ä¸­æŒ‡å®šæ˜¯å¦éœ€è¦é€€å‡ºé‡å¯ï¼Œè¿™æ ·å½“serviceå‡ºç°å¼‚å¸¸crashæ—¶å°±å¯ä»¥æœ‰æœºä¼šå¤åŸ)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">service &lt;name&gt; &lt;pathname&gt; [ &lt;argument&gt; ]*</span><br><span class="line">        &lt;option&gt;</span><br><span class="line">        &lt;option&gt;</span><br><span class="line">        ...</span><br><span class="line"># &lt;name&gt;       serviceæœåŠ¡çš„åå­—</span><br><span class="line"># &lt;pathname&gt;   serviceè·¯å¾„ï¼Œä¸€èˆ¬å¯¹åº”å¯æ‰§è¡Œç¨‹åºæˆ–è€…è„šæœ¬</span><br><span class="line"># &lt;argument&gt;   å¯åŠ¨pathnameä¸‹çš„serviceæ‰€éœ€è¦çš„å‚æ•°</span><br><span class="line"># &lt;option&gt;     serviceçš„çº¦æŸé¡¹</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h1><table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>disable</td>
<td>éšå¼å£°æ˜ï¼Œé»˜è®¤ä¸ä¼šè‡ªåŠ¨å¯åŠ¨è¯¥æœåŠ¡ï¼Œéœ€è¦æ˜¾å¼è°ƒç”¨</td>
</tr>
<tr>
<td>oneshot</td>
<td>å­—é¢æ„æ€ä¸€æ¬¡æ€§ï¼Œå³æœåŠ¡é€€å‡ºæ—¶ï¼Œä¸è¦ä¸»åŠ¨é‡å¯è¯¥æœåŠ¡</td>
</tr>
<tr>
<td>onrestart</td>
<td>å½“æœåŠ¡é‡å¯æ—¶ï¼Œæ‰§è¡ŒæŸäº›å‘½ä»¤ï¼ˆéœ€è¦ç†è§£ï¼‰</td>
</tr>
<tr>
<td>class <name></name></td>
<td>æŒ‡å®šè¯¥æœåŠ¡å±äº<name>classç±»ï¼Œé»˜è®¤classåä¸ºdefaultï¼ˆæ³¨ï¼šåŒä¸€ä¸ªclassæ‰€æœ‰æœåŠ¡å¿…é¡»æ˜¯åŒæ—¶å¯åŠ¨æˆ–åœæ­¢ï¼‰</name></td>
</tr>
<tr>
<td>socket <name> <type> <perm> [<user> [<group>] ]</group></user></perm></type></name></td>
<td>åˆ›å»ºä¸€ä¸ªåä¸ºdev/socket/<name>çš„ socketï¼Œç„¶åå°†å®ƒçš„fdå€¼ä¼ ç»™å¯åŠ¨å®ƒçš„è¿›ï¼Œæœ‰æ•ˆçš„<type>å€¼åŒ…æ‹¬dgram,stream å’Œseqpacketã€‚ueser å’Œgroup çš„é»˜è®¤å€¼ä¸º0ã€‚</type></name></td>
</tr>
<tr>
<td>critical</td>
<td>è¡¨æ˜è¿™æ˜¯å¯¹è®¾å¤‡è‡³å…³é‡è¦çš„æœåŠ¡ï¼›å¦‚æœå®ƒåœ¨å››åˆ†é’Ÿå†…é€€å‡ºè¶…è¿‡å››æ¬¡ï¼Œåˆ™è®¾å¤‡å°†è¿›å…¥Recovery æ¨¡å¼</td>
</tr>
<tr>
<td>group <groupname> [<groupname>]*</groupname></groupname></td>
<td>åœ¨å¯åŠ¨æœåŠ¡å‰å°†ç”¨æˆ·ç»„åˆ‡æ¢è‡³<groupname></groupname></td>
</tr>
<tr>
<td>setenv <name> <value></value></name></td>
<td>è®¾ç½®ç¯å¢ƒå˜é‡<name> ä¸ºå€¼<value></value></name></td>
</tr>
</tbody></table>
<h1 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h1><ol>
<li>serviceå’ŒActionséƒ½æ˜¯æœ‰å”¯ä¸€çš„åå­—çš„ã€‚å¦‚æœæœ‰é‡åçš„æƒ…å†µä¼šä½œä¸ºé”™è¯¯å¿½ç•¥ã€‚</li>
<li>æ— è®ºæ˜¯åŠ¨ä½œè¿˜æ˜¯æœåŠ¡ï¼Œå¹¶ä¸æ˜¯æŒ‰ç…§æ–‡ä»¶çš„ç¼–æ’é¡ºåºæ‰§è¡Œçš„ã€‚</li>
<li>è¯¥æ–‡ä»¶ä¸­æ³¨é‡Šä»¥â€œ#â€å¼€å§‹ï¼›åæ–œæ â€œ\â€åœ¨è¡Œå°¾è¡¨ç¤ºä¸‹é¢ä¸€è¡Œæ˜¯åŒä¸€è¡Œ</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">/* </span><br><span class="line"> * copy from http://androidxref.com/6.0.0_r5/xref/bootable/recovery/etc/init.rc</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">import /init.recovery.${ro.hardware}.rc</span><br><span class="line"></span><br><span class="line">on early-init</span><br><span class="line">    start ueventd</span><br><span class="line">    start healthd</span><br><span class="line"></span><br><span class="line">on init</span><br><span class="line">    export PATH /sbin:/system/bin</span><br><span class="line">    export ANDROID_ROOT /system</span><br><span class="line">    export ANDROID_DATA /data</span><br><span class="line">    export EXTERNAL_STORAGE /sdcard</span><br><span class="line"></span><br><span class="line">    symlink /system/etc /etc</span><br><span class="line"></span><br><span class="line">    mkdir /sdcard</span><br><span class="line">    mkdir /system</span><br><span class="line">    mkdir /data</span><br><span class="line">    mkdir /cache</span><br><span class="line">    mkdir /sideload</span><br><span class="line">    mount tmpfs tmpfs /tmp</span><br><span class="line"></span><br><span class="line">    chown root shell /tmp</span><br><span class="line">    chmod 0775 /tmp</span><br><span class="line"></span><br><span class="line">    write /proc/sys/kernel/panic_on_oops 1</span><br><span class="line">    write /proc/sys/vm/max_map_count 1000000</span><br><span class="line"></span><br><span class="line">on fs</span><br><span class="line">    mkdir /dev/usb-ffs 0770 shell shell</span><br><span class="line">    mkdir /dev/usb-ffs/adb 0770 shell shell</span><br><span class="line">    mount functionfs adb /dev/usb-ffs/adb uid=2000,gid=2000</span><br><span class="line"></span><br><span class="line">    write /sys/class/android_usb/android0/enable 0</span><br><span class="line">    write /sys/class/android_usb/android0/idVendor 18D1</span><br><span class="line">    write /sys/class/android_usb/android0/idProduct D001</span><br><span class="line">    write /sys/class/android_usb/android0/f_ffs/aliases adb</span><br><span class="line">    write /sys/class/android_usb/android0/functions adb</span><br><span class="line">    write /sys/class/android_usb/android0/iManufacturer ${ro.product.manufacturer}</span><br><span class="line">    write /sys/class/android_usb/android0/iProduct ${ro.product.model}</span><br><span class="line">    write /sys/class/android_usb/android0/iSerial ${ro.serialno}</span><br><span class="line"></span><br><span class="line">on boot</span><br><span class="line">    ifup lo</span><br><span class="line">    hostname localhost</span><br><span class="line">    domainname localdomain</span><br><span class="line"></span><br><span class="line">    class_start default</span><br><span class="line"></span><br><span class="line"># Load properties from /system/ + /factory after fs mount.</span><br><span class="line">on load_all_props_action</span><br><span class="line">    load_all_props</span><br><span class="line"></span><br><span class="line">on firmware_mounts_complete</span><br><span class="line">   rm /dev/.booting</span><br><span class="line"></span><br><span class="line"># Mount filesystems and start core system services.</span><br><span class="line">on late-init</span><br><span class="line">    trigger early-fs</span><br><span class="line">    trigger fs</span><br><span class="line">    trigger post-fs</span><br><span class="line">    trigger post-fs-data</span><br><span class="line"></span><br><span class="line">    # Load properties from /system/ + /factory after fs mount. Place</span><br><span class="line">    # this in another action so that the load will be scheduled after the prior</span><br><span class="line">    # issued fs triggers have completed.</span><br><span class="line">    trigger load_all_props_action</span><br><span class="line"></span><br><span class="line">    # Remove a file to wake up anything waiting for firmware</span><br><span class="line">    trigger firmware_mounts_complete</span><br><span class="line"></span><br><span class="line">    trigger early-boot</span><br><span class="line">    trigger boot</span><br><span class="line"></span><br><span class="line">on property:sys.powerctl=*</span><br><span class="line">   powerctl ${sys.powerctl}</span><br><span class="line"></span><br><span class="line">service ueventd /sbin/ueventd</span><br><span class="line">    critical</span><br><span class="line">    seclabel u:r:ueventd:s0</span><br><span class="line"></span><br><span class="line">service healthd /sbin/healthd -r</span><br><span class="line">    critical</span><br><span class="line">    seclabel u:r:healthd:s0</span><br><span class="line"></span><br><span class="line">service recovery /sbin/recovery</span><br><span class="line">    seclabel u:r:recovery:s0</span><br><span class="line"></span><br><span class="line">service adbd /sbin/adbd --root_seclabel=u:r:su:s0 --device_banner=recovery</span><br><span class="line">    disabled</span><br><span class="line">    socket adbd stream 660 system system</span><br><span class="line">    seclabel u:r:adbd:s0</span><br><span class="line"></span><br><span class="line"># Always start adbd on userdebug and eng builds</span><br><span class="line">on property:ro.debuggable=1</span><br><span class="line">    write /sys/class/android_usb/android0/enable 1</span><br><span class="line">    start adbd</span><br><span class="line"></span><br><span class="line"># Restart adbd so it can run as root</span><br><span class="line">on property:service.adb.root=1</span><br><span class="line">    write /sys/class/android_usb/android0/enable 0</span><br><span class="line">    restart adbd</span><br><span class="line">    write /sys/class/android_usb/android0/enable 1</span><br></pre></td></tr></tbody></table></figure>]]></content>
      <categories>
        <category>Linux</category>
        <category>Andriod</category>
      </categories>
  </entry>
  <entry>
    <title>Andriod Propertyå·¥ä½œæœºåˆ¶</title>
    <url>/2023/04/27/andriod/property/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>Propertyå±æ€§ç³»ç»Ÿæ˜¯ Android ä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„è¿›ç¨‹é—´ä¿¡æ¯å…±äº«æœºåˆ¶äº†ã€‚æœ¬è´¨ä¸Šå±æ€§(property)æ˜¯ä¸€å¯¹é”®/å€¼(key/value)ç»„åˆï¼Œé”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚Androdä¸­éå¸¸å¤šçš„åº”ç”¨ç¨‹åºå’Œåº“ç›´æ¥æˆ–è€…é—´æ¥çš„ä¾èµ–äºå±æ€§ç³»ç»Ÿï¼Œå¹¶ç”±æ­¤å†³å®šå…¶è¿è¡ŒæœŸçš„è¡Œä¸ºã€‚å®ƒçš„å¤„ç†æµç¨‹åŒandroidçš„å…¶ä»–æ¨¡å—ä¸€æ ·ï¼Œä¹Ÿåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œpropertyè®¾ç½®å¿…é¡»åœ¨æœåŠ¡ç«¯ï¼Œè¯»å–ç›´æ¥åœ¨å®¢æˆ·ç«¯ã€‚å…¶ç‰¹ç‚¹å¯ä»¥æ€»ç»“ä¸º</p>
<ul>
<li>å¯åŠ¨å¯åŠ¨åå°†init.rcã€build.propã€default.propç­‰å±æ€§æ–‡ä»¶ä¸­åŠ è½½è¿›ä¸€å—å…±äº«å†…å­˜</li>
<li>å±æ€§æ–‡ä»¶çš„æ ¼å¼ç±»ä¼¼äºmapè¡¨ï¼Œä»¥key/valueçš„å½¢å¼å­˜åœ¨ï¼Œæ‰€æœ‰é”®å€¼æ˜¯ä»¥å­—çº¿æ ‘çš„å½¢å¼è¿›è¡Œç»„ç»‡èµ·æ¥çš„</li>
<li>ä»»ä½•è¿›ç¨‹éƒ½ä¼šå°†å…±äº«å†…å­˜æ˜ å°„åˆ°è‡ªå·±çš„å†…å­˜ä¸­ï¼Œè¿›è€Œå¯ä»¥è¯»å‡ºå€¼</li>
<li>ä¿®æ”¹å˜é‡ä¸åŒè¿›ç¨‹åªå¯ä»¥é€šè¿‡socketæ–¹å¼ï¼Œå‘å±æ€§æœåŠ¡å‘å‡ºä¿®æ”¹å±æ€§å€¼çš„è¯·æ±‚ï¼Œè€Œä¸èƒ½ç›´æ¥ä¿®æ”¹å±æ€§å€¼</li>
<li>ç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªå®ä½“å¯ä»¥è®¾ç½®ä¿®æ”¹å±æ€§å€¼ï¼Œå³å±æ€§æœåŠ¡</li>
</ul>
<h2 id="å­—å…¸æ ‘"><a href="#å­—å…¸æ ‘" class="headerlink" title="å­—å…¸æ ‘"></a>å­—å…¸æ ‘</h2><p>å±æ€§åœ¨å†…å­˜ä¸­æ˜¯ä»¥å­—å…¸æ ‘çš„å½¢å¼è¿›è¡Œå­˜å‚¨çš„</p>
<ol>
<li>é¦–å…ˆæ˜¯å…±äº«å†…å­˜èµ·å§‹å—prop_areaã€‚å…¶ä¸­è§„å®šäº†byte_usedã€versionã€magic_numberç­‰ç­‰</li>
<li>ç´§æ¥ç€æ˜¯ä¸€ä¸ªç©ºç™½èŠ‚ç‚¹prop_btï¼Œå…¶ä½œä¸ºæ•´æ£µæ ‘çš„æ ¹èŠ‚ç‚¹</li>
<li>ä¸‹é¢å°†ä¾æ¬¡å­˜å‚¨ç›¸å…³å±æ€§<ul>
<li>å±æ€§åå°†ä»¥â€˜.â€™ç¬¦å·ä¸ºåˆ†å‰²ç¬¦è¢«åˆ†å‰²å¼€æ¥ã€‚æ¯”å¦‚ro.secureå±æ€§åå°±ä¼šè¢«åˆ†å‰²æˆâ€œroâ€å’Œâ€œsecureâ€ä¸¤éƒ¨åˆ†ï¼Œè€Œä¸”æ¯ä¸ªéƒ¨åˆ†ç”¨ä¸€ä¸ªprop_btèŠ‚ç‚¹è¡¨è¾¾ã€‚</li>
<li>å±æ€§åä¸­çš„è¿™ç§â€˜.â€™å…³ç³»è¢«è¡¨ç¤ºä¸ºçˆ¶å­å…³ç³»ï¼Œæ‰€ä»¥â€œroâ€èŠ‚ç‚¹çš„childrenåŸŸï¼Œä¼šæŒ‡å‘â€œsecureâ€èŠ‚ç‚¹ï¼Œä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªchildrenåŸŸï¼Œå¦‚æœå®ƒè¿˜æœ‰å…¶ä»–å­©å­ï¼Œé‚£äº›å­©å­å°†ä¼šå’Œç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆæ¯”å¦‚secureèŠ‚ç‚¹ï¼‰ç»„æˆä¸€æ£µäºŒå‰æ ‘ã€‚</li>
<li>å½“ä¸€ä¸ªå±æ€§åå¯¹åº”çš„â€œå­—å…¸æ ‘æâ€éƒ½å·²ç»å½¢æˆå¥½åï¼Œä¼šå¦å¤–åˆ›å»ºä¸€ä¸ªprop_infoèŠ‚ç‚¹ï¼Œä¸“é—¨è¡¨ç¤ºè¿™ä¸ªå±æ€§ï¼Œè¯¥èŠ‚ç‚¹å°±æ˜¯â€œå­—å…¸æ ‘å¶â€</li>
</ul>
</li>
</ol>
<h1 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h1><h2 id="è·å–å±æ€§"><a href="#è·å–å±æ€§" class="headerlink" title="è·å–å±æ€§"></a>è·å–å±æ€§</h2><p>getprop å±æ€§å</p>
<h2 id="è®¾ç½®å±æ€§"><a href="#è®¾ç½®å±æ€§" class="headerlink" title="è®¾ç½®å±æ€§"></a>è®¾ç½®å±æ€§</h2><p>setprop å±æ€§å å±æ€§å€¼</p>
<h2 id="å‡½æ•°è°ƒç”¨æµç¨‹"><a href="#å‡½æ•°è°ƒç”¨æµç¨‹" class="headerlink" title="å‡½æ•°è°ƒç”¨æµç¨‹"></a>å‡½æ•°è°ƒç”¨æµç¨‹</h2><h3 id="è·å–æ‰€æœ‰å±æ€§"><a href="#è·å–æ‰€æœ‰å±æ€§" class="headerlink" title="è·å–æ‰€æœ‰å±æ€§"></a>è·å–æ‰€æœ‰å±æ€§</h3><ul>
<li>property_list -call-&gt; __system_property_foreach(void (*propfn)(const prop_info *pi, void *cookie)</li>
<li>__system_property_foreach(void (*propfn)(const prop_info *pi, void *cookie) -call-&gt; foreach_property()éå†æ‰€æœ‰å±æ€§</li>
</ul>
<h3 id="è·å–æŸä¸ªå±æ€§"><a href="#è·å–æŸä¸ªå±æ€§" class="headerlink" title="è·å–æŸä¸ªå±æ€§"></a>è·å–æŸä¸ªå±æ€§</h3><p>è¯´æ˜ï¼šè·å–å±æ€§çš„æµç¨‹ä¸å†èµ°socketï¼Œè€Œæ˜¯ç›´æ¥ä»å…±äº«å†…å­˜ä¸­è¯»å–</p>
<ul>
<li>int property_get-call-&gt;system_property_get(key, value)</li>
<li>__system_property_find-call-&gt; __system_property_find_compat(name)</li>
</ul>
<h3 id="è®¾ç½®å±æ€§-1"><a href="#è®¾ç½®å±æ€§-1" class="headerlink" title="è®¾ç½®å±æ€§"></a>è®¾ç½®å±æ€§</h3><ul>
<li>property_set call-&gt; __system_property_set(key, value)</li>
<li>__system_property_set(key, value) -call-&gt; send_prop_msg(&amp;msg)</li>
</ul>
<p>__system_property_seté€šè¿‡æœ¬åœ°SOCKET: â€œ/dev/socket/property_serviceâ€ ä¸initè¿›ç¨‹ä¸­propertiesæœåŠ¡é€šè®¯ã€‚</p>
<h1 id="Propertyè°ƒç”¨æµç¨‹"><a href="#Propertyè°ƒç”¨æµç¨‹" class="headerlink" title="Propertyè°ƒç”¨æµç¨‹"></a>Propertyè°ƒç”¨æµç¨‹</h1><ol>
<li><p>åˆå§‹åŒ–ä¸€å—å…±äº«å†…å­˜</p>
<ul>
<li>void property_init(void)  ==&gt; init_property_area(void)</li>
</ul>
<ul>
<li><p>property_area_inited  åˆå§‹åŒ–å†…å­˜åŒºåŸŸæ ‡å¿—ä½æ£€æŸ¥</p>
</li>
<li><p>__system_property_area_init()  ==&gt;  map_prop_area_rw()</p>
<p>åˆ›å»ºå¹¶æ‰“å¼€/tmp/__properties__æ–‡ä»¶ï¼›ftruncate(fd, PA_SIZE)æ–‡ä»¶å¤§å°æŒ‡å®šä¸ºPA_SIZEï¼›æ˜ å°„ä¸€æ®µåœ°å€åˆ°æ–‡ä»¶å¹¶åˆå§‹åŒ–å†…å­˜ï¼›å°†å†…å­˜åœ°å€__system_property_area__èµ‹å€¼åˆ°å…¨å±€å˜é‡</p>
</li>
<li><p>init_workspace(workspace *w, size_t size)   è®¾ç½®waorspaceç»“æ„ä½“ï¼Œåªè¯»æ‰“å¼€PROP_FILENAME</p>
</li>
<li><p>fcntl(pa_workspace.fd, F_SETFD, FD_CLOEXEC)</p>
</li>
<li><p>property_area_inited = 1; ç½®ä½</p>
</li>
</ul>
</li>
<li><p>åŠ è½½æ‰€æœ‰é»˜è®¤å±æ€§</p>
<ul>
<li>load_all_props( )   ==&gt;  load_properties_from_file(const char *fn, const char *filter)</li>
</ul>
<ul>
<li><p>*read_file(fn, &amp;sz)   è¯»fnæ–‡ä»¶å¤§å°å­˜å…¥szï¼Œå¼€è¾Ÿä¸€å—size+2çš„å †ç©ºé—´ï¼Œé¦–åœ°å€ä½œä¸ºè¿”å›å€¼returnå‡ºå»</p>
</li>
<li><p>void load_properties(char *data, const char *filter)</p>
<ul>
<li><p>while ((eol = strchr(sol, â€˜\nâ€™))) é€è¡Œè§£æ</p>
<ul>
<li><p>#   å…³é”®å­—ç¬¦æ¯”è¾ƒã€‚å¤„ç†ï¼šæ³¨é‡Š</p>
</li>
<li><p>import å…³é”®å­—ç¬¦æ¯”è¾ƒã€‚å¤„ç†ï¼šå¯¼å…¥å…¶ä»–.propæ–‡ä»¶</p>
</li>
<li><p>= å…³é”®å­—ç¬¦æ¯”è¾ƒã€‚å¤„ç†ï¼šæŒ‰ç…§keyï¼Œvalue</p>
<ul>
<li><p>property_set(key, value)</p>
</li>
<li><p>__system_property_add(const char *name, unsigned int namelen,  const char *value, unsigned int valuelen)</p>
</li>
<li><p>prop_info *find_property(prop_bt *const trie, const char *name, uint8_t namelen, const char *value, uint8_t valuelen, bool alloc_if_needed)</p>
<p>æ ¸å¿ƒå‡½æ•°ï¼Œå°†propæŒ‰ç…§mapå­˜å‚¨åˆ°å¯¹åº”çš„å†…å­˜ä½ç½®</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>è§£æåŠ è½½init.rcä¸­çš„service</p>
<p>init_parse_config_file(â€œ/etc/init.rcâ€)</p>
</li>
<li><p>å°†æŸä¸ªåŠ¨ä½œæ·»åŠ åˆ°é˜Ÿåˆ—</p>
<p>queue_builtin_action(property_service_init_actionï¼Œ (char*)â€property_service_initâ€);</p>
</li>
<li><p>åœ¨æŸä¸ªé˜¶æ®µå‡ºå‘æŸä¸ªservice</p>
<p>action_for_each_trigger(â€œlate-initâ€, action_add_queue_tail);</p>
</li>
<li><p>for(;;) å¾ªç¯</p>
</li>
</ol>
<h1 id="å¦‚ä½•å®ç°å…±äº«"><a href="#å¦‚ä½•å®ç°å…±äº«" class="headerlink" title="å¦‚ä½•å®ç°å…±äº«"></a>å¦‚ä½•å®ç°å…±äº«</h1><p>init_workspacedå‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œæ‰“å¼€çš„å¥æŸ„è®°å½•åœ¨pa_workspace.fdå¤„ï¼Œä»¥åæ¯å½“initè¿›ç¨‹æ‰§è¡Œsocketå‘½ä»¤ï¼Œå¹¶è°ƒç”¨service_start()æ—¶ï¼Œæ‰§è¡Œï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">get_property_workspace(&amp;fd, &amp;sz);                                          </span><br><span class="line"><span class="built_in">sprintf</span>(tmp, <span class="string">"%d,%d"</span>, dup(fd), sz);</span><br><span class="line">add_environment(<span class="string">"ANDROID_PROPERTY_WORKSPACE"</span>, tmp);</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶å®å°±æ˜¯æŠŠ pa_workspace.fd çš„å¥æŸ„è®°å…¥ä¸€ä¸ªåå«â€œ ANDROID_PROPERTY_WORKSPACE â€çš„ç¯å¢ƒå˜é‡å»ã€‚</p>
<p>androidé‡‡ç”¨äº†gccçš„constructorå±æ€§ï¼Œè¯¥å±æ€§æŒ‡æ˜ä¸€ä¸ª_libc_preinitå‡½æ•°,å½“bionicåº“è¢«åŠ è½½æ—¶å°†è‡ªåŠ¨è°ƒç”¨_libc_preinit,å…³é”®callè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">__libc_preinit -call-&gt; __libc_init_common(*args)-&gt;__system_properties_init-&gt;map_prop_area</span><br></pre></td></tr></tbody></table></figure>

<p>map_prop_area( )</p>
<ul>
<li>get_fd_from_env()ï¼Œ é€šè¿‡ANDROID_PROPERTY_WORKSPACEç¯å¢ƒå˜é‡æ‹¿åˆ°fd</li>
<li>map_fd_ro(const int fd)ï¼Œæ˜ å°„è¯¥å†…å­˜åŒºåŸŸåˆ°æœ¬åœ°è¿›ç¨‹</li>
</ul>
<h1 id="å±æ€§ç‰¹æ®Šå¤„ç†"><a href="#å±æ€§ç‰¹æ®Šå¤„ç†" class="headerlink" title="å±æ€§ç‰¹æ®Šå¤„ç†"></a>å±æ€§ç‰¹æ®Šå¤„ç†</h1><p>ctl.å¼€å¤´çš„å±æ€§æ˜¯æ§åˆ¶å±æ€§ï¼Œç”¨äºæ§åˆ¶ç³»ç»Ÿçš„æœ¬åœ°æœåŠ¡</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">ctl.xxxï¼ˆstart/stop/restartï¼‰   servicename[:args]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>ro.å¼€å¤´çš„å±æ€§ä¸èƒ½è¢«ä¿®æ”¹ï¼›</li>
<li>net.å¼€å§‹çš„å±æ€§(é™¤net.changeå¤–)è®¾ç½®ï¼Œ å°†å¼•å‘net.change=keyçš„å±æ€§è®¾ç½®ï¼Œè¢«bionic/libc/netbsd/resolv/res_state.cä¸­çš„ä»£ç å¤„ç†(é€šè¿‡__system_property_findå‡½æ•°)ï¼›</li>
<li>persist.å¼€å§‹çš„å±æ€§ï¼Œå¦‚æœåœ¨init.rcå’Œä»£ç ä¸­è®¾ç½®ï¼Œ å°†ä¼šè¢«å†™åˆ°/data/propertyç›®å½•ä¸‹ï¼›</li>
</ul>
<h1 id="rtoså®ç°æ–¹å¼"><a href="#rtoså®ç°æ–¹å¼" class="headerlink" title="rtoså®ç°æ–¹å¼"></a>rtoså®ç°æ–¹å¼</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>è‡ªå·±åœ¨freertosçš„å¼€å‘ä¸­ï¼Œæ•´ä½“ä½¿ç”¨Cè¯­è¨€ï¼Œé’ˆå¯¹propertyçš„åŠŸèƒ½è‡ªå·±å®ç°äº†ä¸€å¥—ç›¸å…³ä»£ç ã€‚ä¸»è¦åŒ…æ‹¬ï¼šget/set propertyï¼›é’ˆå¯¹propertyçš„å‰ç½®å±æ€§è¿›è¡Œåˆ¤æ–­ï¼Œro/rw/presistç­‰ç­‰</p>
<h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><ol>
<li>å‰æœŸå‡†å¤‡<ul>
<li>é€‰æ‹©åŸºç¡€æ•°æ®ç»“æ„ï¼šmap</li>
<li>é€‰æ‹©è¯­è¨€ï¼šC</li>
<li>æ„å»ºæ•´ä½“è½¯ä»¶æ¡†æ¶ï¼šrbtreeâ€“&gt;mapâ€”&gt;system_propâ€”&gt;server_prop</li>
</ul>
</li>
<li>åœ¨PCè¿›è¡Œä»£ç æ„å»º<ul>
<li>åŸºäº<a href="https://github.com/forhappy/rbtree">å¼€æºä»£ç rbtree</a>çš„å®ç°ï¼Œå°è£…å‡ºmapæ¥å£</li>
<li>åŸºäºandriodçš„å®ç°å’Œæä¾›çš„mapæ¥å£å°è£…system_prop</li>
<li>åŸºäºsystem_propå°è£…å¯¼å‡ºçš„APIæ¥å£</li>
</ul>
</li>
<li>æµ‹è¯•ä»£ç åŠŸèƒ½</li>
<li>ç§»æ¤åˆ°å¼€å‘æ¿å¹¶è°ƒè¯•</li>
<li>æ·»åŠ å†…å­˜æ± ï¼Œè¿›è¡Œä»£ç ä¼˜åŒ–</li>
</ol>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ul>
<li><a href="https://www.pianshen.com/article/8653307704/">æ·±å…¥è®²è§£Android Propertyæœºåˆ¶</a></li>
<li><a href="https://blog.csdn.net/weixin_39613712/article/details/117314185">Android Propertyå±æ€§çš„å®ç°ç»†èŠ‚</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Andriod</category>
      </categories>
  </entry>
  <entry>
    <title>51jobçˆ¬è™«é¡¹ç›®</title>
    <url>/2022/12/03/item/51job/</url>
    <content><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>ç´§æ¥ç€è±†ç“£çˆ¬è™«çš„é¡¹ç›®ï¼Œè¯¥é¡¹ç›®ä½œä¸ºå…¶åçš„ç»ƒä¹ å’Œæ‰©å±•ï¼Œç®—æ˜¯ä¸€ä¸ªè¾ƒä¸ºä¸é”™çš„ä¸Šæ‰‹ç»ƒä¹ ã€‚æœ¬æ–‡æ‰€æ¶‰åŠçš„æ˜¯å¯¹äº51jobæ•°æ®çš„çˆ¬å–ã€è§£æå’Œä¿å­˜ã€‚å¯¹äºæ•°æ®å¯è§†åŒ–æ“ä½œï¼Œåœ¨åç»­ä¼šæŒç»­æ›´æ–°ï¼Œè¯·å…³æ³¨ï¼<br>åœ¨ä¸‹é¢ä»£ç ä¸­æœ‰äº›å‡½æ•°å†…éƒ¨è°ƒç”¨äº†å…¶ä»–å‡½æ•°ï¼Œéœ€è¦è¡¥å…¨å„ä¸ªéƒ¨åˆ†çš„å‡½æ•°ã€‚å¦‚æœéœ€è¦æºç è¯·ç§ä¿¡æˆ–è€…è¯„è®ºã€‚</p>
<blockquote>
<p>å…·ä½“å…³äºåº“çš„æ“ä½œæˆ‘é€‰æ‹©äº†ä¸€äº›å®˜æ–¹æ–‡æ¡£å’Œè¾ƒå¥½ç†è§£çš„è§£è¯»æ–‡ç« åšé“¾æ¥ï¼ŒçŸ¥è¯†ç‚¹æ¯”è¾ƒå…¨é¢è¯·å‚è€ƒä¸‹åˆ—è¡¨ã€‚</p>
</blockquote>
<ul>
<li><p><a href="https://python-selenium-zh.readthedocs.io/zh_CN/latest/">è¯¦æƒ…é¡µURLè·å–æ¨¡å—ï¼šselenium</a></p>
</li>
<li><p><a href="https://requests.readthedocs.io/zh_CN/latest/">URLå¤„ç†ç¬¬ä¸‰æ–¹æ¨¡å—ï¼šrequests</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/9135d7833d6d">æ•°æ®æå–etreeæ¨¡å—ï¼šlxml</a></p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.7/library/sqlite3.html">æ•°æ®åº“ä¿å­˜æ¨¡å—ï¼šsqlite3</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/python-robot/p/9958352.html">æœ¬åœ°æ–‡ä»¶ä¿å­˜æ¨¡å—ï¼šxlwt</a></p>
</li>
</ul>
<h1 id="æ•°æ®çˆ¬å–ä¸è§£æ"><a href="#æ•°æ®çˆ¬å–ä¸è§£æ" class="headerlink" title="æ•°æ®çˆ¬å–ä¸è§£æ"></a>æ•°æ®çˆ¬å–ä¸è§£æ</h1><h2 id="è¯¦æƒ…é¡µé“¾æ¥çš„è·å–ï¼šselenium"><a href="#è¯¦æƒ…é¡µé“¾æ¥çš„è·å–ï¼šselenium" class="headerlink" title="è¯¦æƒ…é¡µé“¾æ¥çš„è·å–ï¼šselenium"></a>è¯¦æƒ…é¡µé“¾æ¥çš„è·å–ï¼šselenium</h2><p>seleniumä½œä¸ºwebè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œç›®å‰åœ¨pythonçˆ¬è™«ä¸­åº”ç”¨ä¹Ÿè¶Šæ¥è¶Šå¹¿æ³›ã€‚å…¶ä¸»è¦åº”ç”¨åŸç†æ˜¯ï¼šé€šè¿‡å®Œå…¨æ¨¡æ‹Ÿæµè§ˆå™¨çš„æ“ä½œï¼Œæ¯”å¦‚è¾“å…¥æ¡†è¾“å…¥ã€ç‚¹å‡»è¶…é“¾æ¥å…ƒç´ ã€ä¸‹æ‹‰æ»šåŠ¨æ¡ç­‰ç­‰æ¥æ‹¿åˆ°jsæ¸²æŸ“ä¹‹åçš„ä»£ç ã€‚<br>å¿…è¦æ€§ï¼šä¹‹å‰ç”¨çš„requestsæ˜¯å¯¹ä¸€ä¸ªé¡µé¢å‘é€è¯·æ±‚ï¼Œåªèƒ½è·å¾—å½“å‰åŠ è½½å‡ºæ¥çš„éƒ¨åˆ†é¡µé¢å³æœ€åˆçš„æºä»£ç ï¼ŒåŠ¨æ€åŠ è½½çš„æ•°æ®æ˜¯è·å–ä¸åˆ°çš„ï¼Œæ¯”å¦‚jsæ¸²æŸ“åçš„ä»£ç ã€ä¸‹æ‹‰æ»šè½®å¾—åˆ°çš„æ•°æ®å’Œä¸€äº›æ¡†å†…éšè—å…ƒç´ ç­‰ç­‰ã€‚<br>å¯¹äºseleniumçš„è§£è¯»ï¼Œ<a href="https://blog.csdn.net/heartbeat196/article/details/113831482">è¯·ç‚¹å‡»click</a>ï¼</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#è·å¾—æ‰€æœ‰ç½‘é¡µè¯¦æƒ…é¡µé“¾æ¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_link</span>():</span><br><span class="line">    linklist = []</span><br><span class="line">    <span class="comment">#åˆ›å»ºé©±åŠ¨å™¨å¯¹è±¡</span></span><br><span class="line">    wd = webdriver.Chrome(<span class="string">r'C:\Program Files\Google\Chrome\Application\chromedriver.exe'</span>)</span><br><span class="line">    wd.implicitly_wait(<span class="number">5</span>)</span><br><span class="line">    <span class="comment">#è®¿é—®51jobç½‘ç«™</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">21</span>):</span><br><span class="line">        wd.get(<span class="string">f"https://search.51job.com/list/010000,000000,0000,00,9,99,keyword,2,<span class="subst">{i}</span>.html?"</span>)</span><br><span class="line">        <span class="comment">#æŸ¥æ‰¾æ¯æ¯ä¸€æ¡ä¿¡æ¯é“¾æ¥è¿›å…¥è¯¦æƒ…é¡µ</span></span><br><span class="line">        joblists = wd.find_elements_by_xpath(<span class="string">'//div[@class="j_joblist"]/div/a'</span>)</span><br><span class="line">        <span class="keyword">for</span> joblist <span class="keyword">in</span> joblists:</span><br><span class="line">            con_link = joblist.get_attribute(<span class="string">"href"</span>)</span><br><span class="line">            linklist.append(con_link)</span><br><span class="line">    wd.quit()</span><br><span class="line">    <span class="keyword">return</span> linklist</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>æ³¨é‡Šï¼š</p>
<ol>
<li>ä»£ç ä¸­çš„ webdriver.Chromeï¼Œåé¢æ˜¯è‡ªå·±æ‰€ç”¨çš„é©±åŠ¨å™¨çš„æœ¬åœ°åœ°å€ã€‚</li>
<li>webdriverå¯¹è±¡wdï¼Œè°ƒç”¨ getæ–¹æ³•ï¼Œåé¢æ‹¬å·å†…ä¸ºè‡ªå·±æ‰€è¦è®¿é—®çš„ç½‘é¡µé“¾æ¥åœ°å€ã€‚</li>
</ol>
</blockquote>
<h2 id="æ•°æ®çˆ¬å–ä¸è§£æï¼šxpath"><a href="#æ•°æ®çˆ¬å–ä¸è§£æï¼šxpath" class="headerlink" title="æ•°æ®çˆ¬å–ä¸è§£æï¼šxpath"></a>æ•°æ®çˆ¬å–ä¸è§£æï¼šxpath</h2><p>ç”±äºè‡ªå·±ä¹ æƒ¯äºä½¿ç”¨xpathæ–¹æ³•è§£æï¼Œåœ¨æ­¤åªåšxpathè§£æçš„æ–¹æ³•ï¼Œå¦‚æœéœ€è¦reæ­£åˆ™è¡¨è¾¾å¼æˆ–è€…BeautifulSoupè§£æï¼Œè¯„è®ºåç»­ä¼šæ›´æ–°ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    job_information = []</span><br><span class="line">    url_lists = get_link()</span><br><span class="line">    <span class="keyword">for</span> i,url <span class="keyword">in</span> <span class="built_in">enumerate</span>(url_lists):</span><br><span class="line">        datalist=[]</span><br><span class="line">        header = {</span><br><span class="line">            <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0(Windows NT 10.0;Win64;x64)AppleWebKit/537.36(KHTML,likeGecko)Chrome/88.0.4324.150Safari/537.36"</span></span><br><span class="line">        }</span><br><span class="line">        response = requests.get(url, headers=header)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            html = response.content.decode(<span class="string">"gbk"</span>)</span><br><span class="line">            data = etree.HTML(html)</span><br><span class="line">            link = url</span><br><span class="line">            datalist.append(link)		<span class="comment">#å­˜å…¥å²—ä½é“¾æ¥</span></span><br><span class="line">            title = data.xpath(<span class="string">r'//div[@class="cn"]/h1/@title'</span>)[<span class="number">0</span>]</span><br><span class="line">            datalist.append(title)		<span class="comment">#å­˜å…¥å²—ä½åç§°</span></span><br><span class="line">            salary = data.xpath(<span class="string">r'//div[@class="cn"]/strong/text()'</span>)[<span class="number">0</span>]</span><br><span class="line">            datalist.append(salary)</span><br><span class="line">            information = data.xpath(<span class="string">r'//p[@class="msg ltype"]/@title'</span>)[<span class="number">0</span>]</span><br><span class="line">            information = re.sub(<span class="string">r"\s+"</span>, <span class="string">""</span>, information)  <span class="comment"># å»é™¤ç©ºç™½æ ¼</span></span><br><span class="line">            experience = information.split(<span class="string">"|"</span>)[<span class="number">1</span>]</span><br><span class="line">            datalist.append(experience)</span><br><span class="line">            education = information.split(<span class="string">"|"</span>)[<span class="number">2</span>]</span><br><span class="line">            datalist.append(education)</span><br><span class="line">            num = information.split(<span class="string">"|"</span>)[<span class="number">3</span>]</span><br><span class="line">            datalist.append(num)</span><br><span class="line">            place = data.xpath(<span class="string">r'//p[@class="fp"]/text()'</span>)[<span class="number">0</span>]</span><br><span class="line">            datalist.append(place)</span><br><span class="line">            treatment = data.xpath(<span class="string">r'//span[@class="sp4"]/text()'</span>)</span><br><span class="line">            treatment = <span class="string">" "</span>.join(treatment)</span><br><span class="line">            datalist.append(treatment)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"-----ç¬¬{}æ¡------"</span>.<span class="built_in">format</span>(i))</span><br><span class="line">            job_information.append(datalist)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"-----ç¬¬{}æ¡å‡ºé”™ï¼ŒåŸå› æ˜¯{}------"</span>.<span class="built_in">format</span>(i,e))</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment">#print(job_information)		#æµ‹è¯•</span></span><br><span class="line">    <span class="keyword">return</span> job_information</span><br></pre></td></tr></tbody></table></figure>
<h1 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h1><h2 id="Excelæœ¬åœ°ä¿å­˜"><a href="#Excelæœ¬åœ°ä¿å­˜" class="headerlink" title="Excelæœ¬åœ°ä¿å­˜"></a>Excelæœ¬åœ°ä¿å­˜</h2><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">save_data_excel</span>(<span class="params">datalist</span>):</span><br><span class="line">    workbook = xlwt.Workbook(encoding=<span class="string">"gbk"</span>, style_compression=<span class="number">0</span>)</span><br><span class="line">    worksheet = workbook.add_sheet(<span class="string">"python"</span>)</span><br><span class="line">    col = [<span class="string">"é“¾æ¥"</span>, <span class="string">"å²—ä½åç§°"</span>, <span class="string">"è–ªèµ„"</span>, <span class="string">"å·¥ä½œç»éªŒ"</span>, <span class="string">"å­¦å†"</span>, <span class="string">"æ‹›è˜äººæ•°"</span>, <span class="string">"å·¥ä½œåœ°ç‚¹"</span>, <span class="string">"ç¦åˆ©"</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>):</span><br><span class="line">        worksheet.write(<span class="number">0</span>, i, col[i])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(datalist)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>):</span><br><span class="line">            worksheet.write(i+<span class="number">1</span>,j,datalist[i][j])</span><br><span class="line">    workbook.save(<span class="string">"åŒ—äº¬-pythonå·¥ä½œ.xls"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Excelæ•°æ®ä¿å­˜ç»“æœå±•ç¤º"><a href="#Excelæ•°æ®ä¿å­˜ç»“æœå±•ç¤º" class="headerlink" title="Excelæ•°æ®ä¿å­˜ç»“æœå±•ç¤º"></a>Excelæ•°æ®ä¿å­˜ç»“æœå±•ç¤º</h2><p><img src="/images/item/51job-1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="sqliteæ•°æ®åº“ä¿å­˜"><a href="#sqliteæ•°æ®åº“ä¿å­˜" class="headerlink" title="sqliteæ•°æ®åº“ä¿å­˜"></a>sqliteæ•°æ®åº“ä¿å­˜</h2><p>åœ¨æ­¤éƒ¨åˆ†åªå†™äº†æ•°æ®åº“ä¿å­˜çš„å·¥ä½œï¼Œæ•°æ®åº“çš„åˆå§‹åŒ–åˆ›å»ºéœ€å‡½æ•°sql_initéœ€è¦æ·»åŠ å³å¯ä½¿ç”¨ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">save_data_sql</span>(<span class="params">datalist,dbpath</span>):</span><br><span class="line">    sql_init(dbpath)</span><br><span class="line">    conn = sqlite3.connect(dbpath)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> datalist:</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">            data[index] = <span class="string">'"'</span> + data[index] + <span class="string">'"'</span></span><br><span class="line">        sql = <span class="string">'''</span></span><br><span class="line"><span class="string">        insert into job_information(</span></span><br><span class="line"><span class="string">            link,title,salary,experience,education,num,place,treatment)</span></span><br><span class="line"><span class="string">            values(%s)'''</span>%<span class="string">","</span>.join(data)</span><br><span class="line">        <span class="comment">#print(sql)     #æµ‹è¯•sqlè¯­å¥æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">        cur.execute(sql)</span><br><span class="line">        conn.commit()</span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br></pre></td></tr></tbody></table></figure>
<h2 id="sqliteæ•°æ®åº“ä¿å­˜ç»“æœå±•ç¤º"><a href="#sqliteæ•°æ®åº“ä¿å­˜ç»“æœå±•ç¤º" class="headerlink" title="sqliteæ•°æ®åº“ä¿å­˜ç»“æœå±•ç¤º"></a>sqliteæ•°æ®åº“ä¿å­˜ç»“æœå±•ç¤º</h2><p><img src="/images/item/51job-2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="æ•°æ®å¯è§†åŒ–"><a href="#æ•°æ®å¯è§†åŒ–" class="headerlink" title="æ•°æ®å¯è§†åŒ–"></a>æ•°æ®å¯è§†åŒ–</h1><p>null</p>
]]></content>
      <categories>
        <category>Item</category>
      </categories>
  </entry>
  <entry>
    <title>è®¡ç®—æœºå­˜å‚¨ä½“ç³»</title>
    <url>/2023/02/07/computerSystem/%E5%AD%98%E5%82%A8%E4%BD%93%E7%B3%BB/</url>
    <content><![CDATA[<p>ä½œä¸ºè®¡ç®—æœºäº”å¤§æ ¸å¿ƒåŠŸèƒ½ï¼ˆè¿ç®—ã€å­˜å‚¨ã€æ§åˆ¶ã€è¾“å…¥ã€è¾“å‡ºï¼‰ä¹‹ä¸€çš„å­˜å‚¨ï¼Œæ— ç–‘åœ¨æ•´ä¸ªè®¡ç®—æœºä½“ç³»ç»“æ„ä¸­æœ‰ç€ä¸¾è¶³è½»é‡çš„åœ°ä½ã€‚</p>
<p>å­˜å‚¨å™¨å±äºè®¡ç®—æœºçš„è®°å¿†è£…ç½®ï¼Œç”¨äºå­˜æ”¾ç¨‹åºå’Œæ•°æ®ã€‚åœ¨æˆ‘çœ‹æ¥ç¨‹åºæ˜¯ä½œä¸ºè®¡ç®—æœºçš„çµé­‚è€Œå­˜åœ¨çš„ï¼Œå®ƒæŒ‡å¯¼äº†è®¡ç®—æœºçš„ä¸€åˆ‡è¡Œä¸ºï¼Œè€Œæ•°æ®åˆ™æ˜¯è¿™ä¸€åˆ‡è¡Œä¸ºçš„åŸºçŸ³ã€‚</p>
<p>æœ¬æ–‡å°†åŸºäºå­˜å‚¨å™¨å¯¹è®¡ç®—æœºçš„å­˜å‚¨ç³»ç»Ÿåšç®€è¦ä»‹ç»</p>
<h1 id="å­˜å‚¨å™¨åˆ†ç±»"><a href="#å­˜å‚¨å™¨åˆ†ç±»" class="headerlink" title="å­˜å‚¨å™¨åˆ†ç±»"></a>å­˜å‚¨å™¨åˆ†ç±»</h1><p><img src="/images/computerSystem/storage/storage-0.png" alt="image"></p>
<h1 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h1><p><img src="/images/computerSystem/storage/storage-1.png" alt="image"></p>
<h2 id="è®¾è®¡ç›®çš„"><a href="#è®¾è®¡ç›®çš„" class="headerlink" title="è®¾è®¡ç›®çš„"></a>è®¾è®¡ç›®çš„</h2><p>é€šè¿‡å­˜å‚¨å™¨åˆ†ç±»å›¾ä¸éš¾çœ‹å‡ºå­˜å‚¨å™¨çš„ç§ç±»ç¹å¤šï¼Œè€Œå¦‚ä½•åˆç†çš„ä½¿ç”¨æ¯ä¸€ç§å­˜å‚¨å™¨ç»„æˆåºå¤§çš„å­˜å‚¨ä½“ç³»ç»“æ„æ— ä¸ä½“ç°ç€å·¥ç¨‹å¸ˆä»¬çš„æ™ºæ…§ã€‚</p>
<p>å­˜å‚¨ç³»ç»Ÿè®¾è®¡çš„æ ¸å¿ƒé—®é¢˜åœ¨äºï¼š<strong>æˆæœ¬ï¼ˆå­˜å‚¨1bitï¼‰ã€å®¹é‡ã€é€Ÿåº¦ä¸‰è€…å¹³è¡¡</strong>ã€‚æ°å¥½è¿™ä¸‰è€…ä¹‹é—´åˆæ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œä¸»è¦ä½“ç°åœ¨ï¼šå®¹é‡è¶Šé«˜ï¼Œæˆæœ¬è¶Šä½ï¼Œè€Œé€Ÿåº¦è¶Šæ…¢ï¼›é€Ÿåº¦è¶Šå—ï¼Œæˆæœ¬å°±è¶Šé«˜ï¼ˆå…¶å®ƒæƒ…å†µå¯æ ¹æ® 2.2é‡‘å­—å¡”ç« èŠ‚ ç†è§£ï¼‰ï¼Œå› æ­¤å¹³è¡¡æˆäº†å…³é”®ã€‚å› æ­¤å­˜å‚¨ä½“ç³»ç»“æ„è®¾è®¡ç›®çš„å¯æ€»ç»“ä¸ºï¼šå°†å„ç§ä¸åŒçš„å™¨ä»¶ç»„åˆæˆä¸€ä¸ªä½“ç³»ï¼Œè®©å„ç§å™¨ä»¶æ‰¬é•¿é¿çŸ­ï¼Œä»è€Œå½¢æˆä¸€ç§å¿«é€Ÿã€å¤§å®¹é‡ã€ä½æˆæœ¬çš„å†…å­˜ç³»ç»Ÿ</p>
<p>é€šè¿‡ä¼˜åŒ–å­˜å‚¨ç³»ç»Ÿçš„ç»„ç»‡æ¥ä½¿å¾—é’ˆå¯¹å…¸å‹åº”ç”¨å¹³å‡è®¿å­˜æ—¶é—´æœ€çŸ­</p>
<h2 id="é‡‘å­—å¡”"><a href="#é‡‘å­—å¡”" class="headerlink" title="é‡‘å­—å¡”"></a>é‡‘å­—å¡”</h2><p><img src="/images/computerSystem/storage/storage-2.png" alt="image"></p>
<p>è¶Šé è¿‘é‡‘å­—å¡”é¡¶ï¼Œè·ç¦»å¤„ç†å™¨è¶Šè¿‘ï¼Œè®¿é—®é€Ÿåº¦å°±è¶Šå¿«ï¼Œé€ ä»·ä¹Ÿå°±è¶Šé«˜ï¼ŒåŒæ—¶å®¹é‡ä¹Ÿä¼šæ›´å°</p>
<table>
<thead>
<tr>
<th></th>
<th>å­˜å‚¨å™¨ç§ç±»</th>
<th>ç¡¬ä»¶ï¼ˆå­˜å‚¨1bitï¼‰</th>
<th>é€Ÿåº¦</th>
</tr>
</thead>
<tbody><tr>
<td>å¯„å­˜å™¨</td>
<td>è§¦å‘å™¨</td>
<td>åå‡ ä¸ªæ™¶ä½“ç®¡</td>
<td>300ps</td>
</tr>
<tr>
<td>ç¼“å­˜</td>
<td>sram</td>
<td>6ä¸ªæ™¶ä½“ç®¡</td>
<td>L1-1nsï¼›L2-10ns</td>
</tr>
<tr>
<td>å†…å­˜</td>
<td>dram</td>
<td>1ä¸ªmosç®¡+1ä¸ªç”µå®¹</td>
<td>100ns</td>
</tr>
<tr>
<td>ç¡¬ç›˜</td>
<td>flash/ç£æ€§å­˜å‚¨â€¦</td>
<td>/</td>
<td>SSD-25usï¼›HDD-5ms</td>
</tr>
</tbody></table>
<p>é€šè¿‡è¡¨æ ¼å¯ä»¥å‘ç°å†…å­˜çš„ç»„æˆæœ‰ç”µå®¹çš„å­˜åœ¨ï¼Œå› æ­¤ä¸å†æ˜¯å•çº¯çš„é€»è¾‘ç”µè·¯æ›´ä¸èƒ½ç”¨CMOSå·¥è‰ºåˆ¶é€ ï¼Œè€ŒSRAMå´å¯ä»¥ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç¼“å­˜å¯ä»¥é›†æˆåˆ°èŠ¯ç‰‡å†…éƒ¨ï¼Œè€Œå†…å­˜æ˜¯å’ŒèŠ¯ç‰‡åˆ†å¼€åˆ¶é€ çš„ã€‚</p>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Storage</category>
      </categories>
      <tags>
        <tag>storage system</tag>
      </tags>
  </entry>
  <entry>
    <title>è±†ç“£ç”µå½±Top250æ•°æ®çˆ¬å–ã€æ•°æ®åˆ†æåŠæ•°æ®å¯è§†åŒ–</title>
    <url>/2022/12/03/item/doubanTop250Spider/</url>
    <content><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>åœ¨çˆ¬è™«å­¦ä¹ ä¸­ï¼Œä¸€å¥—å®Œæ•´çš„é¡¹ç›®å®æˆ˜å¯¹äºä»£ç å’Œè®¡ç®—æœºæ€ç»´èƒ½åŠ›æœ‰å¾ˆå¤§çš„æå‡ã€‚æœ¬æ–‡åŸºäºBç«™è§†é¢‘<a href="https://www.bilibili.com/video/BV12E411A7ZQ?from=search&amp;seid=4741588992451392787">ã€ŠPythonçˆ¬è™«åŸºç¡€5å¤©é€Ÿæˆï¼ˆ2021å…¨æ–°åˆé›†ï¼‰Pythonå…¥é—¨+æ•°æ®å¯è§†åŒ–ã€‹</a>å…³äº â€œè±†ç“£ç”µå½±Top250â€ é¡¹ç›®åšå‡ºçš„æ€»ç»“ã€æ‹“å±•ä¸åˆ†äº«ã€‚<br>åœ¨æœ¬æ–‡ä¸­ï¼Œåªå±•ç¤ºæ•°æ®çˆ¬å–åˆ°æ•°æ®ä¿å­˜çš„å·¥ä½œï¼Œæ•°æ®å¯è§†åŒ–éƒ¨åˆ†åªåšéƒ¨åˆ†åˆ†æå’Œç»“æœå±•ç¤ºã€‚å…·ä½“å…³äºåº“çš„æ“ä½œæˆ‘é€‰æ‹©äº†ä¸€äº›å®˜æ–¹æ–‡æ¡£åšé“¾æ¥ï¼ŒçŸ¥è¯†ç‚¹æ¯”è¾ƒå…¨é¢è¯·å‚è€ƒä¸‹åˆ—è¡¨ã€‚å¦‚æœæƒ³è¦é¡¹ç›®æºä»£ç ï¼Œè¯·è¯„è®ºæˆ–ç§ä¿¡ã€‚</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3.7/library/urllib.html?highlight=urllib">URLå¤„ç†ç³»ç»Ÿæ¨¡å—ï¼šurllib</a></li>
<li><a href="https://requests.readthedocs.io/zh_CN/latest/">URLå¤„ç†ç¬¬ä¸‰æ–¹æ¨¡å—ï¼šrequests</a></li>
<li><a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/">æ•°æ®æå–bs4æ¨¡å—ï¼šBeautifulSoup</a></li>
<li><a href="https://docs.python.org/zh-cn/3.7/library/re.html">æ•°æ®æå–æ­£åˆ™è¡¨è¾¾å¼æ¨¡å—ï¼šre</a></li>
<li><a href="https://www.jianshu.com/p/9135d7833d6d">æ•°æ®æå–æ¨¡å— ï¼šlxml</a></li>
<li><a href="https://docs.python.org/zh-cn/3.7/library/sqlite3.html">æ•°æ®åº“ä¿å­˜æ¨¡å—ï¼šsqlite3</a></li>
<li><a href="https://www.cnblogs.com/python-robot/p/9958352.html">æœ¬åœ°æ–‡ä»¶ä¿å­˜æ¨¡å—ï¼šxlwt</a></li>
</ul>
<h1 id="æ•°æ®çˆ¬å–ä¸è§£æ"><a href="#æ•°æ®çˆ¬å–ä¸è§£æ" class="headerlink" title="æ•°æ®çˆ¬å–ä¸è§£æ"></a>æ•°æ®çˆ¬å–ä¸è§£æ</h1><h2 id="æ•°æ®çˆ¬å–"><a href="#æ•°æ®çˆ¬å–" class="headerlink" title="æ•°æ®çˆ¬å–"></a>æ•°æ®çˆ¬å–</h2><p>æ•°æ®çˆ¬å–å·¥ä½œæ˜¯æ•´ä¸ªå·¥ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µæ‰€è¦åšçš„å·¥ä½œæ˜¯å°†ç½‘é¡µä¸Šå¸¦æœ‰æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯çš„ç½‘é¡µæºç æŠ“å–ä¸‹æ¥ã€‚<strong>å»ºè®®åœ¨æ­¤æ­¥éª¤æ—¶ï¼Œå¦‚æœæ•°æ®é‡ä¸å¤§å…¨éƒ¨æŠ“å–ä¿å­˜åˆ°æœ¬åœ°ï¼›å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œåˆ™å…ˆä¿å­˜ä¸€ç»„åˆ°å¤šç»„æ•°æ®åˆ°æœ¬åœ°</strong>ã€‚åœ¨æ¥ä¸‹çš„æ•°æ®è§£ææ—¶é€šè¿‡æœ¬åœ°æ–‡ä»¶è§£æï¼Œè¿™æ ·åšä¼šé¿å…åé¢å¤šæ¬¡è®¿é—®ç½‘ç«™è€Œè¢«å°ipï¼Œå½“ç„¶é’ˆå¯¹è¢«å°ipæœ‰ç›¸åº”çš„è§£å†³åŠæ³•ï¼Œä½†æ˜¯è¿™äº›å†…å®¹æ¶‰åŠåˆ°ç½‘ç»œçŸ¥è¯†ï¼Œå»ºè®®åé¢å†å­¦ã€‚</p>
<h3 id="urllibæ–¹æ³•"><a href="#urllibæ–¹æ³•" class="headerlink" title="urllibæ–¹æ³•"></a>urllibæ–¹æ³•</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">base_url = <span class="string">"https://movie.douban.com/top250?start="</span></span><br><span class="line">header = {</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36"</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">#æ„å»ºè¯·æ±‚</span></span><br><span class="line">req = urllib.request.Request(url=base_url,headers=header)</span><br><span class="line"><span class="comment">#å¾—åˆ°å“åº”</span></span><br><span class="line">response = urllib.request.urlopen(req)</span><br><span class="line">html = response.read().decode(<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"top250_first_page.html"</span>,<span class="string">"w"</span>,encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(html)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="requestsæ–¹æ³•"><a href="#requestsæ–¹æ³•" class="headerlink" title="requestsæ–¹æ³•"></a>requestsæ–¹æ³•</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">base_url = <span class="string">"https://movie.douban.com/top250?start="</span></span><br><span class="line">header = {</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36"</span></span><br><span class="line">}</span><br><span class="line">response = requests.get(url=base_url,headers=header)</span><br><span class="line">data = response.content.decode()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"top250_first_page.html"</span>,<span class="string">"w"</span>,encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æ•°æ®è§£æ"><a href="#æ•°æ®è§£æ" class="headerlink" title="æ•°æ®è§£æ"></a>æ•°æ®è§£æ</h2><p>æ•°æ®è§£æä½œä¸ºç¬¬äºŒæ­¥æ˜¯æ•´ä¸ªå·¥ç¨‹çš„æ ¸å¿ƒï¼Œè¿™ä¸€æ­¥ç›´æ¥å†³å®šäº† æˆ‘ä»¬æ˜¯å¦èƒ½å¤Ÿåœ¨æµ·é‡çš„æ•°æ®ä¸­åªå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚çˆ¬è™«ä¸­ä¸‰ç§é‡è¦çš„æ•°æ®è§£æçš„æ–¹æ³•åˆ†åˆ«æ˜¯ï¼šBeautifulSoupã€reæ­£åˆ™è¡¨è¾¾å¼å’Œxpathï¼Œä¸‰ç§æ–¹æ³•æ²¡æœ‰ä¼˜åŠ£å¥½åï¼ŒæŒ‰ç…§æˆ‘å‰é¢ç»™å‡ºçš„æ–‡æ¡£ï¼Œè‡ªå·±ç”¨å¥½ä¸€ç§å³å¯æ»¡è¶³éœ€æ±‚ï¼Œå½“ç„¶ä¸‰ç§æ–¹æ³•æ ¹æ®åœºæ™¯ä½¿ç”¨æ˜¯æœ€é«˜æ•ˆçš„ï¼Œå¦‚æœä½ æ˜¯å¤§ä½¬çš„è¯ğŸ‘ã€‚<br>æˆ‘è‡ªå·±å¸¸ç”¨çš„æ˜¯xpathæ–¹æ³•ã€‚ç¬¬ä¸€ï¼Œxpathè·¯å¾„å¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸Šè¿›è¡Œå¤åˆ¶ï¼›ç¬¬äºŒï¼Œå¯ä»¥é€šè¿‡<a href="https://blog.csdn.net/heartbeat196/article/details/113790232">XPath Helperå·¥å…·</a>è¿›è¡Œæ›´å¥½çš„æµ‹è¯•ï¼Œæˆ‘åœ¨ä¹‹å‰çš„åšå®¢æœ‰æåˆ°å¯ä»¥<a href="https://blog.csdn.net/heartbeat196/article/details/113790232">ç‚¹å‡»</a>æŸ¥çœ‹ã€‚ä¸‹é¢æˆ‘ç”¨ä¸‰ç§ä¸åŒçš„æ–¹æ³•å¯¹ä¿å­˜åˆ°æœ¬åœ°çš„ä¸€é¡µä¸Šçš„æ•°æ®è¿›è¡Œäº†è§£æã€‚</p>
<h3 id="BeaufifulSoup"><a href="#BeaufifulSoup" class="headerlink" title="BeaufifulSoup"></a>BeaufifulSoup</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#å°†è¦è§£æçš„ç½‘ç«™æ‰“å¼€</span></span><br><span class="line">html = <span class="built_in">open</span>(<span class="string">"top250_first_page.html"</span>,<span class="string">"rb"</span>)</span><br><span class="line"><span class="comment">#æ„å»ºBeautifulSoupå¯¹è±¡</span></span><br><span class="line">soup = BeautifulSoup(html,<span class="string">"html.parser"</span>)</span><br><span class="line"><span class="comment">#å¾—åˆ°æ¯ä¸€å—çš„å†…å®¹</span></span><br><span class="line">blocks = soup.select(<span class="string">".grid_view .item"</span>)</span><br><span class="line"><span class="comment">#æ„å»ºç”µå½±åˆ—è¡¨</span></span><br><span class="line">movie_list = []</span><br><span class="line"><span class="comment">#ç”µå½±é“¾æ¥å’Œç”µå½±å›¾ç‰‡é“¾æ¥</span></span><br><span class="line"><span class="keyword">for</span> index,block <span class="keyword">in</span> <span class="built_in">enumerate</span>(blocks):</span><br><span class="line">    movie_dict = {}</span><br><span class="line">    movie_dict[<span class="string">"movie_href"</span>] = block.select(<span class="string">"a"</span>)[<span class="number">0</span>].get(<span class="string">"href"</span>)       <span class="comment">#ç”µå½±è¯¦æƒ…é¡µé“¾æ¥</span></span><br><span class="line">    movie_dict[<span class="string">"pic_href"</span>] = block.select(<span class="string">"img"</span>)[<span class="number">0</span>].get(<span class="string">"src"</span>)        <span class="comment">#ç”µå½±é“¾æ¥</span></span><br><span class="line">    title = block.select(<span class="string">".title"</span>)                      <span class="comment">#ç”µå½±åå­—</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(title)==<span class="number">2</span>:</span><br><span class="line">        movie_dict[<span class="string">"c_title"</span>] = block.select(<span class="string">".title"</span>)[<span class="number">0</span>].text            <span class="comment">#ç”µå½±ä¸­æ–‡åå­—</span></span><br><span class="line">        o_title = block.select(<span class="string">".title"</span>)[<span class="number">1</span>].text            <span class="comment"># ç”µå½±ä¸­æ–‡åå­—</span></span><br><span class="line">        movie_dict[<span class="string">"o_title"</span>] = o_title.replace(<span class="string">"/"</span>,<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        movie_dict[<span class="string">"c_title"</span>] = block.select(<span class="string">".title"</span>)[<span class="number">0</span>].text            <span class="comment">#ç”µå½±ä¸­æ–‡åå­—</span></span><br><span class="line">        movie_dict[<span class="string">"o_title"</span>] = <span class="string">" "</span>                                       <span class="comment">#ç”µå½±å¤–æ–‡åå­—</span></span><br><span class="line">    movie_dict[<span class="string">"rate"</span>] = block.select(<span class="string">".star .rating_num"</span>)[<span class="number">0</span>].text        <span class="comment">#ç”µå½±è¯„åˆ†</span></span><br><span class="line">    movie_dict[<span class="string">"judge"</span>] = block.select(<span class="string">".star span"</span>)[<span class="number">3</span>].text[:-<span class="number">3</span>]         <span class="comment">#è¯„åˆ†äººæ•°</span></span><br><span class="line">    bd = block.select(<span class="string">".bd p"</span>)[<span class="number">0</span>].text</span><br><span class="line">    movie_dict[<span class="string">"bd"</span>] = re.sub(<span class="string">" "</span>,<span class="string">""</span>,bd)</span><br><span class="line">    movie_dict[<span class="string">"inq"</span>] = block.select(<span class="string">".quote .inq"</span>)[<span class="number">0</span>].text.replace(<span class="string">"ã€‚"</span>,<span class="string">""</span>)</span><br><span class="line">    movie_list.append(movie_dict)</span><br><span class="line"><span class="comment">#æ‰“å°æµ‹è¯•</span></span><br><span class="line"><span class="built_in">print</span>(movie_list)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#å°†è¦è§£æçš„ç½‘ç«™æ‰“å¼€</span></span><br><span class="line">html = <span class="built_in">open</span>(<span class="string">"top250_first_page.html"</span>,<span class="string">"rb"</span>)</span><br><span class="line">content = html.read().decode(<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="comment">#æ„å»ºetreeå¯¹è±¡</span></span><br><span class="line">data = etree.HTML(content)</span><br><span class="line"><span class="comment">#è·å–å¤šä¸ªç”µå½±ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line">divs = data.xpath(<span class="string">'//div[@class="item"]'</span>)</span><br><span class="line"><span class="keyword">for</span> div <span class="keyword">in</span> divs:</span><br><span class="line">    movie_dict = { }</span><br><span class="line">    movie_dict[<span class="string">"movie_href"</span>] = div.xpath(<span class="string">'div[@class="pic"]/a/@href'</span>)</span><br><span class="line">    <span class="comment">#print(movie_href)          #æµ‹è¯•</span></span><br><span class="line">    movie_dict[<span class="string">"pic_href"</span>] = div.xpath(<span class="string">'div[@class="pic"]//img/@src'</span>)</span><br><span class="line">    <span class="comment">#print(pic_href)           #æµ‹è¯•</span></span><br><span class="line">    title = div.xpath(<span class="string">'div[@class="info"]//a/span[@class="title"]/text()'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(title)==<span class="number">2</span>:</span><br><span class="line">        movie_dict[<span class="string">"c_title"</span>] = title[<span class="number">0</span>]</span><br><span class="line">        o_title = title[<span class="number">1</span>].replace(<span class="string">"/"</span>,<span class="string">""</span>)</span><br><span class="line">        movie_dict[<span class="string">"o_title"</span>] = <span class="string">""</span>.join(o_title.split())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        movie_dict[<span class="string">"c_title"</span>] = title[<span class="number">0</span>]</span><br><span class="line">        movie_dict[<span class="string">"o_title"</span>] = <span class="string">" "</span></span><br><span class="line">    <span class="comment">#print(c_title,o_title)      #æµ‹è¯•</span></span><br><span class="line">    movie_dict[<span class="string">"rate"</span>] = div.xpath(<span class="string">'div//div[2]/div/span[2]/text()'</span>)</span><br><span class="line">    <span class="comment">#print(rate)                #æµ‹è¯•</span></span><br><span class="line">    judge = div.xpath(<span class="string">'div//div[2]/div/span[4]/text()'</span>)</span><br><span class="line">    movie_dict[<span class="string">"judge"</span>] = (<span class="built_in">str</span>(judge))[<span class="number">2</span>:-<span class="number">5</span>]</span><br><span class="line">    <span class="comment">#print(judge)                #æµ‹è¯•</span></span><br><span class="line">    bd = <span class="built_in">str</span>(div.xpath(<span class="string">'div//div[@class="bd"]/p[1]/text()'</span>))</span><br><span class="line">    movie_dict[<span class="string">"bd"</span>] = bd.replace(<span class="string">" "</span>,<span class="string">""</span>).replace(<span class="string">r"\xa0"</span>,<span class="string">""</span>).replace(<span class="string">r"\r"</span>,<span class="string">""</span>).replace(<span class="string">r"\n"</span>,<span class="string">""</span>)</span><br><span class="line">    <span class="comment">#print(bd)                   #æµ‹è¯•</span></span><br><span class="line">    <span class="built_in">print</span>(movie_dict)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="reæ­£åˆ™è¡¨è¾¾å¼"><a href="#reæ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="reæ­£åˆ™è¡¨è¾¾å¼"></a>reæ­£åˆ™è¡¨è¾¾å¼</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="comment">#å½±ç‰‡è¯¦æƒ…é“¾æ¥è§„åˆ™</span></span><br><span class="line">findLink = re.<span class="built_in">compile</span>(<span class="string">r'&lt;a href="(.*?)"&gt;'</span>)        <span class="comment">#åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œè¡¨ç¤ºè§„åˆ™ï¼ˆå­—ç¬¦ä¸²çš„æ¨¡å¼ï¼‰</span></span><br><span class="line"><span class="comment">#å½±ç‰‡å›¾ç‰‡è§„åˆ™</span></span><br><span class="line">findSrclink = re.<span class="built_in">compile</span>(<span class="string">r'&lt;img.*src="(.*?)"'</span>,re.S)</span><br><span class="line"><span class="comment">#å½±ç‰‡ç‰‡åè§„åˆ™</span></span><br><span class="line">findTitle = re.<span class="built_in">compile</span>(<span class="string">r'&lt;span class="title"&gt;(.*)&lt;/span&gt;'</span>)</span><br><span class="line"><span class="comment">#å½±ç‰‡çš„è¯„åˆ†è§„åˆ™</span></span><br><span class="line">findGrade = re.<span class="built_in">compile</span>(<span class="string">r'&lt;span class="rating_num" property="v:average"&gt;(.*)&lt;/span&gt;'</span>)</span><br><span class="line"><span class="comment">#è¯„ä»·äººæ•°è§„åˆ™</span></span><br><span class="line">findJud = re.<span class="built_in">compile</span>(<span class="string">r'&lt;span&gt;(.*)äººè¯„ä»·&lt;/span&gt;'</span>)</span><br><span class="line"><span class="comment">#æ‰¾åˆ°æ¦‚å†µ</span></span><br><span class="line">findInq = re.<span class="built_in">compile</span>(<span class="string">r'&lt;span class="inq"&gt;(.*)&lt;/span&gt;'</span>)</span><br><span class="line"><span class="comment">#å½±ç‰‡ç›¸å…³å†…å®¹</span></span><br><span class="line">findBd = re.<span class="built_in">compile</span>(<span class="string">r'&lt;p class=""&gt;(.*?)&lt;/p&gt;'</span>,re.S)</span><br><span class="line"><span class="comment">#å°†è¦è§£æçš„ç½‘ç«™æ‰“å¼€</span></span><br><span class="line">html = <span class="built_in">open</span>(<span class="string">"top250_first_page.html"</span>,<span class="string">"rb"</span>)</span><br><span class="line">content = html.read().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">datalist = []</span><br><span class="line">soup = BeautifulSoup(content, <span class="string">"html.parser"</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> soup.find_all(<span class="string">"div"</span>,class_ = <span class="string">"item"</span>):</span><br><span class="line">    item = <span class="built_in">str</span>(item)</span><br><span class="line">    <span class="comment">#print(html)                                             #æµ‹è¯•ç”µå½±ä¿¡æ¯çš„ä¸€å°æ®µæœ‰æ²¡æœ‰å†…è§£ææ‹¿åˆ°</span></span><br><span class="line">    data = [ ]</span><br><span class="line">    title = re.findall(findTitle,item)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(title)==<span class="number">2</span>):</span><br><span class="line">        Ctitle = title[<span class="number">0</span>]</span><br><span class="line">        data.append(Ctitle)</span><br><span class="line">        Ftitle = title[<span class="number">1</span>]</span><br><span class="line">        Ftitle = title[<span class="number">1</span>].replace(<span class="string">"/"</span>, <span class="string">""</span>)</span><br><span class="line">        Ftitle = <span class="string">""</span>.join(Ftitle.split())</span><br><span class="line">        data.append(Ftitle)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        Ctitle = title[<span class="number">0</span>]</span><br><span class="line">        data.append(Ctitle)</span><br><span class="line">        Ftitle = <span class="string">" "</span></span><br><span class="line">        data.append(Ftitle)</span><br><span class="line">    link = re.findall(findLink,item)[<span class="number">0</span>]</span><br><span class="line">    data.append(link)</span><br><span class="line">    srclink = re.findall(findSrclink,item)[<span class="number">0</span>]</span><br><span class="line">    data.append(srclink)</span><br><span class="line">    grade = re.findall(findGrade,item)[<span class="number">0</span>]</span><br><span class="line">    data.append(grade)</span><br><span class="line">    judge = re.findall(findJud,item)[<span class="number">0</span>]</span><br><span class="line">    data.append(judge)</span><br><span class="line">    inq = re.findall(findInq,item)[<span class="number">0</span>]</span><br><span class="line">    data.append(inq)</span><br><span class="line">    bd = re.findall(findBd,item)[<span class="number">0</span>]</span><br><span class="line">    bd = re.sub(<span class="string">'&lt;br(\s+)?/&gt;(\s+)?'</span>,<span class="string">" "</span>,bd)</span><br><span class="line">    bd = re.sub(<span class="string">"/"</span>,<span class="string">" "</span>,bd)</span><br><span class="line">    bd = <span class="string">""</span>.join(bd.split())</span><br><span class="line">    data.append(bd)</span><br><span class="line">    datalist.append(data)</span><br><span class="line"><span class="built_in">print</span>(datalist)            <span class="comment">#æµ‹è¯•æ‰€æœ‰åˆ—è¡¨æ˜¯å¦è¢«æ‰“å°</span></span><br></pre></td></tr></tbody></table></figure>
<h1 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h1><h2 id="æœ¬åœ°excelä¿å­˜"><a href="#æœ¬åœ°excelä¿å­˜" class="headerlink" title="æœ¬åœ°excelä¿å­˜"></a>æœ¬åœ°excelä¿å­˜</h2><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line">workbook = xlwt.Workbook(encoding=<span class="string">"utf-8"</span>, style_compression=<span class="number">0</span>)</span><br><span class="line">worksheet = workbook.add_sheet(<span class="string">"è±†ç“£ç”µå½±250"</span>)</span><br><span class="line">col = [<span class="string">"ä¸­æ–‡å"</span>, <span class="string">"å¤–æ–‡å"</span>, <span class="string">"ç”µå½±é“¾æ¥"</span>, <span class="string">"å›¾ç‰‡é“¾æ¥"</span>, <span class="string">"è¯„åˆ†"</span>, <span class="string">"è¯„ä»·äººæ•°"</span>, <span class="string">"æ¦‚è¯„"</span>, <span class="string">"æ¦‚è¿°"</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>):</span><br><span class="line">    worksheet.write(<span class="number">0</span>, i, col[i])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(datalist)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>):</span><br><span class="line">        worksheet.write(i + <span class="number">1</span>, j, datalist[i][j])</span><br><span class="line">workbook.save(<span class="string">"è±†ç“£top250_firstPage.xls"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="sqliteæ•°æ®åº“ä¿å­˜"><a href="#sqliteæ•°æ®åº“ä¿å­˜" class="headerlink" title="sqliteæ•°æ®åº“ä¿å­˜"></a>sqliteæ•°æ®åº“ä¿å­˜</h2><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_db</span>(<span class="params">dbpath</span>):</span><br><span class="line">    sql = <span class="string">'''</span></span><br><span class="line"><span class="string">        create table movie250 </span></span><br><span class="line"><span class="string">        (</span></span><br><span class="line"><span class="string">        id integer primary key autoincrement,</span></span><br><span class="line"><span class="string">        info_link text,</span></span><br><span class="line"><span class="string">        pic_link text,</span></span><br><span class="line"><span class="string">        cname varchar,</span></span><br><span class="line"><span class="string">        ename varchar,</span></span><br><span class="line"><span class="string">        score numeric ,</span></span><br><span class="line"><span class="string">        rated numeric ,</span></span><br><span class="line"><span class="string">        instroduction text,</span></span><br><span class="line"><span class="string">        info text</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    '''</span>  <span class="comment"># åˆ›å»ºæ•°æ®è¡¨</span></span><br><span class="line">    conn = sqlite3.connect(dbpath)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    conn.commit()</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">saveData2DB</span>(<span class="params">datalist, dbpath</span>):</span><br><span class="line">    <span class="comment">#init_db(dbpath)</span></span><br><span class="line">    conn = sqlite3.connect(dbpath)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> datalist:</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">        	data[index] = <span class="string">'"'</span> + data[index] + <span class="string">'"'</span></span><br><span class="line">        sql = <span class="string">'''</span></span><br><span class="line"><span class="string">                insert into movie250 (</span></span><br><span class="line"><span class="string">                info_link,pic_link,cname,ename,score,rated,instroduction,info) </span></span><br><span class="line"><span class="string">                values(%s)'''</span> % <span class="string">","</span>.join(data)</span><br><span class="line">        cur.execute(sql)</span><br><span class="line">        conn.commit()</span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line">saveData2DB(datalist,<span class="string">"movie.db"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ç»“æœå±•ç¤º"><a href="#ç»“æœå±•ç¤º" class="headerlink" title="ç»“æœå±•ç¤º"></a>ç»“æœå±•ç¤º</h3><p><img src="/images/item/douban-1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="/images/item/douban-2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="æ•°æ®å¯è§†åŒ–"><a href="#æ•°æ®å¯è§†åŒ–" class="headerlink" title="æ•°æ®å¯è§†åŒ–"></a>æ•°æ®å¯è§†åŒ–</h1><h2 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a><a href="https://dormousehole.readthedocs.io/en/latest/">Flask</a></h2><p>Flask æ˜¯ä¸€ä¸ªå¾®å‹çš„ Python å¼€å‘çš„ Web æ¡†æ¶ï¼ŒåŸºäºWerkzeug WSGIå·¥å…·ç®±å’ŒJinja2 æ¨¡æ¿å¼•æ“ã€‚ Flaskä½¿ç”¨BSDæˆæƒã€‚ Flaskä¹Ÿè¢«ç§°ä¸ºâ€œmicroframeworkâ€ï¼Œå› ä¸ºå®ƒä½¿ç”¨ç®€å•çš„æ ¸å¿ƒï¼Œç”¨extensionå¢åŠ å…¶ä»–åŠŸèƒ½ã€‚Flaskæ²¡æœ‰é»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“ã€çª—ä½“éªŒè¯å·¥å…·ã€‚<br>ç®€å•æ¥è¯´åœ¨æ­¤é¡¹ç›®ä¸­ï¼ŒFlaskæ¡†æ¶ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæœ¬åœ°ç½‘é¡µå¹³å°å±•ç¤ºæ•°æ®ã€‚æˆ‘ä»¬æ ¹æ®ä¸åŒçš„è·¯ç”±åœ°å€è¿›è¡Œåˆ°ä¸åŒçš„é¡µé¢è®¿é—®ã€‚å¦‚ä¸‹å›¾æ˜¯é¦–ç•Œé¢ï¼Œé€šè¿‡ä¸åŒçš„é“¾æ¥åœ°å€å¯ä»¥å®ç°é¡µé¢è·³è½¬ï¼Œå½“ç„¶åªæ˜¯æœ¬åœ°ï¼<br><img src="/images/item/douban-3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="Echarts"><a href="#Echarts" class="headerlink" title="Echarts"></a><a href="https://echarts.apache.org/en/index.html">Echarts</a></h2><p>Echartsæ˜¯ä¸€ä¸ªçº¯åŸºäºjsçš„å›¾è¡¨åº“ï¼Œå¯ä»¥æµç•…çš„è¿è¡Œåœ¨ PC å’Œç§»åŠ¨è®¾å¤‡ä¸Šã€‚åœ¨æœ¬é¡¹ç›®ä¸­å¯ä»¥å°†æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†ç±»ä»è€Œç”¨ä¸åŒçš„å±•ç¤ºæ–¹æ³•è¿›è¡Œå±•ç°ã€‚åœ¨Echartsä¸­å¯ä»¥æ”¯æŒçš„å›¾è¡¨ç±»å‹æœ‰å¾ˆå¤šï¼ŒåŒæ—¶å…¶æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç‚¹åœ¨äºå®ƒèƒ½æ»¡è¶³æˆ‘ä»¬å®æ—¶ä¿®æ”¹æŸ¥çœ‹ï¼Œæœ€ç»ˆå½¢æˆè‡ªå·±æƒ³è¦çš„å›¾ï¼Œä¾¿å°†jsä»£ç å¤åˆ¶ç²˜è´´åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„ç½‘é¡µä»£ç çš„åœ°æ–¹ã€‚<br>ç”±äºåœ¨é¡µé¢å†…æœ‰åŠ¨æ€æ˜¾ç¤ºï¼Œæ‰€ä»¥ä¸åœ¨è¿›è¡Œå±•ç¤ºã€‚</p>
<h2 id="WordCloud"><a href="#WordCloud" class="headerlink" title="WordCloud"></a>WordCloud</h2><p>è¯äº‘å±•ç¤ºæ–¹æ³•æ˜¯è¿‘äº›å¹´æ¥è¾ƒä¸ºå¸¸ç”¨çš„æ•°æ®å¯è§†åŒ–æ–¹æ³•ã€‚å…¶ä¸»è¦æ˜¯é€šè¿‡åˆ†è¯æŠ€æœ¯å°†ä¸€ç¯‡æ–‡ç« æˆ–è€…ä¸€æ®µè¯åˆ†æˆè‹¥å¹²å•è¯ï¼Œç„¶åç»Ÿè®¡è¿™äº›è¯å‡ºç°çš„é¢‘ç‡ï¼Œæˆ‘ä»¬æ ¹æ®è‡ªå®šä¹‰åŒ–è®¾ç½®ç”»å¸ƒå’Œè¿™äº›è¯å‡ºç°çš„é¢œè‰²å¤§å°ç­‰ç­‰æ¥å¾—åˆ°æŸä¸ªè¯äº‘ã€‚è¯äº‘ä¸­é‡è¦çš„æ˜¯ç”»å¸ƒçš„é…ç½®ã€è‡ªå·±æ‰€è¦å®šä¹‰çš„å½¢å¼æ˜¯ä»€ä¹ˆæ ·å­ï¼Œå…¶ä»–æ›´å¤šçš„æ˜¯æŸäº›å›ºå®šçš„æ–¹æ³•ã€‚ä¸‹å›¾ä¸ºæˆ‘é€šè¿‡çˆ¬å–æ¯›ä¸æ˜“çš„æ­Œè¯å†…å®¹è·å¾—æ¯›ä¸æ˜“çš„æ­Œè¯è¯äº‘å›¾ï¼Œå¦‚æœéœ€è¦æ­¤é¡¹ç›®æºç æˆ–è€…æ–¹æ³•è¯·ç§ä¿¡ã€‚<br><img src="/images/item/douban-4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="æ–°æ‰‹é—®é¢˜æ€»ç»“ä¸è§£å†³æ–¹æ³•"><a href="#æ–°æ‰‹é—®é¢˜æ€»ç»“ä¸è§£å†³æ–¹æ³•" class="headerlink" title="æ–°æ‰‹é—®é¢˜æ€»ç»“ä¸è§£å†³æ–¹æ³•"></a>æ–°æ‰‹é—®é¢˜æ€»ç»“ä¸è§£å†³æ–¹æ³•</h1><h2 id="ipè¢«å°"><a href="#ipè¢«å°" class="headerlink" title="ipè¢«å°"></a>ipè¢«å°</h2><p>ipè¢«å°å¯èƒ½æ˜¯æ–°æ‰‹åœ¨çˆ¬è™«å­¦ä¹ é˜¶æ®µé‡åˆ°çš„æœ€å¤§çš„é—®é¢˜ã€‚é¦–å…ˆå¦‚æœæ˜¯åˆå­¦æƒ³è¦å°½å¿«å®ç°ä¸€äº›æˆæœæ—¶ï¼Œå»ºè®®åœ¨åˆç†èŒƒå›´å†…å‡å°‘çˆ¬å–æ¬¡æ•°ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è·å¾—ç½‘é¡µå†…å®¹äº†é¦–å…ˆå°†å…¶å­˜åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ä¸‹è¿›è¡Œåç»­çš„æµ‹è¯•å’Œè§£æã€‚ä¿—è¯è¯´ï¼šä¸Šæœ‰æ”¿ç­–ä¸‹æœ‰å¯¹ç­–ï¼Œé¢å¯¹ipè¢«å°ï¼šåŸºç¡€é˜¶æ®µæˆ‘ä»¬å¯ä»¥æ·»åŠ è¯·æ±‚å¤´ï¼Œå°½å¯èƒ½çš„è¿›è¡Œä¼ªè£…åƒä¸€ä¸ªæµè§ˆå™¨åœ¨è®¿é—®ï¼›å†è¿›ä¸€æ­¥æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„å»ºä»£ç†ipå‡½æ•°ï¼Œä»¿ç…§æºç æ·»åŠ å…è´¹ipï¼Œæ„å»ºhandlerå¤„ç†å™¨ä½¿ç”¨openeræ–¹æ³•ä¹Ÿå¯ä»¥ï¼›å¦‚æœæœ‰èƒ½åŠ›çš„è¯ï¼Œå¯ä»¥å­¦ä¹ ä»£ç†ipæ± çš„æ–¹æ³•æ¥è§£å†³è¯¥é—®é¢˜ã€‚<br>å½“ç„¶ï¼Œçˆ¬è™«æˆ‘ä»¬æ˜¯è¦åœ¨åˆæ³•èŒƒå›´å†…è¿›è¡ŒæŠ“å–ï¼Œå¦‚æœæŸäº›æ•°æ®æ˜¯æœºå¯†æˆ–è€…ä¸èƒ½è®¿é—®çš„ï¼Œæˆ‘ä»¬è¿˜ä¸€ç›´è®¿é—®å¯èƒ½å°±å¾ˆå¿«æœ‰è‡ªå·±çš„å°æ‰‹é•¯å­äº†ğŸ”“ã€‚æˆ‘ä»¬åªçˆ¬å–æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°çš„ï¼Œçˆ¬è™«åªæ˜¯æé«˜æ•ˆç‡ï¼Œä¸æ˜¯ç¿»è¿‡ç¦å¢™ã€‚</p>
<h2 id="æŸ¥çœ‹ç½‘é¡µæºç å’Œâ€F12-Elementsâ€åä¸ä¸€è‡´"><a href="#æŸ¥çœ‹ç½‘é¡µæºç å’Œâ€F12-Elementsâ€åä¸ä¸€è‡´" class="headerlink" title="æŸ¥çœ‹ç½‘é¡µæºç å’Œâ€F12 Elementsâ€åä¸ä¸€è‡´"></a>æŸ¥çœ‹ç½‘é¡µæºç å’Œâ€F12 Elementsâ€åä¸ä¸€è‡´</h2><p>è¯¥é—®é¢˜å¯ä»¥æ€»ç»“ä¸ºç”¨ä¸€èˆ¬æ–¹æ³•æœ‰äº›éœ€è¦çš„å…ƒç´ æŠ“å–ä¸åˆ°ã€‚åœ¨æœ¬æ¬¡é¡¹ç›®ä¸­æˆ‘ä»¬çˆ¬å–çš„é¡µé¢æ˜¯é™æ€ç½‘é¡µæ‰€ä»¥å¯ä»¥ç›´æ¥æŠ“å–ï¼Œä½†æ˜¯å¯¹äºåŠ¨æ€ç½‘é¡µå°±ä¼šæ— èƒ½ä¸ºåŠ›ã€‚<br>æŸ¥çœ‹ç½‘é¡µæºç ï¼šæœ€åŸå§‹çš„ä»£ç ï¼ŒæŒ‡çš„æ˜¯æœåŠ¡å™¨ç›´æ¥å‘é€åˆ°æµè§ˆå™¨çš„ä»£ç ã€‚<br>F12æ£€æŸ¥å…ƒç´ ï¼šjsæ¸²æŸ“åçš„ä»£ç ã€‚è€Œç¡®å®çš„éƒ¨åˆ†å°±æ˜¯jsæ‰€æ¸²æŸ“çš„ã€‚<br>å¦‚æœæˆ‘ä»¬æƒ³è¦æŠ“å–è¿™éƒ¨åˆ†ä»£ç å¯ä»¥é‡‡å–ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>åœ¨é¡µé¢ä¸Šè¿›è¡ŒæŠ“åŒ…ï¼Œè·å–è¡¨å•çš„å…ƒç´ å’Œjsé“¾æ¥æäº¤è¯·æ±‚</li>
<li>é€šè¿‡seleniumæŠ€æœ¯ï¼Œæ¨¡æ‹Ÿç”¨æˆ·æ‰“å¼€ç½‘é¡µï¼Œè¿›è¡Œè‡ªåŠ¨åŒ–çš„æŠ“å–ã€‚</li>
</ol>
<h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜æ˜¯æˆ‘åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æ‰€é‡åˆ°çš„ï¼Œå½“ç„¶åœ¨é¢å¯¹æ›´å¤æ‚çš„çˆ¬è™«å·¥ä½œæ—¶ï¼Œä¼šæœ‰æ›´åŠ ç¹ççš„é—®é¢˜å‡ºç°ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–é—®é¢˜ï¼Œæˆ‘å°†å…¶æ€»ç»“ä¸ºåŸºç¡€çŸ¥è¯†é—®é¢˜ã€‚åœ¨å¾ˆå¤šåˆå­¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬è·å¾—çš„æ•°æ®å¾€å¾€ä»¥ä¸åŒçš„æ ¼å¼è¿›è¡Œå­˜å‚¨ï¼Œä½†æ˜¯æŸäº›æ–¹æ³•åªèƒ½é’ˆå¯¹æŸäº›å›ºå®šæ•°æ®æ ¼å¼ï¼Œè¿™äº›éœ€è¦æˆ‘ä»¬æèµ·æ³¨æ„ï¼›è¿˜æœ‰å°±æ˜¯æˆ‘ä»¬ä¸å¯é¿å…çš„é©¬è™é—®é¢˜ï¼Œå…³é”®è¯æ‹¼å†™é”™è¯¯ï¼Œå˜é‡ä¹¦å†™é”™è¯¯ç­‰ç­‰ï¼Œè¿™äº›æœ€å¥½çš„è§£å†³åŠæ³•å°±æ˜¯å­°èƒ½ç”Ÿå·§ã€‚<br>æœ€åå°±æ˜¯å»ºè®®å¤§å®¶åœ¨å®Œæˆä¸€ä¸ªé¡¹ç›®æ—¶é€‰æ‹©åˆ†å—æŒ‰ç…§ä¸åŒçš„æ¨¡å—å»ç»ƒä¹ æµ‹è¯•ï¼Œæœ€ç»ˆå®Œæˆé¡¹ç›®ã€‚</p>
]]></content>
      <categories>
        <category>Item</category>
      </categories>
  </entry>
  <entry>
    <title>æ™ºèƒ½å®¶å±…æ¨¡å‹è®¾è®¡</title>
    <url>/2022/12/03/item/smartHome/</url>
    <content><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>ä¼´éšç€é€šä¿¡æŠ€æœ¯çš„ä¸æ–­å‘å±•å’Œç¤¾ä¼šç¯å¢ƒçš„è¿›æ­¥ï¼Œäººä»¬å¯¹æ›´æ™ºèƒ½åŒ–çš„ç”Ÿæ´»æœ‰äº†æ›´é«˜çš„è¿½æ±‚ã€‚ç‰©è”ç½‘æ™ºèƒ½å®¶å±…å·²ç»ä¸èƒ½ç®—æ˜¯æ–°é²œçš„åè¯äº†ï¼Œå…¶å•å“åŠäº’è”åº”ç”¨ä¹Ÿéƒ½å·²ç»éå¸¸å¹¿æ³›äº†ã€‚æœ¬è®¾è®¡åŸºäºSTM32å•ç‰‡æœºï¼Œé€šè¿‡ESP8266æ— çº¿é€šä¿¡æ¨¡å—ä»¥åŠè¿æ¥ç›¸åº”çš„ä¼ æ„Ÿå™¨åŠå¤–è®¾å¯¹æ™ºèƒ½å®¶å±…çš„åœºæ™¯è¿›è¡Œæ¨¡æ‹Ÿã€‚æœ¬æ–‡æœ€åˆå†™äºä»Šå¹´6æœˆï¼Œç°åœ¨ä»äº‹åµŒå…¥å¼å·¥ä½œä¸€æ®µæ—¶é—´åç°åœ¨å†æ¬¡å°†æˆ‘çš„æ¯•ä¸šè®¾è®¡é‡æ–°è¿›è¡Œæ•´ç†å’Œæ€è€ƒï¼Œå¸Œæœ›èƒ½å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©ï¼</p>
<h1 id="è®¾è®¡æ€è·¯"><a href="#è®¾è®¡æ€è·¯" class="headerlink" title="è®¾è®¡æ€è·¯"></a>è®¾è®¡æ€è·¯</h1><p>å¯¹äºä»»ä½•ä¸€ä¸ªé¡¹ç›®æˆ–è€…å·¥ç¨‹çš„å¼€å§‹ç¬¬ä¸€æ­¥æ°¸è¿œæ˜¯å…ˆæ˜ç¡®éœ€æ±‚ï¼ŒçŸ¥é“è‡ªå·±åšæˆä»€ä¹ˆæ ·å­çš„ä¸œè¥¿ã€‚åœ¨æˆ‘å‚è€ƒäº†ä¸€äº›èµ„æ–™å¹¶é˜…è¯»äº†å‡ ç¯‡æ–‡çŒ®åï¼Œå¯¹å…¶æœ‰äº†åˆè®¤è¯†ã€‚æˆ‘ç†è§£çš„æ™ºèƒ½å®¶å±…å°±æ˜¯ä»æ„ŸçŸ¥å±‚å‡ºå‘å¯¹ç¯å¢ƒè¿›è¡Œç›‘æµ‹ï¼Œé€šè¿‡ä¼ è¾“å±‚éµä»ä¸€å®šçš„ç½‘ç»œåè®®å¯¹æ•°æ®è¿›è¡Œä¼ è¾“åŒæ—¶é€šè¿‡è½¯ä»¶å¯¹æ•°æ®è¿›è¡Œæ•´ç†åˆ†æï¼Œå¹¶åœ¨åº”ç”¨å±‚ï¼ˆå®¶å…·çŠ¶æ€ï¼‰åšå‡ºç›¸åº”çš„åŠ¨ä½œã€‚æœ€ç»ˆæˆ‘å°†è¯¥æµç¨‹æ•´ç†æˆä¸‹å›¾æ‰€ç¤ºçš„å®ç‰©æ¨¡æ‹Ÿï¼Œè¿›è€Œå¯¹å…¶è¿›è¡Œæ¨¡å—çš„æŠ½è±¡ã€‚åŸºäºæ­¤ï¼Œè¿›è¡Œä¸‹é¢çš„ç¡¬ä»¶è®¾è®¡é€‰å‹åŠè½¯ä»¶å®ç°ç­‰ç­‰ã€‚<br><img src="/images/item/smarthome-1.png"></p>
<h1 id="ç¡¬ä»¶è®¾è®¡"><a href="#ç¡¬ä»¶è®¾è®¡" class="headerlink" title="ç¡¬ä»¶è®¾è®¡"></a>ç¡¬ä»¶è®¾è®¡</h1><h2 id="ç¡¬ä»¶é€‰å‹åŸåˆ™"><a href="#ç¡¬ä»¶é€‰å‹åŸåˆ™" class="headerlink" title="ç¡¬ä»¶é€‰å‹åŸåˆ™"></a>ç¡¬ä»¶é€‰å‹åŸåˆ™</h2><p>ç”±äºè¯¥é¡¹ç›®æ˜¯æ¨¡å‹è®¾è®¡ï¼Œå¯¹äºç¡¬ä»¶çš„é€‰å‹æ•´ä½“ä¸Šæ˜¯ä»¥==ä½æˆæœ¬ã€ä½åŠŸè€—ã€é«˜é›†æˆã€é«˜ä»¿çœŸåº¦==ä¸ºåŸåˆ™çš„ã€‚</p>
<ul>
<li>æ»¡è¶³åŠŸèƒ½åŠæ€§èƒ½éœ€æ±‚ã€‚æœ¬è®¾è®¡çš„ä¾§é‡ç‚¹ä¸åœ¨äºæ•°æ®çš„ç²¾ç¡®å’Œæ§åˆ¶çš„çµæ•ï¼Œæ•…æ²¡æœ‰ä¸¥æ ¼å‚æ•°è¦æ±‚ã€‚</li>
<li>æ˜“ä¸Šæ‰‹çš„â€œå¤§ä¼—â€äº§å“ã€‚å¯¹äºè¿™äº›å…ƒä»¶æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œè€Œä¸”é¿å…è¸©å‘ã€‚</li>
<li>å…¼å®¹æ€§ã€‚ç”±äºæ˜¯æ¨¡å—åŒ–è®¾è®¡ï¼Œå¯¹äºéƒ¨åˆ†æ¨¡å—çš„å…¼å®¹æ€§æ˜¯è¦æœ‰ä¸€å®šçš„è¦æ±‚çš„ã€‚</li>
</ul>
<h2 id="ç¡¬ä»¶é€‰å‹"><a href="#ç¡¬ä»¶é€‰å‹" class="headerlink" title="ç¡¬ä»¶é€‰å‹"></a>ç¡¬ä»¶é€‰å‹</h2><p>å¦‚ä¸‹æ˜¯å¯¹äºç¡¬ä»¶çš„é€‰å‹åŠç›¸å…³ä»‹ç»ï¼Œæœ€åé™„æœ‰ä¸€å¼ æ‰€æœ‰ç”¨åˆ°çš„ç¡¬ä»¶çš„å›¾ç‰‡ã€‚</p>
<p><em><strong>1. ä¸»æ§æ¨¡å—â€”-STM32F103C8T6</strong></em></p>
<p>   æˆ‘ç›¸ä¿¡51åº”è¯¥æ˜¯å¤§éƒ¨åˆ†ç”µå­åŒå­¦å…¥æ‰‹çš„ç¬¬ä¸€æ¬¾å•ç‰‡æœºã€‚è¯šç„¶ï¼Œ51æœ‰å…¶çµæ´»è½»å·§ä¹‹å¤„ï¼Œä½†æ˜¯stm32å…·æœ‰å¼ºå¤§å¤–è®¾æ¥å£å’Œè¾ƒé«˜çš„è¿è¡Œé€Ÿåº¦ï¼ˆSTM32F103çš„CPUæœ€é«˜é€Ÿåº¦è¾¾72 MHzï¼Œå…·æœ‰16KB ~ 1MB Flashã€å¤šç§æ§åˆ¶å¤–è®¾ã€USBå…¨é€Ÿæ¥å£å’ŒCANï¼›å¤šè¾¾112ä¸ªå¿«é€ŸI/Oå£ã€11ä¸ªå®šæ—¶å™¨å’Œ13ä¸ªé€šä¿¡æ¥å£ï¼‰ æ­¤å¤–STM32è¿˜æä¾›äº†ä¸‰ç§çœç”µæ¨¡å¼å’Œä¸¤ç§è°ƒè¯•æ–¹å¼ã€‚å…¶çµæ´»çš„è°ƒè¯•æ–¹æ³•ã€å¤šæ ·çš„åŠŸèƒ½ç‰¹ç‚¹å’Œè¾ƒä¼˜çš„æ€§èƒ½å‚æ•°åŒæ ·ä¹Ÿæ˜¯é€‰æ‹©STM32ä½œä¸ºä¸»æ§èŠ¯ç‰‡çš„åŸå› ã€‚  </p>
<p><em><strong>2. æ— çº¿é€šä¿¡æ¨¡å—â€”-ESP01Sæ— çº¿é€šä¿¡æ¨¡å—</strong></em></p>
<p>   åŸºäºæ­¤æ¨¡å—é¦–å…ˆè€ƒè™‘çš„æ˜¯é€šä¿¡æ–¹å¼ï¼Œå¦‚æœä¸è°ˆåº”ç”¨åœºæ™¯ï¼Œæ¯”è¾ƒä¼ è¾“é€Ÿåº¦ã€ä¼ è¾“è·ç¦»å’Œå®‰å…¨æ€§ï¼Œzigbeeå’Œè“ç‰™ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯åœ¨æ™ºèƒ½å®¶å±…çš„åœºæ™¯ä¸‹ï¼Œwifiæ— ç–‘ä¼šæ˜¯æ›´ä¼˜é€‰ï¼Œå› ä¸ºå½“ä¸‹wifiå·²ç»åŸºæœ¬æ™®åŠåˆ°äº†æ¯ä¸ªå®¶åº­ï¼Œæ¨¡æ‹Ÿè¿˜åŸåº¦ä¼šæ›´é«˜ã€‚æ¥ä¸‹æ¥æ˜¯å…·ä½“èŠ¯ç‰‡çš„é€‰æ‹©ï¼Œå®‰ä¿¡å¯çš„ESP8266æ¨¡ç»„å¾ˆå¤šéƒ½å¯ä»¥åœ¨è¯¥åœºæ™¯ä¸‹åº”ç”¨ï¼Œå…¶å…·ä½“çš„åŒºåˆ†ä¸»è¦ä½“ç°åœ¨å°è£…æ–¹å¼ã€ç¡¬ä»¶é…ç½®ã€èµ„æºå¼•è„šç­‰ç­‰æ–¹é¢ã€‚å…·ä½“çš„åŒºåˆ†å¯ä»¥å‚è€ƒå®‰ä¿¡å¯å®˜ç½‘ç»™å‡ºçš„æ–‡æ¡£è¯´æ˜ï¼Œ<a href="https://www.ai-thinker.com/product/esp8266">please click</a>ï¼</p>
<p><em><strong>3. ç¯å¢ƒç›‘æµ‹æ¨¡å—</strong></em></p>
<ul>
<li><p>æ¸©æ¹¿åº¦ç›‘æµ‹â€”-DHT11</p>
<blockquote>
<p>  DHT11æ˜¯ä¸€æ¬¾æœ‰å·²æ ¡å‡†æ•°å­—ä¿¡å·è¾“å‡ºçš„æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ã€‚æ­¤ä¼ æ„Ÿå™¨ä½¿ç”¨èµ·æ¥ç®€å•ï¼Œç²¾åº¦å’Œæ€§èƒ½å‚æ•°è¶³å¤Ÿæ»¡è¶³ç¯å¢ƒç›‘æµ‹çš„åœºæ™¯ã€‚å…¶éµä»å•æ€»çº¿åè®®ï¼Œæœ‰ä¸¥æ ¼çš„æ—¶åºè¦æ±‚ã€‚ä¸»æœºå…ˆè¦å‘é€ä¸€ä¸ªè‡³å°‘18msçš„ä½ç”µå¹³ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDHT11å†…éƒ¨å®ŒæˆADè½¬æ¢ç­‰æ“ä½œï¼Œå½“ä¸»æœºæ‹‰é«˜åï¼Œæœ‰20-40usæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´ç”¨äºä¸»æœºåšè¾“å…¥è¾“å‡ºåˆ‡æ¢ï¼Œå½“ä¸»æœºé‡Šæ”¾æ€»çº¿æ§åˆ¶æƒï¼ˆæ­¤æ—¶ä¸»æœºä¸ºè¾“å…¥çŠ¶æ€ï¼Œæ€»çº¿è¢«ä¸Šæ‹‰ç”µé˜»æ‹‰é«˜ï¼‰ï¼ŒDHT11å°è¯•å°†æ€»çº¿æ‹‰ä½ï¼ŒæˆåŠŸæ‹‰ä½åå°±å¼€å§‹å‡†å¤‡å‘é€æ•°æ®äº†ï¼Œå†æ‹‰é«˜ä¸€æ¬¡å°±å¼€å§‹ä¼ è¾“æ•°æ®äº†ã€‚</p>
</blockquote>
</li>
<li><p>ç©ºæ°”è´¨é‡ç›‘æµ‹â€”-MQ135<br> &gt; MQç³»åˆ—ä¼ æ„Ÿå™¨æ˜¯ç›‘æµ‹ç©ºæ°”ç¯å¢ƒæœ€å¸¸ç”¨çš„ä¼ æ„Ÿå™¨ï¼Œå¤§æ¦‚åå‡ ä¸ªéƒ½æ˜¯é’ˆå¯¹ä¸åŒæ±¡æŸ“ç‰©è¿›è¡Œæ£€æµ‹çš„ï¼Œæœ¬æ¬¡å®éªŒæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯MQ135ï¼Œä¸»è¦é’ˆå¯¹æ°¨æ°”ã€è‹¯ã€é…’ç²¾ã€çƒŸé›¾é¢—ç²’è¿›è¡Œç©ºæ°”è´¨é‡æ£€æµ‹ï¼ŒåŒæ ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚å¯ä»¥é€‰æ‹©å…¶ä»–å‹å·çš„ä¼ æ„Ÿå™¨å§ï¼Œæ¯”å¦‚çƒŸé›¾ã€é…’ç²¾ã€ä¸€æ°§åŒ–ç¢³ç­‰ç­‰ã€‚</p>
</li>
<li><p>å…‰ç…§ç›‘æµ‹â€”-BH1750</p>
<blockquote>
<p> BH1750ä¼ æ„Ÿå™¨æœ‰æ¥è¿‘è§†è§‰çµæ•åº¦çš„å…‰è°±çµæ•åº¦ç‰¹æ€§ï¼Œå®ƒæ”¯æŒI2CBUSæ¥å£ï¼Œæ”¯æŒ1.8vé€»è¾‘è¾“å…¥æ¥å£ã€‚ä¼ æ„Ÿå™¨æœ‰ä¸¤ç§å¯é€‰çš„I2Cslaveåœ°å€ï¼Œæ— éœ€å…¶ä»–å¤–éƒ¨ä»¶ã€‚å…‰æºä¾èµ–æ€§å¼±ï¼Œå—çº¢å¤–çº¿å½±å“å¾ˆå°ã€‚ä¼ æ„Ÿå™¨é€šè¿‡é™ä½åŠŸç‡åŠŸèƒ½ï¼Œå®ç°ä½ç”µæµåŒ–ã€‚</p>
</blockquote>
</li>
</ul>
<p><em><strong>4. æ•°æ®å±•ç¤ºæ¨¡å—â€”-OLED</strong></em></p>
<p>   æ•°æ®æ˜¾ç¤ºæ— éå°±æ˜¯OLEDã€LCDã€TFTå±å¹•ç­‰ç­‰ã€‚è¯¥æ¨¡å—çš„ä½œç”¨æ˜¯å¯¹ç›‘æµ‹åˆ°çš„ç¯å¢ƒæ•°æ®åŠå®¶å…·çš„çŠ¶æ€è¿›è¡Œå®æ—¶æ˜¾ç¤ºã€‚OLEDç›¸è¾ƒäºLCDå±å¹•åˆ™ä¸éœ€è¦èƒŒå…‰å±‚ï¼ŒåŒæ ·ä¹Ÿä¸éœ€è¦å‘å‡ºå…‰äº®çš„æ¶²æ™¶å±‚ï¼›è€Œç›¸è¾ƒäºTFTæœ‰æ›´é«˜çš„æ€§ä»·æ¯”ï¼Œæœ€ç»ˆé€‰æ‹©äº†0.96å¯¸OLEDå±å¹•ã€‚</p>
<p><em><strong>5. å®¶å…·æ¨¡æ‹Ÿæ¨¡å—</strong></em></p>
<p>   å®¶å…·æ¨¡æ‹Ÿæ¨¡å—ä¸»è¦æ˜¯æ¨¡æ‹Ÿåˆ°äº†é—¨ã€çª—ã€ç¯å’Œé£æ‰‡ã€‚å…·ä½“æ˜¯é€šè¿‡æ­¥è¿›ç”µæœºã€èˆµæœºã€LEDç¯å’Œé£æ‰‡æ¨¡å—å®ç°çš„ã€‚è€Œåº”ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œé…ç½®IOå£çš„å·¥ä½œæ¨¡å¼ï¼Œæ§åˆ¶GPIOå£è¾“å‡ºçš„é«˜ä½ç”µå¹³å³å¯ã€‚<br>   <img src="/images/item/smarthome-2.png"></p>
<h2 id="PCBè®¾è®¡"><a href="#PCBè®¾è®¡" class="headerlink" title="PCBè®¾è®¡"></a>PCBè®¾è®¡</h2><p>å¯¹äºä»¥ä¸Šä¼—å¤šå…ƒä»¶å’Œæ¨¡å—ï¼Œå¦‚æœç”¨å¯¼çº¿ç›´æ¥è¿æ¥èµ·æ¥çš„è¯ï¼Œæˆ‘åªèƒ½æƒ³åˆ°ä¸€ä¸ªè¯å½¢å®¹ï¼šä¸€å›¢ä¹±éº»ï¼å› æ­¤è®¾è®¡PCBæ¿å°±æˆäº†è§£å†³è¯¥é—®é¢˜çš„æœ€å¥½æ–¹æ³•ã€‚å¯èƒ½æœ‰çš„åŒå­¦åœ¨å¤§å­¦æœŸé—´å­¦ä¹ è¿‡å¦‚ä½•ç”»æ¿æ‰“æ¿ï¼Œæœ‰äº›åŒå­¦æ²¡æœ‰æ¥è§¦è¿‡ï¼Œä»¥æˆ‘è‡ªå·±çš„ç»éªŒæ¥è®²ï¼Œå­¦ä¹ ä¸€ä¸¤å‘¨æ—¶é—´å¯¹äºç»˜åˆ¶è¯¥é¡¹ç›®PCBå·²ç»ç»°ç»°æœ‰ä½™ã€‚è¯¥é¡¹ç›®å¹¶ä¸éœ€è¦åœ¨æ¿å­ä¸Šæœ‰å„ä¸ªç”µè·¯çš„è®¾è®¡ï¼ˆæœ‰èƒ½åŠ›çš„åŒå­¦å¯ä»¥è®¾è®¡ä¸€ä¸ªç”µæºç”µè·¯ï¼‰ï¼Œå› æ­¤åªéœ€è¦å¸ƒå±€å¸ƒçº¿å³å¯è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä»¥ä¸‹æ˜¯æˆ‘æ‰€è®¾è®¡çš„æ¿å­ ã€‚</p>
<p>è¯¥éƒ¨åˆ†çš„è®¾è®¡è®©è‡ªå·±å¯¹äºæ•´ä¸ªç¡¬ä»¶èµ„æºçš„äº†è§£åŠä½¿ç”¨æœ‰ä¸€ä¸ªæ–°çš„è®¤è¯†ã€‚åœ¨ä¸»æ§èŠ¯ç‰‡æœ‰é™çš„ç¡¬ä»¶èµ„æºã€æœ‰é™ç©ºé—´çš„ç”µè·¯æ¿ä¸Šï¼Œå¦‚ä½•èƒ½å……åˆ†åˆ©ç”¨æ¯ä¸ªå…ƒä»¶çš„å½¢çŠ¶å¤§å°å’Œæ€§èƒ½ç‰¹ç‚¹æ¥åšåˆ°å½¼æ­¤ä¹‹é—´çš„äº¤äº’æ˜¯è¯¥éƒ¨åˆ†çš„é‡éš¾ç‚¹ã€‚<br>==Tipsï¼šé˜…è¯»æ¯æ ¹pinçš„åŠŸèƒ½ï¼Œåˆ†é…å¥½ä¸»æ§èŠ¯ç‰‡çš„å„ä¸ªç®¡è„šèµ„æº==</p>
<p><img src="/images/item/smarthome-3.png"></p>
<h1 id="è½¯ä»¶è®¾è®¡"><a href="#è½¯ä»¶è®¾è®¡" class="headerlink" title="è½¯ä»¶è®¾è®¡"></a>è½¯ä»¶è®¾è®¡</h1><p>æ•´ä¸ªä»£ç å·¥ç¨‹å†…å®¹ç›¸å¯¹è¾ƒå¤§ï¼Œåœ¨æ­¤å°±ä¸è¿›è¡Œè¯¦ç»†çš„å±•ç¤ºäº†å¦‚æœæœ‰éœ€è¦å¯ä»¥ç§ä¿¡æˆ‘ã€‚åœ¨æ­¤åªå±•ç¤ºéƒ¨åˆ†ä¸»å‡½æ•°ä»£ç å’Œç›¸å…³å¤´æ–‡ä»¶ç­‰ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ•°æ®ä¸Šäº‘æ ¼å¼å®šä¹‰ã€å‘½ä»¤ä¸‹å‘ã€å„ä¸ªæ¨¡å—çš„é©±åŠ¨å‡½æ•°åŒæ ·é‡è¦ï¼</p>
<h2 id="å¤´æ–‡ä»¶"><a href="#å¤´æ–‡ä»¶" class="headerlink" title="å¤´æ–‡ä»¶"></a>å¤´æ–‡ä»¶</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"stm32f10x.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"stdio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"math.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"delay.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"string.h"</span>	</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"dht11.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"BH1750.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"adc.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"led.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"OLED_I2C.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"usart.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"timer.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"exti.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"key.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"door_bsp.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"fan.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"esp8266.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"MqttKit.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"onenet.h"</span></span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä¸»å‡½æ•°"><a href="#ä¸»å‡½æ•°" class="headerlink" title="ä¸»å‡½æ•°"></a>ä¸»å‡½æ•°</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>{</span>					<span class="comment">//å®šä¹‰ç»“æ„ä½“</span></span><br><span class="line">	<span class="type">uint8_t</span> temp;				<span class="comment">//æ¸©åº¦</span></span><br><span class="line">	<span class="type">uint8_t</span> humi;				<span class="comment">//æ¹¿åº¦</span></span><br><span class="line">	<span class="type">float</span> mq;					<span class="comment">//MQ135ä¼ æ„Ÿå™¨</span></span><br><span class="line">	<span class="type">float</span> sun;					<span class="comment">//å…‰ç…§å¼ºåº¦ä¼ æ„Ÿå™¨</span></span><br><span class="line">	<span class="type">uint8_t</span> LED_FLAG;			<span class="comment">//LED</span></span><br><span class="line">	<span class="type">uint8_t</span> FAN_FLAG;			<span class="comment">//é£æ‰‡</span></span><br><span class="line">	<span class="type">uint8_t</span> DOOR_FLAG;			<span class="comment">//æ­¥è¿›ç”µæœº</span></span><br><span class="line">	<span class="type">uint8_t</span> WARNING_FLAG;		<span class="comment">//æ­¥è¿›ç”µæœº</span></span><br><span class="line">}SendData;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> SendData send_data;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">uint8_t</span> cmd_rev_flag;</span><br><span class="line">SendData send_data = {<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span> ,<span class="number">0</span>};	<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">uint8_t</span> cmd_rev_flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> *data_ptr = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">short</span> timeCount = <span class="number">0</span>;	<span class="comment">//å‘é€é—´éš”å˜é‡</span></span><br><span class="line">	Hardware_Init();</span><br><span class="line">	Net_Init();</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	{  		</span><br><span class="line">		<span class="keyword">if</span>(++timeCount &gt;= <span class="number">200</span> || (cmd_rev_flag == <span class="number">1</span>))	</span><br><span class="line">{	</span><br><span class="line">			DHT11_Read_Data(&amp;send_data.temp,&amp;send_data.humi);</span><br><span class="line">			send_data.mq=(<span class="type">float</span>)(Get_Adc_Average(ADC_Channel_1,<span class="number">10</span>))*(<span class="number">3.3</span>/<span class="number">4096</span>);	</span><br><span class="line">			send_data.sun = LIght_Intensity();										 </span><br><span class="line">			OneNet_SendData();	<span class="comment">//å‘é€æ•°æ®</span></span><br><span class="line">			timeCount = <span class="number">0</span>;</span><br><span class="line">			cmd_rev_flag=<span class="number">0</span>;</span><br><span class="line">			ESP8266_Clear();</span><br><span class="line">		}</span><br><span class="line">		data_ptr = ESP8266_GetIPD(<span class="number">0</span>);		<span class="comment">//æ£€æŸ¥æ˜¯å¦æœ‰ä¸‹å‘æŒ‡å®š</span></span><br><span class="line">		<span class="keyword">if</span>(data_ptr != <span class="literal">NULL</span>)</span><br><span class="line">			OneNet_RevPro(data_ptr);</span><br><span class="line">		delay_ms(<span class="number">10</span>);</span><br><span class="line">	}		 </span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="ç¡¬ä»¶åˆå§‹åŒ–"><a href="#ç¡¬ä»¶åˆå§‹åŒ–" class="headerlink" title="ç¡¬ä»¶åˆå§‹åŒ–"></a>ç¡¬ä»¶åˆå§‹åŒ–</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">Hardware_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">	delay_init();	    		<span class="comment">//å»¶æ—¶å‡½æ•°åˆå§‹åŒ–</span></span><br><span class="line">	TIM2_Int_Init(<span class="number">4999</span>,<span class="number">7199</span>);  	<span class="comment">//ç”¨äºOLEDæ˜¾ç¤º</span></span><br><span class="line">	Usart1_Init(<span class="number">115200</span>);		<span class="comment">//ä¸²å£è°ƒè¯•</span></span><br><span class="line">	Usart2_Init(<span class="number">115200</span>);		<span class="comment">//esp8266--stm32é€šä¿¡</span></span><br><span class="line">	OLED_Init();				<span class="comment">//OLEDåˆå§‹åŒ–</span></span><br><span class="line">	OLED_CLS();</span><br><span class="line">	KEY_Init();					<span class="comment">//æŒ‰é”®åˆå§‹åŒ–</span></span><br><span class="line">	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);</span><br><span class="line">								<span class="comment">//è®¾ç½®ä¸­æ–­ä¼˜å…ˆçº§åˆ†ç»„2ï¼Œä¸ºåé¢å¤–éƒ¨ä¸­æ–­åšåŸºç¡€</span></span><br><span class="line">	EXTIX_Init();				<span class="comment">//åˆ¤æ–­é”®å€¼æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">	DHT11_Init();				<span class="comment">//æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨åˆå§‹åŒ–</span></span><br><span class="line">	Adc_Init();					<span class="comment">//ç©ºæ°”æ£€æµ‹åˆå§‹åŒ–</span></span><br><span class="line">	BH1750_Init();				<span class="comment">//å…‰ç…§</span></span><br><span class="line">	TIM3_Int_Init(<span class="number">4999</span>,<span class="number">7199</span>);  	<span class="comment">//æŠ¥è­¦æ˜¾ç¤º</span></span><br><span class="line">	ESP8266_Init();				<span class="comment">//åˆå§‹åŒ–ESP8266</span></span><br><span class="line">	<span class="keyword">while</span>(OneNet_DevLink())		<span class="comment">//æ¥å…¥OneNET</span></span><br><span class="line">	delay_ms(<span class="number">500</span>);</span><br><span class="line">}	</span><br></pre></td></tr></tbody></table></figure>

<h1 id="äº‘å¹³å°é€‰æ‹©"><a href="#äº‘å¹³å°é€‰æ‹©" class="headerlink" title="äº‘å¹³å°é€‰æ‹©"></a>äº‘å¹³å°é€‰æ‹©</h1><p>æœ¬è®¾è®¡è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†å°±æ˜¯å¯¹äºäº‘å¹³å°çš„é€‰æ‹©ï¼Œæœ¬é¡¹ç›®é€‰æ‹©çš„æ˜¯ä¸­å›½ç§»åŠ¨ç‰©è”ç½‘äº‘å¹³å°OneNETã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰èƒ½åŠ›çš„åŒå­¦è‡ªå·±åšä¸ªappæ›´å¥½ã€‚</p>
<p>ç›®å‰å¾ˆå¤šäº‘å¹³å°å‚å•†éƒ½æ”¯æŒäº†å¯¹äºä¸ªäººå¼€å‘è€…çš„ç‰©è”ç½‘åº”ç”¨çš„éœ€æ±‚ï¼Œæˆ‘è§åˆ°ç”¨åˆ°æœ€å¤šçš„åŒ…æ‹¬é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€æœºæ™ºäº‘ã€OneNETç­‰ç­‰ã€‚è¿™äº›å¹³å°å¯¹å¯¹äºä¸ªäººå¼€å‘è€…è¿˜æ˜¯å¾ˆæœ‰å¥½çš„ï¼Œæœ‰ç€æ¯”è¾ƒå®Œå–„çš„æµç¨‹ã€‚æˆ‘ä¸ªäººä½¿ç”¨è¿‡æœºæ™ºäº‘å’ŒOneNETï¼Œå¯¹æ­¤åšå‡ºä»¥ä¸‹å»ºè®®ã€‚</p>
<ul>
<li>OneNETï¼šæ›´é€‚åˆå·²æœ‰å·¥ç¨‹æ–‡ä»¶ï¼Œåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šè¿›è¡Œé€šä¿¡éƒ¨åˆ†çš„å¼€å‘ã€‚å…¶å¯¹äºæœ€ç»ˆçš„ç•Œé¢è®¾è®¡å¾ˆå¼€æ”¾ï¼Œå¯ä»¥è‡ªè¡Œè®¾è®¡å›¾æ ‡åŠæ˜¾ç¤ºæ–¹å¼ç­‰ï¼›</li>
<li>æœºæ™ºäº‘ï¼šé€‚åˆæ²¡æœ‰å·¥ç¨‹æ–‡ä»¶ï¼Œä»åˆšå¼€å§‹å°±é€‰æ‹©ä½¿ç”¨è¯¥ç‰©è”ç½‘äº‘å¹³å°ã€‚å¯ä»¥åœ¨å¹³å°ä¸Šç”Ÿæˆä»£ç åŒ…è¿›è¡Œå¼€å‘ï¼›</li>
</ul>
<h1 id="ç»“æœå±•ç¤º"><a href="#ç»“æœå±•ç¤º" class="headerlink" title="ç»“æœå±•ç¤º"></a>ç»“æœå±•ç¤º</h1><h2 id="å®ç‰©å›¾ä¸æ‰‹æœºç•Œé¢"><a href="#å®ç‰©å›¾ä¸æ‰‹æœºç•Œé¢" class="headerlink" title="å®ç‰©å›¾ä¸æ‰‹æœºç•Œé¢"></a>å®ç‰©å›¾ä¸æ‰‹æœºç•Œé¢</h2><p><img src="/images/item/smarthome-4.png"></p>
<h2 id="äº‘å¹³å°æ•°æ®å¯è§†åŒ–ç•Œé¢"><a href="#äº‘å¹³å°æ•°æ®å¯è§†åŒ–ç•Œé¢" class="headerlink" title="äº‘å¹³å°æ•°æ®å¯è§†åŒ–ç•Œé¢"></a>äº‘å¹³å°æ•°æ®å¯è§†åŒ–ç•Œé¢</h2><p><img src="/images/item/smarthome-5.png"></p>
<h2 id="äº‘å¹³å°æ§åˆ¶ç•Œé¢"><a href="#äº‘å¹³å°æ§åˆ¶ç•Œé¢" class="headerlink" title="äº‘å¹³å°æ§åˆ¶ç•Œé¢"></a>äº‘å¹³å°æ§åˆ¶ç•Œé¢</h2><p><img src="/images/item/smarthome-6.png"></p>
<h1 id="å®ç°åŠŸèƒ½åŠæ‰©å±•"><a href="#å®ç°åŠŸèƒ½åŠæ‰©å±•" class="headerlink" title="å®ç°åŠŸèƒ½åŠæ‰©å±•"></a>å®ç°åŠŸèƒ½åŠæ‰©å±•</h1><h2 id="å®ç°åŠŸèƒ½"><a href="#å®ç°åŠŸèƒ½" class="headerlink" title="å®ç°åŠŸèƒ½"></a>å®ç°åŠŸèƒ½</h2><ul>
<li><p>ç›‘æµ‹ï¼šç©ºæ°”ä¸­æ¸©åº¦ã€æ¹¿åº¦ã€å…‰ç…§å’Œç©ºæ°”è´¨é‡ç­‰ç¯å¢ƒå› ç´ ï¼›</p>
</li>
<li><p>æ§åˆ¶ï¼šæ¨¡æ‹Ÿçš„â€œå®¶å±…â€ï¼šé—¨ã€ç¯ã€çª—å¸˜ã€é£æ‰‡ï¼›</p>
</li>
<li><p>æ˜¾ç¤ºï¼šOLEDæ˜¾ç¤ºã€æ‰‹æœºæ˜¾ç¤ºã€ç”µè„‘æ˜¾ç¤ºï¼›</p>
</li>
<li><p>æ§åˆ¶æ–¹å¼ï¼šæŒ‰é”®æ§åˆ¶ã€æ‰‹æœºæ§åˆ¶ã€ç”µè„‘æ§åˆ¶ï¼›</p>
</li>
<li><p>æŠ¥è­¦ï¼šè®¾ç½®ç¯å¢ƒå› ç´ é˜ˆå€¼ï¼Œè¶…æ ‡å¼€å‘æ¿çš„ç¯äº®èµ·ï¼ˆå¯æ”¹æˆèœ‚é¸£å™¨ï¼‰</p>
</li>
<li><p>ä»¥ä¸Šæ‰€æœ‰ç¯å¢ƒåŠå®¶å…·çŠ¶æ€éƒ½å¯ä»¥å¯è§†åŒ–æ˜¾ç¤º</p>
</li>
</ul>
<h2 id="å¯æ‰©å±•åŠŸèƒ½"><a href="#å¯æ‰©å±•åŠŸèƒ½" class="headerlink" title="å¯æ‰©å±•åŠŸèƒ½"></a>å¯æ‰©å±•åŠŸèƒ½</h2><p>è¯¥ç³»ç»Ÿå…·æœ‰å¾ˆé«˜çš„æ‰©å±•æ€§ï¼Œåšå‡ºåŸºç¡€æ¨¡å‹ä¹‹åå¯ä»¥è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å°†ç¡¬ä»¶èµ„æºåˆ†é…å¥½ã€‚</p>
<ul>
<li>è¯­éŸ³æ¨¡å—ã€‚è¯­éŸ³æ§åˆ¶æ™ºèƒ½å®¶å±…çš„çŠ¶æ€ã€‚</li>
<li>å®‰é˜²ç³»ç»Ÿã€‚æ·»åŠ æŒ‡çº¹ã€RFIDã€é¢éƒ¨è¯†åˆ«ç­‰å¼€é—¨æ–¹å¼ã€‚</li>
<li>å‘Šè­¦ç³»ç»Ÿã€‚ç›®å‰åªæ˜¯é‡åˆ°å‘Šè­¦å¹³å°è‡ªåŠ¨æé†’ï¼Œå¯ä»¥æ·»åŠ çŸ­ä¿¡é€šçŸ¥åŠŸèƒ½ã€‚</li>
<li>æ¨¡å¼é€‰æ‹©ã€‚å±…å®¶å¤šç§æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢ï¼Œå¨±ä¹æ¨¡å¼ã€ä¼‘æ¯æ¨¡å¼ã€ç¦»å®¶æ¨¡å¼ç­‰ç­‰ï¼Œå®¶å…·å¯ä»¥å¯¹åº”ç€ä¸åŒçŠ¶æ€ã€‚</li>
<li>â€¦â€¦</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬è®¾è®¡å¯¹äºæ™ºèƒ½å®¶å±…æ§åˆ¶ç³»ç»Ÿçš„æ¨¡æ‹Ÿä»ä¼ ç»Ÿåˆ°æ™ºèƒ½ã€ä»å‰ç«¯åˆ°åç«¯ï¼Œè¦†ç›–é¢ã€è¿˜åŸåº¦è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ï¼›å…¶æ¬¡ï¼Œç³»ç»Ÿçš„å…¼å®¹æ€§å’Œå¯æ‰©å±•ç§»æ¤æ€§è¾ƒé«˜ï¼ŒåŸºäºæ­¤å¯ä»¥è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå¯ä»¥æ‰©å±•çš„å†…å®¹æˆ‘åœ¨ä¸Šé¢ä¹Ÿæœ‰æ€»ç»“ã€‚æˆ‘è®¤ä¸ºç›¸å¯¹å®¹æ˜“ä¸Šæ‰‹çš„å°±æ˜¯å¯¹äºç›‘æµ‹åˆ°çš„æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥åˆ†æåº”ç”¨ã€‚æœ€åå°±æ˜¯å…¶åº”ç”¨æ€§ï¼Œå½“è‡ªå·±è®¾è®¡å¥½ç”µæºæ¨¡å—å¯ä»¥ç‹¬ç«‹ä¾›ç”µåå°±å¯ä»¥ç›´æ¥åº”ç”¨åˆ°ç”Ÿæ´»ä¸­ï¼Œå³ä½¿ä¸åšæ¯•è®¾diyä¸€ä¸ªç¯å¢ƒç›‘æµ‹çš„ç³»ç»Ÿä¹Ÿæ˜¯ä¸é”™çš„ã€‚æ•´ä½“æ¥è¯´ï¼Œæœ¬è®¾è®¡å®ç°çš„åŠŸèƒ½æ˜¯ï¼šå››æµ‹ä¸‰æ˜¾ä¸¤æ§ä¸€å¹³å°ï¼ŒåŸºæœ¬å®ç°äº†æ™ºèƒ½å®¶å±…æ¨¡æ‹Ÿçš„åŸºæœ¬çš„è¦æ±‚ã€‚åŒæ ·è¯¥é¡¹ç›®è¿˜å¯ä»¥åº”ç”¨åˆ°ç¯å¢ƒç›‘æµ‹ç­‰æ–¹é¢çš„ï¼Œä½†æ˜¯å…¶ä¾§é‡ç‚¹æ›´è¦åå‘æ•°æ®çš„åˆ†æå’Œå¤„ç†ã€‚</p>
<p>è¡Œæ–‡è‡³æ­¤å°±ç»“æŸå•¦ï¼Œå¦‚æœæœ‰ä¸è¶³ä¹‹å¤„æˆ–è€…æ›´å¥½çš„æƒ³æ³•å¯ä»¥ä¸€èµ·äº¤æµ ~</p>
]]></content>
      <categories>
        <category>Item</category>
      </categories>
      <tags>
        <tag>æ¯•ä¸šè®¾è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ç†è§£c/c++ Volatileå…³é”®å­—</title>
    <url>/2022/11/15/language-grammar/Volatile/</url>
    <content><![CDATA[<p>ç½‘ç»œä¸Šå¯¹äºvolatileçš„è§£è¯»ä¼—è¯´çº·çº­ï¼Œè€Œä¸”å…¶ä¸­è¾ƒå¤šçš„æ˜¯javaå†…å­˜æ¨¡å‹ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« å°†åŸºäºè‡ªå·±çš„å­¦ä¹ å’Œå®éªŒï¼Œé’ˆå¯¹C/C++è¯­è¨€åµŒå…¥å¼å¼€å‘åœºæ™¯è¿›è¡Œvolatileå…³é”®å­—çš„åˆ†æ</p>
<h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><p>volatile å…³é”®å­—æ˜¯ C /C++ ç¼–ç¨‹è¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼Œä½œä¸ºä¸€ç§ç±»å‹ä¿®é¥°ç¬¦ã€‚æˆ‘å°†å…¶ä½œç”¨æ€»ç»“ä¸º<em><strong>å‘Šè¯‰ç¼–è¯‘å™¨ç¦æ­¢ä¼˜åŒ–å…¶æ‰€ä¿®é¥°å¯¹è±¡çš„è¯»å†™è®¿å­˜æ“ä½œåŠæŒ‡ä»¤é¡ºåºï¼Œä¿è¯å˜é‡çš„å¯è§æ€§</strong></em></p>
<blockquote>
<p>å¯è§æ€§ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡åï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚</p>
<p>æœ‰åºæ€§ï¼šç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚</p>
<p>åŸå­æ€§ï¼šä¸€ä¸ªæ“ä½œæˆ–å¤šä¸ªæ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œä¸”æ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œã€‚</p>
</blockquote>
<p>åœ¨ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹è¿™æœ¬ä¹¦ä¸­è®²åˆ°ï¼ŒvolatileåŸºæœ¬å¯ä»¥åšåˆ°ä¸¤ä¸ªäº‹æƒ…ï¼š</p>
<ol>
<li>é˜»æ­¢ç¼–è¯‘å™¨ä¸ºäº†æé«˜é€Ÿåº¦å°†ä¸€ä¸ªå˜é‡ç¼“å­˜åˆ°å¯„å­˜å™¨å†…è€Œä¸å†™å›</li>
<li>é˜»æ­¢ç¼–è¯‘å™¨è°ƒæ•´æ“ä½œvolatileå˜é‡çš„æŒ‡ä»¤é¡ºåº</li>
</ol>
<p>å¯¹äºç¬¬ä¸€ä¸ªä½œç”¨volatileæ˜¯å¯ä»¥å¾ˆå¥½çš„åšåˆ°ï¼Œè€Œå¯¹äºç¬¬äºŒä¸ªä½œç”¨ç¼–è¯‘å™¨å±‚é¢å¯ä»¥ä¿è¯æŒ‡ä»¤æœ‰åºä½†æ˜¯æˆ‘ä»¬æ— æ³•é˜»æ­¢cpuåŠ¨æ€è°ƒæ•´é¡ºåºã€‚çœŸæ­£ä¿è¯æœ‰åºæ€§æ˜¯éœ€è¦é€šè¿‡å†…å­˜å±éšœå®Œæˆçš„ï¼Œè€Œvolatileå¹¶æ²¡æœ‰å†…å­˜å±éšœçš„åŠŸèƒ½ï¼Œgcc æä¾›äº†ä¸€ä¸ªå†…è”å‡½æ•° <em><strong>asm volatile (â€œâ€ : : : â€œmemoryâ€</strong>)</em> ç¼–è¯‘å™¨å±éšœï¼Œå…·ä½“å¹³å°ç›¸å…³å†…å­˜å±éšœéœ€è¦åˆ°å…·ä½“çš„ç»“æ„å¹³å°å»å‚è€ƒ</p>
<h1 id="ç†è§£volatile"><a href="#ç†è§£volatile" class="headerlink" title="ç†è§£volatile"></a>ç†è§£volatile</h1><blockquote>
<p>Collinså¯¹äºVolatileé‡Šä¹‰ï¼šA situation that is volatile is <strong>likely</strong> to change <strong>suddenly</strong> and <strong>unexpectedly</strong>.</p>
</blockquote>
<p><strong>volatile</strong> æœ¬èº«é‡Šä¹‰ä¸º <strong>æ˜“å¤±çš„ã€æ˜“å˜çš„</strong></p>
<p>å¯¹äºç”¨volatileæ‰€ä¿®é¥°çš„å¯¹è±¡ï¼Œåœ¨å…¶è‡ªèº«çš„å«ä¹‰åŸºç¡€ä¸Šï¼Œæœ‰ä¸‰ä¸ªå‰¯è¯å¯ä»¥å¾ˆå¥½çš„å¯¹å…¶æ€§è´¨è¿›è¡Œè¯ é‡Šï¼š</p>
<ul>
<li><p>likely   å¯èƒ½åœ°ï¼ŒæŒ‡å¯¹è±¡çš„çŠ¶æ€å¯èƒ½å˜åŒ–ã€ä¹Ÿå¯èƒ½ä¸å˜ä¿æŒçŠ¶æ€ï¼Œå¼ºè°ƒç»“æœï¼›</p>
</li>
<li><p>suddenly:   çªç„¶åœ°ï¼ŒæŒ‡å¯¹è±¡çŠ¶æ€çš„ç¬æ—¶å˜åŒ–ï¼Œå¼ºè°ƒè¿‡ç¨‹ï¼›</p>
</li>
<li><p>unexpectedly:  ä¸å¯é¢„æœŸåœ°ï¼ŒæŒ‡å¯¹è±¡å˜åŒ–çš„æ—¶é—´ç»“æœéƒ½ä¸å¯é¢„æœŸï¼›</p>
</li>
</ul>
<h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><p>æ ¹æ®å«ä¹‰æ€§è´¨ï¼Œåœ¨åµŒå…¥å¼å¼€å‘ä¸­ä»¥ä¸‹ä¸‰ç§åœºæ™¯æ˜¯ä¸€å®šè¦è€ƒè™‘ä½¿ç”¨volatileå…³é”®å­—çš„ï¼ˆå¤§å¤šæ•°æƒ…å†µä¸€å®šä½¿ç”¨ï¼ï¼ï¼ï¼‰</p>
<ol>
<li>å¤šçº¿ç¨‹ä»»åŠ¡è¯»å†™åŒä¸€å…¨å±€å˜é‡ï¼Œ</li>
<li>ä¸­æ–­æœåŠ¡ç¨‹åºä¿®æ”¹çš„å…¨å±€å˜é‡</li>
<li>å†…å­˜æ˜ å°„å¤–è®¾å¯„å­˜å™¨</li>
</ol>
<h1 id="æµ‹è¯•ç”¨ä¾‹"><a href="#æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹"></a>æµ‹è¯•ç”¨ä¾‹</h1><h2 id="ä¸­æ–­åœºæ™¯"><a href="#ä¸­æ–­åœºæ™¯" class="headerlink" title="ä¸­æ–­åœºæ™¯"></a>ä¸­æ–­åœºæ™¯</h2><p>ä¸‹é¢ä¸€æ®µä»£ç ï¼Œæˆ‘ä»¬æ‰€æœŸå¾…çš„ç»“æœæ˜¯ä¸»ç¨‹åºè¿è¡Œï¼Œç›´åˆ°crtl+cæŒ‰é”®æŒ‰ä¸‹ç¨‹åºé€€å‡ºï¼Œä»£ç ç¼–è¯‘æ‰§è¡Œä¹‹åå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€é¢„æœŸçš„æ ·å­ã€‚å¦‚æœsig_doneå˜é‡ä¸é€šè¿‡volatileä¿®é¥°ç¨‹åºå°†æ°¸è¿œä¸ä¼šé€€å‡ºï¼Œè€Œvolatileå…³é”®å­—å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸€ä¸ªé—®é¢˜</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">bool</span> sig_done = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//static volatile bool sig_done = false;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handler</span><span class="params">(<span class="type">int</span> sig)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span>(sig == SIGINT)</span><br><span class="line">    â”†   sig_done = <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc , <span class="type">char</span> *argv[])</span></span><br><span class="line">{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"main start, press ctrl+c go on\n"</span>);</span><br><span class="line">    signal(SIGINT, handler);</span><br><span class="line">    <span class="keyword">while</span>(!sig_done) {</span><br><span class="line">    }   </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"main exit\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–è¯‘å‘½ä»¤</span></span><br><span class="line">gcc main.c <span class="number">-02</span></span><br><span class="line">objdump -d a.out &gt; a.s</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡åæ±‡ç¼–æ¯”è¾ƒä¸¤ä¸ªç¨‹åºçš„å¼‚åŒï¼ˆå·¦ä¾§volatileï¼Œå³ä¾§æ— volatileï¼‰</p>
<p><img src="/images/coding/meld.png" alt="image"></p>
<p>æ²¡æœ‰voaltileçš„whileå®ç°æ–¹å¼ä¸ºï¼š</p>
<ol>
<li>æ¯”è¾ƒripå¯„å­˜å™¨+0x2f65åœ°å€å¤„çš„å€¼ï¼ˆsig_doneï¼‰ä¸ 0 æ˜¯å¦ç›¸ç­‰</li>
<li>ä¸ç›¸ç­‰è·³è½¬åˆ°main+0x30å³ä¸Šä¸€æ¡æŒ‡ä»¤å¤„</li>
<li>è·³è½¬</li>
</ol>
<p>æœ‰volatileçš„whileå®ç°æ–¹å¼ï¼š</p>
<ol>
<li><p>nopl (%rax) ç¼–è¯‘å™¨å¼€å¯ä¼˜åŒ–åä½¿æŒ‡ä»¤æŒ‰å­—å¯¹é½,å‡å°‘å–æŒ‡ä»¤çš„æ—¶é’Ÿå‘¨æœŸã€‚</p>
</li>
<li><p>å°† ripå¯„å­˜å™¨+0x2f65åœ°å€å¤„çš„å€¼æ”¾åˆ°eaxå¯„å­˜å™¨ä¸­</p>
<blockquote>
<p>movzblæŒ‡ä»¤è´Ÿè´£æ‹·è´ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ç”¨0å¡«å……å…¶ç›®çš„æ“ä½œæ•°ä¸­çš„å…¶ä½™å„ä½ï¼Œè¿™ç§æ‰©å±•æ–¹å¼å«â€œé›¶æ‰©å±•â€ã€‚</p>
<p>movsblæŒ‡ä»¤è´Ÿè´£æ‹·è´ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ç”¨æºæ“ä½œæ•°çš„æœ€é«˜ä½å¡«å……å…¶ç›®çš„æ“ä½œæ•°ä¸­çš„å…¶ä½™å„ä½ï¼Œè¿™ç§æ‰©å±•æ–¹å¼å«â€œç¬¦å·æ‰©å±•â€ã€‚</p>
</blockquote>
</li>
<li><p>test   %al,%al å¯¹eaxå¯„å­˜å™¨ä½ä½é€»è¾‘ä¸</p>
<blockquote>
<p>Testå‘½ä»¤ï¼šå°†ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡Œé€»è¾‘ä¸è¿ç®—ï¼Œå¹¶æ ¹æ®è¿ç®—ç»“æœè®¾ç½®ç›¸å…³çš„æ ‡å¿—ä½ï¼ˆze: zero flagï¼‰ã€‚ä½†æ˜¯ï¼ŒTestå‘½ä»¤çš„ä¸¤ä¸ªæ“ä½œæ•°ä¸ä¼šè¢«æ”¹å˜ã€‚è¿ç®—ç»“æœåœ¨è®¾ç½®è¿‡ç›¸å…³æ ‡è®°ä½åä¼šè¢«ä¸¢å¼ƒã€‚</p>
</blockquote>
</li>
<li><p>je   å¦‚æœZFï¼ˆé›¶æ ‡å¿—ä½ï¼‰=1ï¼Œé›¶æ ‡å¿—ä½ä¸º1ï¼ˆçœŸå€¼ï¼‰è¯´æ˜ç»“æœä¸º0ï¼Œåˆ™è½¬åˆ°labelæ‰€æŒ‡çš„æŒ‡ä»¤è¯­å¥ï¼›å¦åˆ™è·³è¿‡è¿™æ¡è¯­å¥ï¼Œæ‰§è¡Œä¸‹æ¡è¯­å¥</p>
</li>
</ol>
<h2 id="å¤šçº¿ç¨‹åœºæ™¯"><a href="#å¤šçº¿ç¨‹åœºæ™¯" class="headerlink" title="å¤šçº¿ç¨‹åœºæ™¯"></a>å¤šçº¿ç¨‹åœºæ™¯</h2><figure class="highlight cpp"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">bool</span> mstop = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//static volatile bool mstop = true;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">first_thread</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s start\n"</span>, __func__);</span><br><span class="line">    <span class="keyword">while</span>(mstop) {</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s exit\n"</span>, __func__);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">second_thread</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s start\n"</span>, __func__);</span><br><span class="line">    mstop = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s exit\n"</span>, __func__);</span><br><span class="line">}                                                                                                                                                                     </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::thread fthread{first_thread};</span><br><span class="line">    std::thread sthread{second_thread};</span><br><span class="line">    fthread.<span class="built_in">join</span>();</span><br><span class="line">	sthread.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å¤–è®¾å¯„å­˜å™¨"><a href="#å¤–è®¾å¯„å­˜å™¨" class="headerlink" title="å¤–è®¾å¯„å­˜å™¨"></a>å¤–è®¾å¯„å­˜å™¨</h2><p>å¯¹äºå¤–è®¾é€šå¸¸è®¾ç½®æœ‰çŠ¶æ€å¯„å­˜å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¾ªç¯è¯»å–çŠ¶æ€å¯„å­˜å™¨çš„å€¼æ¥æŸ¥çœ‹å¯¹åº”å¤–è®¾çš„çŠ¶æ€ã€‚å¯¹äºå¦‚ä¸‹ç¤ºä¾‹ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨volatileå…³é”®å­—ï¼Œç¼–è¯‘å™¨å¯èƒ½ç”Ÿæˆçš„ä»£ç æ˜¯è¯»å–ä¸€ä¸ªå›ºå®šåœ°å€çš„å€¼è€Œä¸ä¼šæ¯æ¬¡éƒ½ä»ä¸»å­˜ä¸­è¯»å–æ–°çš„å€¼ï¼ˆæˆ–è€…è¯»å–næ¬¡çŠ¶æ€ï¼Œç”Ÿæˆçš„ä»£ç åªè¯»å–äº†ä¸€æ¬¡ï¼Œç„¶åä½¿ç”¨næ¬¡ç›¸åŒçš„å€¼ï¼‰</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®å¯„å­˜å™¨</span></span><br><span class="line">*(<span class="keyword">volatile</span> <span class="type">unsigned</span> <span class="type">int</span> *) STATUS_BASE_ADDR = <span class="number">1</span> &lt;&lt; <span class="number">24</span>; </span><br><span class="line"><span class="comment">//è¯»å¯„å­˜å™¨</span></span><br><span class="line"><span class="keyword">while</span>(!(*(<span class="keyword">volatile</span> <span class="type">unsigned</span> <span class="type">int</span> *) STATUS_BASE_ADDR)) {</span><br><span class="line">    <span class="comment">// do action</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h1 id="çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"><a href="#çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼" class="headerlink" title="çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"></a>çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼</h1><p>è¯¥éƒ¨åˆ†ä¸æ˜¯volatileçš„ä½¿ç”¨ï¼Œè€Œæ˜¯å¯¹å†…å±å±éšœçš„ç†è§£</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//mp3decoder.h</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mp3decoder</span> :</span> public decoderImp </span><br><span class="line">{</span><br><span class="line">    public:</span><br><span class="line">    	<span class="type">static</span> mp3decoder* <span class="title function_">getInstance</span><span class="params">()</span>;</span><br><span class="line">    private:</span><br><span class="line">    	mp3decoder();</span><br><span class="line">    	~mp3decoder();</span><br><span class="line">    	<span class="type">static</span> mp3decoder* mdecoder;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">//mp3decoder.cpp</span></span><br><span class="line"><span class="comment">//çº¿ç¨‹ä¸å®‰å…¨ï¼Œé€‚ç”¨äºå•çº¿ç¨‹</span></span><br><span class="line">mp3decoder* mp3decoder::mdecoder = <span class="literal">NULL</span>;</span><br><span class="line">mp3decoder* <span class="title function_">mp3decoder::getInstance</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span>(mdecoder == <span class="literal">NULL</span>)</span><br><span class="line">        mdecoder = new mp3decoder();</span><br><span class="line">    <span class="keyword">return</span> mdecoder;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//çº¿ç¨‹å®‰å…¨ï¼Œä½†é”çš„ä»£ä»·å¤ªé«˜</span></span><br><span class="line">mp3decoder* <span class="title function_">mp3decoder::getInstance</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    lock();</span><br><span class="line">    <span class="keyword">if</span>(mdecoder == <span class="literal">NULL</span>)</span><br><span class="line">        mdecoder = new mp3decoder();</span><br><span class="line">    <span class="keyword">return</span> mdecoder;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//çº¿ç¨‹å®‰å…¨ï¼Œé”çš„ä»£ä»·å¤ªé«˜</span></span><br><span class="line">mp3decoder* <span class="title function_">mp3decoder::getInstance</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    lock();</span><br><span class="line">    <span class="keyword">if</span>(mdecoder == <span class="literal">NULL</span>)</span><br><span class="line">        mdecoder = new mp3decoder();</span><br><span class="line">    <span class="keyword">return</span> mdecoder;</span><br><span class="line">    unlock();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//Double-Checked Locking Pattern (DCLP åŒæ£€æŸ¥é”)ï¼ŒæŒ‡ä»¤é‡æ’åºreorderä¸å®‰å…¨</span></span><br><span class="line">mp3decoder* <span class="title function_">mp3decoder::getInstance</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (mdecoder == <span class="literal">NULL</span>) {</span><br><span class="line">        lock();</span><br><span class="line">    	<span class="keyword">if</span>(mdecoder == <span class="literal">NULL</span>)</span><br><span class="line">       		mdecoder = new mp3decoder();</span><br><span class="line">         unlock();</span><br><span class="line">    	<span class="keyword">return</span> mdecoder;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å†…å­˜å±éšœ</span></span><br><span class="line">mp3decoder* <span class="title function_">mp3decoder::getInstance</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (mdecoder == <span class="literal">NULL</span>) {</span><br><span class="line">    	<span class="keyword">if</span>(mdecoder == <span class="literal">NULL</span>) {</span><br><span class="line">            mp3decoder *tmp = new mp3decoder();</span><br><span class="line">            MemoryBarrier();</span><br><span class="line">            mdecoder = tmp;</span><br><span class="line">        }</span><br><span class="line">    	<span class="keyword">return</span> mdecoder;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// mdecoder = new mp3decoder()åœ¨cpuå±‚é¢åŠ¨ä½œï¼š</span></span><br><span class="line"><span class="comment">// 1. åˆ†é…å†…å­˜</span></span><br><span class="line"><span class="comment">// 2. è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">// 3. å°†å†…å­˜åœ°å€èµ‹å€¼ç»™mdecoderæŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// ç”±äº2ã€3å¯¹äºç¼–è¯‘å™¨æ¥è®²æ˜¯æœ‰å¯èƒ½è¿›è¡Œä¼˜åŒ–çš„ï¼Œå³å…ˆå°†æŒ‡é’ˆèµ‹å€¼å†è°ƒç”¨æ„é€ å‡½æ•°ï¼Œå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ï¼ï¼</span></span><br></pre></td></tr></tbody></table></figure>



<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<ul>
<li><a href="https://barrgroup.com/embedded-systems/how-to/c-volatile-keyword">How to Use Câ€™s volatile Keyword</a></li>
<li><a href="https://barrgroup.com/tech-talks/volatile-c">Pro Tips for Using Câ€™s volatile Keyword</a></li>
<li><a href="https://liam.page/2018/01/18/volatile-in-C-and-Cpp/">è°ˆè°ˆ c / c++ ä¸­çš„volatile</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>c/c++</category>
      </categories>
      <tags>
        <tag>volatile</tag>
      </tags>
  </entry>
  <entry>
    <title>libcéƒ¨åˆ†åº“å‡½æ•°è¯´æ˜</title>
    <url>/2023/05/17/language-grammar/libc-function/</url>
    <content><![CDATA[<h1 id="strtok"><a href="#strtok" class="headerlink" title="strtok"></a>strtok</h1><blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/liuintermilan/article/details/6280816">strtokå’Œstrtok_rçš„ä½¿ç”¨è¦ç‚¹å’Œå®ç°åŸç†</a> </p>
</blockquote>
<p><em><strong>å­—ç¬¦åˆ†éš”å‡½æ•°æœ€å¥½ä½¿ç”¨ strsep è€Œæœ€å¥½ä¸è¦ä½¿ç”¨strtok,</strong></em></p>
<p><em><strong>ç¬¬ä¸€ä¸ªå‚æ•°æºå­—ç¬¦ä¸²ä¸€å®šä¸ºå­—ç¬¦ä¸²æ•°ç»„å˜é‡ï¼Œä¸èƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡ã€‚å› ä¸ºå­—ç¬¦ä¸²å¸¸é‡ç¦æ­¢ä¿®æ”¹ï¼ï¼</strong></em></p>
<ul>
<li><p>å¤´æ–‡ä»¶ï¼š#include &lt;string.h&gt;</p>
<p>å£°æ˜ï¼šchar *strtok(char *str, const char *delim);</p>
</li>
<li><p>å‚æ•°åŠè¿”å›å€¼</p>
<p>æºå­—ç¬¦ä¸²æ•°ç»„æŒ‡é’ˆï¼Œåˆ†éš”ç¬¦å­—ç¬¦ä¸²æŒ‡é’ˆï¼›</p>
<p>æ”¾å›å€¼ä¸ºæŒ‡å‘è¢«åˆ†å‰²çš„å­ä¸²çš„æŒ‡é’ˆ</p>
</li>
<li><p>å‡½æ•°åŠŸèƒ½ï¼š</p>
<p>å¯¹å­—ç¬¦ä¸²sï¼Œä»¥delimä¸ºåˆ†éš”ç¬¦å°†såˆ‡åˆ†ä¸ºä¸€ä¸ªä¸ªå­ä¸²</p>
</li>
<li><p>å®ä¾‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span>* nbaName = <span class="string">"jordan,james,kobe,curry"</span>;</span><br><span class="line">    <span class="type">char</span> cbaName[] = <span class="string">"yaoMing,yijianLian,wangzhiZhi,zhouQi"</span>;</span><br><span class="line">    <span class="type">char</span> *ptr = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">char</span> name[<span class="number">32</span>] = {<span class="number">0</span>};</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1 </span></span><br><span class="line"><span class="comment">//    for(ptr=strtok(nbaName,","); ptr; ptr=strtok(NULL,","))  // error </span></span><br><span class="line">    <span class="keyword">for</span>(ptr=strtok(cbaName,<span class="string">","</span>); ptr; ptr=strtok(<span class="literal">NULL</span>,<span class="string">","</span>))    <span class="comment">// right</span></span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, ptr);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="built_in">memcpy</span>(name, nbaName, <span class="built_in">strlen</span>(nbaName));</span><br><span class="line">    <span class="keyword">for</span>(ptr=strtok(name,<span class="string">","</span>); ptr; ptr=strtok(<span class="literal">NULL</span>,<span class="string">","</span>))</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, ptr);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">} </span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h1 id="access"><a href="#access" class="headerlink" title="access"></a>access</h1><ol>
<li><p>linuxå¤´æ–‡ä»¶ :  &lt;unistd.h&gt;</p>
<p>å£°æ˜ : int access ( const char * pathname , int mode)</p>
</li>
<li><p>ä½œç”¨ :  è¯¥å‡½æ•°åŒæ¥åˆ¤æ–­æŒ‡å®šæ–‡ä»¶æˆ–è€…ç›®å½•æ˜¯å¦æœ‰modeå¯¹åº”çš„å±æ€§. æœ‰æ•ˆè¿”å›0, å¦åˆ™è¿”å›-1</p>
</li>
<li><p>å‚æ•°ä»‹ç»:</p>
<p>pathname æ—¶æ–‡ä»¶çš„è·¯å¾„åå­— + æ–‡ä»¶å</p>
<table>
<thead>
<tr>
<th>mode</th>
<th>value</th>
<th>meaning</th>
</tr>
</thead>
<tbody><tr>
<td>F_OK</td>
<td>0</td>
<td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>X_OK</td>
<td>1</td>
<td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰å¯æ‰§è¡Œæƒé™</td>
</tr>
<tr>
<td>W_OK</td>
<td>2</td>
<td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰å†™æƒé™</td>
</tr>
<tr>
<td>R_OK</td>
<td>3</td>
<td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰è¯»æƒé™</td>
</tr>
</tbody></table>
<blockquote>
<p>åé¢ä¸‰ç§å¯ä»¥é€šè¿‡â€œ | â€çš„æ–¹å¼ä¸€èµ·ä½¿ç”¨,ä¾‹å¦‚ :  W_OK | X_OK</p>
</blockquote>
</li>
<li><p>windowså¤´æ–‡ä»¶ : &lt;io.h&gt;</p>
<p>å£°æ˜ : int _access(const char* _Filename, int _AccessMode);</p>
<p>ä½¿ç”¨ä¸linuxåŒ, å­˜åœ¨(00)ã€ä»…è¯»(04)ã€ä»…å†™(02)ã€æ—¢å¯è¯»åˆå¯å†™(06)æƒé™</p>
<p>å¦‚æœmodeä¼ å…¥çš„å€¼ä¸æ˜¯0æˆ–2æˆ–4æˆ–6ï¼Œè°ƒç”¨æ­¤å‡½æ•°åˆ™ä¼šcrash</p>
</li>
</ol>
<h1 id="c-str"><a href="#c-str" class="headerlink" title="c_str( )"></a>c_str( )</h1><ol>
<li><p>c++ å¤´æ–‡ä»¶ : <iostream></iostream></p>
<p>å£°æ˜ : const char* c_str() const</p>
</li>
<li><p>è¿”å›å€¼: </p>
<p>c_str()å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘Cå­—ç¬¦ä¸²çš„æŒ‡é’ˆå¸¸é‡ï¼Œå³æ˜¯const char*çš„ï¼Œä¸èƒ½ç›´æ¥èµ‹å€¼ç»™char*<br>è¿™å°†ä¸cè¯­è¨€å…¼å®¹ï¼Œc_str()æŠŠstring å¯¹è±¡è½¬æ¢æˆcä¸­çš„å­—ç¬¦ä¸²æ ·å¼</p>
</li>
<li><p>ä½¿ç”¨æ–¹å¼</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">char</span> c[<span class="number">20</span>]; </span><br><span class="line"><span class="built_in">string</span> s=<span class="string">"1234"</span>; </span><br><span class="line"><span class="built_in">strcpy</span>(c,s.c_str()); </span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h1 id="strtoul"><a href="#strtoul" class="headerlink" title="strtoul( )"></a>strtoul( )</h1><ol>
<li>cå¤´æ–‡ä»¶&lt;stdlib.h&gt;</li>
</ol>
<p>   å£°æ˜ï¼šunsigned long int strtoul(const char *nptr, char **endptr, int base);<br>              unsigned long long int strtoull(const char *nptr, char **endptr,int base);</p>
<ol start="2">
<li><p>å‚æ•°åŠè¿”å›å€¼</p>
<ul>
<li>å‚æ•°nptrï¼šå­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€</li>
<li>å‚æ•°endptrï¼š è¿”å›å­—ç¬¦ä¸²æœ‰æ•ˆæ•°å­—çš„ç»“å°¾åœ°å€ã€‚å¦‚ 123456fe789 åˆ™è¿”å›æ•°å­—fçš„åœ°å€ã€‚</li>
<li>å‚æ•°baseï¼šè½¬åŒ–åŸºæ•°ã€‚å‚æ•° base èŒƒå›´ä»2 è‡³36ï¼Œæˆ–0ã€‚å‚æ•° base ä»£è¡¨ nptr é‡‡ç”¨çš„è¿›åˆ¶æ–¹å¼ï¼Œå¦‚ base å€¼ä¸º10 åˆ™é‡‡ç”¨ 10 è¿›åˆ¶ï¼Œè‹¥ base å€¼ä¸º16 åˆ™é‡‡ç”¨16 è¿›åˆ¶æ•°ç­‰ã€‚</li>
</ul>
</li>
<li><p>åŠŸèƒ½æè¿°</p>
<p>   convert a string to an unsigned long integer(æŠŠè¾“å…¥çš„å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—).<br>      strtoul() ä¼šæ‰«æå‚æ•°nptr å­—ç¬¦ä¸²ï¼Œè·³è¿‡å‰é¢çš„ç©ºç™½å­—ç¬¦ï¼ˆä¾‹å¦‚ç©ºæ ¼ï¼Œtabç¼©è¿›ç­‰ï¼Œå¯ä»¥é€šè¿‡ isspace() å‡½æ•°æ¥æ£€æµ‹ï¼‰ï¼Œç›´åˆ°é‡ä¸Šæ•°å­—æˆ–æ­£è´Ÿç¬¦å·æ‰å¼€å§‹åšè½¬æ¢ï¼Œå†é‡åˆ°éæ•°å­—æˆ–å­—ç¬¦ä¸²ç»“æŸæ—¶(â€˜\0â€™)ç»“æŸè½¬æ¢ï¼Œå¹¶å°†ç»“æœè¿”å›ã€‚</p>
</li>
<li><p>æ³¨æ„</p>
<ul>
<li>å½“ base çš„å€¼ä¸º 0 æ—¶ï¼Œé»˜è®¤é‡‡ç”¨ 10 è¿›åˆ¶è½¬æ¢ï¼Œä½†å¦‚æœé‡åˆ° â€˜0xâ€™ / â€˜0Xâ€™ å‰ç½®å­—ç¬¦åˆ™ä¼šä½¿ç”¨ 16 è¿›åˆ¶è½¬æ¢ï¼Œé‡åˆ° â€˜0â€™ å‰ç½®å­—ç¬¦åˆ™ä¼šä½¿ç”¨ 8 è¿›åˆ¶è½¬æ¢ã€‚</li>
<li>è‹¥ endptr ä¸ä¸ºNULLï¼Œåˆ™ä¼šå°†é‡åˆ°çš„ä¸ç¬¦åˆæ¡ä»¶è€Œç»ˆæ­¢çš„å­—ç¬¦æŒ‡é’ˆç”± endptr ä¼ å›ï¼›è‹¥ endptr ä¸º NULLï¼Œåˆ™è¡¨ç¤ºè¯¥å‚æ•°æ— æ•ˆï¼Œæˆ–ä¸ä½¿ç”¨è¯¥å‚æ•°ã€‚æœ¬æ–‡æœ€åçš„èŒƒä¾‹æ²¡æœ‰å±•ç¤º endptr å‚æ•°çš„ä½¿ç”¨ï¼Œä½ å¯ä»¥å‚è€ƒ strtol() å‡½æ•°çš„èŒƒä¾‹æ¥æ›´åŠ ç›´è§‚åœ°äº†è§£ endptr å‚æ•°ã€‚</li>
</ul>
</li>
<li><p>å®ä¾‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span> </span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">()</span> </span><br><span class="line">{   </span><br><span class="line">	<span class="type">char</span> buffer [<span class="number">256</span>];   </span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> ul; </span><br><span class="line">    <span class="type">char</span> * endptr;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	{</span><br><span class="line">	   <span class="built_in">printf</span> (<span class="string">"Enter an unsigned number: "</span>);  </span><br><span class="line">	   fgets (buffer, <span class="number">256</span>, <span class="built_in">stdin</span>);   </span><br><span class="line">	   ul = strtoul (buffer, &amp;endptr, <span class="number">10</span>);   </span><br><span class="line">       <span class="built_in">printf</span> (<span class="string">"Value entered: %lu ,the address of the first invalid character is %d ,invalid character=%s\n"</span>, ul,endptr,endptr);   </span><br><span class="line">	   system(<span class="string">"pause"</span>); </span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">} </span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h1 id="snprintf"><a href="#snprintf" class="headerlink" title="snprintf( )"></a>snprintf( )</h1><ol>
<li><p>cå¤´æ–‡ä»¶ ï¼š &lt;stdio.h&gt;</p>
<p>å£°æ˜ï¼šint snprintf(char *str, size_t size, const char *format, â€¦);</p>
</li>
<li><p>å‚æ•°åŠè¿”å›å€¼</p>
<p>strä¸ºè¦å†™å…¥çš„å­—ç¬¦ä¸²ï¼›nä¸ºè¦å†™å…¥çš„å­—ç¬¦çš„æœ€å¤§æ•°ç›®ï¼Œè¶…è¿‡nä¼šè¢«æˆªæ–­ï¼›formatä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¸printf()å‡½æ•°ç›¸åŒï¼›argumentä¸ºå˜é‡ã€‚</p>
<p>æˆåŠŸåˆ™è¿”å›å‚æ•°str å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¤±è´¥åˆ™è¿”å›-1ï¼Œé”™è¯¯åŸå› å­˜äºerrno ä¸­ã€‚</p>
</li>
<li><p>å‡½æ•°åŠŸèƒ½</p>
<p>å†™å…¥å­—ç¬¦ä¸²</p>
</li>
<li><p>å®ä¾‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> str[<span class="number">5</span>];</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">snprintf</span>(str, <span class="number">3</span>, <span class="string">"%s"</span>, <span class="string">"abcdefg"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ret);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>,str);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h1 id="fork-x2F-exec"><a href="#fork-x2F-exec" class="headerlink" title="fork/exec"></a>fork/exec</h1><ul>
<li><p>fork</p>
<p>è°ƒç”¨forkå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ç§°ä¸ºå­è¿›ç¨‹, è°ƒç”¨forkå‡½æ•°çš„è¿›ç¨‹ç§°ä¸ºçˆ¶è¿›ç¨‹, å­è¿›ç¨‹çš„æ‰€æœ‰å†…å®¹éƒ½å’Œçˆ¶è¿›ç¨‹ç›¸åŒ, é™¤äº†pcb(è¿›ç¨‹æ§åˆ¶æ¨¡å—)ã€‚å¦‚æœè¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½æ²¡æœ‰å¯¹å†…å­˜åšå†™æ“ä½œçš„è¯, é‚£ä¹ˆä¸¤ä¸ªè¿›ç¨‹å…±äº«è°ƒç”¨forkå‡½æ•°çš„è¿›ç¨‹çš„å†…å­˜é¡µ, è¿™æ ·è¡¨é¢ä¸Šçœ‹forkåˆ›å»ºè¿›ç¨‹æ¯”execåˆ›å»ºè¿›ç¨‹å¿«. ä½†åªè¦ä¸¤ä¸ªè¿›ç¨‹å…¶ä¸­ä¸€ä¸ªå¯¹å†…å­˜åšäº†ä¿®æ”¹, é‚£ä¹ˆåœ¨ä¿®æ”¹ä¹‹å‰, å°±ä¼šæŠŠå†…å­˜é¡µå¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ç”¨ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰</p>
</li>
<li><p>exec</p>
<p>è°ƒç”¨execåˆ›å»ºè¿›ç¨‹, å®é™…ä¸Šä¸æ˜¯åˆ›å»ºè¿›ç¨‹, æ›´å‡†ç¡®çš„è¯´æ˜¯åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶, è°ƒç”¨execåä¼šæŠŠexecä¸­æŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½åˆ°è°ƒç”¨execçš„è¿›ç¨‹çš„ç©ºé—´å†…, å¹¶æŠŠè°ƒç”¨execçš„è¿›ç¨‹çš„å†…å­˜æ›´æ–°ä¸ºexecä¸­æŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶çš„å†…å®¹.</p>
</li>
</ul>
]]></content>
      <categories>
        <category>c/c++</category>
      </categories>
  </entry>
  <entry>
    <title>CMake &amp;&amp; Makefile</title>
    <url>/2022/08/25/tools/cmake/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>å®˜ç½‘ : <a href="https://cmake.org/cmake/help/v3.15/">https://cmake.org/cmake/help/v3.15/</a></p>
</blockquote>
<p>CMakeæ˜¯è·¨å¹³å°çš„ å…è´¹å’Œå¼€æºè½¯ä»¶ï¼Œç”¨äºä½¿ç”¨ç‹¬ç«‹äºç¼–è¯‘å™¨çš„æ–¹æ³•æ„å»ºè‡ªåŠ¨åŒ–ã€æµ‹è¯•ã€æ‰“åŒ…å’Œå®‰è£…è½¯ä»¶ã€‚CMake æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªæ„å»ºç³»ç»Ÿï¼›å®ƒç”Ÿæˆå¦ä¸€ä¸ªç³»ç»Ÿçš„æ„å»ºæ–‡ä»¶ã€‚å®ƒæ”¯æŒç›®å½•å±‚æ¬¡ç»“æ„å’Œä¾èµ–äºå¤šä¸ªåº“çš„åº”ç”¨ç¨‹åºã€‚å®ƒä¸åŸç”Ÿæ„å»ºç¯å¢ƒç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚Makeã€Qt Creatorã€Ninjaã€Android Studioã€Apple çš„Xcodeå’ŒMicrosoft Visual Studioã€‚ï¼ˆæ‘˜è‡ªWikiï¼‰</p>
<h1 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h1><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><ol>
<li><p>cmakeè¦æ±‚æœ€ä½ç‰ˆæœ¬(é€‰æ‹©æ€§æ·»åŠ )</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">cmake_minimum_required(VERSION <span class="number">3.0</span><span class="number">.0</span>)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ç¼–è¯‘å·¥ç¨‹å</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">project(xxx)</span><br><span class="line"><span class="comment">//ä¼šè‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªå˜é‡ï¼ŒPROJECT_SOURCE_DIRå’ŒPROJECT_NAME</span></span><br><span class="line"><span class="comment">//${PROJECT_SOURCE_DIR}ï¼šæœ¬CMakeLists.txtæ‰€åœ¨çš„æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class="line"><span class="comment">//${PROJECT_NAME}ï¼šæœ¬CMakeLists.txtçš„projectåç§°</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ç»™éƒ¨åˆ†æ–‡ä»¶æˆ–è·¯å¾„ç»„åˆèµ·åˆ«å, é€šè¿‡${å˜é‡}è·å–å˜é‡å†…å®¹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">set</span>(å˜é‡ æ–‡ä»¶å/è·¯å¾„/...)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>è®¾ç½®c / c++ ç¼–è¯‘ç¼–è¯‘å‚æ•°</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> (CMAKE_C_FLAGS <span class="string">"-Wall -O2"</span>)</span><br><span class="line"><span class="built_in">set</span> (CMAKE_CXX_FLAGS <span class="string">"-Wall -std=C++11"</span>)</span><br><span class="line">add_compile_options( -Wall )				<span class="comment">//è¯¥å‘½ä»¤è¯‘é€‰é¡¹æ˜¯é’ˆå¯¹æ‰€æœ‰ç¼–è¯‘å™¨çš„(åŒ…æ‹¬cå’Œc++ç¼–è¯‘å™¨)</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ä¸ºå½“å‰è·¯å¾„ä»¥åŠå­ç›®å½•çš„æºæ–‡ä»¶åŠ å…¥ç”±-Då¼•å…¥çš„define flag</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">add_definitions(-DFOO -DDEBUG ...)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å¯¹å­æ–‡ä»¶å¤¹è¿›è¡Œcmakeç¼–è¯‘</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">add_subdirectory(å­æ–‡ä»¶å¤¹å) </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>æ‰“å°ä¿¡æ¯</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">message() 			<span class="comment">//ç›´æ¥æ·»åŠ æ‰“å°çš„å†…å®¹å’Œå˜é‡å³å¯,ä¸éœ€è¦åŒå¼•å·</span></span><br><span class="line">message(<span class="string">"PROJECT_SOURCE_DIR = ${PROJECT_SOURCE_DIR}"</span>)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å¸®åŠ©ä¿¡æ¯ </p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1.</span> æŸ¥çœ‹cmakeé»˜è®¤å˜é‡		cmake --help-variable-<span class="built_in">list</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h2 id="åˆ¤æ–­è¯­å¥"><a href="#åˆ¤æ–­è¯­å¥" class="headerlink" title="åˆ¤æ–­è¯­å¥"></a>åˆ¤æ–­è¯­å¥</h2><p>ç”¨æ³•ï¼šæ ¹æ®æŸä¸ªå®ç¡®å®šç¼–è¯‘å†…å®¹ã€‚æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œç›¸åŒè¿”å›true</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (CPU_PLATFORM_BIT STREQUAL <span class="string">"64"</span>)</span><br><span class="line">    add_library(mylib generic_64bit.c)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    add_library(mylib generic_32bit.c)</span><br><span class="line">endif()  </span><br></pre></td></tr></tbody></table></figure>

<h2 id="ç¼–è¯‘ç›®æ ‡"><a href="#ç¼–è¯‘ç›®æ ‡" class="headerlink" title="ç¼–è¯‘ç›®æ ‡"></a>ç¼–è¯‘ç›®æ ‡</h2><h3 id="äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="äºŒè¿›åˆ¶æ–‡ä»¶"></a>äºŒè¿›åˆ¶æ–‡ä»¶</h3><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">add_executable(ç›®æ ‡æ–‡ä»¶åå­—xxx æºæ–‡ä»¶)</span><br><span class="line"><span class="comment">//example: add_executable(${PROJECT_NAME} example_person.cpp)</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="åŠ¨æ€-x2F-é™æ€åº“"><a href="#åŠ¨æ€-x2F-é™æ€åº“" class="headerlink" title="åŠ¨æ€ / é™æ€åº“"></a>åŠ¨æ€ / é™æ€åº“</h3><p>å°†æŒ‡å®šçš„æºæ–‡ä»¶ç”Ÿæˆé“¾æ¥æ–‡ä»¶ï¼Œç„¶åæ·»åŠ åˆ°å·¥ç¨‹ä¸­å»</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">add_library(&lt;name&gt; [STATIC | SHARED | MODULE]</span><br><span class="line">[EXCLUDE_FROM_ALL]</span><br><span class="line">[source1] [source2] [...])</span><br><span class="line"></span><br><span class="line"><span class="comment">//&lt;name&gt;è¡¨ç¤ºåº“æ–‡ä»¶çš„åå­—ï¼Œè¯¥åº“æ–‡ä»¶ä¼šæ ¹æ®å‘½ä»¤é‡Œåˆ—å‡ºçš„æºæ–‡ä»¶æ¥åˆ›å»ºã€‚ç”Ÿæˆçš„åº“è‡ªåŠ¨è¡¥å…¨,å¦‚libxxx.so </span></span><br><span class="line"><span class="comment">//STATICã€SHAREDå’ŒMODULEçš„ä½œç”¨æ˜¯æŒ‡å®šç”Ÿæˆçš„åº“æ–‡ä»¶çš„ç±»å‹ã€‚STATICåº“æ˜¯ç›®æ ‡æ–‡ä»¶çš„å½’æ¡£æ–‡ä»¶ï¼Œåœ¨é“¾æ¥å…¶å®ƒç›®æ ‡çš„æ—¶å€™ä½¿ç”¨ã€‚SHAREDåº“ä¼šè¢«	åŠ¨æ€é“¾æ¥ï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰ï¼Œåœ¨è¿è¡Œæ—¶ä¼šè¢«åŠ è½½ã€‚MODULEåº“æ˜¯ä¸€ç§ä¸ä¼šè¢«é“¾æ¥åˆ°å…¶å®ƒç›®æ ‡ä¸­çš„æ’ä»¶ï¼Œä½†æ˜¯å¯èƒ½ä¼šåœ¨è¿è¡Œæ—¶ä½¿ç”¨dlopen-ç³»åˆ—çš„å‡½æ•°	ã€‚é»˜è®¤çŠ¶æ€ä¸‹ï¼Œåº“æ–‡ä»¶å°†ä¼šåœ¨äºæºæ–‡ä»¶ç›®å½•æ ‘çš„æ„å»ºç›®å½•æ ‘çš„ä½ç½®è¢«åˆ›å»ºï¼Œè¯¥å‘½ä»¤ä¹Ÿä¼šåœ¨è¿™é‡Œè¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">//source1 source2åˆ†åˆ«è¡¨ç¤ºå„ä¸ªæºæ–‡ä»¶</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="é“¾æ¥-x2F-è·¯å¾„"><a href="#é“¾æ¥-x2F-è·¯å¾„" class="headerlink" title="é“¾æ¥/è·¯å¾„"></a>é“¾æ¥/è·¯å¾„</h2><h3 id="å¤´æ–‡ä»¶è·¯å¾„"><a href="#å¤´æ–‡ä»¶è·¯å¾„" class="headerlink" title="å¤´æ–‡ä»¶è·¯å¾„"></a>å¤´æ–‡ä»¶è·¯å¾„</h3><p>æ·»åŠ å¤´æ–‡ä»¶çš„æŸ¥æ‰¾è·¯å¾„, ç›¸å½“äºå‘½ä»¤è¡Œçš„  <em><strong>-l</strong></em> å‚æ•°</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">include_directories(../thirdparty/comm/include)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="é“¾æ¥åº“è·¯å¾„"><a href="#é“¾æ¥åº“è·¯å¾„" class="headerlink" title="é“¾æ¥åº“è·¯å¾„"></a>é“¾æ¥åº“è·¯å¾„</h3><p>æ·»åŠ éœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶ç›®å½•, ç›¸å½“äºå‘½ä»¤è¡Œ <em><strong>-L</strong></em> å‚æ•°</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">link_directories(<span class="string">"/home/server/third/lib"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="é“¾æ¥åº“"><a href="#é“¾æ¥åº“" class="headerlink" title="é“¾æ¥åº“"></a>é“¾æ¥åº“</h3><p> å°†ç›®æ ‡æ–‡ä»¶ä¸åº“æ–‡ä»¶è¿›è¡Œé“¾æ¥</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">target_link_libraries(&lt;target&gt; [item1] [item2] [...] [[debug|optimized|general] &lt;item&gt;] ...)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//&lt;target&gt;æ˜¯æŒ‡é€šè¿‡add_executable()å’Œadd_library()æŒ‡ä»¤ç”Ÿæˆå·²ç»åˆ›å»ºçš„ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//[item]è¡¨ç¤ºåº“æ–‡ä»¶æ²¡æœ‰åç¼€çš„åå­—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåº“ä¾èµ–é¡¹æ˜¯ä¼ é€’çš„ã€‚å½“è¿™ä¸ªç›®æ ‡é“¾æ¥åˆ°å¦ä¸€ä¸ªç›®æ ‡æ—¶ï¼Œé“¾æ¥åˆ°è¿™ä¸ªç›®æ ‡çš„åº“ä¹Ÿä¼šå‡ºç°åœ¨å¦ä¸€ä¸ªç›®æ ‡çš„è¿æ¥çº¿ä¸Šã€‚è¿™ä¸ªä¼ é€’çš„æ¥å£å­˜å‚¨åœ¨interface_link_librariesçš„ç›®æ ‡å±æ€§ä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®è¯¥å±æ€§ç›´æ¥é‡å†™ä¼ é€’æ¥å£ã€‚</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="å®‰è£…ï¼ˆInstallï¼‰"><a href="#å®‰è£…ï¼ˆInstallï¼‰" class="headerlink" title="å®‰è£…ï¼ˆInstallï¼‰"></a>å®‰è£…ï¼ˆInstallï¼‰</h2><ul>
<li>è¯¦æƒ…å‚è€ƒï¼š<a href="https://cmake.org/cmake/help/v3.22/command/install.html">https://cmake.org/cmake/help/v3.22/command/install.html</a></li>
<li>ä½œç”¨ï¼šç”¨äºå®šä¹‰å®‰è£…è§„åˆ™ï¼Œå®‰è£…å†…å®¹åŒ…æ‹¬å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé™æ€åº“ï¼ŒåŠ¨æ€åº“ä»¥åŠæ–‡ä»¶ï¼Œç›®å½•ï¼Œè„šæœ¬ç­‰</li>
<li>ä½¿ç”¨æ–¹æ³•ï¼šmake install</li>
<li>ç›®æ ‡å®‰è£…è·¯å¾„ï¼š${CMAKE_INSTALL_PREFIX}æŒ‡å®šï¼Œé»˜è®¤/usr/local</li>
</ul>
<h3 id="ç›®æ ‡æ–‡ä»¶å®‰è£…"><a href="#ç›®æ ‡æ–‡ä»¶å®‰è£…" class="headerlink" title="ç›®æ ‡æ–‡ä»¶å®‰è£…"></a>ç›®æ ‡æ–‡ä»¶å®‰è£…</h3><p>ç›®æ ‡æ–‡ä»¶æŒ‡çš„æ˜¯æˆ‘ä»¬é€šè¿‡ add_executable / add_library å¾—åˆ°çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…åº“ï¼Œåªæœ‰è¿™äº›æ–‡ä»¶æ‰å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è£…è½½åˆ°ç›¸åº”çš„ä½ç½®</p>
<ul>
<li>å¯æ‰§è¡Œæ–‡ä»¶ï¼šRUNTIME</li>
<li>åŠ¨æ€åº“ï¼šLIBRARY</li>
<li>é™æ€åº“ï¼šARCHIVE</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">install(TARGETS targets... [EXPORT &lt;export-name&gt;]</span><br><span class="line">        [RUNTIME_DEPENDENCIES args...|RUNTIME_DEPENDENCY_SET &lt;<span class="built_in">set</span>-name&gt;]</span><br><span class="line">        [[ARCHIVE|LIBRARY|RUNTIME|OBJECTS|FRAMEWORK|BUNDLE|</span><br><span class="line">          PRIVATE_HEADER|PUBLIC_HEADER|RESOURCE]</span><br><span class="line">         [DESTINATION &lt;dir&gt;]</span><br><span class="line">         [PERMISSIONS permissions...]</span><br><span class="line">         [CONFIGURATIONS [Debug|Release|...]]</span><br><span class="line">         [COMPONENT &lt;component&gt;]</span><br><span class="line">         [NAMELINK_COMPONENT &lt;component&gt;]</span><br><span class="line">         [OPTIONAL] [EXCLUDE_FROM_ALL]</span><br><span class="line">         [NAMELINK_ONLY|NAMELINK_SKIP]</span><br><span class="line">        ] [...]</span><br><span class="line">        [INCLUDES DESTINATION [&lt;dir&gt; ...]]</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line"><span class="comment">// example:</span></span><br><span class="line">install(TARGETS mybin mystaiclib mydynamiclib</span><br><span class="line">        RUNTIME DESTINATION bin</span><br><span class="line">        ARCHIVE DESTINATION lib</span><br><span class="line">        LIBRARY DESTINATION lib)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æ™®é€šæ–‡ä»¶å®‰è£…"><a href="#æ™®é€šæ–‡ä»¶å®‰è£…" class="headerlink" title="æ™®é€šæ–‡ä»¶å®‰è£…"></a>æ™®é€šæ–‡ä»¶å®‰è£…</h3><p>æ™®é€šæ–‡ä»¶å³éœ€è¦å¯¼å‡ºçš„å¤´æ–‡ä»¶ã€ä¾èµ–çš„ä¸‰æ–¹åº“ç­‰ç­‰ï¼Œè¯¥å‘½ä»¤åŒæ—¶å¯ä»¥æŒ‡å®šå¯¼å‡ºæ–‡ä»¶çš„æƒé™ï¼ˆé»˜è®¤644ï¼‰</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">install(&lt;FILES|PROGRAMS&gt; files...</span><br><span class="line">        TYPE &lt;type&gt; | DESTINATION &lt;dir&gt;</span><br><span class="line">        [PERMISSIONS permissions...]</span><br><span class="line">        [CONFIGURATIONS [Debug|Release|...]]</span><br><span class="line">        [COMPONENT &lt;component&gt;]</span><br><span class="line">        [RENAME &lt;name&gt;] [OPTIONAL] [EXCLUDE_FROM_ALL])</span><br><span class="line">        </span><br><span class="line"><span class="comment">// example</span></span><br><span class="line">install(FILES mylib.h DESTINATION include)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ç›®å½•å®‰è£…"><a href="#ç›®å½•å®‰è£…" class="headerlink" title="ç›®å½•å®‰è£…"></a>ç›®å½•å®‰è£…</h3><p>å‚æ•°ä»‹ç»ï¼š</p>
<ul>
<li>DIRECTORYï¼šåé¢è¿æ¥çš„æ˜¯æ‰€åœ¨Sourceç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼ˆç»“å°¾æ˜¯å¦æ˜¯â€/â€œå¯¹æ‹·è´ç»“æœæœ‰ä¸€å®šå½±å“ï¼‰</li>
<li>PATTERNï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè¿‡æ»¤</li>
<li>PERMISSIONSï¼šæŒ‡å®šPATTERNè¿‡æ»¤åçš„æ–‡ä»¶æƒé™ã€‚</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">install(DIRECTORY dirs...</span><br><span class="line">        TYPE &lt;type&gt; | DESTINATION &lt;dir&gt;</span><br><span class="line">        [FILE_PERMISSIONS permissions...]</span><br><span class="line">        [DIRECTORY_PERMISSIONS permissions...]</span><br><span class="line">        [USE_SOURCE_PERMISSIONS] [OPTIONAL] [MESSAGE_NEVER]</span><br><span class="line">        [CONFIGURATIONS [Debug|Release|...]]</span><br><span class="line">        [COMPONENT &lt;component&gt;] [EXCLUDE_FROM_ALL]</span><br><span class="line">        [FILES_MATCHING]</span><br><span class="line">        [[PATTERN &lt;pattern&gt; | REGEX &lt;regex&gt;]</span><br><span class="line">         [EXCLUDE] [PERMISSIONS permissions...]] [...])</span><br><span class="line"></span><br><span class="line"><span class="comment">// example</span></span><br><span class="line">install(DIRECTORY src/ DESTINATION include/myproj  FILES_MATCHING PATTERN <span class="string">"*.h"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><ol>
<li><p>Q: ç¼–è¯‘å‚æ•°æ·»åŠ äº†-lpthread å‚æ•°, ä½†æ˜¯è¿˜æ˜¯æŠ¥undefined reference to `pthread_createâ€™ </p>
<p>A : éœ€è¦ä½¿ç”¨target_link_libraries( target thread) åœ¨è¿™é‡Œé“¾æ¥threadåº“</p>
</li>
<li><p>Q: å¦‚æœåœ¨å¤šçº§çš„ç›®å½•ä¸‹ç¼–è¯‘, å§‹ç»ˆæ‰¾ä¸åˆ°é—®é¢˜æŠ¥ undefineçš„é—®é¢˜ ?</p>
<p>A : çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯é“¾æ¥çš„åº“æˆ–ç›®æ ‡æ–‡ä»¶æ ¼å¼ä¸åŒ, ä¸€ä¸ªc ä¸€ä¸ªc++ , è¿™æ ·å°±ä¼šå¯¼è‡´æ‰¾ä¸åˆ°ç¬¦å·é”™è¯¯</p>
</li>
<li><p>Q: undefined reference to `typeinfo for xxxBase_classâ€™ ?</p>
<p>A: åŸºç±»çš„æ„é€ å’Œææ„å‡½æ•°éœ€è¦åŠ { };  å¦åˆ™å°±ä¼šæŠ¥è¿™ä¸ªé—®é¢˜</p>
</li>
</ol>
<h1 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h1><h2 id="åŸºæœ¬"><a href="#åŸºæœ¬" class="headerlink" title="åŸºæœ¬"></a>åŸºæœ¬</h2><h3 id="PHYON"><a href="#PHYON" class="headerlink" title="PHYON"></a>PHYON</h3><p>.PHONY åœ¨ makefile ä¸­è¡¨ç¤ºå®šä¹‰ä¼ªç›®æ ‡ã€‚æ‰€è°“ä¼ªç›®æ ‡ï¼Œå°±æ˜¯å®ƒä¸ä»£è¡¨ä¸€ä¸ªçœŸæ­£çš„æ–‡ä»¶åï¼Œåœ¨æ‰§è¡Œ make æ—¶å¯ä»¥æŒ‡å®šè¿™ä¸ªç›®æ ‡æ¥æ‰§è¡Œå…¶æ‰€åœ¨è§„åˆ™å®šä¹‰çš„å‘½ä»¤</p>
<h2 id="èµ‹å€¼è¯­å¥"><a href="#èµ‹å€¼è¯­å¥" class="headerlink" title="èµ‹å€¼è¯­å¥"></a>èµ‹å€¼è¯­å¥</h2><ul>
<li><p>=</p>
<p>æœ€åŸºæœ¬çš„èµ‹å€¼æ–¹å¼ï¼Œè¯­å¥ä¸åœ¨æ–‡ä¸­çš„ä½ç½®æ— å…³ï¼Œç³»ç»Ÿè‡ªåŠ¨æ¨å¯¼å°†æœ€ç»ˆçš„èµ‹å€¼ä½œä¸ºå˜é‡çš„å€¼</p>
<figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line">str=123</span><br><span class="line"><span class="section">target:</span></span><br><span class="line">	@echo  <span class="variable">$(str)</span></span><br><span class="line">str=456</span><br><span class="line"><span class="comment"># æœ€ç»ˆç»“æœï¼š456</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ï¼š=</p>
<p>è¦†ç›–å¼èµ‹å€¼ã€‚å¦‚æœå˜é‡åœ¨ä¹‹å‰å®šä¹‰èµ‹å€¼è¿‡ï¼Œæœ¬æ¬¡çš„å€¼å°†æ›´æ–°å˜é‡ã€‚è¯¥ç¬¦å·èµ‹å€¼åªèƒ½æ¨å¯¼è¯¥ç¬¦å·ä½ç½®ä¹‹å‰çš„å€¼</p>
<figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line">str:=<span class="variable">$(str1)</span>123</span><br><span class="line">str1=456</span><br><span class="line"><span class="section">target:</span></span><br><span class="line">	@echo  <span class="variable">$(str)</span></span><br><span class="line"><span class="comment"># æœ€ç»ˆç»“æœï¼š123ï¼ˆå°†stré»˜è®¤ä¸ºç©ºå­—ç¬¦ï¼‰</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ï¼Ÿ=</p>
<p>å¦‚æœå½“å‰å˜é‡åœ¨ä¹‹å‰è¢«èµ‹å€¼è¿‡ï¼Œåˆ™æ­¤æ¬¡èµ‹å€¼ä¸æ‰§è¡Œï¼Œå¦åˆ™æ‰§è¡Œ</p>
<figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line">str=123</span><br><span class="line">str?=456</span><br><span class="line"><span class="section">target:</span></span><br><span class="line">	@echo  <span class="variable">$(str)</span></span><br><span class="line"><span class="comment"># æœ€ç»ˆç»“æœ 123</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>+=</p>
<p>è¿½åŠ èµ‹å€¼ã€‚æ—§å€¼ä¿æŒä¸å˜ï¼Œå°†æ–°å€¼é»è´´åˆ°æ—§å€¼åé¢</p>
<figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line">str=123</span><br><span class="line">str+=456</span><br><span class="line"><span class="section">target:</span></span><br><span class="line">	@echo  <span class="variable">$(str)</span></span><br><span class="line"><span class="comment"># æœ€ç»ˆç»“æœï¼š123 456</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h2 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦"></a>é€šé…ç¬¦</h2><table>
<thead>
<tr>
<th>é€šé…ç¬¦</th>
<th>ä½¿ç”¨è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>åŒ¹é…0ä¸ªæˆ–è€…æ˜¯ä»»æ„ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>?</td>
<td>åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>[]</td>
<td>æˆ‘ä»¬å¯ä»¥æŒ‡å®šåŒ¹é…çš„å­—ç¬¦æ”¾åœ¨ â€œ[]â€ ä¸­</td>
</tr>
<tr>
<td>%</td>
<td>åŒ¹é…ä»»æ„ä¸ªå­—ç¬¦</td>
</tr>
</tbody></table>
<h2 id="è‡ªåŠ¨åŒ–å˜é‡"><a href="#è‡ªåŠ¨åŒ–å˜é‡" class="headerlink" title="è‡ªåŠ¨åŒ–å˜é‡"></a>è‡ªåŠ¨åŒ–å˜é‡</h2><table>
<thead>
<tr>
<th>è‡ªåŠ¨åŒ–å˜é‡</th>
<th align="center">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>$@</td>
<td align="center">è¡¨ç¤ºè§„åˆ™çš„ç›®æ ‡æ–‡ä»¶åã€‚å¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªæ–‡æ¡£æ–‡ä»¶ï¼ˆLinux ä¸­ï¼Œä¸€èˆ¬æˆ .a æ–‡ä»¶ä¸ºæ–‡æ¡£æ–‡ä»¶ï¼Œä¹Ÿæˆä¸ºé™æ€çš„åº“æ–‡ä»¶ï¼‰ï¼Œ é‚£ä¹ˆå®ƒä»£è¡¨è¿™ä¸ªæ–‡æ¡£çš„æ–‡ä»¶åã€‚åœ¨å¤šç›®æ ‡æ¨¡å¼è§„åˆ™ä¸­ï¼Œå®ƒä»£è¡¨çš„æ˜¯è§¦å‘è§„åˆ™è¢«æ‰§è¡Œçš„æ–‡ä»¶åã€‚</td>
</tr>
<tr>
<td>$%</td>
<td align="center">å½“ç›®æ ‡æ–‡ä»¶æ˜¯ä¸€ä¸ªé™æ€åº“æ–‡ä»¶æ—¶ï¼Œä»£è¡¨é™æ€åº“çš„ä¸€ä¸ªæˆå‘˜åã€‚</td>
</tr>
<tr>
<td>$&lt;</td>
<td align="center">è§„åˆ™çš„ç¬¬ä¸€ä¸ªä¾èµ–çš„æ–‡ä»¶åã€‚å¦‚æœæ˜¯ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ä½¿ç”¨éšå«çš„è§„åˆ™æ¥é‡å»ºï¼Œåˆ™å®ƒä»£è¡¨ç”±éšå«è§„åˆ™åŠ å…¥çš„ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>$?</td>
<td align="center">æ‰€æœ‰æ¯”ç›®æ ‡æ–‡ä»¶æ›´æ–°çš„ä¾èµ–æ–‡ä»¶åˆ—è¡¨ï¼Œç©ºæ ¼åˆ†éš”ã€‚å¦‚æœç›®æ ‡æ–‡ä»¶æ—¶é™æ€åº“æ–‡ä»¶ï¼Œä»£è¡¨çš„æ˜¯åº“æ–‡ä»¶ï¼ˆ.o æ–‡ä»¶ï¼‰ã€‚</td>
</tr>
<tr>
<td>$^</td>
<td align="center">ä»£è¡¨çš„æ˜¯æ‰€æœ‰ä¾èµ–æ–‡ä»¶åˆ—è¡¨ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚å¦‚æœç›®æ ‡æ˜¯é™æ€åº“æ–‡ä»¶ï¼Œå®ƒæ‰€ä»£è¡¨çš„åªèƒ½æ˜¯æ‰€æœ‰çš„åº“æˆå‘˜ï¼ˆ.o æ–‡ä»¶ï¼‰åã€‚ ä¸€ä¸ªæ–‡ä»¶å¯é‡å¤çš„å‡ºç°åœ¨ç›®æ ‡çš„ä¾èµ–ä¸­ï¼Œå˜é‡  $ åªè®°å½•å®ƒçš„ç¬¬ä¸€æ¬¡å¼•ç”¨çš„æƒ…å†µã€‚å°±æ˜¯è¯´å˜é‡ $ ä¼šå»æ‰é‡å¤çš„ä¾èµ–æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>$+</td>
<td align="center">ç±»ä¼¼â€œ$^â€ï¼Œä½†æ˜¯å®ƒä¿ç•™äº†ä¾èµ–æ–‡ä»¶ä¸­é‡å¤å‡ºç°çš„æ–‡ä»¶ã€‚ä¸»è¦ç”¨åœ¨ç¨‹åºé“¾æ¥æ—¶åº“çš„äº¤å‰å¼•ç”¨åœºåˆã€‚</td>
</tr>
<tr>
<td>$*</td>
<td align="center">åœ¨æ¨¡å¼è§„åˆ™å’Œé™æ€æ¨¡å¼è§„åˆ™ä¸­ï¼Œä»£è¡¨â€œèŒâ€ã€‚â€œèŒâ€æ˜¯ç›®æ ‡æ¨¡å¼ä¸­â€œ%â€æ‰€ä»£è¡¨çš„éƒ¨åˆ†ï¼ˆå½“æ–‡ä»¶åä¸­å­˜åœ¨ç›®å½•æ—¶ï¼Œ â€œèŒâ€ä¹ŸåŒ…å«ç›®å½•éƒ¨åˆ†ï¼‰ã€‚</td>
</tr>
</tbody></table>
<h2 id="ç‰¹æ®Šå‡½æ•°"><a href="#ç‰¹æ®Šå‡½æ•°" class="headerlink" title="ç‰¹æ®Šå‡½æ•°"></a>ç‰¹æ®Šå‡½æ•°</h2><h3 id="æ·»åŠ å‰ç¼€"><a href="#æ·»åŠ å‰ç¼€" class="headerlink" title="æ·»åŠ å‰ç¼€"></a>æ·»åŠ å‰ç¼€</h3><ul>
<li>å‡½æ•°åï¼šaddprefix( )</li>
<li>è¯­æ³•ï¼š$(addprefix PREFIX/,${NAMEâ€¦})</li>
<li>å‡½æ•°åŠŸèƒ½ï¼šä¸ºâ€œNAMESâ€¦â€ä¸­çš„æ¯ä¸€ä¸ªæ–‡ä»¶åæ·»åŠ å‰ç¼€â€œPREFIXâ€ã€‚å‚æ•°â€œNAMESâ€¦â€æ˜¯ç©ºæ ¼åˆ†å‰²çš„æ–‡ä»¶ååºåˆ—ï¼Œå°†â€œPREFIXâ€æ·»åŠ åˆ°æ­¤åºåˆ—çš„æ¯ä¸€ä¸ªæ–‡ä»¶åä¹‹å‰ã€‚</li>
<li>è¿”å›å€¼ï¼šä»¥å•ç©ºæ ¼åˆ†å‰²çš„æ·»åŠ äº†å‰ç¼€â€œPREFIXâ€çš„æ–‡ä»¶ååºåˆ—ã€‚</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">$(addprefix src/,foo bar)</span><br><span class="line"><span class="comment">//è¿”å›å€¼ä¸ºâ€œsrc/foo src/barâ€</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h3><ul>
<li>å‡½æ•°åï¼šfilter( )</li>
<li>è¯­æ³•ï¼š$(filter SUFFIXâ€¦,$(SOURCES))</li>
<li>ä½œç”¨ï¼šä¿ç•™å­—ä¸² â€œ $(SOURCES)â€ ä¸­æ‰€æœ‰ç¬¦åˆæ¨¡å¼ â€œ SUFFIX â€ çš„å•è¯</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">sources := main.c AT.txt</span><br><span class="line">foo : $(sources)</span><br><span class="line">    cc $(filter %.c,%.s,$(sources)) -o foo</span><br></pre></td></tr></tbody></table></figure>



<h2 id="æ‰“å°"><a href="#æ‰“å°" class="headerlink" title="æ‰“å°"></a>æ‰“å°</h2><p>ç”¨äºMakefileçš„Debugï¼Œæ‰“å°åˆ†ä¸ºä¸‰ä¸ªç­‰çº§ï¼šinfoã€warningã€error</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">$(info SRC = $(SRC))</span><br><span class="line">$(warning INC = $(INC))</span><br><span class="line"><span class="comment">//æ³¨æ„ï¼šæ‰§è¡Œåˆ°errorä¼šç›´æ¥stopé€€å‡º</span></span><br><span class="line">$(error INC = $(INC))</span><br></pre></td></tr></tbody></table></figure>



]]></content>
      <categories>
        <category>Tools</category>
      </categories>
      <tags>
        <tag>Makefile</tag>
        <tag>CmakeLists.txt</tag>
      </tags>
  </entry>
  <entry>
    <title>forkä¸mmapçš„åº•å±‚åŸç†</title>
    <url>/2023/09/10/language-grammar/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>ä¸Šä¸€ç¯‡ä¸»è¦å¯¹é¡µä¸­æ–­çš„æœºåˆ¶è¿›è¡Œç®€å•çš„äº†è§£å¹¶å¯¹æºç è¿›è¡Œç›¸å…³çš„é˜…è¯»ï¼Œè€Œè¿‡ç¨‹ä¸­ä¾èµ–äºé¡µä¸­æ–­çš„åœºæ™¯æ˜¯æ¯”è¾ƒå¤šçš„ã€‚æœ¬ç¯‡ä¸»è¦é’ˆå¯¹forkã€execveã€mmapä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨çš„åŸç†è¿›è¡Œåˆ†æã€‚å¯¹äºå®ƒä»¬æ‰€å®Œæˆçš„åŠŸèƒ½èƒŒåéƒ½æ˜¯ç”±é¡µä¸­æ–­åœ¨èƒŒåè¿›è¡Œé»˜é»˜æ”¯æ’‘çš„ã€‚</p>
<h1 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h1><h2 id="å‡½æ•°åŸå‹"><a href="#å‡½æ•°åŸå‹" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">fork</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>åŠŸèƒ½</p>
<p>ä»¥å½“å‰è¿›ç¨‹ä½œä¸ºçˆ¶è¿›ç¨‹ï¼Œå°†æ‰€æœ‰èµ„æºè¿›è¡Œæ‹·è´åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚</p>
</li>
<li><p>è¿”å›å€¼</p>
<ul>
<li>&lt;0ï¼Œforkå‡½æ•°è°ƒç”¨å¤±è´¥</li>
<li>=0ï¼Œçˆ¶è¿›ç¨‹è¿”å›å€¼</li>
<li>&gt;0ï¼Œå­è¿›ç¨‹è¿”å›å€¼ï¼Œå®é™…ä¸Šæ˜¯å­è¿›ç¨‹çš„PID</li>
</ul>
<p>å½“forkç³»ç»Ÿè°ƒç”¨æˆåŠŸæ—¶ï¼Œå®ƒä¼šè¿”å›ä¸¤ä¸ªå€¼ï¼š0ï¼ˆçˆ¶è¿›ç¨‹ï¼‰ï¼Œæ–°çš„å­è¿›ç¨‹çš„PIDï¼ˆ&gt;0</p>
</li>
</ul>
<h2 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h2><ol>
<li><p>å¤åˆ¶ä¸€ä»½è¿›ç¨‹æ§åˆ¶å—ï¼ˆProcess Control Blockï¼ŒPCB)ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹æˆ‘ç†è§£ç±»ä¼¼äºå¤åˆ¶ç²˜è´´ï¼Œæ­¤æ—¶çˆ¶å­è¿›ç¨‹æ‹¥æœ‰ç›¸åŒçš„è™šæ‹Ÿèµ„æºï¼ˆå„è‡ªä¸€ä»½ï¼‰å’Œç¡¬ä»¶èµ„æºï¼ˆåŒä¸€ä¸ªï¼‰ã€‚PCBç»“æ„ä½“å†…æ‰€å­˜å‚¨çš„æ‰€æœ‰å†…å®¹å¯¹ä¸¤ä¸ªè¿›ç¨‹å…¨éƒ¨å…¬å¼€ä¸”å…±äº«ã€‚</p>
</li>
<li><p>å¤åˆ¶é¡µè¡¨å¹¶å°†PTEæ·»åŠ å†™ä¿æŠ¤</p>
<p>æŠŠé¡µè¡¨ä¸­æ‰€æœ‰æ­£å¸¸çŠ¶æ€çš„æ•°æ®æ®µã€å †å’Œæ ˆç©ºé—´çš„è™šæ‹Ÿå†…å­˜é¡µï¼Œè®¾ç½®ä¸ºä¸å¯å†™ï¼Œç„¶åæŠŠå·²ç»æ˜ å°„çš„ç‰©ç†é¡µé¢çš„å¼•ç”¨è®¡æ•°åŠ  1ã€‚</p>
</li>
<li><p>ä¸¤ä¸ªè¿›ç¨‹åŠ å…¥æ“ä½œç³»ç»Ÿè°ƒåº¦é˜Ÿåˆ—ï¼ˆforkä½œç”¨ç»“æŸï¼‰</p>
</li>
<li><p>å¦‚æœçˆ¶å­è¿›ç¨‹éƒ½æ²¡æœ‰å†™æ“ä½œï¼Œåˆ™æ­£å¸¸è°ƒåº¦ç›´è‡³ä¸¤ä¸ªè¿›ç¨‹ç»“æŸï¼Œç”±äºå¤åˆ¶PCBä¸¤ä¸ªè¿›ç¨‹çš„IPå¯„å­˜å™¨æŒ‡å‘forkè°ƒç”¨æ‰€ä»¥æœ‰ä¸¤ä¸ªè¿”å›å€¼</p>
</li>
<li><p>çˆ¶å­è¿›ç¨‹å¦‚æœæœ‰ä¸€ä¸ªå‘ç”Ÿå†™æ“ä½œï¼Œç”±äºé¡µè¡¨é¡¹è®¾ç½®æˆä¸å¯å†™ï¼Œæ‰€ä»¥ä¸€å®šå‘ç”Ÿå†™ä¿æŠ¤ä¸­æ–­</p>
<ul>
<li><p>do_page_fault</p>
</li>
<li><p>handle_pte_fault</p>
<p>åˆ¤æ–­ä¸­æ–­å‘ç”Ÿç±»å‹ã€‚PTEé¡µè¡¨é¡¹PRESENTç½®ä½è¯´æ˜å·²ç»æ˜ å°„äº†ç‰©ç†é¡µé¢ï¼ŒåŒæ—¶flagå‚æ•°æ˜¯å†™è¯·æ±‚ä½†æ˜¯åˆ¤æ–­PTEå¹¶æ²¡æœ‰å†™æƒé™ï¼Œè¯´æ˜æ˜¯ä¸€æ¬¡å†™ä¿æŠ¤ä¸­æ–­</p>
</li>
<li><p>do_wp_page</p>
<p>åˆ¤æ–­å‘ç”Ÿä¸­æ–­çš„è™šæ‹Ÿåœ°å€æ‰€å¯¹åº”çš„ç‰©ç†åœ°å€çš„å¼•ç”¨è®¡æ•°ï¼Œå¦‚æœå¤§äº 1ï¼Œå°±è¯´æ˜ç°åœ¨å­˜åœ¨å¤šä¸ªè¿›ç¨‹å…±äº«è¿™ä¸€å—ç‰©ç†é¡µé¢ï¼Œé‚£ä¹ˆå®ƒå°±éœ€è¦ä¸ºå‘ç”Ÿä¸­æ–­çš„è¿›ç¨‹å†åˆ†é…ä¸€ä¸ªç‰©ç†é¡µé¢ï¼ŒæŠŠè€çš„é¡µé¢å†…å®¹æ‹·è´è¿›è¿™ä¸ªæ–°çš„ç‰©ç†é¡µï¼Œæœ€åæŠŠå‘ç”Ÿä¸­æ–­çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°æ–°çš„ç‰©ç†é¡µã€‚è¿™å°±å®Œæˆäº†ä¸€æ¬¡å†™æ—¶å¤åˆ¶ (Copy On Writeï¼Œ COWï¼‰</p>
</li>
</ul>
</li>
</ol>
<h1 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h1><h2 id="å‡½æ•°åŸå‹-1"><a href="#å‡½æ•°åŸå‹-1" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length, <span class="type">int</span> prot, <span class="type">int</span> flags, <span class="type">int</span> fd, <span class="type">off_t</span> offset)</span>;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>å‚æ•°</p>
<ul>
<li><p>addrï¼šç”¨æˆ·è¿›ç¨‹ä¸­è¦æ˜ å°„çš„ç”¨æˆ·ç©ºé—´çš„èµ·å§‹åœ°å€ï¼Œé€šå¸¸ä¸ºNULLï¼ˆç”±å†…æ ¸æ¥æŒ‡å®šï¼‰</p>
</li>
<li><p>lengthï¼šè¦æ˜ å°„çš„å†…å­˜åŒºåŸŸçš„å¤§å°</p>
</li>
<li><p>protï¼šæœŸæœ›çš„å†…å­˜ä¿æŠ¤æ ‡å¿—</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">PROT_EXEC 		<span class="comment">// é¡µå†…å®¹å¯ä»¥è¢«æ‰§è¡Œ</span></span><br><span class="line">PROT_READ		<span class="comment">// é¡µå†…å®¹å¯ä»¥è¢«è¯»å–</span></span><br><span class="line">PROT_WRITE		<span class="comment">// é¡µå¯ä»¥è¢«å†™å…¥</span></span><br><span class="line">PROT_NONE 		<span class="comment">// é¡µä¸å¯è®¿é—®</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>flagsï¼šæŒ‡å®šæ˜ å°„å¯¹è±¡çš„ç±»å‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">MAP_FIXEDï¼ˆ***ï¼‰</span><br><span class="line"><span class="comment">//ä½¿ç”¨æŒ‡å®šçš„æ˜ å°„èµ·å§‹åœ°å€ï¼Œå¦‚æœç”±startå’Œlenå‚æ•°æŒ‡å®šçš„å†…å­˜åŒºé‡å äºç°å­˜çš„æ˜ å°„ç©ºé—´ï¼Œé‡å éƒ¨åˆ†å°†ä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœæŒ‡å®šçš„èµ·å§‹åœ°å€ä¸å¯ç”¨ï¼Œæ“ä½œå°†ä¼šå¤±è´¥ã€‚å¹¶ä¸”èµ·å§‹åœ°å€å¿…é¡»è½åœ¨é¡µçš„è¾¹ç•Œä¸Šã€‚è¯¥å‚æ•°æ˜¯ç”¨äºå›ºå®šmmapç¬¬ä¸€ä¸ªå‚æ•°addrçš„</span></span><br><span class="line">MAP_SHAREDï¼ˆ***ï¼‰</span><br><span class="line"><span class="comment">//ä¸å…¶å®ƒæ‰€æœ‰æ˜ å°„è¿™ä¸ªå¯¹è±¡çš„è¿›ç¨‹å…±äº«æ˜ å°„ç©ºé—´ã€‚å¯¹å…±äº«åŒºçš„å†™å…¥ï¼Œç›¸å½“äºè¾“å‡ºåˆ°æ–‡ä»¶ã€‚ç›´åˆ°msync()æˆ–è€…munmap()è¢«è°ƒç”¨ï¼Œæ–‡ä»¶å®é™…ä¸Šä¸ä¼šè¢«æ›´æ–°ã€‚ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªå…±äº«æ˜ å°„åŒºï¼Œä¸€ä¸ªè¿›ç¨‹å¯¹è¯¥æ–‡ä»¶çš„ä¿®æ”¹ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œè¿™å°±å®ç°äº†æ•°æ®çš„é€šè®¯</span></span><br><span class="line">MAP_PRIVATEï¼ˆ***ï¼‰</span><br><span class="line"><span class="comment">//å»ºç«‹ä¸€ä¸ªå†™å…¥æ—¶æ‹·è´çš„ç§æœ‰æ˜ å°„ã€‚å†…å­˜åŒºåŸŸçš„å†™å…¥ä¸ä¼šå½±å“åˆ°åŸæ–‡ä»¶ã€‚è¿™ä¸ªæ ‡å¿—å’Œä»¥ä¸Šæ ‡å¿—æ˜¯äº’æ–¥çš„ï¼Œåªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªã€‚</span></span><br><span class="line">MAP_DENYWRITE </span><br><span class="line"><span class="comment">//è¿™ä¸ªæ ‡å¿—è¢«å¿½ç•¥</span></span><br><span class="line">MAP_EXECUTABLE </span><br><span class="line"><span class="comment">//åŒä¸Š</span></span><br><span class="line">MAP_NORESERVE</span><br><span class="line"><span class="comment">//ä¸è¦ä¸ºè¿™ä¸ªæ˜ å°„ä¿ç•™äº¤æ¢ç©ºé—´ã€‚å½“äº¤æ¢ç©ºé—´è¢«ä¿ç•™ï¼Œå¯¹æ˜ å°„åŒºä¿®æ”¹çš„å¯èƒ½ä¼šå¾—åˆ°ä¿è¯ã€‚å½“äº¤æ¢ç©ºé—´ä¸è¢«ä¿ç•™ï¼ŒåŒæ—¶å†…å­˜ä¸è¶³ï¼Œå¯¹æ˜ å°„åŒºçš„ä¿®æ”¹ä¼šå¼•èµ·æ®µè¿ä¾‹ä¿¡å·ã€‚</span></span><br><span class="line">MAP_LOCKED</span><br><span class="line"><span class="comment">//é”å®šæ˜ å°„åŒºçš„é¡µé¢ï¼Œä»è€Œé˜²æ­¢é¡µé¢è¢«äº¤æ¢å‡ºå†…å­˜ã€‚</span></span><br><span class="line">MAP_GROWSDOWN </span><br><span class="line"><span class="comment">//ç”¨äºå †æ ˆï¼Œå‘Šè¯‰å†…æ ¸VMç³»ç»Ÿï¼Œæ˜ å°„åŒºå¯ä»¥å‘ä¸‹æ‰©å±•ã€‚</span></span><br><span class="line">MAP_ANONYMOUSï¼ˆ***ï¼‰</span><br><span class="line"><span class="comment">//åŒ¿åæ˜ å°„ï¼Œæ˜ å°„åŒºä¸ä¸ä»»ä½•æ–‡ä»¶å…³è”(éœ€è¦æ³¨æ„æ­¤æ—¶ï¼Œfdå‚æ•°éœ€è¦ç½®ç©º)</span></span><br><span class="line">MAP_ANON</span><br><span class="line"><span class="comment">//MAP_ANONYMOUSçš„åˆ«ç§°ï¼Œä¸å†è¢«ä½¿ç”¨ã€‚</span></span><br><span class="line">MAP_FILE</span><br><span class="line"><span class="comment">//å…¼å®¹æ ‡å¿—ï¼Œè¢«å¿½ç•¥ã€‚</span></span><br><span class="line">MAP_32BIT</span><br><span class="line"><span class="comment">//å°†æ˜ å°„åŒºæ”¾åœ¨è¿›ç¨‹åœ°å€ç©ºé—´çš„ä½2GBï¼ŒMAP_FIXEDæŒ‡å®šæ—¶ä¼šè¢«å¿½ç•¥ã€‚å½“å‰è¿™ä¸ªæ ‡å¿—åªåœ¨x86-64å¹³å° ä¸Šå¾—åˆ°æ”¯æŒã€‚</span></span><br><span class="line">MAP_POPULATE</span><br><span class="line"><span class="comment">//ä¸ºæ–‡ä»¶æ˜ å°„é€šè¿‡é¢„è¯»çš„æ–¹å¼å‡†å¤‡å¥½é¡µè¡¨ã€‚éšåå¯¹æ˜ å°„åŒºçš„è®¿é—®ä¸ä¼šè¢«é¡µè¿ä¾‹é˜»å¡ã€‚</span></span><br><span class="line">MAP_NONBLOCK </span><br><span class="line"><span class="comment">//ä»…å’ŒMAP_POPULATEä¸€èµ·ä½¿ç”¨æ—¶æ‰æœ‰æ„ä¹‰ã€‚ä¸æ‰§è¡Œé¢„è¯»ï¼Œåªä¸ºå·²å­˜åœ¨äºå†…å­˜ä¸­çš„é¡µé¢å»ºç«‹é¡µè¡¨å…¥å£ã€‚</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼ˆç”±openå‡½æ•°è¿”å›ï¼‰</p>
</li>
<li><p>offsetï¼šè®¾ç½®åœ¨å†…æ ¸ç©ºé—´ä¸­å·²ç»åˆ†é…å¥½çš„çš„å†…å­˜åŒºåŸŸä¸­çš„åç§»ï¼Œä¾‹å¦‚æ–‡ä»¶çš„åç§»é‡ï¼Œå¤§å°ä¸ºPAGE_SIZEçš„æ•´æ•°å€</p>
</li>
</ul>
</li>
<li><p>è¿”å›å€¼</p>
<p>mmap()è¿”å›è¢«æ˜ å°„åŒºçš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆå°±æ˜¯éœ€è¦æ˜ å°„çš„å†…æ ¸ç©ºé—´åœ¨ç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿåœ°å€</p>
</li>
</ul>
<h2 id="å‡½æ•°åŠŸèƒ½"><a href="#å‡½æ•°åŠŸèƒ½" class="headerlink" title="å‡½æ•°åŠŸèƒ½"></a>å‡½æ•°åŠŸèƒ½</h2><h3 id="ç§æœ‰åŒ¿åæ˜ å°„"><a href="#ç§æœ‰åŒ¿åæ˜ å°„" class="headerlink" title="ç§æœ‰åŒ¿åæ˜ å°„"></a>ç§æœ‰åŒ¿åæ˜ å°„</h3><ul>
<li>åº”ç”¨åœºæ™¯ï¼šåˆ†é…å †ç©ºé—´ï¼ˆæœ¬è´¨ä¸Šæ¥è¯´ï¼Œè¿™éƒ¨åˆ†ç”³è¯·çš„ç©ºé—´æ˜¯ä»æ–‡ä»¶æ˜ å°„åŒºæ˜ å°„å¾—åˆ°çš„ï¼Œä½†æ˜¯åŠŸèƒ½ä¸Šä¸å †ç©ºé—´ç±»ä¼¼ï¼Œæš‚ä¸”å¯ä»¥ç§°ä¹‹ä¸ºå †ï¼‰</li>
<li>å‚æ•°<ul>
<li>flagï¼šMAP_PRIVATEã€MAP_ANONYMOUS</li>
<li>fdï¼š-1</li>
</ul>
</li>
<li>åŸç†<ol>
<li>åœ¨æ–‡ä»¶æ˜ å°„åŒºåˆ†é…ç”¨æˆ·æ‰€éœ€è¦çš„å†…å­˜å¤§å°</li>
<li>åˆ›å»ºVMAç»“æ„ï¼Œä¸è¿›è¡Œå®é™…ç‰©ç†å†…å­˜çš„åˆ†é…ï¼Œè¿”å›</li>
<li>å†™å†…å­˜æ—¶ï¼Œè°ƒç”¨do_anonymous_page è¿›è¡Œç‰©ç†å†…å­˜çš„åˆ†é…</li>
<li>å»ºç«‹è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„å…³ç³»</li>
</ol>
</li>
</ul>
<h3 id="ç§æœ‰æ–‡ä»¶æ˜ å°„"><a href="#ç§æœ‰æ–‡ä»¶æ˜ å°„" class="headerlink" title="ç§æœ‰æ–‡ä»¶æ˜ å°„"></a>ç§æœ‰æ–‡ä»¶æ˜ å°„</h3><ul>
<li><p>åº”ç”¨åœºæ™¯ï¼šåŠ è½½åŠ¨æ€é“¾æ¥åº“</p>
</li>
<li><p>å‚æ•°</p>
<ul>
<li>flagï¼šMAP_PRIVATE</li>
<li>fdï¼šéç©ºï¼Œè¯¥å‚æ•°å¡«å……ä½¿ç”¨openç³»ç»Ÿè°ƒç”¨æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦</li>
</ul>
</li>
<li><p>åŸç†ï¼š</p>
<ol>
<li>åœ¨æ–‡ä»¶æ˜ å°„åŒºåˆ†é…ç”¨æˆ·æ‰€éœ€è¦çš„å†…å­˜å¤§å°</li>
<li>åˆ›å»ºVMAç»“æ„ï¼Œä¸è¿›è¡Œå®é™…ç‰©ç†å†…å­˜çš„åˆ†é…ï¼Œè¿”å›</li>
<li>ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œä¸€å®šæ˜¯ç¼ºé¡µä¸­æ–­ç”±äºæ˜¯æ–‡ä»¶æ˜ å°„ï¼Œåˆ™è°ƒç”¨do_faultå‡½æ•°è¿›ä¸€æ­¥åˆ¤æ–­</li>
<li>å¦‚æœæ˜¯è¯»æ“ä½œï¼Œè°ƒç”¨do_read_fault</li>
<li>å¦‚æœæ˜¯å†™æ“ä½œï¼Œå¹¶ä¸”æ˜¯ç§æœ‰æ˜ å°„è°ƒç”¨do_cow_fault</li>
<li>ç§æœ‰æ–‡ä»¶æ˜ å°„çš„ä»£ç æ®µï¼ˆåªè¯»é¡µï¼‰æ˜¯åœ¨å¤šè¿›ç¨‹é—´å…±äº«çš„ï¼Œè€Œæ•°æ®æ®µï¼ˆå¯å†™é¡µï¼‰æ˜¯ç§æœ‰çš„åœ¨æ¯ä¸€ä¸ªè¿›ç¨‹ä¸­ç‹¬ç«‹ï¼Œè€Œè¿™ä¸ªå‰¯æœ¬ä»ç„¶æ˜¯å†™æ—¶å¤åˆ¶</li>
</ol>
</li>
<li><p>å…¶å®ƒ</p>
<p>åœ¨linuxæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç£ç›˜ä¸Šçš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªinodeç»“æ„ä¸ä¹‹å¯¹åº”ï¼Œä¸”è¿™ä¸ªinodeç»“æ„åœ¨æ•´ä¸ªç³»ç»Ÿä¸Šæ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šä¸ªè¿›ç¨‹çœ‹åˆ°çš„inodeç»“æ„æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>è¯¥inodeåŒ…å«æœ‰å…³æ–‡ä»¶æˆ–ç›®å½•çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶ç±»å‹ã€æ–‡ä»¶å¤§å°ã€æƒé™ã€æ‰€æœ‰è€…ã€æ—¶é—´æˆ³å’Œæ•°æ®å—æŒ‡é’ˆã€‚</p>
<p>åœ¨ inode ç»“æ„ä¸­ï¼Œæœ‰ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œä»¥æ–‡ä»¶çš„é¡µå·ä¸º keyï¼Œä»¥ç‰©ç†å†…å­˜é¡µä¸º valueã€‚å½“è¿›ç¨‹ A æ‰“å¼€äº†æ–‡ä»¶ fï¼Œç„¶åè¯»å–äº†å®ƒçš„ç¬¬ 4 é¡µï¼Œè¿™æ—¶ï¼Œå†…æ ¸å°±ä¼šæŠŠ 4 å’Œè¿™ä¸ªç‰©ç†é¡µï¼Œæ”¾å…¥è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­ã€‚å½“è¿›ç¨‹ B å†æ‰“å¼€æ–‡ä»¶ fï¼Œè¦è¯»å–å®ƒçš„ç¬¬ 4 é¡µæ—¶ï¼Œå› ä¸º f çš„ç¬¬ 4 é¡µçš„å†…å®¹å·²ç»è¢«åŠ è½½åˆ°ç‰©ç†é¡µä¸­äº†ï¼Œæ‰€ä»¥å°±ä¸ç”¨å†åŠ è½½ä¸€æ¬¡äº†ã€‚åªéœ€è¦å°† B çš„è™šæ‹Ÿåœ°å€ä¸è¿™ä¸ªç‰©ç†é¡µå»ºç«‹æ˜ å°„å°±å¯ä»¥äº†</p>
</li>
</ul>
<h3 id="å…±äº«æ–‡ä»¶æ˜ å°„"><a href="#å…±äº«æ–‡ä»¶æ˜ å°„" class="headerlink" title="å…±äº«æ–‡ä»¶æ˜ å°„"></a>å…±äº«æ–‡ä»¶æ˜ å°„</h3><ul>
<li><p>åº”ç”¨åœºæ™¯ï¼šå¤šè¿›ç¨‹é€šä¿¡</p>
</li>
<li><p>å‚æ•°</p>
<ul>
<li>flagï¼šMAP_SHARED</li>
<li>fdï¼šéç©ºï¼Œè¯¥å‚æ•°å¡«å……ä½¿ç”¨openç³»ç»Ÿè°ƒç”¨æ‰“å¼€çš„æ–‡ä»¶æè¿°</li>
</ul>
</li>
<li><p>åŸç†</p>
<p>å…±äº«æ–‡ä»¶æ˜ å°„çš„åŸç†ä¸ç§æœ‰æ–‡ä»¶çš„æ˜ å°„åŸç†å‡ ä¹ä¸€è‡´ï¼Œä½†æ˜¯å…±äº«æ–‡ä»¶çš„éœ€æ±‚å°±æ˜¯è¦æ±‚æ¯ä¸€ä¸ªè¿›ç¨‹å¯¹æ–‡ä»¶çš„ä¿®æ”¹å¯¹å…¶ä»–æ–‡ä»¶éƒ½å¯è§ï¼Œæ‰€ä»¥å¯¹äºå¯å†™é¡µé¢ä¹Ÿä¸ä¼šåˆ›å»ºå‰¯æœ¬è€Œæ˜¯å…±äº«ã€‚</p>
<p>è€Œå½“å‘ç”Ÿç¼ºé¡µä¸­æ–­çš„æ—¶å€™ï¼Œæœ€ç»ˆè°ƒç”¨çš„å‡½æ•°ä¸ºdo_share_faultï¼ˆæ–‡ä»¶æ˜ å°„ã€å…±äº«æ˜ å°„ï¼‰</p>
</li>
</ul>
<h3 id="å…±äº«åŒ¿åæ˜ å°„"><a href="#å…±äº«åŒ¿åæ˜ å°„" class="headerlink" title="å…±äº«åŒ¿åæ˜ å°„"></a>å…±äº«åŒ¿åæ˜ å°„</h3><ul>
<li><p>åº”ç”¨åœºæ™¯ï¼šçˆ¶å­é—´çš„è¿›ç¨‹é€šè®¯</p>
</li>
<li><p>å‚æ•°</p>
<ul>
<li>flagï¼šMAP_ANONYMOUSã€MAP_SHARED</li>
<li>fdï¼š-1</li>
</ul>
</li>
<li><p>ä»£ç ç¤ºä¾‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶è¿›ç¨‹åˆ›å»ºä¸€å—å†…å­˜åŒºåŸŸï¼Œå­è¿›ç¨‹ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™å—åŒºåŸŸ</span></span><br><span class="line">addr = mmap(<span class="literal">NULL</span>, length, PROT_READ | PROT_WRITE, MAP_SHARED | MAP_ANOUNYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">child_pid = fork();</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>åŸç†</p>
<p>å½“forkå­è¿›ç¨‹çš„æ—¶å€™ï¼Œä¼šå°†vmaç»“æ„ä¸€èµ·å¤åˆ¶ä¸€ä»½ã€‚çˆ¶å­è¿›ç¨‹éƒ½å¯ä»¥çœ‹åˆ°è¿™å—åŒºåŸŸï¼Œå¯¹äºè¿™å—å†…å­˜æ˜¯å…±äº«çš„å¯è¯»å†™ï¼Œæ‰€ä»¥åé¢çš„æ“ä½œä¸å…±äº«æ–‡ä»¶æ˜ å°„æ˜¯ä¸€è‡´çš„ã€‚è€Œå½“å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™ï¼Œå†™ä¿æŠ¤ä¸­æ–­å‘ç”Ÿä½œç”¨ï¼Œè°ƒç”¨do_wp_faultï¼Œè¿™ä¸ªæµç¨‹å°±å¯ä»¥å‚è€ƒforkçš„æ“ä½œã€‚</p>
</li>
</ul>
<h2 id="åŠŸèƒ½æ€»ç»“"><a href="#åŠŸèƒ½æ€»ç»“" class="headerlink" title="åŠŸèƒ½æ€»ç»“"></a>åŠŸèƒ½æ€»ç»“</h2><p><img src="/images/coding/mmapfunc.png" alt="image"></p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>&lt;&lt;ç¼–ç¨‹é«˜æ‰‹å¿…å­¦çš„å†…å­˜çŸ¥è¯† â€“ 10&gt;&gt;   æµ·çº³</p>
]]></content>
      <categories>
        <category>c/c++</category>
      </categories>
  </entry>
  <entry>
    <title>Docker</title>
    <url>/2023/04/19/tools/docker/</url>
    <content><![CDATA[<h1 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h1><h2 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h2><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">sudo docker ps</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„ID</span></span><br><span class="line">sudo docker ps -aq</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹dockerçš„é•œåƒ</span></span><br><span class="line">sudo docker images</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="åœæ­¢å®¹å™¨"><a href="#åœæ­¢å®¹å™¨" class="headerlink" title="åœæ­¢å®¹å™¨"></a>åœæ­¢å®¹å™¨</h2><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ® CONTAINER IDæˆ– NAMES åœæ­¢ä¸€ä¸ª/å¤šä¸ªå®¹å™¨(IDæˆ–NAMEé€šè¿‡docker psæŸ¥çœ‹)</span></span><br><span class="line">sudo docker stop ID1 ID2 ID3</span><br><span class="line">sudo dokcer stop NAME1 NAME2 NAME3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœæ­¢æ‰€æœ‰ï¼ˆæ­£åœ¨è¿è¡Œ/é€€å‡º...ï¼‰å®¹å™¨</span></span><br><span class="line">sudo docker stop $(sudo docker ps -aq)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h2><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ® CONTAINER IDæˆ– NAMES å–å‡ºä¸€ä¸ª/å¤šä¸ªå®¹å™¨(IDæˆ–NAMEé€šè¿‡docker psæŸ¥çœ‹)</span></span><br><span class="line">sudo docker rm ID1 ID2 ID3</span><br><span class="line">sudo dokcer rm NAME1 NAME2 NAME3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å–å‡ºæ‰€æœ‰ï¼ˆæ­£åœ¨è¿è¡Œ/é€€å‡º...ï¼‰å®¹å™¨</span></span><br><span class="line">sudo docker rm $(sudo docker ps -aq)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h1 id="æ­å»ºHttpæœåŠ¡å™¨"><a href="#æ­å»ºHttpæœåŠ¡å™¨" class="headerlink" title="æ­å»ºHttpæœåŠ¡å™¨"></a>æ­å»ºHttpæœåŠ¡å™¨</h1><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹è½½docker</span></span><br><span class="line">sudo apt-get install docker;</span><br><span class="line">sudo apt-get install docker.io</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. å¯¼å…¥ç¯å¢ƒå˜é‡ï¼Œæœ€ç»ˆä½œä¸ºæœåŠ¡å™¨æ ¹ç›®å½•çš„æ–‡ä»¶å¤¹</span></span><br><span class="line">export DOCK_SERVER_PATH=/home/user/docker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. åˆ›å»ºå®¹å™¨ï¼Œåœ¨åˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç”¨åˆ°nginxçš„é•œåƒæ–‡ä»¶ï¼Œé•œåƒæ–‡ä»¶çš„ä¸‹è½½æ—¶è‡ªåŠ¨å®Œæˆçš„ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šçš„ç‰ˆæœ¬å·ï¼Œé»˜è®¤æ—¶æœ€æ–°ç‰ˆæœ¬ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">	-dè¡¨ç¤º  å®¹å™¨åœ¨åå°è¿è¡Œï¼ˆä¸äº§ç”Ÿè¾“å‡ºåˆ°Shellï¼‰å¹¶æ˜¾ç¤ºå®¹å™¨çš„IDï¼›</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">	-pè¡¨ç¤º  æ˜ å°„å®¹å™¨çš„ç«¯å£åˆ°å®¿ä¸»æœºçš„ç«¯å£ï¼›</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	-vè¡¨ç¤º  å°†æœ¬åœ°ç›®å½•å¤åˆ¶åˆ°æœåŠ¡å™¨çš„ç›®å½•ï¼Œä¸­é—´å†’å·éš”å¼€ï¼›æ˜ å°„çš„ç›®å½•</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">	--<span class="built_in">rm</span>   å®¹å™¨åœæ­¢åè‡ªåŠ¨åˆ é™¤å®¹å™¨ï¼Œä¾‹å¦‚é€šè¿‡docker container stop mynginxä»¥åï¼Œå®¹å™¨å°±æ²¡æœ‰äº†ï¼›</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">	-name  åé¢çš„mynginxå°±æ˜¯è‡ªå®šä¹‰å®¹å™¨çš„åå­—</span></span><br><span class="line">sudo docker container run -d -p 80:80 --rm -v $DOCK_SERVER_PATH/:/usr/share/nginx/html --name mynginx nginx </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. è¿›å…¥å®¹å™¨</span></span><br><span class="line">sudo docker exec -it 576ff9b465d0 /bin/bash</span><br></pre></td></tr></tbody></table></figure>

]]></content>
      <categories>
        <category>Tools</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¡¬ä»¶éšæœºæ•°æµ‹è¯•æ–¹æ³•</title>
    <url>/2022/11/26/third-party/DTRNG_Test/</url>
    <content><![CDATA[<h1 id="æµ‹è¯•æ–¹æ³•"><a href="#æµ‹è¯•æ–¹æ³•" class="headerlink" title="æµ‹è¯•æ–¹æ³•"></a>æµ‹è¯•æ–¹æ³•</h1><p>é…ç½®èŠ¯ç‰‡DTRNGç¡¬ä»¶å•å…ƒå¯„å­˜å™¨ç”Ÿæˆä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œä¿å­˜æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨NISTæµ‹è¯•å¥—ä»¶è¿›è¡ŒéªŒè¯å¾—åˆ°æ˜¯å¦éšæœºçš„ç»“è®ºã€‚</p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><ol>
<li>DTRNGï¼šDigital True Random Number Generatorï¼Œæ•°å­—çœŸéšæœºæ•°å‘ç”Ÿå™¨</li>
<li>NISTï¼šNational Institude of Standards and Technologyï¼Œå›½å®¶æ ‡å‡†æŠ€æœ¯ç ”ç©¶æ‰€</li>
<li>NIST-sts (Statistical Test Suite)ï¼Œç»Ÿè®¡æµ‹è¯•å¥—ä»¶ï¼š</li>
</ol>
<ul>
<li><p>æºç é“¾æ¥ï¼š<a href="https://csrc.nist.gov/projects/random-bit-generation/documentation-and-software%EF%BC%88Download%E5%8D%B3%E5%8F%AF%EF%BC%89">https://csrc.nist.gov/projects/random-bit-generation/documentation-and-softwareï¼ˆDownloadå³å¯ï¼‰</a></p>
</li>
<li><p>æ–‡æ¡£é“¾æ¥ï¼š<a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-22r1a.pdf">https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-22r1a.pdf</a></p>
</li>
<li><p>windowså®‰è£…</p>
<p>å®˜ç½‘çš„è½¯ä»¶åŒ…æ˜¯Linuxç³»ç»Ÿä¸‹å¼€å‘çš„ï¼ŒWindowsç³»ç»Ÿéœ€è¦å…ˆä¸‹ä¸€ä¸ª<a href="https://cygwin.com/install.html">cygwinè½¯ä»¶</a>æ¥è¾…åŠ©ä½¿ç”¨</p>
<p>å¯ä»¥å‚è€ƒåšå®¢ï¼š<a href="https://blog.csdn.net/weixin_39928192/article/details/89256576">https://blog.csdn.net/weixin_39928192/article/details/89256576</a>?</p>
</li>
<li><p>Linuxå®‰è£…</p>
<p>è¿›å…¥å·¥ç¨‹æ–‡ä»¶å¤¹sts-2.1.2ç›´æ¥makeå³å¯ï¼Œå¾—åˆ° assess å¯æ‰§è¡Œç¨‹åº</p>
</li>
</ul>
<h1 id="éšæœºæµ‹è¯•é¡¹"><a href="#éšæœºæµ‹è¯•é¡¹" class="headerlink" title="éšæœºæµ‹è¯•é¡¹"></a><strong>éšæœºæµ‹è¯•é¡¹</strong></h1><p>æ¯ä¸€ä¸ªæµ‹è¯•é¡¹çš„è§£è¯»ï¼š<a href="https://blog.csdn.net/lafu5137/article/details/79593845">https://blog.csdn.net/lafu5137/article/details/79593845</a></p>
<ol>
<li>The Frequency (Monobit) Testï¼Œé¢‘ç‡æ£€æµ‹ã€‚è¯¥æ£€éªŒä¸»è¦æ˜¯çœ‹0å’Œ1åœ¨æ•´ä¸ªåºåˆ—ä¸­æ‰€å çš„æ¯”ä¾‹ï¼ˆåŸºç¡€æ£€æµ‹ï¼‰</li>
<li>Frequency Test within a Blockï¼Œå—å†…é¢‘ç‡æ£€æµ‹</li>
<li>The Runs Testï¼Œæ¸¸ç¨‹æ£€æµ‹ã€‚æ¸¸ç¨‹æŒ‡çš„æ˜¯ä¸€ä¸ªæ²¡æœ‰é—´æ–­çš„ç›¸åŒæ•°åºåˆ—</li>
<li>Tests for the Longest-Run-of-Ones in a Blockï¼Œå—å†…æœ€é•¿æ¸¸ç¨‹æ£€æµ‹</li>
<li>The Binary Matrix Rank Testï¼ŒäºŒå…ƒçŸ©é˜µç§©æ£€æµ‹</li>
<li>The Discrete Fourier Transform (Spectral) Testï¼Œç¦»æ•£å‚…ç«‹å¶å˜æ¢æ£€æµ‹</li>
<li>The Non-overlapping Template Matching Testï¼Œéé‡å æ¨¡å—åŒ¹é…æ£€æµ‹</li>
<li>The Overlapping Template Matching Testï¼Œé‡å æ¨¡å—åŒ¹é…æ£€æµ‹</li>
<li>Maurerâ€™s â€œUniversal Statisticalâ€ Testï¼ŒMaurerçš„é€šç”¨æ£€æµ‹ç»Ÿè®¡</li>
<li>The Linear Complexity Testï¼Œçº¿æ€§å¤æ‚åº¦æ£€æµ‹</li>
<li>The Serial Testï¼Œåºåˆ—æ£€æµ‹</li>
<li>The Approximate Entropy Testï¼Œè¿‘ä¼¼ç†µæ£€æµ‹</li>
<li>The Cumulative Sums (Cusums) Testï¼Œç´¯åŠ å’Œæ£€éªŒ</li>
<li>The Random Excursions Testï¼Œéšæœºæ¸¸åŠ¨æ£€æµ‹</li>
<li>The Random Excursions Variant Test.ï¼Œéšæœºæ¸¸åŠ¨çŠ¶æ€é¢‘ç‡æ£€æµ‹</li>
</ol>
<h1 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a><strong>ä½¿ç”¨æ–¹æ³•</strong></h1><p>è¯¥æµç¨‹æ˜¯åŸºäºLinuxç³»ç»Ÿè¿›è¡Œæ“ä½œçš„ï¼Œä½¿ç”¨çš„æ•°æ®ï¼šsts-2.1.2/data/data.pi</p>
<ol>
<li>å¯åŠ¨ç¨‹åºã€‚**./assess ï¼Œ**stream lengthè¯‘ä¸ºæµçš„é•¿åº¦ã€‚</li>
<li>è¾“å…¥å¾…æµ‹æ–‡ä»¶è·¯å¾„ã€‚æ ¹æ®èœå•ï¼Œé”®å…¥0å¹¶è¾“å…¥æ–‡ä»¶çš„è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„éƒ½å¯ä»¥ï¼‰</li>
<li>é€‰æ‹©æµ‹è¯•é¡¹ã€‚é”®å…¥1è¡¨ç¤ºåº”ç”¨å…¨éƒ¨æµ‹è¯•é¡¹ï¼›è¾“å…¥0è¡¨ç¤ºéƒ¨åˆ†æµ‹è¯•é¡¹ï¼Œéšåè¾“å…¥ä¸€ä¸ª16ä½äºŒè¿›åˆ¶åºåˆ—é€‰æ‹©æµ‹è¯•é¡¹ã€‚</li>
<li>å‚æ•°è°ƒæ•´ã€‚å¯ä»¥æ ¹æ®èœå•åŠé€‰é¡¹å¾®è°ƒéƒ¨åˆ†å‚æ•°çš„å€¼ï¼ŒåŸºæœ¬é€‰æ‹©é»˜è®¤å³å¯ã€‚</li>
<li>è¾“å…¥æ¯”ç‰¹æµçš„ä¸ªæ•°ã€‚è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªstream</li>
<li>é€‰æ‹©è¾“å…¥æ–‡ä»¶ç±»å‹ã€‚è¯¥ç±»å‹å¯¹åº”äºç¬¬äºŒæ­¥è¾“å…¥æ–‡ä»¶çš„ç±»å‹ï¼Œä¸¤ç§ç±»å‹ä¾›é€‰æ‹©ï¼šASCII / Binary</li>
</ol>
<h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a><strong>æ³¨æ„äº‹é¡¹</strong></h1><ol>
<li>æ¯ä¸€é¡¹æµ‹è¯•æ‰€éœ€çš„åºåˆ—çš„stream lengthæ˜¯ä¸ä¸€æ ·çš„ï¼Œç»æµ‹è¯•å¦‚æœé€‰æ‹©å…¨éƒ¨æµ‹è¯•é¡¹è‡³å°‘ä¿è¯stream length &gt;= 10000bitsï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯ã€‚è€Œå¦‚æœå•é¡¹æµ‹è¯•æŸ¥é˜…æ–‡æ¡£æ»¡è¶³å‚æ•°èŒƒå›´å³å¯ï¼Œæ¯”å¦‚é€‰æ‹©1é¢‘ç‡æµ‹è¯•åªéœ€ä¿è¯stream length&gt;100bitså³å¯ã€‚</li>
<li>å¿…é¡»ä¿è¯ï¼šæµé•¿åº¦ Ã— æµä¸ªæ•° &lt;= æ–‡ä»¶å¤§å°</li>
<li>å¦‚æœè¾“å…¥çš„æ–‡ä»¶æ˜¯ACSIIæ ¼å¼çš„è¯ï¼Œå¯åŠ¨ç¨‹åºæ—¶æ‰€è¾“å…¥çš„bitstreamçš„å•ä½æ˜¯byteï¼›è€Œè¾“å…¥æ–‡ä»¶ä¸ºBinaryçš„è¯bitstreamå•ä½ä¸ºbitã€‚ä¾‹å¦‚ï¼šç¬¬ä¸€æ­¥é”®å…¥./assess 10000ï¼›ç¬¬äº”æ­¥é”®å…¥10 ï¼›æ­¤æ—¶ç¬¬å…­æ­¥é€‰æ‹©0ä»£è¡¨è¾“å…¥äº†10000Ã—10Ã—8ï¼ˆbitsï¼‰ï¼Œè¾“å…¥1ä»£è¡¨è¾“å…¥äº†10000Ã—10ï¼ˆbitsï¼‰ã€‚å®é™…è¾“å…¥è¿‡ç¨‹æ˜¯è¦åç€ç†è§£ï¼Œå…ˆç¡®å®šè¾“å…¥æ–‡ä»¶ç±»å‹ï¼Œè¿›è€Œç¡®è®¤bitstreamã€numberï¼Œä¿è¯ç¬¬ä¸€ä¸ªå…¬å¼</li>
</ol>
<h1 id="æ£€æµ‹æ ‡å‡†"><a href="#æ£€æµ‹æ ‡å‡†" class="headerlink" title="æ£€æµ‹æ ‡å‡†"></a><strong>æ£€æµ‹æ ‡å‡†</strong></h1><p>æµ‹è¯•æˆåŠŸç»“æŸåˆ™ä¼šåœ¨ <strong>sts-2.1.2/experiments/AlgorithmTesting/</strong> ç›®å½•ä¸‹ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼Œè€Œé’ˆå¯¹æ¯ä¸€ä¸ªé¡¹ç›®çš„ç»“æœä¼šåœ¨å…¶å­ç›®å½•ä¸‹ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šã€‚</p>
<p>æœ€ç»ˆæµ‹è¯•æŠ¥å‘ŠfinalAnalysisReport.txtä¸­P-valueéƒ½å¤§äºç­‰äº0.01å³å¯è®¤ä¸ºé€šè¿‡äº†NISTæ£€éªŒï¼Œè¿™ä¸ªæ•°æ®è¶Šå¤§è¶Šå¥½ã€‚å¦‚æœè¯¥æ•°æ®ä¸º0ï¼Œå¯èƒ½æ˜¯ç”±äºæ•°æ®é‡çš„é—®é¢˜åˆ™å¯ä»¥å»æ¯ä¸ªå­é¡¹ç›®ç»“æœä¸­å»æŸ¥çœ‹ï¼Œä¼šæœ‰SUCCESSå­—æ ·ï¼</p>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a><strong>Q&amp;A</strong></h1><ol>
<li><p>Qï¼šSegment fault</p>
<p>Aï¼š bitstream*num &gt; fileSizeå³æµçš„é•¿åº¦ä¹˜ä»¥æµçš„ä¸ªæ•°è¶…è¿‡äº†æ–‡ä»¶çš„å¤§å°é€šå¸¸ä¼šæœ‰errorä¿¡æ¯</p>
</li>
<li><p>Qï¼šigamc: UNDERFLOWï¼Ÿ</p>
<p>Aï¼šæ•°æ®ä¸‹æº¢ï¼Œå¯èƒ½æ˜¯æ•°æ®æ ¼å¼çš„åŸå› æˆ–è€…æ•°æ®è¿‡äºä¸éšæœº</p>
</li>
<li><p>Qï¼šP-valueå…¨éƒ¨æ˜¯0ï¼Ÿ</p>
<p>Aï¼šå¯¼è‡´ <strong>igamc: UNDERFLOW</strong> çš„åŸå› éƒ½æ˜¯æœ‰å¯èƒ½çš„ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºæ•°æ®é‡ä¸å¤Ÿæ‰€å¯¼è‡´çš„ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Third Party</category>
      </categories>
  </entry>
  <entry>
    <title>gdb &amp;&amp; coredump</title>
    <url>/2023/05/06/tools/gdb/</url>
    <content><![CDATA[<h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><ul>
<li>å†…å­˜è®¿é—®è¶Šç•Œ</li>
<li>å¤šçº¿ç¨‹ç¨‹åºä½¿ç”¨äº†çº¿ç¨‹ä¸å®‰å…¨çš„å‡½æ•°</li>
<li>å¤šçº¿ç¨‹è¯»å†™çš„æ•°æ®æœªåŠ é”ä¿æŠ¤</li>
<li>éæ³•æŒ‡é’ˆ</li>
<li>å †æ ˆæº¢å‡º</li>
</ul>
<h1 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h1><ol>
<li><p>é€šè¿‡æ·»åŠ â€-gâ€çš„å‚æ•°å¯¹ç¨‹åºæ–‡ä»¶è¿›è¡Œç¼–è¯‘</p>
<blockquote>
<p>å›æº¯è·Ÿè¸ªæŒ‡çš„æ˜¯ç›‘è§†ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„å‡½æ•°è°ƒç”¨å†å²ï¼Œå †æ ˆè½¬å‚¨åˆ™æ˜¯ä¸€ç§ä»¥åŸå§‹çš„åå…­è¿›åˆ¶æ ¼å¼ä¿å­˜ç¨‹åºæ‰§è¡Œç¯å¢ƒçš„æ–¹æ³•.</p>
</blockquote>
<ul>
<li>-g1		ä¸åŒ…å«å±€éƒ¨å˜é‡å’Œä¸è¡Œå·æœ‰å…³çš„è°ƒè¯•ä¿¡æ¯ï¼Œåªèƒ½ç”¨äºå›æº¯è·Ÿè¸ªå’Œå †æ ˆè½¬å‚¨ä¹‹ç”¨ã€‚</li>
<li>-g2         æ­¤æ—¶è°ƒè¯•ä¿¡æ¯åŒ…æ‹¬æ‰©å±•çš„ç¬¦å·è¡¨ã€è¡Œå·ã€å±€éƒ¨æˆ–å¤–éƒ¨å˜é‡ä¿¡æ¯**(é»˜è®¤level)**</li>
<li>-g3         åŒ…å«çº§åˆ«2ä¸­çš„è°ƒè¯•ä¿¡æ¯å’Œæºä»£ç ä¸­å®šä¹‰çš„å®</li>
</ul>
</li>
<li><p>é…ç½®è®¾å¤‡ç«¯çš„coreæ–‡ä»¶å¤§å°<br>   ulimit -a        æŸ¥çœ‹å½“å‰çš„å„ç§ç”¨æˆ·è¿›ç¨‹é™åˆ¶<br>   ulimit -c unlimited     å¼€å¯Coredump,å¹¶ä¸”ä¸é™åˆ¶æ–‡ä»¶çš„å¤§å°</p>
</li>
<li><p>æ‰§è¡Œå¯æ‰§è¡Œç¨‹åº, ç”Ÿæˆcoreæ–‡ä»¶</p>
</li>
<li><p>å°†coreæ–‡ä»¶å–å‡º, æ‰§è¡Œ â€œgdb  ./test  coreâ€è¿›è¡Œåˆ†æ</p>
</li>
</ol>
<h1 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h1><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><ol>
<li>gdb è¿›å…¥ç¯å¢ƒ</li>
<li>file a.out(å¯æ‰§è¡Œæ–‡ä»¶å)    åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>set args argv[1] argv[2] â€¦â€¦	åŠ è½½a.outæ‰€éœ€è¦çš„å‚æ•°</li>
</ol>
<h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç®€å†™</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>run</td>
<td></td>
<td>é‡æ–°å¼€å§‹è¿è¡Œæ–‡ä»¶</td>
</tr>
<tr>
<td>start</td>
<td></td>
<td>å•æ­¥æ‰§è¡Œ,è¿è¡Œç¨‹åº,åœåœ¨ç¬¬ä¸€æ‰§è¡Œè¯­å¥</td>
</tr>
<tr>
<td>list</td>
<td>l</td>
<td>æŸ¥çœ‹æºä»£ç </td>
</tr>
<tr>
<td>set</td>
<td></td>
<td>è®¾ç½®å˜é‡çš„å€¼</td>
</tr>
<tr>
<td>next</td>
<td>n</td>
<td>å•æ­¥è°ƒè¯•( é€è¿‡ç¨‹, å‡½æ•°ç›´æ¥æ‰§è¡Œ)</td>
</tr>
<tr>
<td>step</td>
<td>s</td>
<td>å•æ­¥è°ƒè¯•( é€è¯­å¥, è·³å…¥è‡ªå®šä¹‰å‡½æ•°å†…éƒ¨æ‰§è¡Œ)</td>
</tr>
<tr>
<td>backtrace</td>
<td>bt</td>
<td>æŸ¥çœ‹å‡½æ•°çš„è°ƒç”¨æ ˆå¸§å’Œå±‚çº§å…³ç³»</td>
</tr>
<tr>
<td>frame</td>
<td>f</td>
<td>åˆ‡æ¢æ ˆå¸§, ç›´æ¥ä½¿ç”¨frame + &lt;btå‰é¢çš„æ•°å­—&gt;</td>
</tr>
<tr>
<td>info</td>
<td>i</td>
<td>æŸ¥çœ‹å‡½æ•°å†…éƒ¨å±€éƒ¨å˜é‡çš„æ•°å€¼</td>
</tr>
<tr>
<td>finish</td>
<td></td>
<td>ç»“æŸå½“å‰å‡½æ•°, è¿”å›åˆ°å‡½æ•°è°ƒç”¨çš„ç‚¹</td>
</tr>
<tr>
<td>continue</td>
<td>c</td>
<td>ç»§ç»­è¿è¡Œ</td>
</tr>
<tr>
<td>print</td>
<td>p</td>
<td>æ‰“å°å€¼åŠåœ°å€</td>
</tr>
<tr>
<td>break</td>
<td>b</td>
<td>è®¾ç½®æ–­ç‚¹</td>
</tr>
<tr>
<td>disable</td>
<td></td>
<td>å¤±èƒ½æ–­ç‚¹</td>
</tr>
<tr>
<td>delete</td>
<td>d</td>
<td>åˆ é™¤æ–­ç‚¹</td>
</tr>
<tr>
<td>watch</td>
<td>w</td>
<td>è®¾ç½®è§‚å¯Ÿç‚¹</td>
</tr>
<tr>
<td>quit</td>
<td>q</td>
<td>é€€å‡ºgdb</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç®€å†™</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>info args</td>
<td></td>
<td>æŸ¥çœ‹å‚æ•°</td>
</tr>
<tr>
<td>info locals</td>
<td></td>
<td>æŸ¥çœ‹æœ¬åœ°å˜é‡</td>
</tr>
<tr>
<td>info sharedlibrary</td>
<td></td>
<td>æ˜¾ç¤ºå…±äº«é“¾æ¥åº“çš„ä¿¡æ¯</td>
</tr>
<tr>
<td>info breakpoints</td>
<td>info b</td>
<td>æ˜¾ç¤ºæ–­ç‚¹</td>
</tr>
</tbody></table>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>Qï¼šæ²¡æœ‰ç”Ÿæˆcoreæ–‡ä»¶?<br>Aï¼škernelæ²¡æœ‰é€‰æ‹©coredumpåŠŸèƒ½ï¼Œmake kernel-menuconfigé…ç½®é€‰é¡¹ä¸­é€‰æ‹©coredump(ç¬¬ä¸€ä¸ªå³å¯)</p>
</li>
<li><p>Qï¼šgdbæ— æ³•æ˜¾ç¤ºsoåŠ¨æ€åº“çš„ä¿¡æ¯æˆ–è€…æ˜¾ç¤ºä¿¡æ¯æœ‰è¯¯æ—¶</p>
<p>Aï¼šé€šå¸¸æ˜¯ç”±äºåº“æœç´¢è·¯å¾„é”™è¯¯å¯¼è‡´çš„ ;  ä½¿ç”¨set sysroot / , ç„¶åå†æ¬¡tbå¯ä»¥çœ‹åˆ°åº“ä¸­çš„å‡½æ•°</p>
</li>
<li><p>Qï¼šæ— æ³•æ¸…å±ï¼Ÿ</p>
<p>Aï¼šgdbä¸­æ²¡æœ‰ä¸“é—¨çš„æ¸…å±å‘½ä»¤, ä½†æ˜¯å¯ä»¥æ‰§è¡Œshellçš„å‘½ä»¤è¿›è¡Œæ¸…å±ï¼ˆshell clearï¼‰</p>
</li>
</ol>
<h1 id="æ‹“å±•èµ„æ–™"><a href="#æ‹“å±•èµ„æ–™" class="headerlink" title="æ‹“å±•èµ„æ–™"></a>æ‹“å±•èµ„æ–™</h1><ul>
<li><a href="https://blog.csdn.net/rheostat/article/details/8523598">åœ¨C/C++ç¨‹åºä¸­æ‰“å°å½“å‰å‡½æ•°è°ƒç”¨æ ˆ</a></li>
</ul>
]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title>XPath Helperå®‰è£…åŠä½¿ç”¨</title>
    <url>/2022/12/03/tools/xpath/</url>
    <content><![CDATA[<h1 id="å¼•è¯­"><a href="#å¼•è¯­" class="headerlink" title="å¼•è¯­"></a>å¼•è¯­</h1><p><em>åœ¨çˆ¬è™«å„ä¸ªåº”ç”¨åœºæ™¯ä¸‹ï¼Œæ•°æ®è§£æä¸ºå…¶ä¸­é‡è¦çš„ä¸€ç¯ã€‚è€Œåœ¨æ•°æ®è§£æä¸­ï¼ŒBeautifulSoupã€Xpathä»¥åŠæ­£åˆ™è¡¨è¾¾å¼ç­‰å¤šç§æ–¹æ³•å‡ä¸ºåˆ©å™¨ï¼Œåœ¨å®é™…åº”ç”¨ä¸­æ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©ä¸åŒçš„æ–¹æ³•æ˜¯æœ€é«˜æ•ˆçš„ï¼Œä½†æ˜¯å¯¹å„ä¸ªæ–¹æ³•çš„æŒæ¡ç¨‹åº¦è¦æ±‚å¾ˆé«˜ã€‚äº‹å®ä¸Šï¼Œç²¾é€šä¸€ç§æ–¹æ³•å°±å·²ç»æ»¡è¶³éœ€è¦äº†ï¼Œå†æ­¤åŸºç¡€ä¹‹ä¸Šï¼Œç”¨è¾…åŠ©å·¥å…·å¸®åŠ©ç†è§£æé«˜æ•ˆç‡ã€‚<br>æœ¬æ–‡å°†æä¾›ç»™â€œçˆ¬è™«å¤§å¸ˆä»¬â€ä½¿ç”¨xpathæ–¹æ³•çš„è¾…åŠ©å·¥å…·XPath Helperæ’ä»¶ã€‚</em></p>
<h1 id="XPath-Helperç®€ä»‹"><a href="#XPath-Helperç®€ä»‹" class="headerlink" title="XPath Helperç®€ä»‹"></a>XPath Helperç®€ä»‹</h1><p>XPathå³ä¸ºXMLè·¯å¾„è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨æ¥ç¡®å®šXML(æ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†)æ–‡æ¡£ä¸­æŸéƒ¨åˆ†ä½ç½®çš„è¯­è¨€ã€‚XPathåŸºäºXMLçš„æ ‘çŠ¶ç»“æ„ï¼Œæä¾›åœ¨æ•°æ®ç»“æ„æ ‘ä¸­æ‰¾å¯»èŠ‚ç‚¹çš„èƒ½åŠ›ã€‚èµ·åˆXPathçš„æå‡ºçš„åˆè¡·æ˜¯å°†å…¶ä½œä¸ºä¸€ä¸ªé€šç”¨çš„ã€ä»‹äºXPointerä¸XSLé—´çš„è¯­æ³•æ¨¡å‹ã€‚<br>XPath Helperæ˜¯ä¸€æ¬¾ä¸“ç”¨äºchromeå†…æ ¸æµè§ˆå™¨çš„å®ç”¨å‹çˆ¬è™«ç½‘é¡µè§£æå·¥å…·ã€‚XPath Helperæ’ä»¶åŠŸèƒ½å¼ºåŠ²ï¼Œæ”¯æŒè¿›è¡ŒXPathæŸ¥è¯¢åŠŸèƒ½ã€‚XPath Helpæ’ä»¶å¯ä»¥å¸®åŠ©ç”¨æˆ·åœ¨å„ç±»ç½‘ç«™ä¸Šé€šè¿‡æŒ‰shifté”®é€‰æ‹©æƒ³è¦æŸ¥çœ‹çš„é¡µé¢å…ƒç´ æ¥æå–æŸ¥è¯¢å…¶ä»£ç ï¼ŒåŒæ—¶è¿˜æ”¯æŒç”¨æˆ·å¯¹æŸ¥è¯¢å‡ºæ¥çš„ä»£ç è¿›è¡Œç¼–è¾‘ï¼Œè€Œç¼–è¾‘å‡ºçš„ç»“æœå°†ç«‹å³æ˜¾ç¤ºåœ¨æ—è¾¹çš„ç»“æœæ¡†ä¸­ã€‚</p>
<h1 id="XPath-Helperå®‰è£…æ–¹æ³•"><a href="#XPath-Helperå®‰è£…æ–¹æ³•" class="headerlink" title="XPath Helperå®‰è£…æ–¹æ³•"></a>XPath Helperå®‰è£…æ–¹æ³•</h1><ol>
<li>æ ¹æ®ä¸‹é¢çš„é“¾æ¥å°†æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚<br>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/18_Ws5qjHW9skhE1cb1jtYA">https://pan.baidu.com/s/18_Ws5qjHW9skhE1cb1jtYA</a><br>æå–ç ï¼šx0no</li>
<li>ä¸‹è½½å®Œæˆåï¼Œå°†æ–‡ä»¶çš„åç¼€åæ”¹ä¸ºâ€œ.zipâ€ï¼Œå¹¶è¿›è¡Œè§£å‹ã€‚</li>
<li>è§£å‹ä¹‹åæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œå°†æ–‡ä»¶åä¸ºâ€œ2.0.2_0.crxâ€åç¼€åæ”¹ä¸ºâ€œ.zipâ€ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒäºŒæ¬¡è§£å‹ã€‚<br>==è‡³æ­¤ï¼Œæ‰€æœ‰å¼¹å‡ºçš„æç¤ºè¯­å¥å…¨éƒ¨é€‰æ‹©  æ˜¯==</li>
<li>äºŒæ¬¡è§£å‹å®Œæˆï¼Œè·å¾—å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ–‡ä»¶å¤¹ã€‚å¦‚æœçº¢è‰²æ¡†å†…æ–‡ä»¶å¤¹å¦‚å›¾æ‰€ç¤ºï¼Œå°†â€œ_metadataâ€æ”¹ä¸ºâ€œmetadataâ€ã€‚å¦‚æœé»˜è®¤å°±æ˜¯â€œmetadataâ€åˆ™ä¸éœ€è¦åšä»»ä½•æ“ä½œã€‚<br><img src="/images/third-party/xpath-1.png"></li>
<li>è¿›å…¥è‡ªå·±å¯¹åº”çš„æµè§ˆå™¨ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¥Googleæµè§ˆå™¨ä¸ºåŸºç¡€æ“ä½œã€‚</li>
</ol>
<pre><code>**ç‚¹å‡»è°·æ­Œå³ä¸Šè§’çš„ä¸‰ä¸ªç‚¹çš„æŒ‰é’®
é€‰æ‹©æ›´å¤šå·¥å…·â€”â€”&gt;é€‰æ‹©æ‰©å±•ç¨‹åº
è¿›å…¥ï¼Œæ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºï¼Œé€‰æ‹©ç›¸åº”çš„å·²è§£å‹çš„æ–‡ä»¶ï¼Œç¡®è®¤ï¼
é‡å¯æµè§ˆå™¨ï¼Œç¡®è®¤å¯ä»¥æ­£å¸¸ä½¿ç”¨**
</code></pre>
<ol start="6">
<li>å¦‚ä¸‹å›¾è¡¨ç¤ºåˆ›å»ºæˆåŠŸã€‚<img src="/images/third-party/xpath-2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ol>
<h1 id="XPath-Helperç®€å•ä½¿ç”¨æ–¹æ³•"><a href="#XPath-Helperç®€å•ä½¿ç”¨æ–¹æ³•" class="headerlink" title="XPath Helperç®€å•ä½¿ç”¨æ–¹æ³•"></a>XPath Helperç®€å•ä½¿ç”¨æ–¹æ³•</h1><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><ol>
<li>è·å–é¡µé¢å…ƒç´ çš„xpathåœ°å€ã€‚</li>
<li>éªŒè¯ç”¨æˆ·è‡ªå·±å†™çš„xpathåœ°å€æ˜¯å¦æ­£ç¡®ã€‚</li>
</ol>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><ul>
<li>æ‰“å¼€/å…³é—­XPath Helperå¿«æ·é”®ï¼šCtrl+Shift+x</li>
<li>æ‰“å¼€Xpath Helperåçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º<br> <img src="/images/third-party/xpath-3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>æ‰“å¼€è¯¥æ’ä»¶çš„æƒ…å†µä¸‹ï¼ŒæŒ‰ä½Shiftåœ¨é¡µé¢å†…è¿›è¡Œç§»åŠ¨ï¼Œé¼ æ ‡æ‰€ç»è¿‡ä¹‹å¤„ä¼šæœ‰é»„è‰²æ–¹æ¡†æ˜¾ç¤ºï¼Œä¸‹å›¾ä¸ºåœ¨CSDNé¦–é¡µï¼Œé€‰ä¸­æ ‡é¢˜å¼•å¯¼æ¡†çš„ç»“æœã€‚å·¦ä¾§çš„queryæ¡†å†…å³ä¸ºé€‰ä¸­å†…å®¹çš„xpathåœ°å€ã€‚<br><img src="/images/third-party/xpath-4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>å¦‚æœä½œä¸ºéªŒè¯çš„æ–¹æ³•ï¼Œåœ¨queryæ¡†å†…å†™å…¥è‡ªå·±å†™å…¥xpathåœ°å€ï¼Œçœ‹resultæ¡†å†…æ˜¯å¦æ˜¯è‡ªå·±æƒ³è¦æŠ“å–çš„å…ƒç´ ï¼Œå¦‚æœä¸æ­£ç¡®ï¼Œå¯ä»¥å®æ—¶åœ¨queryå†…è¿›è¡Œä¿®æ”¹ï¼Œç›´è‡³è·å¾—æ­£ç¡®xpathåœ°å€ã€‚<br><img src="/images/third-party/xpath-5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ul>
]]></content>
      <categories>
        <category>Tools</category>
      </categories>
  </entry>
  <entry>
    <title>LwIP+websocket</title>
    <url>/2023/04/19/third-party/lwip+websocket/</url>
    <content><![CDATA[<h1 id="WebSocketæµç¨‹"><a href="#WebSocketæµç¨‹" class="headerlink" title="WebSocketæµç¨‹"></a>WebSocketæµç¨‹</h1><blockquote>
<p>websocket <a href="https://github.com/dhbaird/easywsclient">https://github.com/dhbaird/easywsclient</a></p>
</blockquote>
<h2 id="Serverç«¯"><a href="#Serverç«¯" class="headerlink" title="Serverç«¯"></a>Serverç«¯</h2><ol>
<li>socket()</li>
<li>bind()</li>
<li>listen()</li>
<li>accept()</li>
<li>recv()</li>
</ol>
<h2 id="Clientç«¯"><a href="#Clientç«¯" class="headerlink" title="Clientç«¯"></a>Clientç«¯</h2><ol>
<li>socket()</li>
<li>connect()</li>
<li>send()</li>
</ol>
<h1 id="Lwip-API"><a href="#Lwip-API" class="headerlink" title="Lwip-API"></a>Lwip-API</h1><h2 id="lwip-socket"><a href="#lwip-socket" class="headerlink" title="lwip_socket"></a>lwip_socket</h2><ul>
<li><p>åŠŸèƒ½ï¼šç”¨äºæ ¹æ®æŒ‡å®šçš„åœ°å€æ—ã€æ•°æ®ç±»å‹å’Œåè®®æ¥åˆ†é…ä¸€ä¸ªå¥—æ¥å£çš„æè¿°å­—åŠå…¶æ‰€ç”¨çš„èµ„æºçš„å‡½æ•°</p>
</li>
<li><p>å‡½æ•°åŸå‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> socket(domain,type,protocol)	  lwip_socket(domain,type,protocol)</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å‚æ•°é€‰é¡¹</p>
<ul>
<li><p>domainï¼šåœ°å€æ—AF_INETï¼ˆIP_V4ï¼‰ã€AF_INET6(IP_V6)</p>
</li>
<li><p>typeï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SOCK_STREAM     1 <span class="comment">//æµå¼å¥—æ¥å­—æä¾›å¯é çš„ã€é¢å‘è¿æ¥çš„é€šä¿¡æµï¼›å®ƒä½¿ç”¨TCP åè®®ï¼Œä»è€Œä¿è¯äº†æ•°æ®ä¼ è¾“çš„æ­£ç¡®æ€§å’Œé¡ºåºæ€§ã€‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SOCK_DGRAM      2<span class="comment">// æ•°æ®æŠ¥å¥—æ¥å­—å®šä¹‰äº†ä¸€ç§æ— è¿æ¥çš„æœ ï¼Œæ•°æ®é€šè¿‡ç›¸äº’ç‹¬ç«‹çš„æŠ¥æ–‡è¿›è¡Œä¼ è¾“ï¼Œæ˜¯æ— åºçš„ï¼Œå¹¶ä¸”ä¸ä¿è¯æ˜¯å¯é ã€æ— å·®é”™çš„ã€‚å®ƒä½¿ç”¨æ•°æ®æŠ¥åè®®UDPã€‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SOCK_RAW        3<span class="comment">// åŸå§‹å¥—æ¥å­—å…è®¸å¯¹åº•å±‚åè®®å¦‚IPæˆ–ICMPè¿›è¡Œç›´æ¥è®¿é—®ï¼ŒåŠŸèƒ½å¼ºå¤§ä½†ä½¿ç”¨è¾ƒä¸ºä¸ä¾¿ï¼Œä¸»è¦ç”¨äºä¸€äº›åè®®çš„å¼€å‘ã€‚</span></span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ptotocol</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IPPROTO_IP      0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IPPROTO_ICMP    1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IPPROTO_TCP     6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IPPROTO_UDP     17</span></span><br><span class="line"><span class="comment">// ä¸€èˆ¬è‡ªåŠ¨è®¾ç½®ä¸º0, ç³»ç»Ÿè‡ªåŠ¨è®¾ç½®åˆé€‚çš„åè®®</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ul>
<h2 id="lwip-connect"><a href="#lwip-connect" class="headerlink" title="lwip_connect"></a>lwip_connect</h2><ul>
<li><p>å‡½æ•°åŠŸèƒ½ï¼šç”¨äºå»ºç«‹ä¸æŒ‡å®šsocketçš„è¿æ¥ã€‚ä¸€èˆ¬ç”¨äºå®¢æˆ·ç«¯ï¼Œ</p>
</li>
<li><p>å‡½æ•°åŸå‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> connect (s,	name, namelen)	   lwip_connect(s,name,namelen)</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å‚æ•°</p>
<ul>
<li>s ï¼šsocket()è¿”å›æ–‡ä»¶æè¿°ç¬¦ä»£è¡¨çš„å¥—æ¥å­—</li>
<li>const struct sockaddr *nameï¼šå­˜æ”¾äº†æœåŠ¡ç«¯ç”¨äºé€šä¿¡çš„åœ°å€å’Œç«¯å£ã€‚</li>
<li>socklen_t namelenï¼šnameå‚æ•°ç»“æ„ä½“çš„é•¿åº¦ã€‚</li>
</ul>
</li>
</ul>
<h2 id="lwip-setsockopt"><a href="#lwip-setsockopt" class="headerlink" title="lwip_setsockopt"></a>lwip_setsockopt</h2><ul>
<li><p>åŠŸèƒ½ï¼šè®¾ç½®ä¸æŸä¸ªå¥—æ¥å­—å…³è”çš„é€‰é¡¹ï¼Œå½“æ“ä½œå¥—æ¥å­—é€‰é¡¹æ—¶ï¼Œé€‰é¡¹ä½äºçš„å±‚å’Œé€‰é¡¹çš„åç§°å¿…é¡»ç»™å‡º</p>
</li>
<li><p>å‡½æ•°åŸå‹ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">setsockopt</span><span class="params">(<span class="type">int</span> sock, <span class="type">int</span> level,<span class="type">int</span> optname, <span class="type">const</span> <span class="type">void</span> *optval, <span class="type">socklen_t</span> optlen)</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å‚æ•°é€‰é¡¹</p>
<ul>
<li><p>sockï¼šå°†è¦è¢«è®¾ç½®é€‰é¡¹çš„å¥—æ¥å­—</p>
</li>
<li><p>optnameï¼šéœ€è¦è®¿é—®çš„é€‰é¡¹å</p>
</li>
<li><p>optvalï¼šæŒ‡å‘åŒ…å«æ–°é€‰é¡¹å€¼å¾—ç¼“å†²</p>
</li>
<li><p>optlenï¼šç°é€‰é¡¹çš„é•¿åº¦</p>
</li>
<li><p>levelï¼šå‚æ•°ï¼ˆlevelï¼‰è¯¦ç»†è¯´æ˜ï¼šlevelæ˜¯æŒ‡å®šæ§åˆ¶å¥—æ¥å­—çš„å±‚æ¬¡ï¼Œå¯ä»¥å–å¦‚ä¸‹ä¸‰ç§å€¼</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">é€‰é¡¹åç§°(optname)ã€€ã€€ã€€è¯´æ˜ã€€ã€€ã€€ã€€ã€€          ã€€ã€€ã€€ã€€æ•°æ®ç±»å‹</span><br><span class="line">========================================================================</span><br><span class="line">SO_BROADCASTã€€ã€€ã€€ã€€ã€€ å…è®¸å‘é€å¹¿æ’­æ•°æ®ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="type">int</span></span><br><span class="line">SO_DEBUGã€€ã€€ã€€ã€€ã€€ã€€ã€€  å…è®¸è°ƒè¯•ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_DONTROUTEã€€ã€€ã€€ã€€ã€€ã€€ä¸æŸ¥æ‰¾ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_ERRORã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€è·å¾—å¥—æ¥å­—é”™è¯¯ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_KEEPALIVEã€€ã€€ã€€ã€€ã€€ã€€ä¿æŒè¿æ¥ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_LINGERã€€ã€€ã€€ã€€ã€€ã€€ã€€ å»¶è¿Ÿå…³é—­è¿æ¥ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="keyword">struct</span> linger</span><br><span class="line">SO_OOBINLINEã€€ã€€ã€€ã€€ã€€ã€€å¸¦å¤–æ•°æ®æ”¾å…¥æ­£å¸¸æ•°æ®æµã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_RCVBUFã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ¥æ”¶ç¼“å†²åŒºå¤§å°ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_SNDBUFã€€ã€€ã€€ã€€ã€€ã€€ã€€ å‘é€ç¼“å†²åŒºå¤§å°ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_RCVLOWATã€€ã€€ã€€ã€€ã€€ã€€ æ¥æ”¶ç¼“å†²åŒºä¸‹é™ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_SNDLOWATã€€ã€€ã€€ã€€ã€€ã€€ å‘é€ç¼“å†²åŒºä¸‹é™ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_RCVTIMEOã€€ã€€ã€€ã€€ã€€ã€€ æ¥æ”¶è¶…æ—¶ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="keyword">struct</span> timeval</span><br><span class="line">SO_SNDTIMEOã€€ã€€ã€€ã€€ã€€ã€€ å‘é€è¶…æ—¶ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="keyword">struct</span> timeval</span><br><span class="line">SO_REUSERADDRã€€ã€€ã€€ã€€ã€€ å…è®¸é‡ç”¨æœ¬åœ°åœ°å€å’Œç«¯å£ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_TYPEã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ è·å¾—å¥—æ¥å­—ç±»å‹ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">SO_BSDCOMPATã€€ã€€ã€€ã€€ã€€ã€€ä¸BSDç³»ç»Ÿå…¼å®¹ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="type">int</span></span><br><span class="line">========================================================================</span><br><span class="line"><span class="comment">// SOL_SOCKETï¼šé€šç”¨å¥—æ¥å­—é€‰é¡¹</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">é€‰é¡¹åç§°(optname)ã€€ã€€ã€€è¯´æ˜ã€€ã€€ã€€ã€€ã€€          ã€€ã€€ã€€ã€€æ•°æ®ç±»å‹</span><br><span class="line">========================================================================</span><br><span class="line">IP_HDRINCLã€€ã€€ã€€ã€€ã€€ã€€ã€€åœ¨æ•°æ®åŒ…ä¸­åŒ…å«IPé¦–éƒ¨ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">IP_OPTINOSã€€ã€€ã€€ã€€ã€€ã€€ã€€IPé¦–éƒ¨é€‰é¡¹ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="type">int</span></span><br><span class="line">IP_TOSã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ç±»å‹</span><br><span class="line">IP_TTLã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ç”Ÿå­˜æ—¶é—´ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="type">int</span></span><br><span class="line">========================================================================</span><br><span class="line"><span class="comment">//IPPROTO_IPï¼šIPé€‰é¡¹</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">é€‰é¡¹åç§°(optname)ã€€ã€€ã€€è¯´æ˜ã€€ã€€ã€€ã€€ã€€          ã€€ã€€ã€€ã€€æ•°æ®ç±»å‹</span><br><span class="line">========================================================================</span><br><span class="line">TCP_MAXSEGã€€ã€€ã€€ã€€ã€€ã€€TCPæœ€å¤§æ•°æ®æ®µçš„å¤§å°ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="type">int</span></span><br><span class="line">TCP_NODELAYã€€ã€€ã€€ã€€ã€€ ä¸ä½¿ç”¨Nagleç®—æ³•ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="type">int</span></span><br><span class="line">========================================================================</span><br><span class="line"><span class="comment">// IPPROTO_TCPï¼šTCPé€‰é¡¹  </span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ul>
<h2 id="lwip-fcntl"><a href="#lwip-fcntl" class="headerlink" title="lwip_fcntl"></a>lwip_fcntl</h2><ul>
<li>åŠŸèƒ½ï¼šfcntl çš„æœ€å°å®ç°ã€‚ ç›®å‰ä»…å®ç°äº†å‘½ä»¤ F_GETFL å’Œ F_SETFLã€‚ åªæœ‰æ ‡å¿— O_NONBLOCK è¢«å®ç°ã€‚</li>
</ul>
<h2 id="lwip-send-x2F-lwip-sendto-x2F-lwip-write"><a href="#lwip-send-x2F-lwip-sendto-x2F-lwip-write" class="headerlink" title="lwip_send / lwip_sendto / lwip_write"></a>lwip_send / lwip_sendto / lwip_write</h2><ul>
<li><p>åŠŸèƒ½ï¼šå‘é€æ•°æ®</p>
</li>
<li><p>åŒºåˆ«ï¼š</p>
<ul>
<li>lwip_sendï¼šæ ¸å¿ƒï¼Œ æœ€ç»ˆçš„è°ƒç”¨</li>
<li>lwip_writeï¼šç›´æ¥è°ƒç”¨lwip_send</li>
<li>Lwip_sendtoï¼šç›¸è¾ƒäºlwip_toå¤šäº†è¿œç¨‹ä¸»æœºçš„ipåœ°å€å’Œç«¯å£å·ç›¸å…³çš„å‚æ•°ï¼Œå¤„ç†ä¸­å¤šäº†netconn_connectçš„è°ƒç”¨ï¼ˆlwip_connect + lwip_sendï¼‰</li>
</ul>
</li>
<li><p>å‡½æ•°åŸå‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> sendmsg	(s,	messageï¼Œflags )	   lwip_sendmsg(s,message,flags)</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h2 id="lwip-select"><a href="#lwip-select" class="headerlink" title="lwip_select"></a>lwip_select</h2><ul>
<li><p>åŠŸèƒ½ï¼šç”¨äºI/Oå¤šè·¯å¤ç”¨çš„APIï¼Œä½¿ç”¨selectå¯ä»¥åŒæ—¶ç›‘å¬å¤šä¸ªsocketçš„çŠ¶æ€ï¼Œä»¥ä¾¿è¯»å†™æ•°æ®</p>
</li>
<li><p>åŸå‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> select	(maxfdp1,readset,writeset,exceptset,timeout)</span></span><br><span class="line">		lwip_select(maxfdp1,readset,writeset,exceptset,timeout)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å‚æ•°å«ä¹‰</p>
<ul>
<li><p>maxfdp1ï¼šè¦æ£€æŸ¥çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°ç›®ï¼Œä¸€èˆ¬æ˜¯æœ€å¤§dp+1</p>
</li>
<li><p>readset/writeset/exceptsetï¼š</p>
<p>fd_setç±»å‹ï¼ŒæŒ‡å‘éœ€è¦ç›‘å¬çš„å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸äº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆ</p>
</li>
</ul>
</li>
</ul>
<h2 id="lwip-recv"><a href="#lwip-recv" class="headerlink" title="lwip_recv"></a>lwip_recv</h2><ul>
<li><p>å‡½æ•°åŠŸèƒ½ï¼šæ¥å—æ•°æ®</p>
</li>
<li><p>å‡½æ•°åŸå‹</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> recv(s,	mem,len,flags)	   lwip_recv(s,mem,len,flags)</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>Qï¼šè°ƒç”¨lwip_send / lwip_recvæ—¶å‡ºç°WSAEWOULDBLOCK / WSAEINPROGRESS</p>
<p>Aï¼šæœ¬è´¨ä¸Šä»¥ä¸Šä¸¤ä¸ªé”™è¯¯ç ä¸æ˜¯é”™è¯¯ï¼Œè€Œæ˜¯ä¸€ç§è­¦å‘Šï¼Œæ¥æ”¶æ–¹å‘Šè¯‰å‘é€æ–¹å®ƒç°åœ¨å¤„äºbusyçŠ¶æ€</p>
<p>â€‹		WSAEWOULDBLOCKçš„æ„æ€æ˜¯output bufferå·²ç»æ»¡äº†ï¼Œæ— æ³•å†å†™å…¥æ•°æ®ã€‚æŒ‰ç…§ç½‘ä¸Šåšä¸»çš„è¯´æ³•ï¼Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹å…¶å®ä¸ä¼šå‡ºç°bufferæ»¡çš„æƒ…å†µï¼Œè€Œæ˜¯		å¤„äºbusyçŠ¶æ€ã€‚æˆ‘ç†è§£çš„è¿™ä¸overrunçš„æ„æ€å·®ä¸å¤šï¼Œåªä¸è¿‡è¿™é‡Œä¸ä¼šå¯¹æ•°æ®æ­£ç¡®æ€§ã€å®Œæ•´æ€§é€ æˆå½±å“ï¼Œæ¥æ”¶æ–¹å‘Šè¯‰æˆ‘å®ƒçš„ç¼“å†²åŒºæ»¡äº†æˆ–è€…æ•°æ®å·²ç»å¤„ç†		ä¸è¿‡æ¥äº†ï¼Œå®ƒä¸å†æ¥å—æ•°æ®äº†ï¼Œæ‰€ä»¥ç»™æˆ‘ä»¬ä¸€ä¸ªå¼‚å¸¸ã€‚</p>
<p>â€‹		WSAEINPROGRESS:ä¸€ä¸ªé˜»å¡çš„WINDOWSå¥—æ¥å£è°ƒç”¨æ­£åœ¨è¿è¡Œä¸­ã€‚</p>
<p>è§£å†³ï¼šå½“å‡ºç° WSAEWOULDBLOCK å¼‚å¸¸åç›´åˆ°ç©ºå‡º Output Buffer æ—¶ï¼Œç³»ç»Ÿä¼šå‘é€ä¸€ä¸ª FD_WRITE ç»™å‘é€æ–¹ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨ç­‰æ”¶åˆ° FD_WRITE æ¶ˆæ¯åå†é‡æ–°å‘é€ä»å‡ºç°å¼‚å¸¸å¼€å§‹çš„æ•°æ®åŒ…å³å¯ï¼ˆè¯¥åŒ…éœ€è¦å…¨éƒ¨é‡æ–°å‘é€ï¼‰ã€‚</p>
<blockquote>
<p><a href="https://bbs.csdn.net/topics/70198557">å‚è€ƒé“¾æ¥</a></p>
</blockquote>
</li>
<li></li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><p><a href="https://blog.csdn.net/wwwyue1985/article/details/113789192">Lwipä¹‹APIæ¥å£ä¸åŸç†</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_39854159/article/details/120693512">LWIPå­¦ä¹ ä¹‹Socket ï¼ˆAPIç¯‡ï¼‰</a></p>
</li>
<li><p><a href="https://www.nongnu.org/lwip/2_0_x/group__socket.html#gae3d13671f622e17c17317c9a16dfd0ee">Lwip API</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>Third Party</category>
      </categories>
      <tags>
        <tag>lwip websocket</tag>
      </tags>
  </entry>
  <entry>
    <title>LwIPåè®®æ ˆ</title>
    <url>/2022/11/30/third-party/lwip/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>Lwipå®˜ç½‘ï¼š<a href="https://savannah.nongnu.org/projects/lwip/">https://savannah.nongnu.org/projects/lwip/</a></p>
</blockquote>
<p>LWIPï¼ˆlight weight ipï¼‰è½»å‹IPåè®®ï¼Œæœ‰æ— æ“ä½œç³»ç»Ÿçš„æ”¯æŒéƒ½å¯ä»¥è¿è¡Œã€‚LwIPå®ç°çš„é‡ç‚¹æ˜¯åœ¨ä¿æŒTCPåè®®ä¸»è¦åŠŸèƒ½çš„åŸºç¡€ä¸Šå‡å°‘å¯¹RAM çš„å ç”¨ï¼Œå®ƒåªéœ€åå‡ KBçš„RAMå’Œ40Kå·¦å³çš„ROMå°±å¯ä»¥è¿è¡Œï¼Œè¿™ä½¿LwIPåè®®æ ˆé€‚åˆåœ¨ä½ç«¯çš„åµŒå…¥å¼ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚</p>
<p>LWIPæ”¯æŒçš„åè®®ç§ç±»ï¼š</p>
<ul>
<li>DNSï¼ŒåŸŸåè§£æï¼›</li>
<li>SNMPï¼Œç®€å•ç½‘ç»œç®¡ç†åè®®ï¼›</li>
<li>DHCPï¼ŒåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼›</li>
<li>UDP åè®®ï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼›</li>
<li>TCP åè®®ï¼Œæ”¯æŒ TCP æ‹¥å¡æ§åˆ¶ï¼Œ RTT ä¼°è®¡ï¼Œå¿«é€Ÿæ¢å¤ä¸é‡ä¼ ç­‰ï¼›</li>
<li>IP åè®®ï¼ŒåŒ…æ‹¬ IPv4 å’Œ IPv6ï¼Œæ”¯æŒ IP åˆ†ç‰‡ä¸é‡è£…ï¼Œæ”¯æŒå¤šç½‘ç»œæ¥å£ä¸‹æ•°æ®è½¬å‘ï¼›</li>
<li>AUTOIPï¼Œ IP åœ°å€è‡ªåŠ¨é…ç½®ï¼›</li>
<li>ICMP åè®®ï¼Œç”¨äºç½‘ç»œè°ƒè¯•ä¸ç»´æŠ¤ï¼›</li>
<li>IGMP åè®®ï¼Œç”¨äºç½‘ç»œç»„ç®¡ç†ï¼Œå¯ä»¥å®ç°å¤šæ’­æ•°æ®çš„æ¥æ”¶ï¼›</li>
<li>ARP åè®®ï¼Œä»¥å¤ªç½‘åœ°å€è§£æåè®®ï¼›</li>
<li>PPPï¼Œç‚¹å¯¹ç‚¹åè®®ï¼Œæ”¯æŒ PPPoE</li>
</ul>
<h1 id="LwIPæ¶æ„"><a href="#LwIPæ¶æ„" class="headerlink" title="LwIPæ¶æ„"></a>LwIPæ¶æ„</h1><p>LwIP ç¬¦åˆ TCP/IP æ¨¡å‹æ¶æ„ï¼Œè§„å®šäº†æ•°æ®çš„æ ¼å¼ã€ä¼ è¾“ã€è·¯ç”±å’Œæ¥æ”¶ï¼Œä»¥å®ç°ç«¯åˆ°ç«¯çš„é€šä¿¡ã€‚ æ­¤æ¨¡å‹åŒ…æ‹¬å››ä¸ªæŠ½è±¡å±‚ï¼Œç”¨äºæ ¹æ®æ¶‰åŠçš„ç½‘ç»œèŒƒå›´ï¼Œå¯¹æ‰€æœ‰ç›¸å…³åè®®æ’åºã€‚è¿™å‡  å±‚ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼š</p>
<ul>
<li><p>é“¾è·¯å±‚åŒ…å«äº†å±€åŸŸç½‘çš„å•ç½‘æ®µ ï¼ˆé“¾è·¯ï¼‰é€šä¿¡æŠ€æœ¯</p>
</li>
<li><p>ç½‘é™…å±‚ ï¼ˆIPï¼‰å°†ç‹¬ç«‹çš„ç½‘ç»œè¿æ¥èµ·æ¥ï¼Œå»ºç«‹äº’è”</p>
</li>
<li><p>ä¼ è¾“å±‚å¤„ç†ä¸»æœºç«¯å£åˆ°ä¸»æœºç«¯å£çš„é€šä¿¡</p>
</li>
<li><p>åº”ç”¨å±‚åœ¨å®ç°å¤šä¸ªåº”ç”¨è¿›ç¨‹ç›¸äº’é€šä¿¡çš„åŒæ—¶ï¼Œå®Œæˆåº”ç”¨æ‰€éœ€çš„æœåŠ¡ ï¼ˆä¾‹å¦‚ï¼šæ•°æ®å¤„ç†ï¼‰</p>
<p><img src="/images/third-party/lwip.png"></p>
</li>
</ul>
<h1 id="ç¼–ç¨‹æ¨¡å¼"><a href="#ç¼–ç¨‹æ¨¡å¼" class="headerlink" title="ç¼–ç¨‹æ¨¡å¼"></a>ç¼–ç¨‹æ¨¡å¼</h1><h2 id="RAW-API"><a href="#RAW-API" class="headerlink" title="RAW API"></a>RAW API</h2><p>å†…æ ¸å›è°ƒå‹APIï¼Œå½“åˆå§‹åŒ–åº”ç”¨æ—¶ï¼Œç”¨æˆ·éœ€è¦ä¸ºä¸åŒå†…æ ¸äº‹ä»¶æ³¨å†Œæ‰€éœ€çš„å›è°ƒå‡½æ•° ï¼ˆä¾‹å¦‚ TCP_Sentã€ TCP_errorâ€¦ï¼‰ã€‚å½“ç›¸åº”äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ LwIP ä¼šè‡ªå‘åœ°è°ƒç”¨ç›¸å…³çš„å›è°ƒå‡½æ•°ã€‚<em>æ²¡æœ‰æ“ä½œç³»ç»Ÿæ”¯æŒä¸­ï¼Œåªèƒ½ä½¿ç”¨RAW APIå¼€å‘</em></p>
<table>
<thead>
<tr>
<th></th>
<th>API</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>TCPè¿æ¥å»ºç«‹</td>
<td>tcp_new</td>
<td>å»ºç«‹ä¸€ä¸ªæ–°çš„ TCP PCB ï¼ˆåè®®æ§åˆ¶å—ï¼‰ã€‚</td>
</tr>
<tr>
<td></td>
<td>tcp_bind</td>
<td>å°† TCP PCB ç»‘å®šåˆ°æœ¬åœ° IP åœ°å€å’Œç«¯å£ã€‚</td>
</tr>
<tr>
<td></td>
<td>tcp_listen</td>
<td>å¯åŠ¨ TCP PCB ä¸Šçš„ç›‘å¬è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td></td>
<td>tcp_accept</td>
<td>æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œè¿æ¥æˆåŠŸå»ºç«‹åè°ƒç”¨ã€‚</td>
</tr>
<tr>
<td></td>
<td>tcp_connect</td>
<td>å‘é€è¿æ¥å»ºç«‹è¯·æ±‚ã€‚</td>
</tr>
<tr>
<td>å‘é€TCPæ•°æ®</td>
<td>tcp_write</td>
<td>å°†å‘é€æ•°æ®å†™å…¥ TCP ç¼“å†²åŒºä¸­ã€‚</td>
</tr>
<tr>
<td></td>
<td>tcp_sent</td>
<td>æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œæ•°æ®å‘é€æˆåŠŸåè°ƒç”¨ã€‚</td>
</tr>
<tr>
<td></td>
<td>tcp_output</td>
<td>å‘é€ TCP ç¼“å†²åŒºä¸­çš„æ•°æ®</td>
</tr>
<tr>
<td>æ¥æ”¶TCPæ•°æ®</td>
<td>tcp_recv</td>
<td>æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œ TCP æ¥æ”¶åˆ°æ•°æ®åè°ƒç”¨</td>
</tr>
<tr>
<td>åº”ç”¨è½®è¯¢</td>
<td>tcp_poll</td>
<td>æ³¨å†Œå›è°ƒå‡½æ•°ï¼ŒTCPæ…¢å®šæ—¶å™¨è°ƒç”¨ï¼ˆ500msä¸€æ¬¡ï¼‰ã€‚</td>
</tr>
<tr>
<td>å…³é—­å¹¶ç»ˆæ­¢è¿æ¥</td>
<td>tcp_close</td>
<td>ä¸»åŠ¨å…³é—­ã€‚</td>
</tr>
<tr>
<td></td>
<td>tcp_err</td>
<td>æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå‡ºé”™æ—¶è°ƒç”¨ã€‚</td>
</tr>
<tr>
<td></td>
<td>tcp_abort</td>
<td>ä¸­æ­¢è¿æ¥ï¼Œå‘è¿œç¨‹ä¸»æœºå‘é€ RSTã€‚</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>udp_new</td>
<td>åˆ›å»ºæ–°çš„ UDP PCBã€‚</td>
</tr>
<tr>
<td></td>
<td>udp_remove</td>
<td>ç§»é™¤ UDP PCB å¹¶é‡Šæ”¾ç›¸å…³èµ„æºã€‚</td>
</tr>
<tr>
<td></td>
<td>udp_bind</td>
<td>å°† UDP PCB ä¸æœ¬åœ° IP åœ°å€å’Œç«¯å£ç»‘å®šã€‚</td>
</tr>
<tr>
<td></td>
<td>udp_connect</td>
<td>å»ºç«‹ UDP PCB è¿œç¨‹ IP åœ°å€å’Œç«¯å£ã€‚</td>
</tr>
<tr>
<td></td>
<td>udp_disconnect</td>
<td>ç§»é™¤ UDP PCB è¿œç¨‹ IP å’Œç«¯å£ã€‚</td>
</tr>
<tr>
<td></td>
<td>udp_send</td>
<td>å‘é€ UDP æ•°æ®</td>
</tr>
<tr>
<td></td>
<td>udp_recv</td>
<td>æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå½“æ”¶åˆ°æ–°æ•°æ®æŠ¥æ—¶å³å¯¹å…¶è°ƒç”¨ã€‚</td>
</tr>
</tbody></table>
<h2 id="Netconn-API"><a href="#Netconn-API" class="headerlink" title="Netconn API"></a>Netconn API</h2><p>Netconn API ä¸ºé«˜å±‚æœ‰åº APIï¼Œå…¶æ‰§è¡Œæ¨¡å‹åŸºäºå…¸å‹çš„é˜»å¡å¼æ‰“å¼€ - è¯» - å†™ - å…³é—­æœºåˆ¶ã€‚ è‹¥è¦æ­£å¸¸å·¥ä½œï¼Œæ­¤ API å¿…é¡»å¤„äºå¤šçº¿ç¨‹å·¥ä½œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼éœ€ä¸º LwIP TCP/IP æ ˆå®ç°ä¸“ç”¨çº¿ç¨‹ï¼Œ å¹¶ / æˆ–ä¸ºåº”ç”¨å®ç°å¤šä¸ªçº¿ç¨‹ã€‚</p>
<p>åŸºäºæ“ä½œç³»ç»Ÿçš„IPCæœºåˆ¶ï¼ˆå³ä¿¡å·é‡å’Œé‚®ç®±æœºåˆ¶ï¼‰å®ç°çš„ï¼Œå°†LWIPå†…æ ¸ä»£ç å’Œç½‘ç»œåº”ç”¨ç¨‹åºåˆ†ç¦»æˆäº†ç‹¬ç«‹çš„çº¿ç¨‹ï¼Œå› æ­¤LWIPå†…æ ¸çº¿ç¨‹å°±åªè´Ÿè´£æ•°æ®åŒ…çš„TCP/IPå°è£…å’Œæ‹†å°ï¼Œè€Œä¸ç”¨è¿›è¡Œæ•°æ®çš„åº”ç”¨å±‚å¤„ç†ï¼Œå¤§å¤§æé«˜äº†ç³»ç»Ÿå¯¹ç½‘ç»œæ•°æ®åŒ…çš„å¤„ç†æ•ˆç‡</p>
<table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>netconn_new</td>
<td>åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥ã€‚</td>
</tr>
<tr>
<td>netconn_delete</td>
<td>åˆ é™¤ä¸€ä¸ªå·²æœ‰è¿æ¥ã€‚</td>
</tr>
<tr>
<td>netconn_bind</td>
<td>å°†è¿æ¥ç»‘å®šåˆ°æœ¬åœ° IP åœ°å€å’Œç«¯å£ã€‚</td>
</tr>
<tr>
<td>netconn_connect</td>
<td>è¿æ¥è¿œç¨‹ IP åœ°å€å’Œç«¯å£ã€‚</td>
</tr>
<tr>
<td>netconn_send</td>
<td>é€šè¿‡ UDP å‘é€æ•°æ®ã€‚</td>
</tr>
<tr>
<td>netconn_recv</td>
<td>æ¥æ”¶æ•°æ®ã€‚</td>
</tr>
<tr>
<td>netconn_listen</td>
<td>ç½® TCP netconn å¤„äºç›‘å¬æ¨¡å¼ã€‚</td>
</tr>
<tr>
<td>netconn_accept</td>
<td>æ¥å—æ­£åœ¨ç›‘å¬çŠ¶æ€çš„ TCP è¿æ¥ä¸Šçš„ä¼ å…¥è¿æ¥ã€‚</td>
</tr>
<tr>
<td>netconn_write</td>
<td>é€šè¿‡ TCP æ•°æ® ï¼ˆå°†æ•°æ®å†™å…¥ TCP ç¼“å†²åŒºï¼‰ã€‚</td>
</tr>
<tr>
<td>netconn_close</td>
<td>ä¸»åŠ¨å…³é—­ TCP netconnã€‚</td>
</tr>
</tbody></table>
<h2 id="Socket-API"><a href="#Socket-API" class="headerlink" title="Socket API"></a>Socket API</h2><p>äº†æ ‡å‡† BSD å¥—æ¥å­— APIã€‚å®ƒæ˜¯æœ‰åº APIï¼Œåœ¨å†…éƒ¨æ„å»ºäº Netconn API ä¹‹ä¸Šï¼Œå¯¹ç½‘ç»œè¿æ¥è¿›è¡Œäº†é«˜çº§çš„æŠ½è±¡ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥åƒæ“ä½œæ–‡ä»¶ä¸€æ ·æ“ä½œç½‘ç»œè¿æ¥	</p>
<table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>socket</td>
<td>åˆ›å»ºä¸€ä¸ªæ–°å¥—æ¥å­—ã€‚</td>
</tr>
<tr>
<td>bind</td>
<td>å°†å¥—æ¥å­—ç»‘å®šåˆ° IP åœ°å€å’Œç«¯å£ã€‚</td>
</tr>
<tr>
<td>listen</td>
<td>ç›‘å¬å¥—æ¥å­—è¿æ¥ã€‚</td>
</tr>
<tr>
<td>connect</td>
<td>å°†å¥—æ¥å­—è¿æ¥åˆ°è¿œç¨‹ä¸»æœº IP åœ°å€å’Œç«¯å£ã€‚</td>
</tr>
<tr>
<td>accept</td>
<td>åœ¨å¥—æ¥å­—ä¸Šæ¥å—æ–°è¿æ¥ã€‚</td>
</tr>
<tr>
<td>read</td>
<td>ä»å¥—æ¥å­—è¯»å–æ•°æ®ã€‚</td>
</tr>
<tr>
<td>write</td>
<td>å‘å¥—æ¥å­—å†™å…¥æ•°æ®ã€‚</td>
</tr>
<tr>
<td>close</td>
<td>å…³é—­å¥—æ¥å­— ï¼ˆåˆ é™¤å¥—æ¥å­—ï¼‰ã€‚</td>
</tr>
</tbody></table>
<h1 id="LwIPé…ç½®"><a href="#LwIPé…ç½®" class="headerlink" title="LwIPé…ç½®"></a>LwIPé…ç½®</h1><p>lwipopts.h æ–‡ä»¶å…è®¸ç”¨æˆ·å……åˆ†é…ç½®æ ˆåŠå…¶æ‰€æœ‰æ¨¡å—ã€‚ç”¨æˆ·ä¸éœ€è¦å®šä¹‰ æ‰€æœ‰ LwIP é€‰é¡¹ï¼šå¦‚æœæœªå®šä¹‰æŸé€‰é¡¹ï¼Œåˆ™ä½¿ç”¨ opt.h æ–‡ä»¶ä¸­å®šä¹‰çš„é»˜è®¤å€¼ã€‚å› æ­¤ï¼Œ lwipopts.h æä¾›äº†è¦†ç›–è®¸å¤š lwIP è¡Œä¸ºçš„æ–¹æ³•ã€‚</p>
<table>
<thead>
<tr>
<th><strong>Lwip å†…å­˜é€‰é¡¹</strong></th>
<th><strong>å«ä¹‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td>MEM_SIZE</td>
<td>LwIP å †å†…å­˜å¤§å°ï¼šç”¨äºæ‰€æœ‰ LwIP åŠ¨æ€å†…å­˜åˆ†é…</td>
</tr>
<tr>
<td>MEMP_NUM_PBUF</td>
<td>MEM_REF å’Œ MEM_ROM pbuf æ€»æ•°</td>
</tr>
<tr>
<td>MEMP_NUM_UDP_PCB</td>
<td>UDP PCB ç»“æ„ä½“çš„æ€»æ•°</td>
</tr>
<tr>
<td>MEMP_NUM_TCP_PCB</td>
<td>TCP PCB ç»“æ„ä½“çš„æ€»æ•°</td>
</tr>
<tr>
<td>MEMP_NUM_TCP_PCB_LISTEN</td>
<td>å¤„äºç›‘å¬çŠ¶æ€çš„ TCP PCB æ€»æ•°</td>
</tr>
<tr>
<td>MEMP_NUM_TCP_SEG</td>
<td>æœ€å¤šåŒæ—¶åœ¨ TCP ç¼“å†²é˜Ÿåˆ—ä¸­çš„æŠ¥æ–‡æ®µæ•°é‡</td>
</tr>
<tr>
<td>PBUF_POOL_SIZE</td>
<td>PBUF_POOL ç±»å‹çš„ pbuf æ€»æ•°</td>
</tr>
<tr>
<td>PBUF_POOL_BUFSIZE</td>
<td>PBUF_POOL ç±»å‹ pbuf çš„å¤§å°</td>
</tr>
<tr>
<td>TCP_MSS</td>
<td>æœ€å¤§ TCP æŠ¥æ–‡æ®µ ï¼ˆMTU - IP æŠ¥å¤´å¤§å° - TCP æŠ¥å¤´å¤§å°ï¼‰</td>
</tr>
<tr>
<td>TCP_SND_BUF</td>
<td>å¯¹äºä¸€ä¸ªè¿æ¥ï¼Œ TCP çš„å‘é€ç¼“å†²ç©ºé—´</td>
</tr>
<tr>
<td>TCP_SND_QUEUELEN</td>
<td>TCP å‘é€é˜Ÿåˆ—ä¸­ pbuf çš„æœ€å¤§æ•°</td>
</tr>
<tr>
<td>TCP_WND</td>
<td>TCP æ¥æ”¶çª—å¤§å°</td>
</tr>
</tbody></table>
<h1 id="LwIPå†…å­˜ç®¡ç†"><a href="#LwIPå†…å­˜ç®¡ç†" class="headerlink" title="LwIPå†…å­˜ç®¡ç†"></a>LwIPå†…å­˜ç®¡ç†</h1><p>LwIPæœ‰ä¸¤ç§å†…å­˜ç®¡ç†æ–¹å¼ï¼šå†…å­˜æ± ã€å†…å­˜å †</p>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/jiangjunjie_2005/article/details/26051399#t9">https://blog.csdn.net/jiangjunjie_2005/article/details/26051399#t9</a></p>
<h1 id="å®ç°TCPæœåŠ¡å™¨"><a href="#å®ç°TCPæœåŠ¡å™¨" class="headerlink" title="å®ç°TCPæœåŠ¡å™¨"></a>å®ç°TCPæœåŠ¡å™¨</h1><blockquote>
<p>echoserverå®ç°ï¼š<a href="https://github.com/yangLieee/codebackup/tree/master/iperf">https://github.com/yangLieee/codebackup/tree/master/iperf</a></p>
</blockquote>
<ol>
<li><p>æ–°å»ºæ§åˆ¶å— </p>
<p>ä½¿ç”¨tcp_new()å‡½æ•°å»ºç«‹ä¸€ä¸ªTCPæ§åˆ¶å—ã€‚</p>
</li>
<li><p>ç»‘å®šæ§åˆ¶å—</p>
<p>å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œæ–°å»ºä¸€ä¸ªæ§åˆ¶å¿«åï¼Œéœ€è¦åœ¨æ§åˆ¶å—ä¸Šç»‘å®šæœ¬åœ°IPå’Œç«¯å£ï¼Œä»¥æ–¹ä¾¿å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</p>
</li>
<li><p>æ§åˆ¶å—ä¾¦å¬</p>
<p>ä½¿ç”¨tcp_listenå‡½æ•°ï¼Œå¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œéœ€è¦æ˜¾æ€§è°ƒç”¨tcp_listenå‡½æ•°ä»¥ä½¿æ§åˆ¶å—è¿›å…¥ç›‘å¬çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</p>
</li>
<li><p>å»ºç«‹è¿æ¥</p>
<p>åœ¨tcp_listenå‡½æ•°è¿›å…¥æœåŠ¡å™¨ç›‘å¬çŠ¶æ€åï¼Œéœ€è¦é©¬ä¸Šä½¿ç”¨tcp_acceptå‡½æ•°æ¥æ³¨å†Œä¸€ä¸ªæ¥æ”¶å¤„ç†å‡½æ•°ï¼Œå› ä¸ºä¸€æ—¦æœ‰å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚è¢«æˆåŠŸå»ºç«‹åï¼ŒæœåŠ¡å™¨å°±ä¼šè°ƒç”¨è¿™ä¸ªå¤„ç†å‡½æ•°ã€‚</p>
</li>
<li><p>æ¥å—å¹¶å¤„ç†æ•°æ®</p>
<p>ä¸€æ—¦è¿æ¥æˆåŠŸï¼Œacceptå›è°ƒå‡½æ•°ä¼šè°ƒç”¨tcp_recvå‡½æ•°æ³¨å†Œä¸€ä¸ªæ¥æ”¶å®Œæˆçš„å¤„ç†å‡½æ•°ã€‚å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œæ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„æ•°æ®æˆ–æ“ä½œè¦æ±‚ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸€å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†ã€‚è¿™å…¶å®æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼šæ¥æ”¶åˆ°æ•°æ®åï¼Œé¦–å…ˆé€šçŸ¥æ›´æ–°æ¥å—çª—å£ï¼ˆä½¿ç”¨tcp_recvedå‡½æ•°ï¼‰ï¼Œå¤„ç†å¹¶å‘é€æ•°æ®ï¼ˆä½¿ç”¨tcp_writeå‡½æ•°ï¼‰ï¼Œæ•°æ®å‘é€æˆåŠŸåˆ™æ¸…é™¤å·²å‘é€çš„æ•°æ®ï¼ˆä½¿ç”¨tcp_sentå‡½æ•°ï¼‰ï¼Œæœ€åå…³é—­è¿æ¥ï¼ˆä½¿ç”¨å‡½æ•°tcp_closeï¼‰ã€‚</p>
</li>
</ol>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>Qï¼š<a href="https://blog.csdn.net/tanmx219/article/details/105930028">tcp_recvdæ­£ç¡®è°ƒç”¨æ–¹æ³•</a>ï¼Ÿ</p>
<p>Aï¼šå¾ˆå¤šæºç æ˜¯åœ¨tcp_server_sentå‘é€å‡½æ•°ä¸­è°ƒtcp_recvdï¼Œå¦‚æœç”¨æˆ·ä¸æ˜¯ç”¨æ¥echoï¼ˆç«‹å³å‘å›ç›¸åŒçš„æŠ¥æ–‡ï¼‰ï¼Œè€Œæ˜¯çœŸæ­£è¦å¤„ç†äº‹åŠ¡çš„æ—¶å€™ï¼Œè¿™ç§ç”¨æ³•æ˜¯é”™è¯¯çš„ï¼šæ­¤æ—¶ï¼Œæ¥æ”¶çª—å£å¤§å°ç”±å‘é€çª—å£å†³å®šï¼Œå¦‚æœæ²¡æœ‰å‘é€æ–°æ•°æ®ï¼Œæ¥æ”¶çª—å£å°±ä¼šè¶Šæ¥è¶Šå°ï¼Œç›´åˆ°æœ€åæ— æ³•æ¥æ”¶æ•°æ®ã€‚<strong>æ­£ç¡®çš„ç”¨æ³•æ˜¯ï¼šåœ¨æ”¶åˆ°æ•°æ®åï¼Œåº”ç”¨å±‚è°ƒç”¨tcp_recvedå‡½æ•°æ¢å¤åŸæ¥çš„çª—å£å¤§å°ï¼›è€Œåœ¨å‘é€å‡½æ•°ä¸­ï¼Œä¸ç”¨ç®¡çª—å£çš„äº‹ï¼</strong></p>
</li>
<li><p>Qï¼šè°ƒç”¨lwip iperfæ¥å£ï¼Œæ— æ³•å…³é—­server?</p>
<p>Aï¼šlwip iperfåªæ˜¯å®ç°å½“clientæ–­å¼€è¿æ¥åˆ é™¤æ‰å…¶ç›¸å…³pcbç»“æ„ä½“ï¼Œè€Œæ²¡æœ‰æ–­å¼€tcpè¿æ¥æ²¡æœ‰é‡Šæ”¾ç›‘å¬ç«¯å£ï¼Œä»¿ç…§lwiperf_tcp_closeå‡½æ•°å®ç°ä¸€ä¸ªæ–°çš„é’ˆå¯¹serverå…³é—­çš„æ¥å£å³å¯</p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li><a href="https://www.kancloud.cn/jiejietop/tcpip/988613">LwIPåº”ç”¨å¼€å‘æŒ‡å—</a></li>
<li><a href="https://blog.csdn.net/weixin_54217950/article/details/121344759">ç½‘ç»œåŸºç¡€ä¹‹åè®®æ ˆ</a></li>
<li><a href="https://www.st.com/resource/zh/user_manual/um1713-developing-applications-on-stm32cube-with-lwip-tcpip-stack-stmicroelectronics.pdf">ä½¿ç”¨ LwIP TCP/IP æ ˆåœ¨ STM32Cube ä¸Šå¼€å‘åº”ç”¨</a></li>
<li><a href="https://blog.51cto.com/u_15262460/2883223">LwIPä½¿ç”¨ç»éªŒ</a></li>
<li><a href="https://blog.csdn.net/zhzht19861011/article/details/125322654">TCPå›è°ƒå‡½æ•°æ˜¯ä½•æ—¶è°ƒç”¨çš„</a></li>
<li><a href="https://blog.csdn.net/zhzht19861011/article/details/125278742">åè®®æ ˆä»€ä¹ˆæƒ…å†µä¸‹å‘é€ RST æ ‡å¿—</a></li>
</ol>
]]></content>
      <categories>
        <category>Third Party</category>
      </categories>
      <tags>
        <tag>lwip</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlite</title>
    <url>/2023/04/11/third-party/sqlite3/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>sqliteä¸­æ–‡ç½‘ç«™ï¼š<a href="https://www.sqlite.net.cn/">https://www.sqlite.net.cn/</a></p>
</blockquote>
<p>SQLiteæ˜¯ä¸€ç§Cè¯­è¨€åº“ï¼Œå®ƒå®ç°äº†ä¸€ä¸ª&nbsp;å°å‹ã€å¿«é€Ÿã€è‡ªåŒ…å«ã€é«˜å¯é æ€§ï¼Œ&nbsp;åŠŸèƒ½é½å…¨çš„SQLæ•°æ®åº“å¼•æ“ã€‚SQLiteæ˜¯ä¸–ç•Œä¸Šæœ€å¸¸ç”¨çš„æ•°æ®åº“å¼•æ“ï¼Œå¹¿æ³›åº”ç”¨äºåµŒå…¥å¼é¢†åŸŸã€‚</p>
<p>ä¸å¤§å¤šæ•°å…¶ä»–SQLæ•°æ®åº“ä¸åŒï¼ŒSQLiteæ²¡æœ‰å•ç‹¬çš„æœåŠ¡å™¨è¿›ç¨‹ã€‚SQLiteç›´æ¥è¯»å–å’Œå†™å…¥æ™®é€šç£ç›˜æ–‡ä»¶ã€‚å…·æœ‰å¤šä¸ªè¡¨ï¼Œç´¢å¼•ï¼Œè§¦å‘å™¨å’Œè§†å›¾çš„å®Œæ•´SQLæ•°æ®åº“åŒ…å«åœ¨å•ä¸ªç£ç›˜æ–‡ä»¶ä¸­ã€‚</p>
<h1 id="Shellå‘½ä»¤"><a href="#Shellå‘½ä»¤" class="headerlink" title="Shellå‘½ä»¤"></a>Shellå‘½ä»¤</h1><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ•°æ®åº“</span></span><br><span class="line"># sqlite3 test.db</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line"># .database</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºè¡¨æ ¼</span></span><br><span class="line"># CREATE TABLE <span class="title function_">user</span><span class="params">(Id integer PRIMARY KEY, name text)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥è¯¢è¡¨æ ¼</span></span><br><span class="line"># .tables</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥æ•°æ®</span></span><br><span class="line">#  INSERT INTO user <span class="title function_">VALUES</span><span class="params">(<span class="number">1</span>, <span class="string">'å°å¼ '</span>)</span>;</span><br><span class="line">#  INSERT INTO user <span class="title function_">VALUES</span><span class="params">(<span class="number">2</span>, <span class="string">'å°é™ˆ'</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ•°æ®(ä¸€å®šè¦æœ‰åˆ†å·)</span></span><br><span class="line"><span class="meta"># select * from user;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€€å‡ºå‘½ä»¤è¡Œç¯å¢ƒ</span></span><br><span class="line"># .quit / .<span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºæ•°æ®åº“ç»“æ„</span></span><br><span class="line"># .schema</span><br></pre></td></tr></tbody></table></figure>

<h1 id="çº¦æŸ"><a href="#çº¦æŸ" class="headerlink" title="çº¦æŸ"></a>çº¦æŸ</h1><p>çº¦æŸå°±æ˜¯ç”¨æ¥è¿›ä¸€æ­¥æè¿°æ¯ä¸€åˆ—æ•°æ®å±æ€§çš„ã€‚</p>
<h2 id="éç©º-NOT-NULL"><a href="#éç©º-NOT-NULL" class="headerlink" title="éç©º NOT NULL"></a>éç©º NOT NULL</h2><p>æœ‰ä¸€äº›å­—æ®µæˆ‘ä»¬å¯èƒ½ä¸€æ—¶ä¸çŸ¥åˆ°è¯¥å¡«äº›ä»€ä¹ˆï¼ŒåŒæ—¶å®ƒä¹Ÿæ²¡è®¾å®šé»˜è®¤å€¼ï¼Œ å½“æ·»åŠ æ•°æ®æ—¶ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„å­—æ®µç©ºç€ä¸å¡«ï¼Œç³»ç»Ÿè®¤ä¸ºä»–æ˜¯ NULL å€¼ã€‚ä½†æ˜¯è¿˜æœ‰å¦å¤–ä¸€ç±»å­—æ®µï¼Œå¿…é¡»è¢«å¡«ä¸Šæ•°æ®ï¼Œå¦‚æœä¸å¡«ï¼Œç³»ç»Ÿå°±ä¼šæŠ¥é”™ã€‚ è¿™æ ·çš„å­—æ®µè¢«ç§°ä¸º NOT NULL éç©ºå­—æ®µ,éœ€è¦åœ¨å®šä¹‰è¡¨çš„æ—¶å€™äº‹å…ˆå£°æ˜ã€‚</p>
<h2 id="å”¯ä¸€-UNIQUE"><a href="#å”¯ä¸€-UNIQUE" class="headerlink" title="å”¯ä¸€ UNIQUE"></a>å”¯ä¸€ UNIQUE</h2><p>é™¤äº†ä¸»åˆ—ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›åˆ—ä¹Ÿä¸èƒ½æœ‰é‡å¤å€¼ã€‚</p>
<h2 id="ä¸»é”®-PRIMARY-KEY"><a href="#ä¸»é”®-PRIMARY-KEY" class="headerlink" title="ä¸»é”® PRIMARY KEY"></a>ä¸»é”® PRIMARY KEY</h2><p>ä¸€èˆ¬æ˜¯æ•´æ•°æˆ–è€…å­—ç¬¦ä¸²ï¼Œåªè¦ä¿è¯å”¯ä¸€å°±è¡Œã€‚ åœ¨ SQLite ä¸­ï¼Œä¸»é”®å¦‚æœæ˜¯æ•´æ•°ç±»å‹ï¼Œè¯¥åˆ—çš„å€¼å¯ä»¥è‡ªåŠ¨å¢é•¿ã€‚</p>
<h2 id="å¤–é”®-FOREIGN-KEY"><a href="#å¤–é”®-FOREIGN-KEY" class="headerlink" title="å¤–é”® FOREIGN KEY"></a>å¤–é”® FOREIGN KEY</h2><p>æˆ‘ä»¬çš„æ•°æ®åº“ä¸­å·²ç»æœ‰ Teachers è¡¨äº†ï¼Œå‡å¦‚æˆ‘ä»¬å†å»ºç«‹ä¸€ä¸ª Students è¡¨ï¼Œ è¦æ±‚ Students è¡¨ä¸­çš„æ¯ä¸€ä¸ªå­¦ç”Ÿéƒ½å¯¹åº”ä¸€ä¸ª Teachers è¡¨ä¸­çš„æ•™å¸ˆã€‚ å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ Students è¡¨ä¸­å»ºç«‹ä¸€ä¸ª TeacherId å­—æ®µï¼Œä¿å­˜å¯¹åº”æ•™å¸ˆçš„ Id å·ï¼Œ è¿™æ ·ï¼Œå­¦ç”Ÿå’Œæ•™å¸ˆä¹‹é—´å°±å»ºç«‹äº†å…³ç³»ã€‚ é—®é¢˜æ˜¯ï¼šæˆ‘ä»¬æœ‰å¯èƒ½ç»™å­¦ç”Ÿå­˜å…¥ä¸€ä¸ªä¸åœ¨ Teachers è¡¨ä¸­çš„ TeacherId å€¼ï¼Œ è€Œä¸”å‘ç°ä¸äº†è¿™ä¸ªé”™è¯¯ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æŠŠ Students è¡¨ä¸­ TeacherId å­—æ®µå£°æ˜ä¸ºä¸€ä¸ªå¤–é”®ï¼Œ è®©å®ƒçš„å€¼å¯¹åº”åˆ° Teachers è¡¨ä¸­çš„ Id å­—æ®µä¸Šã€‚ è¿™æ ·ï¼Œä¸€æ—¦åœ¨ Students è¡¨ä¸­å­˜å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„æ•™å¸ˆ Id ï¼Œç³»ç»Ÿå°±ä¼šæŠ¥é”™ã€‚</p>
<h2 id="é»˜è®¤å€¼-DEFAULT"><a href="#é»˜è®¤å€¼-DEFAULT" class="headerlink" title="é»˜è®¤å€¼ DEFAULT"></a>é»˜è®¤å€¼ DEFAULT</h2><p>æœ‰ä¸€äº›ç‰¹åˆ«çš„å­—æ®µåˆ—ï¼Œåœ¨æ¯ä¸€æ¡è®°å½•ä¸­ï¼Œä»–çš„å€¼åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚åªæ˜¯åœ¨ä¸ªåˆ«æƒ…å†µä¸‹æ‰æ”¹ä¸ºåˆ«çš„å€¼ï¼Œè¿™æ ·çš„å­—æ®µåˆ—æˆ‘ä»¬å¯ä»¥ç»™ä»–è®¾ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p>
<h2 id="æ¡ä»¶æ£€æŸ¥-CHECK"><a href="#æ¡ä»¶æ£€æŸ¥-CHECK" class="headerlink" title="æ¡ä»¶æ£€æŸ¥ CHECK"></a>æ¡ä»¶æ£€æŸ¥ CHECK</h2><p>æŸäº›å€¼å¿…é¡»ç¬¦åˆä¸€å®šçš„æ¡ä»¶æ‰å…è®¸å­˜å…¥ï¼Œè¿™æ˜¯å°±éœ€è¦ç”¨åˆ°è¿™ä¸ª CHECK çº¦æŸã€‚</p>
<h1 id="VFSåœ¨linuxä¸‹æ¶æ„å›¾"><a href="#VFSåœ¨linuxä¸‹æ¶æ„å›¾" class="headerlink" title="VFSåœ¨linuxä¸‹æ¶æ„å›¾"></a>VFSåœ¨linuxä¸‹æ¶æ„å›¾</h1><p>Linuxç³»ç»Ÿçš„Userä½¿ç”¨GLIBCï¼ˆPOSIXæ ‡å‡†ã€GUN Cè¿è¡Œæ—¶åº“ï¼‰ä½œä¸ºåº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶åº“ï¼Œç„¶åé€šè¿‡æ“ä½œç³»ç»Ÿï¼Œå°†å…¶è½¬æ¢ä¸ºç³»ç»Ÿè°ƒç”¨SCIï¼ˆsystem-call interfaceï¼‰ï¼ŒSCIæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å®šä¹‰çš„ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œè¿™å±‚æŠ½è±¡å…è®¸ç”¨æˆ·ç¨‹åºçš„I/Oæ“ä½œè½¬æ¢ä¸ºå†…æ ¸çš„æ¥å£è°ƒç”¨ã€‚VFSæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå°†POSIX APIæ¥å£ä¸ä¸åŒå­˜å‚¨è®¾å¤‡çš„å…·ä½“æ¥å£å®ç°è¿›è¡Œäº†åˆ†ç¦»ï¼Œä½¿å¾—åº•å±‚çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€è®¾å¤‡ç±»å‹å¯¹ä¸Šå±‚åº”ç”¨ç¨‹åºé€æ˜ã€‚</p>
<p><img src="/images/third-party/sqlite.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="sqlite3-vfs"><a href="#sqlite3-vfs" class="headerlink" title="sqlite3 vfs"></a>sqlite3 vfs</h1><p>APIï¼š<a href="https://www.sqlite.net.cn/cintro.html">https://www.sqlite.net.cn/cintro.html</a></p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œä¸€ä¸ªVFSç³»ç»Ÿï¼Œæ”¯æŒå¤šä¸ªåˆ›å»ºé€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä½¿èƒ½</span></span><br><span class="line"># sqlite3_vfs_register(sqlite3_vfs *pVfs, <span class="type">int</span> makeDflt)</span><br><span class="line"><span class="comment">// ä½¿ç”¨demo vfsæ›¿æ¢é»˜è®¤çš„vfs</span></span><br><span class="line"># sqlite3_open_v2(<span class="string">"demo.db"</span>, &amp;db, SQLITE_OPEN_READWRITE, <span class="string">"demo"</span>);</span><br></pre></td></tr></tbody></table></figure>



<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.51cto.com/u_15169172/2710683">ä¸€æ–‡ææ‡‚åµŒå…¥å¼æ•°æ®åº“sqlite3</a></p>
]]></content>
      <categories>
        <category>Third Party</category>
      </categories>
      <tags>
        <tag>sqlite</tag>
      </tags>
  </entry>
  <entry>
    <title>Mplayerç¼–è¯‘åŠä½¿ç”¨è¯´æ˜</title>
    <url>/2023/03/07/third-party/mplayer/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>å®˜ç½‘ï¼š<a href="http://www.mplayerhq.hu/design7/news.html">http://www.mplayerhq.hu/design7/news.html</a></p>
</blockquote>
<p><strong>MPlayer</strong>æ˜¯ä¸€æ¬¾å¼€æºçš„å¤šåª’ä½“æ’­æ”¾å™¨ï¼Œä»¥GNUé€šç”¨å…¬å…±è®¸å¯è¯å‘å¸ƒã€‚æ­¤æ¬¾è½¯ä»¶å¯åœ¨å„ä¸»æµæ“ä½œç³»ç»Ÿä½¿ç”¨ï¼Œä¾‹å¦‚Linuxå’Œå…¶ä»–ç±»Unixæ“ä½œç³»ç»Ÿã€å¾®è½¯Windowsç³»ç»ŸåŠè‹¹æœç”µè„‘çš„Mac OS ç³»ç»Ÿã€‚MPlayeræ˜¯å»ºåŸºäºå‘½ä»¤è¡Œç•Œé¢ï¼Œåœ¨å„æ“ä½œç³»ç»Ÿå¯é€‰æ‹©å®‰è£…ä¸åŒçš„å›¾å½¢ç•Œé¢ã€‚</p>
<h1 id="ubuntuä¸‹ç¼–è¯‘è¿‡ç¨‹"><a href="#ubuntuä¸‹ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="ubuntuä¸‹ç¼–è¯‘è¿‡ç¨‹"></a>ubuntuä¸‹ç¼–è¯‘è¿‡ç¨‹</h1><ol>
<li><p>ä¸‹è½½å¹¶è§£å‹æºç æ–‡ä»¶<a href="http://www.mplayerhq.hu/design7/news.html">click here</a></p>
</li>
<li><p>ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼ˆç›®å‰ç›´æ¥èµ°é»˜è®¤å‚æ•°é€‰é¡¹ï¼‰</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç›´æ¥æ‰§è¡Œ./configureé”™è¯¯ï¼Œ--yasm=<span class="string">''</span>å‚æ•°æ˜¯æ ¹æ®æç¤ºæ²¡æœ‰æ‰¾åˆ°yasmï¼Œå¯é€šè¿‡è¯¥å‘½ä»¤ç›´æ¥æ‰§è¡Œ</span></span><br><span class="line">./configure --yasm=''</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ç¼–è¯‘</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">make</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">makeå®Œæˆæ—¢å¯çœ‹åˆ°æ–‡ä»¶å¤¹ä¸‹å­˜åœ¨mplayerå¯æ‰§è¡Œæ–‡ä»¶</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å®‰è£…</p>
</li>
</ol>
   <figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†mplayeråŠä¾èµ–çš„åº“æ–‡ä»¶è¿›è¡Œå®‰è£…, ä¸å®‰è£…ä¹Ÿå¯ä»¥è¿›è¡Œä½¿ç”¨</span></span><br><span class="line">sudo make install</span><br></pre></td></tr></tbody></table></figure>

<h1 id="æºç æ–‡ä»¶"><a href="#æºç æ–‡ä»¶" class="headerlink" title="æºç æ–‡ä»¶"></a>æºç æ–‡ä»¶</h1><ul>
<li><p>vd__*	</p>
<p><strong>video decode</strong>  ä¸è§£ç ç›¸å…³çš„,è§£ç å™¨åªæ˜¯è´Ÿè´£æŠŠè§£ç å®Œæˆçš„å¸§ä¼ è¾“ç»™voï¼Œå¦‚ä½•æ˜¾ç¤ºæ˜¯voçš„å‡½æ•°å®ç°;</p>
</li>
<li><p>vf__*  </p>
<p><strong>video filter</strong>  æ‰€æœ‰è¿‡æ»¤å™¨çš„å®šä¹‰ï¼Œå½“å‘½ä»¤è¡Œè¾“å…¥-vfçš„å‚æ•°ï¼Œè§„åˆ™ä¼šå»ç›¸åº”çš„filterå‡½æ•°è§£æã€‚ä¾‹å¦‚ï¼š -vf rotate=2,vf_rotate.cçš„å‡½æ•°è¿›è¡Œè¿›è¡Œrotateå‡½æ•°çš„è§£æã€‚</p>
</li>
<li><p>vo_*</p>
<p><strong>video output</strong>   è¾“å‡ºçš„å‡½æ•°å®šä¹‰ï¼Œæ¯ä¸€ä¸ªå‡½æ•°å¯¹åº”å®ç°ä¸€ç§æˆ–å‡ ç§çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼švo_md5sum.cå¾—åˆ°md5çš„ä¸€ä¸ªå€¼</p>
</li>
<li><p>DOCS æ–‡æ¡£</p>
</li>
</ul>
<h1 id="mplayeræµç¨‹"><a href="#mplayeræµç¨‹" class="headerlink" title="mplayeræµç¨‹"></a>mplayeræµç¨‹</h1><ol>
<li><p>è°ƒç”¨ AddExceptï¼ˆï¼‰æ³¨å†Œå¼‚å¸¸å¤„ç†å‡½æ•°</p>
</li>
<li><p>initmplayer();   //åˆå§‹åŒ–ï¼Œåˆ›å»ºå¿«è¿›å’Œæš‚åœçš„ä¿¡å·é‡</p>
</li>
<li><p>InitTimer();åˆå§‹åŒ–è®¡æ—¶å™¨</p>
</li>
<li><p>mp_msg_init();åˆå§‹åŒ–æ¶ˆæ¯ç³»ç»Ÿ</p>
</li>
<li><p>set_path_env();è®¾ç½®è·¯å¾„ã€ç¯å¢ƒ</p>
</li>
<li><p>ipu_image_start();ipuåˆå§‹åŒ–</p>
</li>
<li><p>mplayer_showmode(1);è®¾ç½®æ˜¾ç¤ºæ¨¡å¼</p>
</li>
<li><p>parse_codec_cfg(NULL);è§£æcodecé…ç½®å¯„å­˜å™¨</p>
</li>
<li><p>æ‰“å¼€æ•°æ®æµ</p>
</li>
<li><p>åˆ†ææ’­æ”¾æ ‘</p>
</li>
<li><p>æ·»åŠ æ’­æ”¾æ ‘åˆ—è¡¨</p>
</li>
<li><p>åˆå§‹åŒ–é¢„å¡«å……ç¼“å­˜</p>
</li>
<li><p>æ‰“å¼€æ’­æ”¾çš„æ–‡ä»¶</p>
</li>
<li><p>åˆ›å»ºbuffer</p>
</li>
<li><p>æ‰“å¼€æ•°æ®æµ</p>
</li>
<li><p>æ£€æµ‹æ•°æ®æµç±»å‹ï¼ˆéŸ³é¢‘æ ¼å¼å’Œè§†é¢‘æ ¼å¼ï¼‰</p>
</li>
<li><p>åˆ†æéŸ³é¢‘æµè§†é¢‘æµçš„ä¿¡æ¯ï¼ˆåŸå§‹è§†é¢‘å°ºå¯¸ã€åˆ†è¾¨ç‡ã€å¸§é¢‘ç‡ã€ç æµå¤§å°ï¼‰</p>
</li>
<li><p>å¯åŠ¨ç›¸åº”çš„åˆ†ç¦»å™¨</p>
</li>
<li><p>åˆ†æå‰ªè¾‘ä¿¡æ¯</p>
</li>
<li><p>åˆå§‹åŒ–codecï¼ˆå¤šåª’ä½“æ•°å­—ä¿¡å·ç¼–è§£ç å™¨ï¼‰</p>
</li>
<li><p>é€‰æ‹©æ‰“å¼€ç›¸åº”çš„è§†é¢‘è§£ç å™¨</p>
</li>
<li><p>åˆå§‹åŒ–è§†é¢‘è§£ç å™¨ï¼Œåˆ†æè§†é¢‘æµä¿¡æ¯</p>
</li>
<li><p>é€‰æ‹©æ‰“å¼€ç›¸åº”çš„éŸ³é¢‘è§£ç å™¨</p>
</li>
<li><p>åˆå§‹åŒ–éŸ³é¢‘è§£ç å™¨ã€PCMï¼Œåˆ†æéŸ³é¢‘ä¿¡æ¯</p>
</li>
<li><p>åŒæ­¥éŸ³é¢‘è§†é¢‘è¾“å‡º</p>
</li>
<li><p>å¼€å§‹æ’­æ”¾</p>
</li>
</ol>
<h1 id="å‘½ä»¤è¡Œå‚æ•°"><a href="#å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°"></a>å‘½ä»¤è¡Œå‚æ•°</h1><ul>
<li><p>-list-options æ‰“ å° æ‰€æœ‰ å¯ ç”¨ çš„ é€‰ é¡¹</p>
</li>
<li><p>-vf   é€‰æ‹©è§†é¢‘ç›¸å…³å‚æ•°</p>
<ul>
<li><p>format é€‰æ‹©è§£ç ä¹‹åçš„æ ¼å¼è¾“å‡º</p>
</li>
<li><ul>
<li>NV12  /  NV21</li>
<li>BGRA</li>
<li>RGB</li>
</ul>
</li>
<li><p>rotate  é€‰æ‹©æ—‹è½¬çš„è§’åº¦è¾“å‡º</p>
</li>
<li><ul>
<li>1  é¡ºæ—¶é’ˆæ—‹è½¬90</li>
<li>2  é¡ºæ—¶é’ˆæ—‹è½¬270</li>
<li>4  æ—‹è½¬0åº¦</li>
</ul>
</li>
</ul>
</li>
<li><p>-slave  ä»æ¨¡å¼ï¼Œmplayerä¼šä»æ ‡å‡†è¾“å…¥è¯»ä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆ/nï¼‰åˆ†éš”å¼€çš„å‘½ä»¤ã€‚</p>
</li>
<li><p>-quiet   å»é™¤æ‚é¡¹ä¿¡æ¯, ä½¿ æ§åˆ¶å±å¹•è¾“å‡ºç®€ç•¥ï¼›å°¤å…¶æ˜¯é˜»æ­¢æ˜¾ç¤ºçŠ¶æ€è¡Œï¼ˆå³ A: 0.7 V: 0.6 A-V: 0.068 â€¦ï¼‰</p>
</li>
<li><p>-speed &lt;0.01 - 100&gt;é€‰æ‹©æ’­æ”¾é€Ÿç‡</p>
</li>
<li><p>-vo æŒ‡å®šè§†é¢‘è¾“å‡ºé©±åŠ¨çš„ä¼˜å…ˆçº§åˆ—è¡¨</p>
</li>
<li><p>-vc  é€‰æ‹©ç¼–è§£ç å™¨ï¼Œ  -vc help å¯ä»¥åˆ—å‡ºæ‰€æœ‰è§†é¢‘è§£ç å™¨ï¼Œå…¶ä¸­ä¸­æ‹¬å·é‡Œé¢æ˜¯.dllçš„æ˜¯æˆ‘ä»¬æ— æ³•ä½¿ç”¨çš„</p>
</li>
<li><ul>
<li>ffm264   264è½¯è§£ç </li>
<li>ffh264v4l2m2m  264ç¡¬è§£ç </li>
</ul>
</li>
<li><p>-ao æŒ‡å®šéŸ³é¢‘è¾“å‡ºé©±åŠ¨çš„ä¼˜å…ˆçº§åˆ—è¡¨</p>
</li>
<li><p>-ac æŒ‡å®šéŸ³é¢‘è§£ç å™¨ä¼˜å…ˆçº§åˆ—è¡¨</p>
</li>
<li><p>-zoom -x 800 -y 400 æŒ‡ä»¤æ’­æ”¾çª—ä½“çš„å¤§å°</p>
</li>
<li><p>-input  è¾“å…¥</p>
</li>
<li><ul>
<li>cmdlist  åˆ—å‡ºæ‰€æœ‰å¯ç»‘å®šæŒ‰é”®çš„å‘½ä»¤</li>
<li>file å‘½ä»¤è¾“å…¥é€šé“ã€‚åˆ¶å®šè¾“å…¥fifoçš„åå­—ï¼Œå†™å…¥æ§åˆ¶å‘½ä»¤ï¼Œä¸slaveå‚æ•°ä¸€èµ·ä½¿ç”¨</li>
</ul>
</li>
</ul>
<h1 id="slaveæ¨¡å¼"><a href="#slaveæ¨¡å¼" class="headerlink" title="slaveæ¨¡å¼"></a>slaveæ¨¡å¼</h1><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>MPlayerä¸ºåå°è¿è¡Œå…¶ä»–ç¨‹åºï¼Œä¸å†æˆªè·é”®ç›˜äº‹ä»¶ï¼ŒMPlayerä¼šä»æ ‡å‡†è¾“å…¥è¯»ä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆ/nï¼‰åˆ†éš”å¼€çš„å‘½ä»¤ã€‚</p>
<p>å¤§å¤šæ•°slaveæ¨¡å¼å‘½ä»¤ç›¸å½“äºå‘½ä»¤è¡Œé€‰é¡¹ã€‚</p>
<ul>
<li><p>å‘½ä»¤è¡Œæ’­æ”¾é€šè¿‡ -input file= å‚æ•°ç›‘å¬æŸä¸ªç®¡é“</p>
</li>
<li><p>å¦èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ›å»ºåŒåç®¡é“å¹¶è¾“å…¥6.2æ‰€ç¤ºæ§åˆ¶å‚æ•°å³å¯è¾¾åˆ°æ§åˆ¶mplayerçš„æ•ˆæœ</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkfifo</span> /tmp/fifofile</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mplayer -slave -input file=/tmp/fifofile &lt;movie&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<p>å…·ä½“ä½¿ç”¨è¯´æ˜å¯ä»¥å‚è€ƒæºæ–‡ä»¶ä¸‹DOCS/tech/slave.txt</p>
<h2 id="æ§åˆ¶å‚æ•°"><a href="#æ§åˆ¶å‚æ•°" class="headerlink" title="æ§åˆ¶å‚æ•°"></a>æ§åˆ¶å‚æ•°</h2><p><strong>mplayer -input cmdlist</strong> å‘½ä»¤å¯ä»¥æ‰“å°å‡ºä¸€ä»½å¯ä»¥è¾“å…¥æ¸…å•</p>
<ul>
<li>get_file_name  æ‰“å°å½“å‰æ–‡ä»¶å</li>
<li>get_percent_pos   æ‰“å°å‡ºæ–‡ä»¶ä¸­çš„å½“å‰ä½ç½®ä¸ºæ•´æ•°ç™¾åˆ†æ¯”(0-100ï¼‰</li>
<li>get_time_length   æ‰“å°å½“å‰æ–‡ä»¶é•¿åº¦ç”¨ç§’è¡¨ç¤º</li>
<li>get_time_pos   æ‰“å°æ–‡ä»¶å½“å‰ä½ç½®ç”¨ç§’è¡¨ç¤º</li>
<li>seek  å®šä½ç”µå½±çš„æŸäº›åœ°æ–¹<ul>
<li>0 æ˜¯ä¸€ä¸ªç›¸å¯¹å®šä½+/- ï¼ˆé»˜è®¤å€¼ï¼‰</li>
<li>1 æ˜¯å®šä½ï¼…åœ¨ç”µå½±é‡Œ</li>
<li>2 æ˜¯å¯»æ±‚ä¸€ä¸ªç»å¯¹ä½ç½®çš„ç§’ã€‚</li>
</ul>
</li>
<li>quit   æ¨å‡ºmplayerè¿›ç¨‹</li>
<li>stop   åœæ­¢æ’­æ”¾</li>
<li>exit   ä»OSDèœå•é€€å‡ºæ§åˆ¶å°ã€‚ä¸åƒâ€™quitâ€™ï¼Œä¸é€€å‡ºMPlayerçš„</li>
</ul>
<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><p>é’ˆå¯¹slaveä½¿ç”¨æ–¹æ³•ï¼Œç®€å•å†™äº†å‡ ä¸ªå‡½æ•°ä½œä¸ºå‚è€ƒç¤ºä¾‹</p>
<p>githubä»“åº“ï¼ˆmplayerInterfaceæ–‡ä»¶å¤¹ï¼‰ï¼š<a href="https://github.com/yangLieee/codebackup.git">click here</a></p>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>MPlayer interrupted by signal 13 in module: key_events ï¼Ÿ</p>
<p>å› ä¸ºMplayeræ˜¯é€šè¿‡æ¢è¡Œç¬¦(â€œ\nâ€)æ¥åˆ†éš”ä¸åŒçš„å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­ä¸ç®¡æ˜¯å†™å…¥åˆ°ç®¡é“æ–‡ä»¶è¿˜æ˜¯å†™å…¥åˆ°QTçš„è¿›ç¨‹ä¸­åœ¨å‘½ä»¤åé¢ä¸€å®šè¦åŠ å…¥æ¢è¡Œç¬¦(â€œ\nâ€),è¿™æ ·Mplayeræ‰èƒ½è¾¨åˆ«ã€‚</p>
</li>
<li><p>åªæœ‰åœ¨ä¸²å£æœ‰è¾“å‡ºï¼Œadb shellæ²¡æœ‰è¾“å‡º </p>
<p>é”™è¯¯ä¿¡æ¯ï¼šCannot find HOME directory.</p>
<p>è§£å†³æ–¹æ³•ï¼šsetenv(â€œHOMEâ€ï¼Œâ€œ/â€ï¼Œâ€œ1â€)</p>
</li>
<li><p>åœ¨voéƒ¨åˆ†æ·»åŠ  rotateåŠŸèƒ½ ä¹‹å, åªæœ‰ä¸€ä¸ªæ–¹å‘å¯ä»¥æ­£å¸¸æ˜¾ç¤º?</p>
</li>
</ol>
<p>   å¯¹äºnv12æ ¼å¼çš„å›¾ç‰‡å’Œæ•°æ®, uv_strideå’Œstrideè¿™ä¸¤ä¸ªå‚æ•°å½±å“LCDæœ€ç»ˆæ˜¾ç¤ºçš„æ•ˆæœ. åœ¨æ—‹è½¬ä¹‹åéœ€è¦å°†å¯¹åº”çš„å®½é«˜å¯¹åº”åˆ°ç›¸åº”çš„strideä¸­, æœ€ç»ˆå¯ä»¥æ­£å¸¸æ˜¾ç¤º</p>
<ol start="4">
<li><p>mpiè¢«mplayerç”¨æ¥å­˜å‚¨è§£ç ä¹‹åçš„å›¾åƒï¼ˆmp_image.hä¸­å®šä¹‰ï¼‰ï¼Œå¾—åˆ°mpiä¹‹åï¼Œvfè¢«è°ƒç”¨ï¼Œæ•´ä¸ªfilteré“¾ä¸Šé’‰filteréƒ½è¢«è°ƒç”¨äº†ä¸€éåŒ…æ‹¬æœ€åçš„vo; åœ¨voçš„put_imageé‡ŒæŠŠå›¾åƒè¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ä¸Šã€‚è¿™ä¸ªæ—¶å€™éœ€è¦è€ƒè™‘å›¾åƒçš„å­˜å‚¨æ–¹æ³•ï¼Œå³ç”¨å“ªç§é¢œè‰²ç©ºé—´ã€‚</p>
</li>
<li><p><a href="https://blog.csdn.net/willand1981/article/details/5783107">https://blog.csdn.net/willand1981/article/details/5783107</a></p>
</li>
</ol>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ul>
<li><p><a href="http://www.mplayerhq.hu/DOCS/man/zh_CN/mplayer.1.html">Mplayerå’Œmencoderä½¿ç”¨æ–‡æ¡£ç®€ä»‹</a></p>
</li>
<li><p><a href="http://www.mplayerhq.hu/DOCS/HTML/zh_CN/index.html">Mplayerä½¿ç”¨æ–‡æ¡£</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qizheguang/article/details/50552810">mplayeræµç¨‹åŠç›¸å…³å‡½æ•°è¯´æ˜</a></p>
</li>
<li><p><a href="https://blog.csdn.net/liangkaiming/article/details/5790893">slave æ¨¡å¼æ–‡æ¡£</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>Third Party</category>
      </categories>
  </entry>
  <entry>
    <title>éŸ³é¢‘POPéŸ³è§£æ</title>
    <url>/2023/08/15/work-expericence/Audio-musicPop/</url>
    <content><![CDATA[<h1 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h1><p>â€œPOPâ€å™ªå£°æ˜¯æŒ‡éŸ³é¢‘å™¨ä»¶åœ¨ä¸Šç”µã€æ–­ç”µç¬é—´ä»¥åŠä¸Šç”µç¨³å®šåï¼Œå„ç§æ“ä½œå¸¦æ¥çš„ç¬æ€å†²å‡»æ‰€äº§ç”Ÿçš„çˆ†ç ´å£°</p>
<h2 id="ç¡¬ä»¶"><a href="#ç¡¬ä»¶" class="headerlink" title="ç¡¬ä»¶"></a>ç¡¬ä»¶</h2><ol>
<li>ç”µå®¹å……ç”µ/æ”¾ç”µï¼š åœ¨éŸ³é¢‘è®¾å¤‡çŠ¶æ€åˆ‡æ¢æ—¶ï¼Œç”µå®¹å¯èƒ½ä¼šè¿›è¡Œå……ç”µæˆ–æ”¾ç”µï¼Œå¯¼è‡´ç”µå‹è·³å˜</li>
<li>æ§åˆ¶éŸ³é¢‘PAä½¿èƒ½å¼•è„šçš„GPIOå£ä¸‹æ‹‰èƒ½åŠ›å¼±ï¼Œæˆ–å…¶ä»–åœ°æ–¹æœ‰ä¸Šæ‹‰ï¼Œå¯¼è‡´é•¿æ—¶é—´æœªå…³æ–­</li>
<li>è€³æœºæ’å…¥</li>
</ol>
<h2 id="è½¯ä»¶"><a href="#è½¯ä»¶" class="headerlink" title="è½¯ä»¶"></a>è½¯ä»¶</h2><ol>
<li>CODECã€PAä¸Šç”µæ‰ç”µæ—¶åºæ§åˆ¶ä¸æ­£ç¡®</li>
<li>CODECå†…éƒ¨éŸ³é¢‘é€šè·¯åˆ‡æ¢</li>
<li>æ“ä½œCODECç›¸å…³å¯„å­˜å™¨ï¼ˆè®¾ç½®Bias Levelï¼‰çš„æ—¶å€™MCLKåŠ¨äº†</li>
<li>å¯¹äºæ¯”è¾ƒå·®çš„æ¨¡æ‹ŸåŠŸæ”¾ï¼Œåœ¨æ“ä½œå…¶muteç®¡è„šå¯èƒ½å‡ºç°é—®é¢˜</li>
</ol>
<h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><ol>
<li><p>éŸ³æºæœ¬èº«å­˜åœ¨é—®é¢˜ï¼Œæ•°æ®æœ¬èº«ä¸è¿ç»­æœ‰è·³å˜</p>
</li>
<li><p>éçº¿æ€§æ”¾å¤§ã€‚éŸ³é¢‘ä¿¡å·åœ¨æ”¾å¤§è¿‡ç¨‹ä¸­å¯èƒ½å¼•èµ·éçº¿æ€§å¤±çœŸï¼Œå¯¼è‡´ â€œpopâ€ éŸ³</p>
</li>
</ol>
<h1 id="é—®é¢˜å®šä½"><a href="#é—®é¢˜å®šä½" class="headerlink" title="é—®é¢˜å®šä½"></a>é—®é¢˜å®šä½</h1><p>å¯¹äºPOPéŸ³çš„äº§ç”Ÿæœ‰å¾ˆå¤šåŸå› ï¼Œç¡®è®¤å…·ä½“äº§ç”ŸåŸå› å¯¹ç—‡ä¸‹è¯</p>
<ol>
<li>ç¡®è®¤MCLKæ˜¯å¦ç¨³å®šã€‚è¿æ¥ç¤ºæ³¢å™¨ï¼Œå½•æ”¾éŸ³æŸ¥çœ‹MCLKæ˜¯å¦ç¨³å®šï¼Œåœ¨å…³é”®BIAS ON / BIAS OFFç­‰å…³é”®èŠ‚ç‚¹åŠ å…¥å»¶æ—¶ä¿è¯å¯ä»¥æ­£å¸¸æŸ¥çœ‹</li>
<li>ç¡®è®¤åŠŸæ”¾CODECä¸Šç”µæ—¶åºã€‚æŸ¥çœ‹ä»£ç æˆ–è€…ç›¸å…³æ‰“å°logä¿è¯åŠŸæ”¾æ—¶åº</li>
<li>ç¡®è®¤CODECå¯„å­˜å™¨å½±å“ã€‚äºŒåˆ†æ³•ä¾æ¬¡æ³¨é‡Šæ‰æ“ä½œå¯„å­˜å™¨ç›¸å…³ä»£ç å¹¶ç¡®è®¤æ˜¯å¦å­˜åœ¨POPéŸ³ï¼Œå®šä½æ˜¯å“ªäº›å¯„å­˜å™¨å½±å“ã€‚</li>
<li>ç¡®è®¤ç¡¬ä»¶ç”µå®¹æ˜¯å¦å½±å“</li>
</ol>
<h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><ol>
<li><p>ç¡¬ä»¶Layout</p>
<p>å‡å° POP éŸ³å°±å¿…é¡»æŠ‘åˆ¶ IC çš„åç½®ç”µå‹biasçš„ç¬å˜ï¼ŒLayoutä¸Šçš„ä½“ç°æ–¹æ³•å°±æ˜¯å¢å¤§biasçš„æ»¤æ³¢ç”µå®¹ã€‚åç½®ç”µå®¹å˜å¾—è¿‡å¤§ä¼šå¯¼è‡´ IC çš„å»ºç«‹æ—¶é—´å˜é•¿ï¼Œå¦å¤–ç”µå®¹è¿‡å¤§è¿˜ä¼šå¯¼è‡´ THD+N å˜å·®ã€‚</p>
</li>
<li><p>æ—¶åºæ§åˆ¶</p>
<ul>
<li>ä¸Šç”µæ—¶åºï¼šæ‰“å¼€codecè¾“å‡ºï¼›PAæ‹‰é«˜ä½¿èƒ½ï¼›å»¶æ—¶ä¸€å°æ®µåé€å…¥ç›¸åº”éŸ³æº</li>
<li>ä¸‹ç”µæ—¶åºï¼šé—­ç›¸åº”éŸ³æºï¼›PA æ‹‰ä½ï¼›å»¶æ—¶ä¸€å°æ®µä»¥åå…³é—­codecè¾“å‡º</li>
</ul>
</li>
<li><p>CODECå¯„å­˜å™¨æ”¯æŒ</p>
<p>ç°åœ¨æœ‰äº›CODECåœ¨è½¯ä»¶ä¸Šæœ‰ä¸€ä¸ªå¯„å­˜å™¨å¯ä»¥è®¾ç½®è¿™ä¸ªç›´æµç”µå¹³çš„ä¸Šå‡æ—¶é—´ï¼Œè®©å®ƒåœ¨ä¸€å®šæ—¶é—´å†…è·³å˜åˆ°1/2VDDï¼Œè€Œä¸æ˜¯å¾ˆé™¡çš„ä¸€ä¸ªä¸Šå‡æ²¿ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦æ”¹å–„è¿™ä¸ªPOPéŸ³ã€‚</p>
</li>
<li><p>é…ç½®CODECå†…éƒ¨éŸ³é¢‘é€šè·¯</p>
<p>åœ¨å½•æ”¾éŸ³å¼€å§‹æˆ–è€…ç»“æŸçš„æ—¶å€™ï¼ŒCODECå†…éƒ¨é€šå¸¸éœ€è¦ä½¿èƒ½ç›¸å…³é€šè·¯çš„å¯„å­˜å™¨ã€‚è¿™äº›å¯„å­˜å™¨çš„æ‰“å¼€çš„å…ˆåé¡ºåºä¹Ÿå¯èƒ½äº§ç”Ÿå½±å“ï¼Œå¯ä»¥è¿›è¡Œè°ƒæ•´è¯•è¯•çœ‹</p>
</li>
<li><p>è½¯ä»¶æ·¡å…¥æ·¡å‡ºæ•ˆæœã€‚ åœ¨éŸ³é¢‘åˆ‡æ¢æ—¶å®ç°è½¯ä»¶æ·¡å…¥æ·¡å‡ºæ•ˆæœï¼Œå¹³æ»‘åˆ‡æ¢éŸ³é¢‘ä¿¡å·ï¼ˆæ·¡å…¥æ·¡å‡ºéŸ³é¢‘ä¿¡å·/ç”µå‹/æŒ¯å¹…ï¼‰</p>
</li>
<li><p>ä¿è¯MCLKç¨³å®š</p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li><a href="https://www.bilibili.com/video/BV1Cv411e79Z">å¸¸è§çš„éŸ³é¢‘é—®é¢˜</a></li>
<li><a href="https://cloud.tencent.com/developer/article/2206040">popéŸ³æ’æŸ¥</a></li>
<li><a href="https://blog.csdn.net/dahailinan/article/details/109129653">éŸ³é¢‘å¸¸è§é—®é¢˜æ€»ç»“</a></li>
<li><a href="https://www.likecs.com/show-727583.html">æ‚éŸ³ &amp; pop éŸ³çš„è§£å†³æ–¹æ³•</a></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Audio</category>
      </categories>
      <tags>
        <tag>opus</tag>
      </tags>
  </entry>
  <entry>
    <title>CODECç§»æ¤å¼€å‘æ€»ç»“</title>
    <url>/2023/07/30/work-expericence/CODEC%E7%A7%BB%E6%A4%8D%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="CODECç§»æ¤å¼€å‘æµç¨‹"><a href="#CODECç§»æ¤å¼€å‘æµç¨‹" class="headerlink" title="CODECç§»æ¤å¼€å‘æµç¨‹"></a>CODECç§»æ¤å¼€å‘æµç¨‹</h1><ol>
<li><p>å‡†å¤‡åŸç†å›¾ã€å¤–è®¾ï¼ˆcodecã€paï¼‰æ‰‹å†Œã€‚æŸ¥çœ‹ç¡¬ä»¶éŸ³é¢‘é€šè·¯ï¼Œmicä½ç½®ã€å–‡å­ä½ç½®ã€åŠŸæ”¾ä½ç½®ç­‰ç­‰</p>
</li>
<li><p>å‡†å¤‡ç›¸å…³ä»£ç ï¼Œç§»æ¤åˆ°å¹³å°ä¸­ã€‚æ”¯æŒé©±åŠ¨ä¸­æ²¡æœ‰çš„å‡½æ•°ä¿è¯ç¼–è¯‘é€šè¿‡</p>
</li>
<li><p>I2Cé€šä¿¡æˆåŠŸï¼Œå¯ä»¥è¯»å‡ºcodecã€paçš„è®¾å¤‡ID</p>
<ul>
<li>é…ç½®è®¾å¤‡é©±åŠ¨è®¾å¤‡æ ‘ã€‚é…ç½®å¯¹åº”è®¾å¤‡èŠ‚ç‚¹çš„compatibleå­—æ®µï¼Œä¿è¯è®¾å¤‡å¯ä»¥æ­£å¸¸è°ƒç”¨probeå‡½æ•°</li>
<li>é…ç½®I2Cè®¾å¤‡æ ‘ã€‚æ ¹æ®åŸç†å›¾åˆ¤æ–­åœ¨å“ªä¸€ç»„çš„I2Cï¼Œå¹¶æ ¹æ®åŸç†å›¾æŸ¥çœ‹è®¾å¤‡åœ°å€ï¼ˆå›ºå®šåœ°å€+é€‰é€šåœ°å€ï¼‰ä¿è¯é€šè®¯æˆåŠŸå¯ä»¥è¯»å‡ºChipID</li>
<li>ï¼ˆå¦‚æœI2Cå¤±è´¥ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼šä¸Šæ‹‰ç”µé˜»ã€ä¸Šæ‹‰ç”µé˜»ç”µå‹ã€è®¾å¤‡åœ°å€ä¸æ­£ç¡®ï¼‰</li>
</ul>
</li>
<li><p>æ³¨å†Œå£°å¡</p>
<ul>
<li>å®šä¹‰å£°å¡çš„ç¡¬ä»¶æè¿°ã€‚å®šä¹‰å£°å¡ç¡¬ä»¶çš„æè¿°ä¿¡æ¯ï¼ŒåŒ…æ‹¬å£°å¡çš„åç§°ã€DAIï¼ˆDigital Audio Interfaceï¼‰å’Œ CODEC çš„è¿æ¥é…ç½®ç­‰ã€‚è¿™é€šå¸¸æ˜¯åœ¨è®¾å¤‡æ ‘ä¸­å®Œæˆçš„ï¼Œä½¿ç”¨ç‰¹å®šçš„è®¾å¤‡æ ‘èŠ‚ç‚¹æ¥æè¿°å£°å¡çš„ç¡¬ä»¶è¿æ¥ã€‚</li>
<li>åˆ›å»ºå£°å¡é©±åŠ¨ä»£ç ï¼šç¼–å†™ç›¸åº”çš„ ALSA å£°å¡é©±åŠ¨ä»£ç ï¼Œè¯¥é©±åŠ¨ä»£ç å°†è´Ÿè´£ä¸è®¾å¤‡æ ‘ä¸­çš„å£°å¡èŠ‚ç‚¹è¿›è¡ŒåŒ¹é…ï¼Œå¹¶åœ¨åŒ¹é…æˆåŠŸæ—¶æ³¨å†Œå£°å¡ã€‚åœ¨é©±åŠ¨ä»£ç ä¸­ï¼Œä½ éœ€è¦å®ç° snd_soc_card ç»“æ„ä½“ï¼Œå¹¶å¡«å……ç›¸åº”çš„å­—æ®µï¼ŒåŒ…æ‹¬å£°å¡çš„åç§°ã€DAI é“¾è·¯ã€CODEC æ§åˆ¶ç­‰ã€‚</li>
<li>æ³¨å†Œå£°å¡ï¼šåœ¨é©±åŠ¨ä»£ç ä¸­ï¼Œé€šè¿‡è°ƒç”¨ snd_soc_register_card() å‡½æ•°æ¥æ³¨å†Œå£°å¡ã€‚è¯¥å‡½æ•°å°†ä¼šåœ¨ ALSA æ¡†æ¶ä¸­æ³¨å†Œå£°å¡ï¼Œå¹¶å»ºç«‹ä¸ç¡¬ä»¶ä¹‹é—´çš„è¿æ¥å…³ç³»ã€‚</li>
<li>å£°å¡åˆå§‹åŒ–ï¼šåœ¨å£°å¡æ³¨å†ŒæˆåŠŸåï¼Œä½ å¯ä»¥åœ¨å£°å¡çš„ probe å‡½æ•°ä¸­è¿›è¡Œå¿…è¦çš„åˆå§‹åŒ–æ“ä½œï¼Œå¦‚è®¾ç½® DAI å’Œ CODEC çš„é…ç½®å‚æ•°ã€è¯·æ±‚ IRQã€åˆ›å»º ALSA æ§åˆ¶æ¥å£ç­‰ã€‚</li>
</ul>
</li>
<li><p>æ ¹æ®ASocæ¡†æ¶ï¼Œé…ç½®platformå’Œcodecï¼ˆè¿™ä¸ªæ­¥éª¤å’Œä¸Šä¸€æ­¥é«˜åº¦è€¦åˆï¼Œä¸Šé¢ä»‹ç»æ¯”è¾ƒæ³›æ³›ï¼Œå…·ä½“é…ç½®æµç¨‹å¦‚ä¸‹ï¼‰</p>
<ul>
<li>é€šå¸¸æ•°æ®è·¯å¾„ï¼šï¼ˆplaybackï¼‰RAM -&gt; DMA -&gt; (xxx) -&gt; cpu dai -&gt; codec dai -&gt; pa</li>
<li>æ¿çº§ç«¯platformã€‚æ ¹æ®ä¸åŒçš„å¹³å°çš„ä½¿ç”¨è¦æ±‚ï¼Œé…ç½®route tableå’Œdapmã€‚è¯¥é€šè·¯éœ€è¦ä¿è¯æ•°æ®ä»RAMåˆ°cpu dai</li>
<li>è®¾å¤‡ç«¯codecã€‚æ ¹æ®æ‰‹å†Œå’Œç›¸å…³æ–‡æ¡£ï¼ŒæŸ¥çœ‹ç›¸å…³æµç¨‹æ˜¯å¦æ­£ç¡®</li>
<li>è®¾å¤‡ç«¯paã€‚æ ¹æ®æ‰‹å†Œå’Œç›¸å…³æ–‡æ¡£ï¼Œè¿›è¡Œé…ç½®</li>
</ul>
</li>
<li><p>æ”¾éŸ³æµ‹è¯•æ­£å¸¸å³å¯</p>
</li>
<li><p>ä¼˜åŒ–codecå¯„å­˜å™¨é…ç½®</p>
</li>
</ol>
<h1 id="é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h1><ol>
<li><p>codecä¸cpuä¸èƒ½è¿›è¡Œi2cé€šä¿¡ï¼Ÿ</p>
<ul>
<li>æ£€æŸ¥è®¾å¤‡åœ°å€</li>
<li>æ£€æŸ¥è®¾å¤‡ä¾›ç”µæ˜¯å¦æœ‰é—®é¢˜</li>
<li>ç¤ºæ³¢å™¨æŸ¥çœ‹I2Cæ—¶åº</li>
<li>æœ€ç»ˆå®šä½åœ¨codecä¾›ç”µæ˜¯3.3vï¼Œè€Œcodecçš„i2cä¸Šæ‹‰æ˜¯1.8vã€‚å°†i2cä¸Šæ‹‰ç”µå‹æ›´æ”¹æ­£å¸¸é€šä¿¡</li>
</ul>
</li>
<li><p>request_firmware å‡½æ•°ä¸èƒ½æ­£å¸¸åŠ è½½å›ºä»¶ï¼Ÿ</p>
<ul>
<li>è·¯å¾„ä¸æ­£ç¡®ã€‚æ‹¼å†™é”™è¯¯</li>
<li>æƒé™ä¸æ­£ç¡®<ul>
<li>æ£€æŸ¥SElinuxå®‰å…¨æ¨¡å—ï¼Œæ˜¯å¦æ˜¯æƒé™é—®é¢˜å¯¼è‡´ç¦æ­¢è¯»</li>
<li>æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿçš„æƒé™ï¼Œæ˜¯å¦å¯ä»¥è¯»</li>
<li>å†…æ ¸é…ç½®é—®é¢˜ã€‚å†…æ ¸æ‰¾åˆ°å‡½æ•°çš„å®ç°éƒ¨åˆ†ï¼Œå®šä½å‡ºç°é”™è¯¯çš„ä½ç½®ï¼Œæœ€ç»ˆå®šä½åˆ°æ˜¯æŸä¸€ä¸ªå®æœªé€‰ä¸­å¯¼è‡´ä½¿ç”¨çš„å‡½æ•°æœªå®ç°</li>
</ul>
</li>
<li>ä»£ç æœ‰è¯¯ã€‚åœ¨å›ºä»¶åŠ è½½è¿‡ç¨‹ä¸­ä¸åŒç¼–è¯‘å™¨ä¸åŒå¹³å°å¯¹äºæ— ç¬¦å·/æœ‰ç¬¦å·çš„å¤„ç†å¯èƒ½ä¸åŒã€‚</li>
</ul>
</li>
<li><p>codecã€æ¿çº§é€šè·¯æ£€æŸ¥æ­£å¸¸ï¼Œå½•éŸ³æŠ¥é”™ï¼Ÿ</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">/ <span class="meta"># arecord -D hw:0,5 -c 2 -r 16000 -d 10 -t wav baic0_16000-2.wav</span></span><br><span class="line">	Recording WAVE <span class="string">'baic0_16000-2.wav'</span> : Unsigned <span class="number">8</span> bit, Rate <span class="number">16000</span> Hz, Stereo</span><br><span class="line">	arecord: set_params:<span class="number">1312</span>: Broken configuration <span class="keyword">for</span> this PCM: no configurations available</span><br><span class="line">/ #</span><br></pre></td></tr></tbody></table></figure>

<p>CONFIG_SND_ASOC_INGENIC_DMA_PREALLOC_PAGESå†…æ ¸ä¸­è¿™ä¸ªå®é…ç½®è¾ƒå°ï¼Œæ”¹æˆ128æ­£å¸¸ï¼ˆingenicå¹³å°ï¼‰</p>
<p>æœ€ç»ˆå®çš„å€¼é…ç½®åœ¨äº† struct snd_pcm_hardware ç»“æ„ä½“ <code>.buffer_bytes_max</code>æˆå‘˜å˜é‡ä¸Šï¼Œè¯¥æˆå‘˜å˜é‡è¡¨ç¤º PCM è®¾å¤‡çš„æœ€å¤§ç¼“å†²åŒºå¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œè¯´æ˜è¯¥æˆå‘˜å˜é‡çš„å€¼ä¸èƒ½å¤ªå°ï¼Œå¦åˆ™ä¼šå‡ºç°ä»¥ä¸Šé”™è¯¯ã€‚</p>
<p>å¦ä¸€ç§è§£å†³åŠæ³•ï¼šåœ¨å‘½ä»¤è¡ŒåŠ å…¥ -B å‚æ•°ï¼Œè¡¨ç¤ºbufferçš„å¤§å°</p>
</li>
<li><p>å½•æ”¾éŸ³é€šè·¯ï¼Ÿ</p>
<p>å¯¹äºå½•éŸ³ï¼Œé€šå¸¸ä¼šæœ‰dmicå’Œamicï¼Œdmicé‡‡æ ·ä¹‹åå·²ç»æ˜¯æ•°å­—è¾“å‡ºï¼Œæ•°å­—æ•°æ®è¾“å‡ºåˆ°CODECå†…éƒ¨å¯¹äºadcçš„é…ç½®ä¸æ¨¡æ‹Ÿæ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼Œéœ€è¦è°ƒæ•´ã€‚</p>
<ul>
<li><p>å½•éŸ³ï¼šmic  â€“&gt;  codec(adc)  â€“&gt;  codec dai  â€“&gt;  I2S â€“&gt; cpu dai â€“&gt; DMA â€“&gt;  RAM</p>
</li>
<li><p>æ”¾éŸ³ï¼šRAM  â€“&gt; DMA  â€“&gt; cpu dai  â€“&gt;  I2S  â€“&gt; codec dai  â€“&gt;  codec(dac)  â€“&gt;  pa</p>
</li>
</ul>
</li>
<li><p>å½•éŸ³é€šè·¯æ­£å¸¸ï¼Œä½†æ˜¯ä½¿ç”¨arecordå½•éŸ³æ²¡æœ‰æ•°æ®ï¼Ÿ</p>
<p>ä½¿ç”¨ç¤ºæ³¢å™¨å¯¹ç¡¬ä»¶ç®¡è„šè¿›è¡Œæ£€æŸ¥ï¼Œå®šä½æ˜¯åœ¨å“ªä¸€ä¸ªç¯èŠ‚æ•°æ®æ²¡æœ‰è¿›ä¸€æ­¥ä¼ è¾“ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­å¯¹äºæ—¶é’Ÿä¹Ÿè¦è¿›è¡Œæµ‹é‡ã€‚</p>
<p>åœ¨ä¸Šè¿°é—®é¢˜å‡ºç°çš„æƒ…å†µä¸‹ï¼Œæµ‹é‡MCLKæ­£å¸¸ï¼ŒLRCLKã€WSæ˜¯æ²¡æœ‰çš„ã€‚é€šè¿‡è½¯ä»¶æ£€æŸ¥å‘ç°ï¼šå¯¹äºx2000-soc aicæ§åˆ¶å™¨æ”¯æŒç‹¬ç«‹æ—¶é’Ÿå’Œå…±äº«æ—¶é’Ÿä¸¤ç§æ¨¡å¼ï¼Œåœ¨ç¡¬ä»¶ä¸Šcodecé€šå¸¸åªæœ‰ä¸€ç»„I2Sï¼Œäº”æ ¹pinï¼ˆMCLKã€LRCLKã€WSã€R_DATAã€T_DATAï¼‰ï¼Œä½†æ˜¯å¯¹äºSOCæ¯ä¸€ç»„çš„I2Sæ—¶é’Ÿéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œéœ€è¦ç¡¬ä»¶å’Œè½¯ä»¶è¿›è¡ŒåŒ¹é…ã€‚æœ€åçš„é—®é¢˜åœ¨äºå°†æ¥å—æ•°æ®çš„clkè¾“å‡ºåˆ°å¦å¤–ä¸€ä¸ªç®¡è„šï¼ˆæ‚¬ç©ºï¼‰ä¸Šï¼Œé€šè¿‡ä¿®æ”¹è®¾å¤‡æ ‘é…ç½®æ­£ç¡®è¾“å‡ºæ—¶é’Ÿå³å¯ã€‚</p>
</li>
<li><p>è€³æœºå½•æ”¾éŸ³æ— å£°ï¼Ÿ</p>
<p>é€šè¿‡ç¤ºæ³¢å™¨æ£€æŸ¥è¾“å‡ºæ³¢å½¢ï¼Œå¦‚æœå­˜åœ¨æ³¢å½¢æ£€æŸ¥ç¡¬ä»¶æ˜¯å¦å­˜åœ¨å°†å…¶æ‹‰åœ°çš„åœ°æ–¹</p>
<p>å¯¹äºå½•éŸ³æ— å£°å¯ä»¥æ£€æŸ¥MICBIASç”µå‹æ˜¯å¦å­˜åœ¨ï¼Œé€šå¸¸ï¼Œéº¦å…‹é£éœ€è¦ä¸€ä¸ªç¨³å®šçš„ç›´æµç”µå‹æ¥æåŒ–éº¦å…‹é£çš„ç”µå®¹å¼å…ƒä»¶æˆ–å…¶ä»–ä¼ æ„Ÿå™¨ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ­£ç¡®åœ°å·¥ä½œå’Œäº§ç”ŸéŸ³é¢‘ä¿¡å·ã€‚Micbiasç”µå‹é€šå¸¸æ˜¯3.3Vã€5Væˆ–å…¶ä»–é€‚åˆéº¦å…‹é£å·¥ä½œçš„ç”µå‹ã€‚å…·ä½“çš„Micbiasç”µå‹å€¼å–å†³äºéº¦å…‹é£çš„ç±»å‹å’Œè§„æ ¼ã€‚</p>
<p><code>å¯¹äºES8326è¿™æ¬¾codecï¼Œä¸èƒ½ä½¿ç”¨VMIDæ¥å½“åšè€³æœºçš„micbias</code></p>
</li>
<li><p>ä¸è®ºæ˜¯å¦æ’å…¥HPè®¾å¤‡ï¼Œéƒ½ä¼šä¸€ç›´æ¥ä¸­æ–­ï¼Ÿ</p>
<p>é¦–å…ˆéœ€è¦æ£€æŸ¥ä¸­æ–­IOæ˜¯å¦é…ç½®æ­£ç¡®ï¼Œå…¶æ¬¡éªŒè¯å¯¹åº”IOçš„ç”µå¹³æ˜¯å¦å‘ç”Ÿç¿»è½¬ã€‚æœ€ç»ˆè§£å†³æ˜¯åœ¨è®¾å¤‡æ ‘ä¸­hp_detect_gpioéœ€è¦é…ç½®æˆHIZï¼Œä¸èƒ½é…ç½®æˆNOBIASï¼ˆå…³é—­åæŒ¯ç”µå‹ï¼‰ã€‚</p>
</li>
<li><p>è€³æœºå½•éŸ³çš„æ—¶å€™å‘ç°å¾ˆå¼ºçš„æ»‹å•¦æ»‹å•¦å£°éŸ³ï¼Ÿ</p>
<p>å¦‚æœæœ‰é£çº¿æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è™šç„Š</p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://blog.csdn.net/weixin_41028621/article/details/105834205">Linux Asoc</a></li>
<li><a href="https://www.cnblogs.com/bobfly1984/p/13966890.html">è§¦å‘DAPMæœºåˆ¶çš„æ—¶æœº </a></li>
<li><a href="https://blog.csdn.net/weixin_41028621/category_9941913.html">éŸ³é¢‘å­ç³»ç»Ÿ</a></li>
<li><a href="https://elixir.bootlin.com/linux/v6.5-rc3/source/sound/soc/soc-core.c">Linuxæºä»£ç bootlin</a></li>
</ul>
]]></content>
      <categories>
        <category>Work Experience</category>
      </categories>
  </entry>
  <entry>
    <title>GPIO</title>
    <url>/2022/09/22/computerSystem/Peripherals/GPIO/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>GPIOï¼šGeneral Purpose Input Outputï¼Œé€šç”¨è¾“å…¥è¾“å‡ºï¼Œç®€ç§°ä¸ºâ€œIOå£â€ï¼ŒèŠ¯ç‰‡ä¸å¤–å›´è®¾å¤‡äº¤äº’çš„ç¡¬ä»¶æ¥å£</p>
<h1 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h1><p>ä»¥ä¸‹å›¾ç‰‡æ¥è‡ªSTM32çš„GPIOç¡¬ä»¶ç”µè·¯å›¾</p>
<p><img src="/images/computerSystem/Peripherals/GPIO-1.png" alt="image"></p>
<p>æ–½å¯†ç‰¹è§¦å‘å™¨ï¼šåœ¨æ­£å‘é€’å¢å’Œè´Ÿå‘é€’å‡ä¸¤ä¸ªæ–¹å‘æœ‰ä¸åŒçš„é˜ˆå€¼ï¼Œæœ‰ä¸€å®šçš„æŠ—å¹²æ‰°èƒ½åŠ›ï¼Œå¤–éƒ¨çš„å°æ‰°åŠ¨ä¸ä¼šå¯¼è‡´cpuè¯¯åˆ¤ï¼Œç›´è‡³å‰§çƒˆå˜åŒ–æˆ–è€…çœŸçš„æœ‰ç”µå¹³çš„å˜åŒ–ã€‚</p>
<h1 id="å·¥ä½œæ¨¡å¼"><a href="#å·¥ä½œæ¨¡å¼" class="headerlink" title="å·¥ä½œæ¨¡å¼"></a>å·¥ä½œæ¨¡å¼</h1><h2 id="è¾“å…¥ï¼ˆ4ï¼‰"><a href="#è¾“å…¥ï¼ˆ4ï¼‰" class="headerlink" title="è¾“å…¥ï¼ˆ4ï¼‰"></a>è¾“å…¥ï¼ˆ4ï¼‰</h2><ol>
<li>æµ®ç©ºè¾“å…¥ï¼šå¤šç”¨äºå¤–éƒ¨æŒ‰é”®è¾“å…¥ï¼ŒioçŠ¶æ€ä¸ç¡®å®šå®Œå…¨ç”±å¤–éƒ¨è¾“å…¥å†³å®š</li>
<li>ä¸Šæ‹‰è¾“å…¥ï¼šIOå£è¾“å…¥è®¾å®šä¸ºé«˜ç”µå¹³è¾“å…¥ï¼ˆ1ï¼‰ï¼Œæ£€æµ‹ä½ç”µå¹³æˆ–ä¸‹é™æ²¿</li>
<li>ä¸‹æ‹‰è¾“å…¥ï¼šIOå£è¾“å…¥è®¾å®šä¸ºä½ç”µå¹³è¾“å…¥ï¼ˆ0ï¼‰</li>
<li>æ¨¡æ‹Ÿè¾“å…¥ï¼šADCæ¨¡æ‹Ÿè¾“å…¥ï¼Œæµ‹é‡å¤–éƒ¨ç”µå‹å¹…å€¼ä¸é€šè¿‡TTL</li>
</ol>
<h2 id="è¾“å‡ºï¼ˆ4ï¼‰"><a href="#è¾“å‡ºï¼ˆ4ï¼‰" class="headerlink" title="è¾“å‡ºï¼ˆ4ï¼‰"></a>è¾“å‡ºï¼ˆ4ï¼‰</h2><ol>
<li>æ¨æŒ½è¾“å‡ºï¼šè¾“å‡ºé«˜ä½ç”µå¹³</li>
<li>å¼€æ¼è¾“å‡ºï¼šåªæœ‰ä¸€ä¸ªNMOSå¯¼é€šï¼Œåªèƒ½è¾“å‡ºä½ç”µå¹³+é«˜é˜»æ€ï¼Œä¸èƒ½è¾“å‡ºé«˜ç”µå¹³ï¼›å½“NMOSå¯¼é€šè¾“å‡ºä½ç”µå¹³ï¼Œæˆªè‡³è¾“å‡ºé«˜é˜»æ€ã€‚ç”¨ä½œçº¿ä¸ï¼Œç”µå¹³ä¸åŒ¹é…çš„åœºåˆï¼Œå¤–éƒ¨ä¸Šæ‹‰</li>
<li>å¤ç”¨æ¨æŒ½è¾“å‡ºï¼šéœ€è¦è¾“å‡ºé«˜ä½ç”µå¹³çš„å…¶ä»–æ¨¡å¼ï¼Œå¦‚ï¼šspi uart</li>
<li>å¤ç”¨å¼€æ¼è¾“å‡ºï¼šæ™®é€ši2cå¤„äºè¯¥æ¨¡å¼</li>
</ol>
<h1 id="GPIOå¯„å­˜å™¨"><a href="#GPIOå¯„å­˜å™¨" class="headerlink" title="GPIOå¯„å­˜å™¨"></a>GPIOå¯„å­˜å™¨</h1><h2 id="é€šç”¨å¯„å­˜å™¨"><a href="#é€šç”¨å¯„å­˜å™¨" class="headerlink" title="é€šç”¨å¯„å­˜å™¨"></a>é€šç”¨å¯„å­˜å™¨</h2><p>ä»¥stm32ä¸ºä¾‹</p>
<ul>
<li>GPIO ç«¯å£æ¨¡å¼å¯„å­˜å™¨ (GPIOx_MODER) (x = Aâ€¦I)</li>
<li>GPIO ç«¯å£è¾“å‡ºç±»å‹å¯„å­˜å™¨ (GPIOx_OTYPER) (x = Aâ€¦I)</li>
<li>GPIO ç«¯å£è¾“å‡ºé€Ÿåº¦å¯„å­˜å™¨ (GPIOx_OSPEEDR) (x = Aâ€¦I/)</li>
<li>GPIO ç«¯å£ä¸Šæ‹‰/ä¸‹æ‹‰å¯„å­˜å™¨ (GPIOx_PUPDR) (x = Aâ€¦I/)</li>
<li>GPIO ç«¯å£è¾“å…¥æ•°æ®å¯„å­˜å™¨ (GPIOx_IDR) (x = Aâ€¦I)</li>
<li>GPIO ç«¯å£è¾“å‡ºæ•°æ®å¯„å­˜å™¨ (GPIOx_ODR) (x = Aâ€¦I)</li>
<li>GPIO ç«¯å£ç½®ä½/å¤ä½å¯„å­˜å™¨ (GPIOx_BSRR) (x = Aâ€¦I)</li>
</ul>
<h2 id="GPIO-Shadow"><a href="#GPIO-Shadow" class="headerlink" title="GPIO Shadow"></a>GPIO Shadow</h2><p>ç”±äºè®¾ç½®æŸä¸ªæ¨¡å¼çš„è¿‡ç¨‹ä¸­é…ç½®çš„ä¸åªæ˜¯ä¸€ä¸ªå¯„å­˜å™¨ï¼Œé…ç½®è¿‡ç¨‹ä¸­å°±å¯èƒ½å‡ºç°åˆ«çš„çŠ¶æ€çš„äº§ç”Ÿï¼Œå¯¼è‡´é”™è¯¯ã€‚è€Œä½¿ç”¨shadowå¯„å­˜å™¨ï¼Œå¯ä»¥å…ˆå°†æ‰€æœ‰éœ€è¦é…ç½®çš„å¯„å­˜å™¨åˆ†åˆ«è®¾ç½®è¿›å»ï¼Œä½†ä¸ç”Ÿæ•ˆï¼Œç›´è‡³å…¨éƒ¨è®¾ç½®å®Œæ¯•ï¼Œå†æŒ‡å®šGPIDå³è¦æ˜ å°„çš„ç»„ä¸Šå»ç”Ÿæ•ˆï¼é¿å…äº†ä¸­é—´éå¿…è¦çŠ¶æ€çš„äº§ç”Ÿã€‚</p>
<h1 id="ç”¨æˆ·å±‚åº”ç”¨"><a href="#ç”¨æˆ·å±‚åº”ç”¨" class="headerlink" title="ç”¨æˆ·å±‚åº”ç”¨"></a>ç”¨æˆ·å±‚åº”ç”¨</h1><h2 id="é…ç½®GPIO"><a href="#é…ç½®GPIO" class="headerlink" title="é…ç½®GPIO"></a>é…ç½®GPIO</h2><p>åœ¨å†…æ ¸å¯¼å‡º gpio èŠ‚ç‚¹çš„å‰æä¸‹ï¼Œ å¯ä»¥æ“ä½œ/sys/class/gpio èŠ‚ç‚¹ï¼Œ æ§åˆ¶ gpio è¾“å…¥è¾“å‡º</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">å¯¼å‡ºèŠ‚ç‚¹ï¼š  echo <span class="number">20</span> &gt; /sys/<span class="class"><span class="keyword">class</span>/<span class="title">gpio</span>/<span class="title">export</span></span></span><br><span class="line"><span class="class">è®¾ç½®æ–¹å‘ï¼š  <span class="title">echo</span> [<span class="title">out</span> / <span class="title">in</span>] &gt;</span> /sys/<span class="class"><span class="keyword">class</span>/<span class="title">gpio</span>/<span class="title">gpio20</span>/<span class="title">direction</span></span></span><br><span class="line"><span class="class">è®¾ç½®å€¼ï¼š    <span class="title">echo</span> [0 / 1] &gt;</span> sys/<span class="class"><span class="keyword">class</span>/<span class="title">gpio</span>/<span class="title">gpio19</span>/<span class="title">value</span></span></span><br><span class="line"><span class="class">è®¾ç½®è§¦å‘æ¨¡å¼ï¼š<span class="title">echo</span> [<span class="title">none</span> / <span class="title">rising</span> / <span class="title">falling</span> /  <span class="title">both</span>] &gt;</span> sys/<span class="class"><span class="keyword">class</span>/<span class="title">gpio</span>/<span class="title">gpio19</span>/<span class="title">edge</span></span></span><br><span class="line"><span class="class">ç¿»è½¬å±æ€§ï¼š  <span class="title">echo</span> [0 / 1] &gt;</span> sys/<span class="class"><span class="keyword">class</span>/<span class="title">gpio</span>/<span class="title">gpio19</span>/<span class="title">active_low</span></span></span><br><span class="line"><span class="class">ç§»é™¤èŠ‚ç‚¹ï¼š  <span class="title">echo</span> 20 &gt;</span> /sys/<span class="class"><span class="keyword">class</span>/<span class="title">gpio</span>/<span class="title">unexport</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„äº‹é¡¹</p>
<ul>
<li>direction<br>å¦‚æœå†…æ ¸ä¸æ”¯æŒæ”¹å˜ GPIO çš„æ–¹å‘ï¼Œæˆ–è€…åœ¨å¯¼å‡ºæ—¶å†…æ ¸ä»£ç æ²¡æœ‰æ˜ç¡®å…è®¸ç”¨æˆ·ç©ºé—´å¯ä»¥é‡æ–°é…ç½® GPIO æ–¹å‘ï¼Œ é‚£ä¹ˆè¿™ä¸ªå±æ€§å°†ä¸å­˜åœ¨ã€‚</li>
<li>value<br>è¾“å‡ºæ—¶ï¼Œæ§åˆ¶é«˜ä½ç”µå¹³ï¼›è¾“å…¥æ—¶ï¼Œè·å–é«˜ä½ç”µå¹³</li>
<li>edge<br>æ§åˆ¶ä¸­æ–­è§¦å‘æ¨¡å¼ï¼Œå¼•è„šè¢«é…ç½®ä¸ºä¸­æ–­åå¯ä»¥ä½¿ç”¨poll() å‡½æ•°ç›‘å¬å¼•è„š<br>éä¸­æ–­å¼•è„šã€ä¸Šå‡æ²¿è§¦å‘ã€ä¸‹é™æ²¿è§¦å‘ã€è¾¹æ²¿è§¦å‘</li>
<li>active_low<br>ç”¨äºç¿»è½¬ç”µå¹³ï¼Œå½“å¤–éƒ¨æœ‰æ•ˆä¿¡å·ä¸GPIOæœ‰æ•ˆä¿¡å·ä¸ä¸€è‡´ï¼ˆå³0å¯èƒ½è¡¨ç¤ºæœ‰æ•ˆï¼Œ1ä¹Ÿæœ‰å¯èƒ½è¡¨ç¤ºæœ‰æ•ˆï¼‰</li>
</ul>
<h2 id="æŸ¥çœ‹GPIOé…ç½®"><a href="#æŸ¥çœ‹GPIOé…ç½®" class="headerlink" title="æŸ¥çœ‹GPIOé…ç½®"></a>æŸ¥çœ‹GPIOé…ç½®</h2><p>ä¸åŒçš„å‚å•†å¯¹äºGPIOé…ç½®ç»“æœçš„æŸ¥çœ‹æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œä»¥ä¸‹ä»¥Ingenic-x2000ä¸ºä¾‹å¯¹åº”ç›¸å…³çš„æ‰‹å†Œå¯ä»¥ç¡®å®šç›¸åº”çš„IOçŠ¶æ€</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">/<span class="meta"># cat /sys/devices/platform/apb/10010000.pinctrl/dump_gpio</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœå¦‚ä¸‹å›¾, ä¸‹é¢ä¼šæœ‰æ¯ä¸€ä¸ªGPIOçŠ¶æ€</span></span><br><span class="line">REG 	|+++GPA++|+++GPB++|+++GPC++|+++GPD++|</span><br><span class="line"></span><br><span class="line">INL 	|<span class="number">0</span>c3fffff|<span class="number">67f</span>6036f|<span class="number">0110f</span>ef4|<span class="number">0f</span>7fffff|</span><br><span class="line">INT 	|<span class="number">02b</span>00000|<span class="number">30440000</span>|<span class="number">00000081</span>|<span class="number">00000100</span>|</span><br><span class="line">MSK 	|<span class="number">194f</span>cfff|ce0a0040|<span class="number">74f</span>f0076|<span class="number">003f</span>feff|</span><br><span class="line">PAT1 	|<span class="number">0265</span>cfff|f6440000|<span class="number">77</span>efc0fb|<span class="number">003f</span>fbff|</span><br><span class="line">PAT0 	|<span class="number">0f</span>8a3000|<span class="number">1033</span>efc0|<span class="number">88100005</span>|<span class="number">00000400</span>|</span><br><span class="line">EDG 	|<span class="number">3f</span>ffff00|f6037f00|<span class="number">10f</span>ff400|<span class="number">7f</span>ffff00|</span><br><span class="line">PLUP 	|<span class="number">14000000</span>|<span class="number">41800000</span>|<span class="number">00200001</span>|<span class="number">00000100</span>|</span><br><span class="line">PLDWN 	|<span class="number">00000000</span>|<span class="number">800000</span>c0|<span class="number">00100002</span>|<span class="number">00000000</span>|</span><br><span class="line">FLAG 	|<span class="number">00000000</span>|<span class="number">00000000</span>|<span class="number">00000000</span>|<span class="number">00000000</span>|</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h1 id="ç›¸å…³åŠŸèƒ½"><a href="#ç›¸å…³åŠŸèƒ½" class="headerlink" title="ç›¸å…³åŠŸèƒ½"></a>ç›¸å…³åŠŸèƒ½</h1><p>åœ¨ä½åŠŸè€—åœºæ™¯ä¸‹ï¼Œç³»ç»Ÿä¼‘çœ ä»¥åéƒ¨åˆ†ç¡¬ä»¶æ—¶é’Ÿå¯èƒ½å…³é—­ã€‚ä½†æ˜¯GPIOä¸ä¾èµ–æ—¶é’Ÿï¼Œæ•…å¯ä»¥é…ç½®IOä½œä¸ºä¸­æ–­æºå¯¹CPUè¿›è¡Œå”¤é†’</p>
]]></content>
      <categories>
        <category>Computure System</category>
      </categories>
  </entry>
  <entry>
    <title>ç”µæ± ç”µé‡æ£€æµ‹</title>
    <url>/2023/03/06/work-expericence/%E7%94%B5%E6%B1%A0%E7%94%B5%E9%87%8F%E6%A3%80%E6%B5%8B/</url>
    <content><![CDATA[<p>è¿‘æœŸåœ¨åšå…³äºç”µæ± ç”µé‡æ£€æµ‹çš„å·¥ä½œï¼Œè€Œç¡¬ä»¶ç”µè·¯å¹¶æ²¡æœ‰ä½¿ç”¨åº“ä»‘è®¡ï¼ˆåœ¨éƒ¨åˆ†åµŒå…¥å¼åœºæ™¯ä¸‹æˆæœ¬å¤ªé«˜ï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨åˆ†å‹ç”µè·¯ADCé‡‡æ ·ã€‚åŸºäºæ­¤å¯¹ç›¸å…³å­¦ä¹ åˆ°çš„å†…å®¹åšæ€»ç»“å’Œåˆ†äº«</p>
<h1 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h1><ul>
<li>é”‚ç”µæ± çš„æ”¾ç”µéçº¿æ€§ï¼›</li>
<li>å……æ”¾ç”µç¬é—´ï¼Œç”µå‹å€¼æ˜¯çªå˜çš„</li>
<li>é”‚ç”µæ± éšç€ä½¿ç”¨ç”µé‡å‡å°‘ï¼Œéœ€è¦å®ç°è‡ªåŠ¨æ ¡å‡†</li>
<li>â€¦â€¦</li>
</ul>
<h1 id="å……ç”µICåŸºç¡€åŸç†"><a href="#å……ç”µICåŸºç¡€åŸç†" class="headerlink" title="å……ç”µICåŸºç¡€åŸç†"></a>å……ç”µICåŸºç¡€åŸç†</h1><h2 id="ICå……ç”µé˜¶æ®µ"><a href="#ICå……ç”µé˜¶æ®µ" class="headerlink" title="ICå……ç”µé˜¶æ®µ"></a>ICå……ç”µé˜¶æ®µ</h2><ul>
<li><p>æ¶“æµå……ç”µï¼ˆTrickle Chargeï¼‰</p>
<p>æ¶“æµå……ç”µé˜¶æ®µé€šå¸¸åªåœ¨ç”µæ± ç”µå‹ä½äºä¸€ä¸ªæä½æ°´å¹³æ—¶é‡‡ç”¨ã€‚</p>
<p>åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œç”µæ± ç»„çš„å†…éƒ¨ä¿æŠ¤ IC å¯èƒ½ç”±äºæ·±åº¦æ”¾ç”µæˆ–å‘ç”Ÿè¿‡æµäº‹ä»¶å·²ç»æ–­å¼€äº†ç”µæ± ã€‚å……ç”µå™¨ IC æä¾›ä¸€ä¸ªå°ç”µæµï¼ˆé€šå¸¸ä¸º 50mAï¼‰ä¸ºç”µæ± ç»„çš„ç”µå®¹å……ç”µï¼Œä»¥è§¦å‘ä¿æŠ¤ IC ï¼Œåˆä¸Šå…¶ FETé‡æ–°è¿æ¥ç”µæ± ã€‚è™½ç„¶æ¶“æµå……ç”µé€šå¸¸åªæŒç»­å‡ ç§’é’Ÿï¼Œä½†å……ç”µå™¨ IC ä»ç„¶éœ€è¦é›†æˆä¸€ä¸ªå®šæ—¶å™¨ã€‚å¦‚æœç”µæ± ç»„åœ¨ä¸€å®šæ—¶é—´å†…æœªé‡æ–°è¿æ¥ï¼Œåˆ™å®šæ—¶å™¨åœæ­¢å……ç”µï¼Œå› ä¸ºè¿™è¡¨æ˜ç”µæ± å·²æŸåã€‚</p>
</li>
<li><p>é¢„å……ç”µï¼ˆPreChargeï¼‰</p>
<p>ä¸€æ—¦ç”µæ± ç»„é‡æ–°è¿æ¥æˆ–å¤„äºæ”¾ç”µçŠ¶æ€ï¼Œå°±è¿›å…¥é¢„å……ç”µé˜¶æ®µã€‚</p>
<p>é¢„å……ç”µæœŸé—´ï¼Œå……ç”µICå¼€å§‹ä»¥ä¸€ä¸ªè¾ƒä½çš„ç”µæµæ°´å¹³ä¸ºè€—å°½çš„ç”µæ± å®‰å…¨å……ç”µï¼Œè¯¥ç”µæµé€šå¸¸ä¸º C / 10ï¼ˆC ä¸ºå®¹é‡ï¼Œä»¥ mAh ä¸ºå•ä½ï¼‰ã€‚é¢„å……ç”µä½¿ç”µæ± ç”µå‹ç¼“æ…¢ä¸Šå‡ã€‚å…¶ç›®çš„æ˜¯åœ¨ä½ç”µæµæ°´å¹³ä¸‹å¯¹ç”µæ± è¿›è¡Œå®‰å…¨çš„å……ç”µï¼Œä»¥é˜²æ­¢æŸåç”µæ± ï¼Œç›´åˆ°å…¶ç”µå‹è¾¾åˆ°ä¸€ä¸ªè¾ƒé«˜çš„æ°´å¹³ã€‚</p>
</li>
<li><p>æ’æµå……ç”µï¼ˆConstant Current Chargeï¼‰</p>
<p>æ’æµï¼ˆCCï¼‰å……ç”µä¹Ÿè¢«ç§°ä½œå¿«é€Ÿå……ç”µé˜¶æ®µï¼Œæ’æµå……ç”µåœ¨é¢„å……ç”µä¹‹åå¼€å§‹ã€‚</p>
<p>åœ¨æ’æµå……ç”µé˜¶æ®µï¼Œç”µæ± å¯ä»¥å®‰å…¨åœ°å¤„ç† 0.5C è‡³3C ä¹‹é—´çš„è¾ƒé«˜å……ç”µç”µæµã€‚æ’æµå……ç”µä¼šæŒç»­åˆ°ç”µæ± ç”µå‹è¾¾åˆ°â€œæ»¡ç”µâ€æˆ–æµ®åŠ¨ç”µå‹æ°´å¹³ï¼Œç„¶åè¿›å…¥æ’å‹å……ç”µé˜¶æ®µã€‚</p>
</li>
<li><p>æ’å‹å……ç”µï¼ˆConstant voltage Chargeï¼‰</p>
<p>å……ç”µå™¨ IC ä¼šåœ¨æ’æµå……ç”µæœŸé—´ç›‘æµ‹ç”µæ± ç”µå‹ã€‚ä¸€æ—¦ç”µæ± è¾¾åˆ°æ’å‹å……ç”µé˜ˆå€¼ï¼Œå……ç”µå™¨ICå°±ä¼šä»æ’æµè½¬æ¢è‡³æ’å‹è°ƒèŠ‚é˜¶æ®µã€‚å½“å……ç”µå™¨ IC ç›‘æµ‹åˆ°å¤–éƒ¨ç”µæ± ç»„ç”µå‹è¶…è¿‡äº†ç”µæ± ç»„ä¸­çš„å®é™…ç”µæ± ç”µå‹ï¼Œå°±å¼€å§‹æ‰§è¡Œæ’å‹å……ç”µã€‚è¿™æ˜¯ç”±äºå­˜åœ¨å†…éƒ¨ç”µæ± ç”µé˜»ã€PCB ç”µé˜»å’Œæ¥è‡ªä¿æŠ¤ FET å’Œå•ç”µæ± çš„ç­‰æ•ˆä¸²è”ç”µé˜» (ESR)ã€‚å……ç”µå™¨ IC ä¸åº”å…è®¸ç”µæ± ç”µå‹è¶…è¿‡å…¶æœ€å¤§æµ®åŠ¨ç”µå‹ï¼Œä»¥ä¿è¯å®‰å…¨çš„è¿è¡Œã€‚</p>
</li>
<li><p>æˆªæ­¢é˜¶æ®µ</p>
<p>å¯¹äºæµ®å……å‹å……ç”µèŠ¯ç‰‡ï¼Œå½“è¾¾åˆ°æµ®å……é˜ˆå€¼ï¼Œè¾“å‡ºæ’å®šç”µå‹</p>
<p>å¯¹äºå…³æ–­å‹å……ç”µèŠ¯ç‰‡ï¼Œå½“å……ç”µå……æ»¡ï¼ŒèŠ¯ç‰‡å¤„äºå…³æ–­å¾…æœºçŠ¶æ€ï¼Œæ— å……ç”µç”µæµ</p>
</li>
</ul>
<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><ol>
<li>å¯¹äºICå„ä¸ªå……ç”µé˜¶æ®µéœ€è¦å‚è€ƒICçš„æ‰‹å†Œæœ€ç»ˆç¡®å®šæœ‰å“ªäº›é˜¶æ®µï¼Œæœ‰äº›å°†æ¶“æµå……ç”µå’Œé¢„å……ç”µåˆæˆä¸€ä¸ªé˜¶æ®µå¤„ç†ï¼Œæ‰€ä»¥éœ€è¦å…·ä½“åˆ†æã€‚</li>
<li>æœ‰äº›å……ç”µICæä¾›äº†å¯ç¼–ç¨‹é…ç½®é˜ˆå€¼çš„åŠŸèƒ½ï¼Œå³é€šè¿‡è¿æ¥ä¸åŒçš„é˜»å€¼æ¥å¯¹å…¶è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœæ²¡æœ‰éœ€è¦å‚è€ƒæ‰‹å†Œç¡®å®šæ¯ä¸ªé˜¶æ®µçš„é˜ˆå€¼åˆ†åˆ«æ˜¯å¤šå°‘ã€‚é…ç½®çš„é˜ˆå€¼èƒ½å¤Ÿæä¾›ä¸€å±‚é¢å¤–çš„å®‰å…¨ä¿æŠ¤ï¼Œä¿æŠ¤ç”µæ± å…å—è¿‡å‹ã€è¿‡çƒ­æ¡ä»¶ä»¥åŠè¿‡è½½çš„å½±å“ï¼Œä»è€Œé¿å…ç”µæ± çš„æ°¸ä¹…æŸåæˆ–å®¹é‡é™çº§ã€‚</li>
</ol>
<h1 id="æµç¨‹æ•´ç†"><a href="#æµç¨‹æ•´ç†" class="headerlink" title="æµç¨‹æ•´ç†"></a>æµç¨‹æ•´ç†</h1><ol>
<li><p>é…ç½® ADC</p>
<p>ä¸­æ–­æ¨¡å¼ã€è®¾ç½®é‡å¤é‡‡æ ·æ—¶é—´ã€è®¾ç½®é‡‡æ ·æ¬¡æ•°</p>
<ul>
<li>Vadc = adcNumer(ADCé‡‡æ ·æ•°æ®) x Vrefï¼ˆADCåŸºå‡†ç”µå‹ï¼‰/  ï¼ˆ2^ADCé‡åŒ–ä½æ•°ï¼‰</li>
<li>Vbat = kï¼ˆç”µé˜»åˆ†å‹ç³»æ•°æ¯”ï¼‰ Ã—  Vadc</li>
</ul>
</li>
<li><p>é…ç½® Timer</p>
<p>é…ç½®ADCé‡‡æ ·çš„æ—¶é—´å³å¤šä¹…è¿›è¡Œä¸€æ¬¡ç”µæ± ç”µé‡æ£€æµ‹</p>
</li>
<li><p>å¯åŠ¨ç”µæ± ç”µé‡æ£€æµ‹ä¸»çº¿ç¨‹</p>
</li>
<li><p>ç­‰å¾…USBæ’æ‹”äº‹ä»¶ä¸­æ–­æˆ–è€…Timeræ—¶é—´è§¦å‘ç”µæ± æ£€æµ‹</p>
<ul>
<li>æ‰“å¼€ADCé‡‡æ ·é€šé“</li>
<li>è·å–ADCæ•°æ®</li>
<li>å…³é—­ADCé‡‡æ ·é€šé“</li>
<li>è®¡ç®—æœ€ç»ˆè¾“å‡ºçš„ç”µæ± ç”µé‡</li>
</ul>
</li>
</ol>
<h1 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h1><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/************************************   ADC    *******************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">adc_interrupt_cb</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// calculate adc voltage</span></span><br><span class="line">    <span class="comment">// æ ¡å‡†ï¼šé‡‡é›†å¤šæ¬¡å»æ‰ä¸€ä¸ªæœ€å°å€¼ã€å»æ‰ä¸€ä¸ªæœ€å¤§å€¼ï¼Œå–å¹³å‡å€¼</span></span><br><span class="line">}</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">adc_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// config adc interrupt mode and callback</span></span><br><span class="line">    <span class="comment">// config adc sampling times</span></span><br><span class="line">    <span class="comment">// enable adc channels</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">/************************************   USB    *******************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">usb_interrupt_callback</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// get usb charging / discharging state</span></span><br><span class="line">    <span class="comment">// put battery detect time to default</span></span><br><span class="line">    <span class="comment">// enable adc sampling(enter adc_interrupt_cb)</span></span><br><span class="line">}   </span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">usb_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// request drv_bus gpio</span></span><br><span class="line">    <span class="comment">// config  drv_bus interrupt and trigger mode</span></span><br><span class="line">    <span class="comment">// config  interrupt callback</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">/***********************************    TIMER     ***************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">timer_interrupt_cb</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// enable adc sampling(enter adc_interrupt_cb)</span></span><br><span class="line">}</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">timer_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// config timer</span></span><br><span class="line">    <span class="comment">// config default battery detect time to timer</span></span><br><span class="line">    <span class="comment">// config timer interrupt callback</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">/***********************************   BATTERY    ***************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">get_battery_voltage</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// enable channels</span></span><br><span class="line">    <span class="comment">// get battery voltage</span></span><br><span class="line">    <span class="comment">// disable channels</span></span><br><span class="line">}</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">adjust_battery_voltage</span><span class="params">(<span class="type">int</span> vbat)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// record pre_percent pre_voltage</span></span><br><span class="line">    <span class="comment">// record voltage and timestamp, calculate new battery detect time</span></span><br><span class="line">    <span class="comment">// other optimize ways</span></span><br><span class="line">}</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">calculate_battery_percent</span><span class="params">(<span class="type">int</span> vbat)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// éœ€è¦å‚å®¶æä¾›ç”µæ± å……æ”¾ç”µç”µæ± å®¹é‡ç™¾åˆ†æ¯”å¯¹åº”çš„ç”µå‹</span></span><br><span class="line">    <span class="comment">// æŸ¥è¡¨===&gt;è®¡ç®—å‡ºç™¾åˆ†æ¯”</span></span><br><span class="line">    <span class="comment">// ç­–ç•¥ï¼š</span></span><br><span class="line">    <span class="comment">//   æœ€ç»ˆçš„ç™¾åˆ†æ¯”ç›¸è¾ƒäºä¸Šä¸€æ¬¡æ˜¯å¦æœ‰è·³å˜ï¼Œ+-1ï¼›</span></span><br><span class="line">    <span class="comment">//   å……ç”µç™¾åˆ†æ¯”å‡å°‘ï¼Œæ”¾ç”µç™¾åˆ†æ¯”å¢åŠ ã€‚ä¸è¢«å…è®¸ï¼Œéœ€è¦å¯¹è¿™ä¸¤ç§æƒ…å†µå¤„ç†æ‰</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">//ç”µæ± ç”µé‡æ£€æµ‹å‡½æ•°å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">battery_detect_thread</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    adc_init();</span><br><span class="line">    usb_init();</span><br><span class="line">    timer_init();</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) {</span><br><span class="line">        <span class="comment">// calculate battery percent</span></span><br><span class="line">        <span class="type">int</span> vbat = get_battery_voltage();</span><br><span class="line">        vbat = adjust_battery_voltage(vbat);</span><br><span class="line">        <span class="type">int</span> percent = calculate_battery_percent(vbat);</span><br><span class="line">    }</span><br><span class="line">    adc_deinit();</span><br><span class="line">    usb_deinit();</span><br><span class="line">    timer_deinit();</span><br><span class="line">}   </span><br></pre></td></tr></tbody></table></figure>

<h1 id="è¯¯å·®æ¥æº"><a href="#è¯¯å·®æ¥æº" class="headerlink" title="è¯¯å·®æ¥æº"></a>è¯¯å·®æ¥æº</h1><ol>
<li>ADCé‡åŒ–è¯¯å·®</li>
<li>åˆ†å‹ç”µé˜»å€¼ä¸å‡†ç¡®ï¼Œå¯¼è‡´åˆ†å‹æ¯”ä¸ç¡®å®šå¸¦æ¥çš„è¯¯å·®</li>
<li>OCVè¡¨æ ¼å†…è®°å½•çš„æ˜¯é˜¶æ®µæ€§çš„ç”µå‹ä¸å®¹é‡æ¯”ï¼Œæ¯ä¸€æ ¼å®é™…ä¸Šä¸æ˜¯çº¿æ€§å˜åŒ–çš„ï¼Œä½†åœ¨å®é™…å¤„ç†è¿‡ç¨‹ä¸­æŒ‰ç…§çº¿æ€§æ¥å¤„ç†</li>
</ol>
<h1 id="æ ¡å‡†è¯¯å·®åŠä¼˜åŒ–ç­–ç•¥"><a href="#æ ¡å‡†è¯¯å·®åŠä¼˜åŒ–ç­–ç•¥" class="headerlink" title="æ ¡å‡†è¯¯å·®åŠä¼˜åŒ–ç­–ç•¥"></a>æ ¡å‡†è¯¯å·®åŠä¼˜åŒ–ç­–ç•¥</h1><ol>
<li><p>ADCé‡‡æ ·</p>
<p>å¹³å‡å€¼æ»¤æ³¢ã€‚å–åæ¬¡adcæ•°æ®ï¼Œå»æ‰æœ€å¤§å€¼ã€æœ€å°å€¼å–å¹³å‡å€¼</p>
</li>
<li><p>æ’å…¥usb / æ‹”å‡ºusbç¬é—´è§¦å‘ç”µæ± æ£€æµ‹</p>
</li>
<li><p>è®°å½•æœ€è¿‘åæ¬¡é‡‡æ ·çš„ç»“æœåŠsysTimeï¼Œè®¡ç®—æ‰ç”µæˆ–ä¸Šç”µ1%å®¹é‡æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œä»è€Œå¯ä»¥è®¡ç®—å‡ºä¸‹ä¸€æ¬¡æ£€æµ‹çš„æ—¶é—´é—´éš”</p>
</li>
<li><p>åœ¨æœ€ç»ˆç”µæ± ç”µé‡çš„æ˜¾ç¤ºä¸Šï¼Œéœ€è¦é€æ­¥é€’å¢é€¼è¿‘é‡‡é›†çš„å€¼ä¸èƒ½çªå˜</p>
</li>
<li><p>æ ¡å‡†ï¼šæ ¹æ®ä¸€ä¸ªç¡®å®šçŠ¶æ€ä¸‹ï¼Œç¡®å®šçš„ç”µå‹å€¼å’Œæˆ‘ä»¬é‡‡é›†åˆ°çš„ç”µå‹å€¼ï¼Œè®¡ç®—å‡ºåå·®ï¼Œæ ¡å‡†</p>
</li>
</ol>
<h1 id="ç¼©å†™è¡¨"><a href="#ç¼©å†™è¡¨" class="headerlink" title="ç¼©å†™è¡¨"></a>ç¼©å†™è¡¨</h1><ul>
<li><p>OCVï¼šOpen Circuitt Voltage  å¼€è·¯ç”µå‹</p>
</li>
<li><p>CVï¼šCyclic Voltammetry å¾ªç¯ä¼å®‰æ³•ï¼ˆæ”¹å˜ç”µä½ä»¥å¾—åˆ°æ°§åŒ–è¿˜åŸç”µæµæ–¹å‘ä¹‹æ–¹æ³•ï¼‰</p>
</li>
<li><p>UVLOï¼šUnder Voltage Lock Out æ¬ å‹é”å®šï¼ˆè¾“å…¥ç”µå‹ä½äºæŸä¸€å€¼æ—¶ï¼Œç”µæºèŠ¯ç‰‡ä¸å·¥ä½œï¼Œå¤„äºä¿æŠ¤çŠ¶æ€ï¼‰</p>
</li>
<li><p>OVPï¼šOver Voltage Protection  è¿‡å‹ä¿æŠ¤</p>
</li>
<li><p>UVPï¼šUnder voltage Protection  æ¬ å‹ä¿æŠ¤</p>
</li>
<li><p>ASOCï¼šAbsolute State-Of-Charge  ç»å¯¹ç”µè·çŠ¶æ€ ï¼ˆç»å¯¹è·ç”µçŠ¶æ€åˆ™æ˜¯ä¸€ä¸ªå½“ç”µæ± åˆ¶é€ å®Œæˆæ—¶ï¼Œæ ¹æ®æ‰€è®¾è®¡çš„å›ºå®šå®¹é‡å€¼æ‰€è®¡ç®—å‡ºæ¥çš„çš„å‚è€ƒå€¼ï¼‰</p>
</li>
<li><p>RSOCï¼š Relative State-Of-Charge ç›¸å¯¹ç”µè·çŠ¶æ€ï¼ˆç›¸å¯¹è·ç”µçŠ¶æ€çš„èŒƒå›´æ˜¯ 0% - 100%ï¼‰</p>
</li>
</ul>
<p>ä¸€ä¸ªå…¨æ–°å®Œå…¨å……ç”µç”µæ± çš„ç»å¯¹è·ç”µçŠ¶æ€æ˜¯100%ï¼›è€Œè€åŒ–çš„ç”µæ± å³ä¾¿å®Œå…¨å……ç”µï¼Œåœ¨ä¸åŒå……æ”¾ç”µæƒ…å†µä¸­ä¹Ÿæ— æ³•åˆ°100%ã€‚</p>
<h1 id="ICåŸç†å›¾åŠå…¶å®ƒå‚è€ƒèµ„æ–™"><a href="#ICåŸç†å›¾åŠå…¶å®ƒå‚è€ƒèµ„æ–™" class="headerlink" title="ICåŸç†å›¾åŠå…¶å®ƒå‚è€ƒèµ„æ–™"></a>ICåŸç†å›¾åŠå…¶å®ƒå‚è€ƒèµ„æ–™</h1><ol>
<li><a href="https://www.dioo.com/uploads/product/20210521/77eaa63f9de5e6b03018958741f47a52.pdf">DIO58056</a></li>
<li><a href="https://www.docin.com/p-2290652672.html">SY8602</a></li>
<li><a href="https://www.ti.com.cn/cn/lit/an/zhcaaf7/zhcaaf7.pdf">TIç”µé‡è®¡è®¾è®¡æŒ‡å¯¼</a></li>
<li><a href="https://blog.csdn.net/Linux_LR/article/details/119787382">ADCç”µé‡æ£€æµ‹ä¸æ ¡å‡†</a></li>
</ol>
]]></content>
      <categories>
        <category>Work Experience</category>
      </categories>
  </entry>
  <entry>
    <title>Problem &amp; Tools</title>
    <url>/2023/04/27/work-expericence/problem_tools/</url>
    <content><![CDATA[<h1 id="ubuntuè½¯ä»¶"><a href="#ubuntuè½¯ä»¶" class="headerlink" title="ubuntuè½¯ä»¶"></a>ubuntuè½¯ä»¶</h1><h2 id="éŸ³é¢‘-audacity"><a href="#éŸ³é¢‘-audacity" class="headerlink" title="éŸ³é¢‘ audacity"></a>éŸ³é¢‘ audacity</h2><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get install audacity</span><br></pre></td></tr></tbody></table></figure>

<h2 id="USBæ‘„åƒå¤´-chesse"><a href="#USBæ‘„åƒå¤´-chesse" class="headerlink" title="USBæ‘„åƒå¤´ chesse"></a>USBæ‘„åƒå¤´ chesse</h2><ol>
<li><p>è®¾ç½®â†’æ·»åŠ â†’usbæ§åˆ¶å™¨â†’å…¼å®¹usb3.0</p>
</li>
<li><p>è™šæ‹Ÿæœºâ†’å¯ç§»åŠ¨è®¾å¤‡â†’web cameraâ†’è¿æ¥ï¼ˆæ–­å¼€ä¸»æœºï¼‰</p>
</li>
<li><p>æŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lsusb</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /dev/video0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¾“å‡º /dev/video0,é…ç½®æˆ</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>æ‰“å¼€ubuntuè‡ªå¸¦çš„chesseè½¯ä»¶ï¼ˆèŒ„å­ï¼‰ï¼Œè¿è¡Œæ‘„åƒå¤´</p>
</li>
</ol>
<h2 id="USBæ‘„åƒå¤´-luvcview"><a href="#USBæ‘„åƒå¤´-luvcview" class="headerlink" title="USBæ‘„åƒå¤´ luvcview"></a>USBæ‘„åƒå¤´ luvcview</h2><ol>
<li><p>æºç ä¸‹è½½ ï¼Œé“¾æ¥ï¼š<a href="https://launchpad.net/ubuntu/+source/luvcview/1:0.2.6-6">https://launchpad.net/ubuntu/+source/luvcview/1:0.2.6-6</a></p>
</li>
<li><p>å®‰è£…ä¾èµ–</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get install debhelper</span><br><span class="line">sudo apt-get install libsdl1.2-dev</span><br><span class="line">sudo apt-get install libv4l-dev</span><br><span class="line">sudo apt-get install pkg-config</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å°†æºç ç§»åŠ¨åˆ°å®‰è£…æ–‡ä»¶å¤¹ä¸‹</p>
</li>
<li><p>æ‰§è¡Œ make ç¼–è¯‘</p>
<p>æ‰§è¡Œ make install å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶</p>
</li>
<li><p>ä½¿ç”¨æ–¹æ³•</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">luvcview -d /dev/video0 -f yuv -s 640x480</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>é—®é¢˜</p>
<ul>
<li><p>æŠ¥é”™ â€luvcview.c:32:10: fatal error: SDL/SDL.h: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•â€œ</p>
<p>æ²¡æœ‰å®‰è£…ä¾èµ–</p>
</li>
<li><p>æŠ¥é”™ â€luvcview.c:36:10: fatal error: linux/videodev.h: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•â€œ</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">sudo ln -s /usr/include/linux/videodev2.h /usr/include/linux/videodev.h</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ol>
<h2 id="å›¾ç‰‡æ ¼å¼7yuv"><a href="#å›¾ç‰‡æ ¼å¼7yuv" class="headerlink" title="å›¾ç‰‡æ ¼å¼7yuv"></a>å›¾ç‰‡æ ¼å¼7yuv</h2><p>å¥½åƒåªç»´æŠ¤åˆ°16.0.4ï¼Œå¯ä»¥æœç´¢ä¸‹æŸ¥çœ‹</p>
<h2 id="ä¸²å£å·¥å…·minicom"><a href="#ä¸²å£å·¥å…·minicom" class="headerlink" title="ä¸²å£å·¥å…·minicom"></a>ä¸²å£å·¥å…·minicom</h2><h2 id="åµŒå…¥å¼å¼€å‘å·¥å…·"><a href="#åµŒå…¥å¼å¼€å‘å·¥å…·" class="headerlink" title="åµŒå…¥å¼å¼€å‘å·¥å…·"></a>åµŒå…¥å¼å¼€å‘å·¥å…·</h2><ul>
<li>UIï¼švimã€emacs</li>
<li>å¤šçª—å£ç®¡ç†å·¥å…·ï¼štmux</li>
<li>æ–‡æœ¬å¯¹æ¯”å·¥å…·ï¼šmeldã€vimdiff</li>
<li>æ–‡æ¡£è®°å½•å·¥å…·ï¼štypora</li>
<li>æ€§èƒ½è°ƒä¼˜å·¥å…·ï¼šperf</li>
</ul>
<h1 id="ssh-x2F-scpå…å¯†"><a href="#ssh-x2F-scpå…å¯†" class="headerlink" title="ssh / scpå…å¯†"></a>ssh / scpå…å¯†</h1><ol>
<li><p>æœ¬åœ°sshåˆ°æœåŠ¡å™¨</p>
<ul>
<li>ssh-keygenäº§ç”Ÿå…¬é’¥ä¸ç§é’¥å¯¹ï¼ˆå‘½ä»¤ï¼šssh-keygenï¼Œè¿‡ç¨‹ä¸­ä¸€ç›´å›è½¦ï¼‰</li>
<li>å¤åˆ¶å…¬é’¥è‡³æœåŠ¡å™¨ï¼ˆå‘½ä»¤ï¼šssh-copy-id -i ~/.ssh/id_rsa.pub username@æœåŠ¡å™¨ipï¼‰</li>
<li>å†æ¬¡sshå³å¯å®ç°å…å¯†ç™»å½•</li>
</ul>
</li>
<li><p>æœåŠ¡å™¨ç«¯scpå…å¯†</p>
<ul>
<li>äº§ç”Ÿå¯†é’¥å¯¹ï¼ˆssh-keygen -t rsaï¼‰</li>
<li>å¤åˆ¶å…¬é’¥è‡³æœ¬åœ°ï¼ˆssh-copy-id -p 22 -i ~/.ssh/id_rsa.pub username@æœ¬åœ°ipï¼‰</li>
<li>å†æ¬¡scpå³å¯å®ç°å…å¯†ä¼ è¾“</li>
</ul>
</li>
<li><p>å‚æ•°è¯´æ˜</p>
<ul>
<li>ssh-keygen     -t    type</li>
<li>ssh-copy-id    -p    port</li>
<li>ssh-copy-id	 -i    identity_file</li>
</ul>
</li>
</ol>
<h1 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h1><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">export		    # æ˜¾ç¤ºå½“å‰ç³»ç»Ÿå®šä¹‰çš„æ‰€æœ‰çš„ç¯å¢ƒå˜é‡</span><br><span class="line">echo $PATH		# è¾“å‡ºå½“å‰PATHç¯å¢ƒå˜é‡çš„å€¼</span><br><span class="line"></span><br><span class="line">:               # å†’å·åˆ†å‰²ä¸åŒçš„è·¯å¾„</span><br></pre></td></tr></tbody></table></figure>





<h1 id="pcæ— æ³•è¯†åˆ«usb"><a href="#pcæ— æ³•è¯†åˆ«usb" class="headerlink" title="pcæ— æ³•è¯†åˆ«usb"></a>pcæ— æ³•è¯†åˆ«usb</h1><ul>
<li><p>ç°è±¡</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">error: insufficient permissions for device</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>è§£å†³æ–¹æ¡ˆ</p>
</li>
</ul>
<ol>
<li><p>ä½¿ç”¨lsusbå‘½ä»¤ï¼ŒæŸ¥çœ‹usbID</p>
</li>
<li><p>æ’å…¥usbä¹‹åï¼Œå†æ¬¡ä½¿ç”¨usbIDï¼ŒæŸ¥æ‰¾å¤šå‡ºæ¥çš„è®¾å¤‡ID</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">Bus 002 Device 002: ID 045e:00db Microsoft Corp. Natural Ergonomic Keyboard 4000 V1.0</span><br><span class="line"></span><br><span class="line">Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub </span><br><span class="line"></span><br><span class="line">Bus 001 Device 025: ID 18d1:4e12 </span><br><span class="line"></span><br><span class="line">Bus 001 Device 007: ID 1a40:0101 TERMINUS TECHNOLOGY INC. </span><br><span class="line"></span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hu</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IDåé¢åˆ†å·å‰é¢å¯¹åº”xxx1ï¼Œåˆ†å·åé¢å¯¹åº”xxx2</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>åœ¨/etc/udev/rules.dä¸­åˆ›å»ºâ€œ51-android.rulesâ€ï¼ˆåå­—ä¸å›ºå®šï¼‰</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">æ·»åŠ å†…å®¹ï¼š</span><br><span class="line"></span><br><span class="line">UBSYSTEM=="usb", ATTRS{idVendor}=="xxx1", ATTRS{idProduct}=="xxx2",MODE="0666"</span><br><span class="line">SUBSYSTEMS=="usb", ATTRS{idVendor}=="18d1", ATTRS{idProduct}=="4e12", MODE="0666", OWNER="your_name"</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ä¸º51-android.rulesåŠ ä¸Šæƒé™ï¼ˆsudo chmod a+x 51-android.rulesï¼‰</p>
</li>
<li><p>é‡å¯UDEVï¼ˆadb sudo restart udev; adb kill-serverï¼‰</p>
</li>
<li><p>æ‹”æ‰USBï¼Œå¹¶é‡æ–°æ’ä¸Šï¼ˆadb devicesï¼‰<br>adb devices</p>
</li>
</ol>
<h1 id="ä¿®æ”¹æ ¹ç›®å½•æƒé™"><a href="#ä¿®æ”¹æ ¹ç›®å½•æƒé™" class="headerlink" title="ä¿®æ”¹æ ¹ç›®å½•æƒé™"></a>ä¿®æ”¹æ ¹ç›®å½•æƒé™</h1><ul>
<li><p>åœºæ™¯</p>
<p>é”™è¯¯ä¿®æ”¹usr/binä¸‹çš„æ‰€æœ‰æ–‡ä»¶æƒé™ä¸º777ï¼Œsudoæ— æ³•ä½¿ç”¨</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/usr/bin/sudo must be owned by uid 0 and have the setuid bit se</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>è§£å†³æ–¹æ¡ˆ</p>
</li>
</ul>
<ol>
<li><p>å‘½ä»¤è¡Œ reboot é‡å¯</p>
</li>
<li><p>æŒ‰ESCè¿›å…¥ï¼Œé€‰æ‹©Advanced options for Ubuntuã€‚é€‰æ‹©recovery modeï¼Œé€‰æ‹©rootå‘½ä»¤è¡Œæ¨¡å¼</p>
<p>mount -o remount rw /<br>mount â€“all</p>
<p>å› ä¸ºrecoveryæ¨¡å¼é»˜è®¤æ˜¯ä»¥åªè¯»æ¨¡å¼æŒ‚è½½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é‡æ–°æŒ‚è½½åˆ‡æ¢åˆ°è¯»å†™æ¨¡å¼</p>
</li>
<li><p>ç»™sudoæƒé™</p>
</li>
</ol>
<pre><code> chown root:root /usr/bin/sudo

 chmod 4755 /usr/bin/sudo 

 pkexec chmod go-w /usr/bin/sudo/sudoers.so
</code></pre>
<ol start="4">
<li>é‡å¯ç³»ç»Ÿï¼Œreboot</li>
</ol>
<h1 id="minicom"><a href="#minicom" class="headerlink" title="minicom"></a>minicom</h1><ol>
<li><p>å¯åŠ¨minicomä¹‹åæ²¡æœ‰æ‰“å°</p>
<ul>
<li>â€œctrl+a &gt; æŒ‰é”®oâ€ æˆ–è€…å¯åŠ¨æ—¶â€œsudo minicom -sâ€è¿›å…¥é…ç½®ç•Œé¢</li>
<li>é€‰æ‹©â€œSerial port setupâ€è¿›å…¥</li>
<li>å°† â€œA -    Serial Deviceâ€ ä¿®æ”¹æˆ â€œ/dev/ttyUSB0â€</li>
</ul>
</li>
<li><p>å¯åŠ¨ä¹‹åä¸èƒ½é”®ç›˜è¾“å…¥</p>
</li>
</ol>
<ul>
<li>â€œctrl+a &gt; æŒ‰é”®oâ€ æˆ–è€…å¯åŠ¨æ—¶â€œsudo minicom -sâ€è¿›å…¥é…ç½®ç•Œé¢</li>
<li>é€‰æ‹©â€œSerial port setupâ€è¿›å…¥</li>
<li>å°†â€œF - Hardware Flow Controlâ€ ç¡¬ä»¶æµæ§å…³é—­ï¼Œå³é€‰æ‹©â€œNoâ€</li>
</ul>
<p>â€‹	</p>
]]></content>
      <categories>
        <category>Work Experience</category>
      </categories>
  </entry>
  <entry>
    <title>ADC</title>
    <url>/2023/03/18/computerSystem/Peripherals/ADC/</url>
    <content><![CDATA[<h1 id="ADCåŸºç¡€"><a href="#ADCåŸºç¡€" class="headerlink" title="ADCåŸºç¡€"></a>ADCåŸºç¡€</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><ul>
<li>ADCï¼šAnalog to Digital Converterï¼Œæ¨¡æ•°è½¬æ¢å™¨</li>
<li>æ¨¡æ‹Ÿä¿¡å·ï¼šéšæ—¶é—´å˜åŒ–è¿ç»­çš„ä¿¡å·ï¼Œä¸€æ®µæ—¶é—´å†…æœ‰æ— æ•°ä¸ªå–å€¼ </li>
<li>æ•°å­—ä¿¡å·ï¼šéšæ—¶é—´å˜åŒ–ç¦»æ•£çš„ä¿¡å·ï¼Œä¸€æ®µæ—¶é—´å†…æœ‰å›ºå®šä¸ªæ•°çš„å–å€¼</li>
</ul>
<h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><ol>
<li><strong>é‡‡æ · Samplingï¼š</strong>æŒ‰ç…§ä¸€å®šçš„é¢‘ç‡å¯¹æ¨¡æ‹Ÿä¿¡å·çš„ç¬æ—¶æ—¶åˆ»è¿›è¡Œæ ·æœ¬é‡‡é›†ï¼›</li>
<li><strong>é‡åŒ– Quantizationï¼š</strong>å¯¹é‡‡æ ·ç‚¹çš„å¹…åº¦èµ‹äºˆå…·ä½“çš„æ•°å€¼ï¼›</li>
<li><strong>ç¼–ç  Encodingï¼š</strong>æŒ‰ç…§ä¸€å®šçš„æ ¼å¼è®°å½•æ•°æ®ï¼›</li>
</ol>
<p><img src="/images/computerSystem/Peripherals/ADC.png" alt="image"></p>
<h2 id="æ€§èƒ½æŒ‡æ ‡"><a href="#æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½æŒ‡æ ‡"></a>æ€§èƒ½æŒ‡æ ‡</h2><ol>
<li><strong>é‡‡æ ·é€Ÿç‡ / æ—¶é’Ÿé¢‘ç‡</strong>ï¼šå•ä½æ—¶é—´å†…èƒ½è¿›è¡Œé‡‡æ ·çš„æ¬¡æ•°	</li>
<li><strong>ä½å®½ / åˆ†è¾¨ç‡ï¼š</strong>è¾“å…¥ä¿¡å·å€¼çš„æœ€å°å˜åŒ–</li>
<li>å…¶å®ƒç»†åŒ–æŒ‡æ ‡<ul>
<li>DLNï¼šå¾®åˆ†éçº¿æ€§ï¼Œç›¸å¯¹æŒ‡æ ‡</li>
<li>ILNï¼š ç§¯åˆ†éçº¿æ€§ï¼Œç»å¯¹æŒ‡æ ‡</li>
<li>SFDRï¼šæ— æ‚æ•£åŠ¨æ€èŒƒå›´</li>
</ul>
</li>
</ol>
<h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h2><h3 id="SAR"><a href="#SAR" class="headerlink" title="SAR"></a>SAR</h3><ul>
<li>SARï¼šSuccessive Approximation Registerï¼Œé€æ¬¡é€¼è¿‘å‹</li>
<li>åŸç†ï¼šäºŒåˆ†æŸ¥æ‰¾</li>
<li>ç‰¹ç‚¹ï¼šä½å»¶è¿Ÿï¼Œä½åŠŸè€—</li>
</ul>
<h3 id="âˆ†-âˆ‘"><a href="#âˆ†-âˆ‘" class="headerlink" title="âˆ† -âˆ‘"></a><strong>âˆ† -âˆ‘</strong></h3><ul>
<li>âˆ† -âˆ‘ ï¼šDelta-Sigma ADC</li>
<li>åŸç†ï¼šå°±æ˜¯æŠŠå¾…æµ‹ä¿¡å·Vinä¸å‚è€ƒç”µå‹ä¹‹é—´çš„å·®å€¼è¿›è¡Œä¸æ–­çš„ç´¯ç§¯å¹¶é€šè¿‡åé¦ˆä»¤è¿™ä¸ªå·®å€¼è¶‹äºé›¶ï¼ˆå°ºå­é‡çº¸ï¼‰</li>
<li>ç‰¹ç‚¹ï¼šç²¾åº¦é«˜ï¼Œå»¶è¿Ÿç›¸è¾ƒäºSARé«˜</li>
</ul>
<h2 id="ä¿¡å·è¯¯å·®æ¥æº"><a href="#ä¿¡å·è¯¯å·®æ¥æº" class="headerlink" title="ä¿¡å·è¯¯å·®æ¥æº"></a>ä¿¡å·è¯¯å·®æ¥æº</h2><ul>
<li>ç”µç£è¾å°„ EMI</li>
<li>ç”µè·¯æ¿è®¾è®¡ç¼ºé™·</li>
<li>ç”µæºç”µå‹çš„å˜åŒ–</li>
<li>ç¯å¢ƒçš„å˜åŒ–</li>
<li>é‡åŒ–è¯¯å·®ï¼ˆå†…éƒ¨ï¼‰</li>
</ul>
<h1 id="SAR-A-x2F-D-Controller"><a href="#SAR-A-x2F-D-Controller" class="headerlink" title="SAR A/D Controller"></a>SAR A/D Controller</h1><p>è¯¥éƒ¨åˆ†æ¶‰å¯†ä¸åšå…·ä½“è¯´æ˜</p>
<h2 id="é€»è¾‘æ¡†å›¾"><a href="#é€»è¾‘æ¡†å›¾" class="headerlink" title="é€»è¾‘æ¡†å›¾"></a>é€»è¾‘æ¡†å›¾</h2><h2 id="åŠŸèƒ½ç‰¹æ€§"><a href="#åŠŸèƒ½ç‰¹æ€§" class="headerlink" title="åŠŸèƒ½ç‰¹æ€§"></a>åŠŸèƒ½ç‰¹æ€§</h2><h2 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h2><h1 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h1><ul>
<li><p>è½®è¯¢Polling</p>
</li>
<li><p>ä¸­æ–­Interrupt</p>
<p>ä½¿ç”¨ä¸­æ–­æ–¹å¼é‡‡æ ·å®Œæˆåä¼šè‡ªåŠ¨è¿›å…¥ä¸­æ–­æœåŠ¡å‡½æ•°ã€‚èŠ‚çº¦CPUèµ„æº</p>
</li>
<li><p>å®šæ—¶å™¨è§¦å‘</p>
</li>
<li><p>DMA</p>
</li>
</ul>
<h1 id="ç»“æœè®¡ç®—"><a href="#ç»“æœè®¡ç®—" class="headerlink" title="ç»“æœè®¡ç®—"></a>ç»“æœè®¡ç®—</h1><p>Vout = ADATA / ( 2 ^ Resolution) Ã— Vref_ADC</p>
<h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><ul>
<li><p>ADC Clock Divide å¯„å­˜å™¨åˆ†é¢‘ç³»æ•°è®¡ç®—å…¬å¼x1600ä¸x2000ä¸ä¸€è‡´</p>
</li>
<li><p>ADVDATn(0-3)å¯„å­˜å™¨è¯»å‡ºç»“æœå AUXEN(0-3) å¯„å­˜å™¨è‡ªåŠ¨æ¸…é›¶ï¼ˆä½†æ˜¯å¦‚æœå°†é‡‡æ ·æ¨¡å¼è®¾ç½®ä¸ºé‡å¤é‡‡æ ·æ¨¡å¼åˆ™ä¸ä¼šè‡ªåŠ¨æ¸…é›¶ï¼‰</p>
</li>
<li><p>ADC æœ€ç»ˆè®¡ç®—å¾—åˆ°çš„ç»“æœå¯èƒ½æ˜¯ä¸­é—´ç»“æœï¼Œéœ€è¦å¯¹ç…§åŸç†å›¾çœ‹æ˜¯å¦æœ‰åˆ†å‹ï¼Œè¿›ä¸€æ­¥è®¡ç®—æœ€ç»ˆç»“æœ</p>
</li>
</ul>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://www.ti.com/seclit/eb/slyw038c/slyw038c.pdf">æ¨¡æ‹Ÿå·¥ç¨‹å¸ˆå£è¢‹å‚è€ƒæŒ‡å—</a></li>
<li><a href="https://training.ti.com/ti-precision-labs-adcs">TIé«˜ç²¾åº¦å®éªŒå®¤åŸ¹è®­è§†é¢‘</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
      </categories>
  </entry>
  <entry>
    <title>RTC</title>
    <url>/2023/05/18/computerSystem/Peripherals/RTC/</url>
    <content><![CDATA[<h1 id="æ—¶é’Ÿ"><a href="#æ—¶é’Ÿ" class="headerlink" title="æ—¶é’Ÿ"></a>æ—¶é’Ÿ</h1><p>å¯¹äºä¸€ä¸ªè®¾å¤‡æ¥è®²ï¼Œé€šå¸¸ä¼šæœ‰ä¸¤ä¸ªæ—¶é’Ÿä¸€ä¸ªè¢«ç§°ä¸ºç¡¬ä»¶æ—¶é’Ÿå¦ä¸€ä¸ªè¢«ç§°ä¸ºç³»ç»Ÿæ—¶é’Ÿã€‚</p>
<ul>
<li><p>ç¡¬ä»¶æ—¶é’Ÿ</p>
<p>æŒ‡ä¸»æœºæ¿ä¸Šçš„æ—¶é’Ÿè®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸å¯åœ¨BIOSç”»é¢è®¾å®šçš„æ—¶é’Ÿï¼Œä¹Ÿç§°ä¸º RTCæˆ– BIOS æ—¶é’Ÿã€‚è¿™æ˜¯ç”µæ± ä¾›ç”µçš„æ—¶é’Ÿï¼Œå³ä½¿åœ¨ç³»ç»Ÿå…³é—­æ—¶ä¹Ÿèƒ½ä¿æŒæ—¶é—´ã€‚</p>
</li>
<li><p>ç³»ç»Ÿæ—¶é’Ÿ</p>
<p>ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œæ‰€æœ‰Linuxç›¸å…³æŒ‡ä»¤ä¸å‡½æ•°éƒ½æ˜¯è¯»å–ç³»ç»Ÿæ—¶é’Ÿçš„è®¾å®šï¼ŒåŒ…æ‹¬systickä¹Ÿæ˜¯å±äºç³»ç»Ÿæ—¶é’Ÿã€‚å½“ç³»ç»Ÿå¯åŠ¨çš„ä¸€ç¬é—´ï¼Œç¡¬ä»¶æ—¶é’Ÿè¢«è¯»å–å¹¶ç”¨äºè®¾ç½®ç³»ç»Ÿæ—¶é’Ÿã€‚ä»è¿™ä¸ªæ—¶åˆ»èµ·ï¼Œç³»ç»Ÿæ—¶é’Ÿç”¨äºè·Ÿè¸ªæ—¶é—´ï¼Œè½¯ä»¶æ—¶é’Ÿåœ¨ç¡¬ä»¶ä¸Šæ˜¯ç”±è®¡æ•°å™¨é…åˆå·¥ä½œçš„ã€‚</p>
<p>è€Œç³»ç»Ÿæ—¶é’Ÿé¢‘ç‡æŒ‡cpuäº§ç”Ÿä¸­æ–­ä¾›è½¯ä»¶ç³»ç»Ÿæ‰§è¡Œè°ƒåº¦çš„æ—¶é—´é—´éš”ã€‚ä¸€èˆ¬ä¸€æ¬¡ä¸­æ–­æˆ‘ä»¬å«ä¸€ä¸ªtickã€‚æ¯”å¦‚æˆ‘ä»¬å°†ç³»ç»Ÿæ—¶é’Ÿé¢‘ç‡è®¾ç½®ä¸º100ï¼ˆsysClkRateå‡½æ•°å¯è®¾ç½®ï¼‰ï¼Œå³æ„å‘³ç€1ç§’é’Ÿä¼šäº§ç”Ÿ100æ¬¡ä¸­æ–­ä¾›ç³»ç»Ÿè½¯ä»¶è°ƒåº¦ã€‚</p>
</li>
</ul>
<h1 id="RTCç®€ä»‹"><a href="#RTCç®€ä»‹" class="headerlink" title="RTCç®€ä»‹"></a>RTCç®€ä»‹</h1><p>RTC ï¼šReal Time Clockï¼Œå®æ—¶æ—¶é’Ÿ</p>
<p>å®æ—¶æ—¶é’Ÿæ˜¯ç³»ç»Ÿä½¿ç”¨çš„ä¸€ç§æ—¶é’ŸåŠŸèƒ½ï¼Œå³ä½¿åœ¨ä¸»è®¾å¤‡ï¼ˆä¾‹å¦‚ MCUï¼‰æ–­ç”µæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ç”µæ± æˆ–è€…è¶…çº§ç”µå®¹å™¨ä¸ºRTCæä¾›ç”µèƒ½æµ‹é‡æ—¶é—´ã€‚å½“å¾®æ§åˆ¶å™¨å¤„äºæ·±åº¦ç¡çœ æˆ–ä½åŠŸè€—æ¨¡å¼æ—¶ï¼ŒRTC çš„å†…éƒ¨æ—¶é’Ÿå’Œç”µè·¯å°†ç»§ç»­è¿è¡Œä»¥ä¿æŒå‡†ç¡®çš„è®¡æ—¶å’Œè­¦æŠ¥åŠŸèƒ½ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç”µæµæ¶ˆè€—å°†ä½è‡³ 0.2uAâ€”â€”0.5uA</p>
<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>æ— è®ºæ˜¯å¯¹äºå†…ç½®RTCçš„MCUæˆ–è€…å¤–ç½®RTCèŠ¯ç‰‡æ¥è¯´ï¼Œé€šå¸¸éƒ½ä¼šå…·æœ‰ä»¥ä¸‹å‡ ç§åŠŸèƒ½ï¼š</p>
<ol>
<li>å®šæ—¶å™¨</li>
<li>é€šè¿‡è½¯ä»¶é…ç½®ï¼Œæä¾›æ—¥å†åŠŸèƒ½</li>
<li>wakeupå”¤é†’åŠŸèƒ½ / Alarm é—¹é’ŸåŠŸèƒ½</li>
</ol>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>RTCå®è´¨æ˜¯ä¸€ä¸ªæ‰ç”µåè¿˜ç»§ç»­è¿è¡Œçš„å®šæ—¶å™¨ã€‚</p>
<h2 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h2><p><img src="/images/computerSystem/Peripherals/rtc.png" alt="image"></p>
<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><h3 id="æ—¶é’Ÿæº"><a href="#æ—¶é’Ÿæº" class="headerlink" title="æ—¶é’Ÿæº"></a>æ—¶é’Ÿæº</h3><p>ä»¥STM32æ¥è®²ï¼Œé€šå¸¸ç”±ä¸‰ä¸ªæ—¶é’Ÿæºå¯ä¾›é€‰æ‹©</p>
<ul>
<li>å¤–éƒ¨ä½é€Ÿæ—¶é’ŸLSEï¼Œé¢‘ç‡32.768KHz</li>
<li>å†…éƒ¨ä½é€Ÿæ—¶é’ŸLSI</li>
<li>å¤–éƒ¨é«˜é€Ÿæ—¶é’ŸHSEï¼Œä¸€èˆ¬æ˜¯éœ€è¦é€šè¿‡PLLåˆ†é¢‘å¾—åˆ°RTCæ‰€éœ€æ—¶é’Ÿ</li>
</ul>
<p>å¯¹äºLSIã€HSEæ¥è®²åœ¨ä¸»ç”µæºæ–­ç”µçš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªæ—¶é’Ÿæºéƒ½ä¼šå—åˆ°å½±å“ï¼Œæ‰€ä»¥é€šå¸¸ä½¿ç”¨LSEå¤–éƒ¨æ™¶æŒ¯ã€‚è€Œæ™¶æŒ¯çš„æ—¶é’Ÿé¢‘ç‡ä¸º32768Hzï¼Œè¿™æ˜¯å› ä¸º2^15=32768ï¼Œä¸€ä¸ªåå…­ä½å¯„å­˜å™¨å³å¯è¡¨å¾ï¼ŒåŒæ—¶åˆ†é¢‘å‡º1hzæ—¶é’Ÿ</p>
<h3 id="ä¸­æ–­æº"><a href="#ä¸­æ–­æº" class="headerlink" title="ä¸­æ–­æº"></a>ä¸­æ–­æº</h3><ul>
<li>é—¹é’Ÿä¸­æ–­ï¼Œå½“è®¾ç½®çš„é—¹é’Ÿç­‰äºè®¡æ•°å€¼çš„æ—¶å€™åˆ™äº§ç”Ÿä¸€ä¸ªé—¹é’Ÿä¸­æ–­ã€‚åŒæ—¶å®ƒä¹Ÿå¯ä»¥ä½œä¸ºå”¤é†’ä¼‘çœ çš„è®¾å¤‡åŠŸèƒ½</li>
<li>ç§’ä¸­æ–­ï¼Œæ¯1säº§ç”Ÿä¸€ä¸ªä¸­æ–­</li>
<li>æº¢å‡ºä¸­æ–­ï¼Œè®¡æ•°å™¨æº¢å‡ºå˜æˆ0</li>
</ul>
<h3 id="ç”µæº"><a href="#ç”µæº" class="headerlink" title="ç”µæº"></a>ç”µæº</h3><p>å¯¹äºRTCæœ‰ä¸¤ç§ä¾›ç”µæ–¹å¼ï¼Œä¸»ç”µæºå­˜åœ¨åˆ™ä½¿ç”¨ä¸»ç”µæºã€‚å½“ä¸»ç”µæºæ–­å¼€ï¼Œå¦‚æœç”µæ± æœ‰ç”µåˆ™ç”µæ± ç»§ç»­ä¾›ç”µä¿è¯RTCçš„æ­£å¸¸å·¥ä½œã€‚å¯¹äºæœ‰äº›è®¾å¤‡ä½¿ç”¨çº½æ‰£ç”µæ± åšå¤‡ç”¨ç”µæºï¼Œæ‰€ä»¥è¿™ä¸€å®šæ˜¯ä½åŠŸè€—çš„</p>
<h1 id="linuxä¸‹RTCç›¸å…³å‘½ä»¤"><a href="#linuxä¸‹RTCç›¸å…³å‘½ä»¤" class="headerlink" title="linuxä¸‹RTCç›¸å…³å‘½ä»¤"></a>linuxä¸‹RTCç›¸å…³å‘½ä»¤</h1><p>å½“Linuxå¯åŠ¨æ—¶ï¼Œç³»ç»Ÿæ—¶é’Ÿä¼šå»è¯»å–ç¡¬ä»¶æ—¶é’Ÿçš„è®¾å®šï¼Œä¹‹åç³»ç»Ÿæ—¶é’Ÿå³ç‹¬ç«‹è¿ä½œã€‚ç”¨dateå‘½ä»¤å¯¹ç³»ç»Ÿæ—¶é—´è¿›è¡Œè®¾ç½®åï¼Œå¹¶ä¸ä¼šå»ä¿®æ”¹ç¡¬ä»¶æ—¶é’Ÿï¼Œæ‰€ä»¥ç³»ç»Ÿé‡å¯åï¼Œç³»ç»Ÿæ—¶é—´è¿˜ç®—ä¼šå»è¯»å–ç¡¬ä»¶æ—¶é—´ï¼Œè¿™å°±æ˜¯ä¸ºä½•dateè®¾ç½®å¤±æ•ˆåˆ°åŸå› ã€‚å› æ­¤ï¼Œéœ€è¦åœ¨è®¾ç½®ç³»ç»Ÿæ—¶é—´åï¼Œéœ€è¦å°†ç³»ç»Ÿæ—¶é—´åŒæ­¥åˆ°ç¡¬ä»¶æ—¶é’Ÿã€‚</p>
<h2 id="timedatectl"><a href="#timedatectl" class="headerlink" title="timedatectl"></a>timedatectl</h2><blockquote>
<p>ä½¿ç”¨æ–‡æ¡£ï¼š<a href="https://www.freedesktop.org/software/systemd/man/timedatectl.html">click here</a></p>
</blockquote>
<p>timedatectlå¯ç”¨äºæŸ¥è¯¢å’Œæ›´æ”¹ç³»ç»Ÿæ—¶é’ŸåŠå…¶è®¾ç½®ï¼Œä»¥åŠå¯ç”¨æˆ–ç¦ç”¨æ—¶é—´åŒæ­¥æœåŠ¡</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨æ–¹å¼ï¼štimedatectl  [é€‰é¡¹...]  {å‘½ä»¤}</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">timedatectl									<span class="comment"># æŸ¥çœ‹æ—¶é’Ÿè®¾ç½®</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">timedatectl list-timezones 					<span class="comment"># æ˜¾ç¤ºå¯ç”¨æ—¶åŒºåˆ—è¡¨</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">timedatectl set-timezone Europe/London		<span class="comment"># è®¾ç½®æ—¶åŒº</span></span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="date"><a href="#date" class="headerlink" title="date"></a>date</h2><p>ä½¿ç”¨ date å‘½ä»¤è®¾ç½®ç³»ç»Ÿæ—¶é—´ä¸ä¼šè‡ªåŠ¨åŒæ­¥ RTCï¼Œåªé’ˆå¯¹ç³»ç»Ÿæ—¶é—´</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">date</span> 									<span class="comment">#æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">date</span> <span class="string">"2022-01-20 17:50:30"</span>		    <span class="comment">#è®¾ç½®ç³»ç»Ÿæ—¶é—´</span></span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="hwclock"><a href="#hwclock" class="headerlink" title="hwclock"></a>hwclock</h2><blockquote>
<p>ä½¿ç”¨æ–‡æ¡£ï¼š<a href="https://busybox.net/downloads/BusyBox.html#hwclock">click here</a></p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">hwclock --show								<span class="comment"># æŸ¥çœ‹ç¡¬ä»¶æ—¶é—´</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">hwclock --<span class="built_in">set</span> --<span class="built_in">date</span> <span class="string">'2021-01-13 14:37:23'</span>	<span class="comment"># è®¾ç½®ç¡¬ä»¶æ—¶é—´</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">hwclock -w									<span class="comment"># å°†ç³»ç»Ÿæ—¶é—´åŒæ­¥åˆ°ç¡¬ä»¶æ—¶é—´</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">hwclock -s									<span class="comment"># å°†ç¡¬ä»¶æ—¶é—´åŒæ­¥åˆ°ç³»ç»Ÿæ—¶é—´</span></span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="alarm"><a href="#alarm" class="headerlink" title="alarm"></a>alarm</h2><p>åœ¨ç¡çœ æ¨¡å¼ä¸‹ï¼ŒRTC å¯ç”¨äºç¨åå”¤é†’ç³»ç»Ÿã€‚å¹¶éæ‰€æœ‰ RTC éƒ½æ”¯æŒè¿™ç§å”¤é†’æ¨¡å¼ï¼Œè¯·æ£€æŸ¥ wakealarm æ–‡ä»¶çš„å¯ç”¨æ€§ã€‚</p>
<p>è¦å¯ç”¨ä»ç°åœ¨èµ· 20 ç§’åå”¤é†’ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> +20 &gt; /sys/class/rtc/rtc2/wakealarm</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>Qï¼šè½¯ä»¶è®¾è®¡è¯»å–æ—¶é—´ï¼Ÿ</p>
<p>Aï¼šä¸Šç”µä¹‹åï¼ŒåŒæ—¶è¯»å–ç³»ç»Ÿæ—¶é—´å’Œç¡¬ä»¶æ—¶é—´ï¼Œå¹¶è®¡ç®—å·®å€¼ã€‚åœ¨ä¹‹åçš„ä»»æ„æ—¶åˆ»æƒ³è¦è¯»å–æ—¶é—´å³å¯è¯»å–è½¯ä»¶æ—¶é—´+å·®å€¼å³å¯å¾—åˆ°å®é™…æ—¶é—´ï¼Œè¿™æ ·å‡å°‘äº†é¢‘ç¹è¯»å–RTCçš„æ¬¡æ•°</p>
</li>
<li><p>Qï¼šsocç³»ç»Ÿä¸­ï¼Œrtcä½œä¸ºä¸€ä¸ªé‡è¦å†…ç½®çš„ç”µè·¯å•å…ƒï¼Œå¯¹äºä½åŠŸè€—è®¾è®¡æœ‰é‡è¦çš„æ„ä¹‰ã€‚rtcç”µè·¯æ˜¯å•ç‹¬è®¾è®¡ç”µæºåŸŸã€‚å†…éƒ¨RTCéš¾ç‚¹ï¼Ÿ</p>
<p>Aï¼šCPUé¢ç§¯å°ï¼Œä½†éœ€è¦æœ‰è¯»å†™éš”ç¦»åŒºï¼›é¢ç§¯å°ï¼Œé™ç”µä¸å®¹æ˜“æ¶ˆé™¤ï¼›å ç”¨èŠ¯ç‰‡è¾ƒå¤§é¢ç§¯</p>
</li>
<li><p>RTCä¸å—RESETæ§åˆ¶ï¼Œå¯ç›‘æµ‹Reset</p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://www.st.com/resource/en/reference_manual/DM00031020-.pdf">STM32 Reference manual</a></li>
<li><a href="https://www.st.com/resource/zh/application_note/an3060-applications-guide-for-serial-realtime-clocks-rtcs-stmicroelectronics.pdf">STä¸²è¡Œå®æ—¶æ—¶é’Ÿï¼ˆRTCï¼‰åº”ç”¨æŒ‡å—</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
      </categories>
  </entry>
  <entry>
    <title>OTA</title>
    <url>/2023/07/08/computerSystem/appFunction/ota/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>OTAï¼ˆOver-the-Airï¼‰ç›´è¯‘æ¥è®²å°±æ˜¯ç©ºä¸­ä¸‹è½½ï¼Œæ˜¯æŒ‡é€šè¿‡ç½‘ç»œå°†è®¾å¤‡å›ºä»¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæ— éœ€ç‰©ç†è¿æ¥ã€‚å¯¹äºä¸åŒå‚å®¶çš„ä¸åŒçš„äº§å“æœ‰ç€ä¸åŒçš„OTAå‡çº§ç­–ç•¥ï¼Œä½†æ˜¯åœ¨OTAå‡çº§ä¸­å…³é”®æ­¥éª¤å‡ ä¹éƒ½æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>ç›¸åº”çš„ï¼Œé€šè¿‡æœ‰çº¿æ–¹å¼è¿›è¡Œå‡çº§ï¼Œå«æœ¬åœ°å‡çº§ï¼Œæ¯”å¦‚é€šè¿‡UARTï¼ŒUSBæˆ–è€…SPIé€šä¿¡æ¥å£æ¥å‡çº§è®¾å¤‡å›ºä»¶</p>
<h2 id="éœ€è¦è§£å†³çš„é—®é¢˜"><a href="#éœ€è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="éœ€è¦è§£å†³çš„é—®é¢˜"></a>éœ€è¦è§£å†³çš„é—®é¢˜</h2><ol>
<li>å¦‚ä½•å°†å›ºä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Ÿ</li>
<li>å¦‚ä½•ä¿è¯ä¸‹è½½åˆ°çš„å›ºä»¶æ˜¯æ­£ç¡®ä¸”å®Œæ•´çš„ï¼Ÿ</li>
<li>å¦‚ä½•çƒ§å½•æ–°çš„å›ºä»¶ä¸”è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜å¯ä»¥æ­£å¸¸æ¢å¤ï¼Ÿ</li>
</ol>
<h1 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h1><ol>
<li>æœåŠ¡å™¨ç«¯åˆ¶ä½œå‡çº§åŒ…</li>
<li>è®¾å¤‡ç«¯ä¸‹è½½å‡çº§åŒ…<ul>
<li>å»ºç«‹ä¸æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥</li>
<li>ä»æœåŠ¡å™¨ä¸‹è½½æ–°çš„å›ºä»¶ç‰ˆæœ¬ï¼Œç¡®è®¤æ˜¯å¦éœ€è¦å‡çº§</li>
<li>ä¸‹è½½å‡çº§åŒ…</li>
</ul>
</li>
<li>è®¾å¤‡ç«¯æ£€éªŒå‡çº§åŒ…<ul>
<li>è§£å‹å‡çº§åŒ…</li>
<li>æ ¡éªŒå›ºä»¶ç‰ˆæœ¬çš„å®Œæ•´æ€§ã€å‡†ç¡®æ€§ã€å®‰å…¨æ€§</li>
</ul>
</li>
<li>å‡çº§<ul>
<li>å°†å›ºä»¶å†™å…¥è®¾å¤‡çš„å­˜å‚¨ä»‹è´¨</li>
<li>å‡çº§æˆåŠŸå†™å…¥æ–°çš„ç‰ˆæœ¬å·</li>
</ul>
</li>
<li>è®¾å¤‡é‡å¯</li>
</ol>
<h1 id="OTAå‡çº§ç­–ç•¥"><a href="#OTAå‡çº§ç­–ç•¥" class="headerlink" title="OTAå‡çº§ç­–ç•¥"></a>OTAå‡çº§ç­–ç•¥</h1><h2 id="å›ºä»¶å®Œæ•´æ€§"><a href="#å›ºä»¶å®Œæ•´æ€§" class="headerlink" title="å›ºä»¶å®Œæ•´æ€§"></a>å›ºä»¶å®Œæ•´æ€§</h2><h3 id="å…¨åŒ…å‡çº§"><a href="#å…¨åŒ…å‡çº§" class="headerlink" title="å…¨åŒ…å‡çº§"></a>å…¨åŒ…å‡çº§</h3><p>å…¨åŒ…å‡çº§ï¼ˆFull Updateï¼‰ï¼šå…¨åŒ…å‡çº§æ˜¯æŒ‡å°†å®Œæ•´çš„å›ºä»¶åŒ…å‘é€ç»™è®¾å¤‡è¿›è¡Œå‡çº§ã€‚è¿™æ„å‘³ç€è®¾å¤‡éœ€è¦ä¸‹è½½æ•´ä¸ªå›ºä»¶åŒ…å¹¶è¿›è¡Œå®Œå…¨çš„æ›¿æ¢ï¼Œæ— è®ºè®¾å¤‡å½“å‰è¿è¡Œçš„æ˜¯å“ªä¸ªç‰ˆæœ¬ã€‚å…¨åŒ…å‡çº§é€‚ç”¨äºè¾ƒå°çš„å›ºä»¶æ›´æ–°æˆ–åœ¨è®¾å¤‡ä¸Šè¿›è¡Œäº†è¾ƒå¤§çš„æ”¹åŠ¨ã€‚</p>
<h3 id="å·®åˆ†å‡çº§"><a href="#å·®åˆ†å‡çº§" class="headerlink" title="å·®åˆ†å‡çº§"></a>å·®åˆ†å‡çº§</h3><p>å·®åˆ†å‡çº§ï¼ˆDifferential Updateï¼‰ï¼šå·®åˆ†å‡çº§æ˜¯æŒ‡åªå‘é€å˜æ›´éƒ¨åˆ†çš„å›ºä»¶åŒ…ç»™è®¾å¤‡è¿›è¡Œå‡çº§ã€‚è¿™æ ·ï¼Œè®¾å¤‡åªéœ€è¦ä¸‹è½½å’Œåº”ç”¨å›ºä»¶çš„å˜åŒ–éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå›ºä»¶åŒ…ã€‚å·®åˆ†å‡çº§é€‚ç”¨äºè¾ƒå¤§çš„å›ºä»¶æ›´æ–°ï¼Œå°¤å…¶æ˜¯å½“è®¾å¤‡å·²ç»å¤„äºè¾ƒæ–°çš„ç‰ˆæœ¬ä¸Šæ—¶ã€‚</p>
<p>è¿™ç§æ–¹å¼å¯ä»¥å¤§å¤§å‡å°‘å‡çº§æ‰€éœ€çš„æ—¶é—´å’Œæ•°æ®é‡ï¼Œæé«˜å‡çº§çš„æ•ˆç‡ã€‚ä½†æ˜¯ï¼Œå·®åˆ†å‡çº§å¯èƒ½éœ€è¦é¢å¤–çš„è®¡ç®—èµ„æºæ¥å¤„ç†å›ºä»¶çš„åˆå¹¶å’Œåº”ç”¨ï¼Œå› ä¸ºè®¾å¤‡éœ€è¦å°†å˜æ›´éƒ¨åˆ†ä¸å½“å‰çš„å›ºä»¶è¿›è¡Œåˆå¹¶ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå‡ºç°ä¸å…¼å®¹çš„æƒ…å†µã€‚</p>
<h2 id="å›ºä»¶è¦†ç›–æ¨¡å¼"><a href="#å›ºä»¶è¦†ç›–æ¨¡å¼" class="headerlink" title="å›ºä»¶è¦†ç›–æ¨¡å¼"></a>å›ºä»¶è¦†ç›–æ¨¡å¼</h2><h3 id="å•åŒºæ¨¡å¼"><a href="#å•åŒºæ¨¡å¼" class="headerlink" title="å•åŒºæ¨¡å¼"></a>å•åŒºæ¨¡å¼</h3><p>åœ¨å•åŒºè¦†ç›–æ¨¡å¼ä¸‹ï¼Œè®¾å¤‡å›ºä»¶çš„å­˜å‚¨ç©ºé—´è¢«åˆ†æˆä¸€ä¸ªå•ä¸€çš„åŒºåŸŸã€‚å½“è¿›è¡ŒOTAå›ºä»¶å‡çº§æ—¶ï¼Œæ–°çš„å›ºä»¶åŒ…ä¼šå®Œå…¨æ›¿æ¢åŸæœ‰çš„å›ºä»¶ï¼Œè¦†ç›–åœ¨åŒä¸€ä¸ªå­˜å‚¨åŒºåŸŸä¸Šã€‚è¿™æ„å‘³ç€åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œè®¾å¤‡çš„å›ºä»¶ä¼šè¢«æ“¦é™¤å¹¶ç”¨æ–°çš„å›ºä»¶æ›¿ä»£ã€‚ä½†æ˜¯ç”±äºç¨‹åºæ‰§è¡Œçš„ä»£ç å·²ç»ä»flashæ‹·è´åˆ°ramä¸­è¿›è¡Œæ‰§è¡Œäº†ï¼Œæ‰€ä»¥OTAçš„æµç¨‹è¿˜æ˜¯å¯ä»¥è¿›è¡Œå®Œæˆçš„ï¼Œå½“æ–°çš„å›ºä»¶è¦†å†™åˆ°æ—§å›ºä»¶çš„å­˜å‚¨åŒºåŸŸå®Œæˆé‡å¯è®¾å¤‡å³å¯è¿›å…¥æ–°ç‰ˆæœ¬</p>
<p>å•åŒºè¦†ç›–æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œå›ºä»¶æ›´æ–°ç›¸å¯¹ç›´æ¥ï¼Œä½†ç¼ºç‚¹æ˜¯å¦‚æœå‡çº§å¤±è´¥ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œå®Œå…¨çš„å›ºä»¶æ¢å¤ï¼Œè€Œä¸”å‡çº§è¿‡ç¨‹ä¸­æ— æ³•å›æ»šåˆ°åŸæœ‰å›ºä»¶ç‰ˆæœ¬ï¼Œç”šè‡³æœ€åå˜æˆâ€œæ¿ç –â€</p>
<h3 id="åŒåŒºæ¨¡å¼"><a href="#åŒåŒºæ¨¡å¼" class="headerlink" title="åŒåŒºæ¨¡å¼"></a>åŒåŒºæ¨¡å¼</h3><p>åœ¨åŒåŒºè¦†ç›–æ¨¡å¼ä¸‹ï¼Œè®¾å¤‡å›ºä»¶çš„å­˜å‚¨ç©ºé—´è¢«åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„åŒºåŸŸï¼Œå‡è®¾ç§°ä¸ºâ€AåŒºâ€å’Œâ€BåŒºâ€ã€‚è®¾å¤‡å½“å‰è¿è¡Œçš„å›ºä»¶ç‰ˆæœ¬å­˜å‚¨åœ¨å…¶ä¸­ä¸€ä¸ªåŒºåŸŸï¼ˆä¾‹å¦‚AåŒºï¼‰ï¼Œè€Œè¿›è¡ŒOTAå›ºä»¶å‡çº§æ—¶ï¼Œæ–°çš„å›ºä»¶åŒ…å°†è¢«ä¸‹è½½å¹¶å†™å…¥å¦ä¸€ä¸ªåŒºåŸŸï¼ˆä¾‹å¦‚BåŒºï¼‰ã€‚</p>
<p>åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œè®¾å¤‡å°†ä¿æŒè¿è¡Œåœ¨å½“å‰å›ºä»¶ç‰ˆæœ¬æ‰€åœ¨çš„åŒºåŸŸï¼ˆä¾‹å¦‚AåŒºï¼‰ï¼Œè€Œæ–°çš„å›ºä»¶è¢«ä¸‹è½½åˆ°å¦ä¸€ä¸ªåŒºåŸŸï¼ˆä¾‹å¦‚BåŒºï¼‰ã€‚ä¸‹è½½å®Œæˆåï¼Œè®¾å¤‡ä¼šè¿›è¡Œå›ºä»¶åˆ‡æ¢ï¼Œå°†è¿è¡Œç¯å¢ƒä»å½“å‰åŒºåŸŸåˆ‡æ¢åˆ°æ–°çš„å›ºä»¶æ‰€åœ¨çš„åŒºåŸŸã€‚è¿™æ ·ï¼Œå¦‚æœå‡çº§å¤±è´¥ï¼Œè®¾å¤‡å¯ä»¥å›æ»šåˆ°åŸæœ‰çš„å›ºä»¶ç‰ˆæœ¬ï¼Œé€šè¿‡åˆ‡æ¢å›ä¹‹å‰çš„åŒºåŸŸã€‚</p>
<p>åŒåŒºè¦†ç›–æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯åœ¨å‡çº§è¿‡ç¨‹ä¸­æä¾›äº†å†—ä½™å’Œå›æ»šçš„èƒ½åŠ›ï¼Œå‡å°‘äº†å‡çº§å¤±è´¥çš„é£é™©ã€‚ç„¶è€Œï¼Œç›¸å¯¹äºå•åŒºè¦†ç›–æ¨¡å¼ï¼ŒåŒåŒºè¦†ç›–æ¨¡å¼éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´æ¥ç»´æŠ¤ä¸¤ä¸ªå›ºä»¶åŒºåŸŸã€‚</p>
<h1 id="å…¶å®ƒç­–ç•¥"><a href="#å…¶å®ƒç­–ç•¥" class="headerlink" title="å…¶å®ƒç­–ç•¥"></a>å…¶å®ƒç­–ç•¥</h1><h2 id="è§£å‹ç­–ç•¥"><a href="#è§£å‹ç­–ç•¥" class="headerlink" title="è§£å‹ç­–ç•¥"></a>è§£å‹ç­–ç•¥</h2><p>åœ¨å·¥ä½œçš„ä¸€ä¸ªé¡¹ç›®ä¸­ï¼ˆfreertosç³»ç»Ÿã€8M nor flashï¼‰ï¼Œç”±äºflashå­˜å‚¨ç©ºé—´æœ‰é™ï¼Œä¸èƒ½å°†å‡çº§åŒ…ä¸‹è½½è§£å‹åˆ°flashæ–‡ä»¶ç³»ç»Ÿä¸Šã€‚</p>
<p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨<code>è¾¹è§£å‹å˜å‡çº§</code>çš„æ–¹å¼ï¼Œä½¿ç”¨minizipã€zlibç­‰å¼€æºåº“çš„APIå°†å‡çº§åŒ…çš„zipåŒ…è§£å‹åˆ°RAMå½“ä¸­ï¼Œæ— è®ºæ˜¯ä½¿ç”¨å †ç©ºé—´è¿˜æ˜¯æ ˆç©ºé—´éƒ½æ˜¯å¯ä»¥çš„ï¼ŒæŒ‰ç…§å›ºå®šå¤§å°è§£å‹åˆ°bufferï¼Œå°†bufferå†…å®¹å‡çº§æˆ–è€…æ˜¯çƒ§å½•è¿›flashå³å¯ã€‚</p>
<p>è¿™æ ·åšçš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼šèŠ‚çœflashç©ºé—´ã€å‡å°‘äº†ä¸€æ¬¡æ•°æ®çš„å†™flashå’Œè¯»flashï¼Œç†è®ºä¸ŠæŒ‰ç…§åŒæ ·å¤§å°çš„å—çƒ§å½•ï¼Œé€Ÿåº¦æ›´å¿«</p>
<h2 id="å®Œæ•´æ€§ç­–ç•¥"><a href="#å®Œæ•´æ€§ç­–ç•¥" class="headerlink" title="å®Œæ•´æ€§ç­–ç•¥"></a>å®Œæ•´æ€§ç­–ç•¥</h2><p>å®Œæ•´æ€§æŒ‡çš„æ˜¯ï¼šæˆ‘ä»¬ä¸‹è½½downloadä¸‹æ¥çš„æ•°æ®åŒ…ä¸ç½‘ç»œæœåŠ¡å™¨ç«¯çš„æ•°æ®åŒ…æ˜¯ä¸€è‡´çš„</p>
<p>è¿™ä¸ªç›¸å¯¹ç®€å•ï¼Œæˆ‘ä»¬å¯¹å‡çº§åŒ…åšhashæˆ–è€…md5å€¼ï¼Œå°†è¿™ä¸ªå€¼å†™å…¥æ–‡ä»¶æ”¾åˆ°æœåŠ¡å™¨ä¸Šã€‚å½“æˆ‘ä»¬ä¸‹è½½å‹ç¼©åŒ…çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªhash/md5ä¸€èµ·ä¸‹è½½ï¼Œåœ¨æœ¬åœ°å¯¹å‹ç¼©åŒ…åšhash/md5ï¼Œå†ä¸ä¸‹è½½ä¸‹æ¥çš„å€¼æ¯”è¾ƒã€‚è¿™æ ·å¯¹äºæ•°æ®åŒ…æ˜¯å¦æ­£ç¡®æ˜¯å¦å®Œæ•´æˆ‘ä»¬å°±æœ‰äº†å‡†ç¡®çš„åˆ¤æ–­ä¾æ®ã€‚</p>
<h2 id="åˆæ³•æ€§ç­–ç•¥"><a href="#åˆæ³•æ€§ç­–ç•¥" class="headerlink" title="åˆæ³•æ€§ç­–ç•¥"></a>åˆæ³•æ€§ç­–ç•¥</h2><p>åˆæ³•æ€§ç­–ç•¥æŒ‡çš„æ˜¯ï¼šå¯¹äºæœåŠ¡å™¨æ¥è®²ï¼Œå®ƒæ‰€å­˜æ”¾çš„å‡çº§åŒ…ä¸èƒ½ç»™è§„å®šäº§å“ä»¥å¤–çš„è®¾å¤‡æ¥è·å–åˆ°å‹ç¼©åŒ…ï¼Œæˆ–è€…è¯´å³ä½¿å®¢æˆ·ç«¯ä¸‹è½½ä¸‹æ¥äº†ä¹Ÿä¸èƒ½æ­£å¸¸è§£å‹å‹ç¼©åŒ…æ‹¿åˆ°æ•°æ®ã€‚</p>
<p>å·¥ä½œä¸­æˆ‘æ‰€æ¶‰åŠçš„åŠ å¯†çš„æ–¹æ³•æ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†RSAç®—æ³•ï¼Œè¿™é‡Œå¯èƒ½æ¶‰åŠåˆ°å¯†ç å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œåé¢æˆ‘ä¹Ÿéœ€è¦å†è¿›ä¸€æ­¥å­¦ä¹ æ•´ç†å‡ºä¸“é—¨çš„æ–‡ç« æ¥åšè§£é‡Šã€‚åœ¨OTAçš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥æ¦‚æ‹¬æˆå¦‚ä¸‹ä¸€äº›æ­¥éª¤ï¼š</p>
<ul>
<li>ç”ŸæˆRSAå¯†é’¥å¯¹ï¼ˆå…¬é’¥+ç§é’¥ï¼‰</li>
<li>å°†å…¬é’¥æä¾›ç»™è®¾å¤‡ç«¯ã€‚å¯ä»¥å°†å…¬é’¥ä½œä¸ºå›ºä»¶çš„ä¸€éƒ¨åˆ†æˆ–å•ç‹¬æä¾›ç»™è®¾å¤‡ã€‚</li>
<li>å°†ç§é’¥æä¾›ç»™æœåŠ¡ç«¯ã€‚åœ¨OTAæœåŠ¡å™¨ç«¯ï¼Œä½¿ç”¨ç§é’¥å¯¹å›ºä»¶æ–‡ä»¶è¿›è¡Œæ•°å­—ç­¾åã€‚</li>
<li>OTAä¸‹è½½æµç¨‹ã€‚å°†å›ºä»¶é€šè¿‡HTTP/HTTPç­‰åè®®ä¼ è¾“åˆ°è®¾å¤‡ç«¯ã€‚</li>
<li>è®¾å¤‡ç«¯éªŒç­¾ã€‚OTAè®¾å¤‡æ¥æ”¶åˆ°åŠ å¯†çš„å›ºä»¶åï¼Œä½¿ç”¨åµŒå…¥åœ¨è®¾å¤‡ä¸­çš„å…¬é’¥å¯¹å›ºä»¶è¿›è¡Œè§£å¯†å’ŒéªŒè¯ã€‚</li>
<li>éªŒè¯æˆåŠŸè¿›å…¥å›ºä»¶å‡çº§æµç¨‹</li>
</ul>
<h1 id="ä¼ªç "><a href="#ä¼ªç " class="headerlink" title="ä¼ªç "></a>ä¼ªç </h1><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">download_firmware</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">verify_firmware</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">write_firmware</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">update_firmware_version</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">restart_device</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">  <span class="keyword">if</span>(download_firmware() &amp;&amp;</span><br><span class="line">     verify_firmware() &amp;&amp;</span><br><span class="line">     write_firmware() &amp;&amp;</span><br><span class="line">     update_firmware_version()) {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"OTA upgrade succeeded.\n"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"OTA upgrade failed.\n"</span>);</span><br><span class="line">  }</span><br><span class="line">    reboot();		<span class="comment">// è®¾å¤‡é‡å¯</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">download_firmware</span><span class="params">()</span> {</span><br><span class="line">	<span class="comment">// ä»æœåŠ¡å™¨ç«¯ä¸‹è½½å›ºä»¶</span></span><br><span class="line">    <span class="comment">// å·¥å…·ï¼šwgetã€curl</span></span><br><span class="line">    <span class="comment">// åœ¨lwipå·¥ç¨‹ä¸­æä¾›äº†ä»£ç http_client_download_to_diskæ¥å£æ¥ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">verify_firmware</span><span class="params">()</span> {</span><br><span class="line">  <span class="comment">// æ ¡éªŒå›ºä»¶ï¼ˆå®Œæ•´æ€§ã€å®‰å…¨æ€§ã€å‡†ç¡®æ€§ï¼‰</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">write_firmware</span><span class="params">()</span> {</span><br><span class="line">  <span class="comment">// å°†å›ºä»¶å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨å™¨å½“ä¸­ï¼ˆwrite to flashï¼‰</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">update_firmware_version</span><span class="params">()</span> {</span><br><span class="line">  <span class="comment">// å°†ç³»ç»Ÿçš„ç‰ˆæœ¬å·è¿›è¡Œæ›´æ–°</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://blog.csdn.net/usstmiracle/article/details/123200234">OTAå®ç°åŸç†</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Function</category>
      </categories>
      <tags>
        <tag>OTA</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠŸè€—ç®¡ç†</title>
    <url>/2023/07/19/computerSystem/appFunction/%E5%8A%9F%E8%80%97%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h1 id="åŠŸè€—ç®¡ç†"><a href="#åŠŸè€—ç®¡ç†" class="headerlink" title="åŠŸè€—ç®¡ç†"></a>åŠŸè€—ç®¡ç†</h1><ul>
<li>ç³»ç»Ÿæ—¶é’Ÿï¼ˆç³»ç»Ÿæ—¶é’Ÿã€å¤–è®¾æ—¶é’Ÿï¼‰</li>
<li>ç”µæºæ¨¡å¼ï¼ˆIDLEã€DEEPã€LIGHTã€STANDBYï¼‰</li>
<li>å¼•è„šå¤„ç†ï¼ˆæ™®é€šå¼•è„šã€æ€»çº¿å¼•è„šã€ä¸­æ–­å¼•è„šï¼‰</li>
<li>å®šæ—¶å™¨ï¼ˆç³»ç»Ÿå®šæ—¶å™¨ã€è½¯ä»¶å®šæ—¶å™¨ã€ä½åŠŸè€—å®šæ—¶å™¨ï¼‰</li>
<li>ç”µæ± ï¼ˆå……ç”µã€æ”¾ç”µæ›²çº¿ï¼‰</li>
<li>ç”µé‡ï¼ˆåº“ä»‘è®¡ã€ç”µæ± ç”µå‹ä¼°ç®—ï¼‰</li>
<li>PMæ¡†æ¶ï¼ˆç¡çœ ç®¡ç†ã€å˜é¢‘ç®¡ç†ï¼‰</li>
</ul>
<h1 id="ä¼‘çœ å”¤é†’æµç¨‹"><a href="#ä¼‘çœ å”¤é†’æµç¨‹" class="headerlink" title="ä¼‘çœ å”¤é†’æµç¨‹"></a>ä¼‘çœ å”¤é†’æµç¨‹</h1><ul>
<li><p>ä¼‘çœ å‡†å¤‡</p>
<ol>
<li>æ­£å¸¸é€€å‡ºåº”ç”¨ç¨‹åºå¹¶ä¿å­˜æ•°æ®ã€‚å°†æ­¤æ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€åŠæ•°æ®è¿›è¡Œä¿å­˜ï¼›</li>
<li>å…³é—­å¤–è®¾ã€GPIOåŠæ—¶é’Ÿç­‰ã€‚è¿™é‡Œæ˜¯å¯¹ç³»ç»ŸåŠŸè€—åšä¼˜åŒ–çš„æ ¸å¿ƒéƒ¨åˆ†ï¼›</li>
<li>é…ç½®å”¤é†’æºã€‚å°†æˆ‘ä»¬æ‰€å…³å¿ƒçš„äº‹ä»¶ä½œä¸ºå”¤é†’æº</li>
</ol>
</li>
<li><p>è¿›å…¥ä¼‘çœ </p>
<p>é€šè¿‡æ‰§è¡Œè½¯ä»¶å‘½ä»¤ï¼Œè¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚</p>
</li>
<li><p>ç­‰å¾…å”¤é†’</p>
<p>åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œä¸»å¤„ç†å™¨å’Œå¤§éƒ¨åˆ†ç³»ç»Ÿæ¨¡å—ä¼šåœæ­¢è¿è¡Œã€‚å½“ç³»ç»Ÿæ£€æµ‹åˆ°å”¤é†’æ—¶é—´å‘ç”Ÿï¼Œæ¯”å¦‚è§¦å±äº‹ä»¶ã€æŒ‰é”®äº‹ä»¶ã€å®šæ—¶å™¨äº‹ä»¶ç­‰ç­‰ï¼Œç³»ç»Ÿå°†è¿›å…¥å”¤é†’æµç¨‹ã€‚ï¼ˆå”¤é†’äº‹ä»¶ä¸€å®šæ˜¯è¦åœ¨ä¼‘çœ å‰è¿›è¡Œé…ç½®çš„ï¼‰</p>
</li>
<li><p>å”¤é†’æ¢å¤</p>
<p>æ¢å¤ä¿å­˜çš„çŠ¶æ€å’Œæ•°æ®ï¼Œé‡æ–°å¯åŠ¨å¿…è¦çš„å¤–è®¾å’Œæ—¶é’Ÿï¼Œå¹¶ä½¿ç³»ç»Ÿå›åˆ°æ­£å¸¸å·¥ä½œçŠ¶æ€ã€‚</p>
</li>
</ul>
<h1 id="ä¼‘çœ å”¤é†’åŸåˆ™"><a href="#ä¼‘çœ å”¤é†’åŸåˆ™" class="headerlink" title="ä¼‘çœ å”¤é†’åŸåˆ™"></a>ä¼‘çœ å”¤é†’åŸåˆ™</h1><h2 id="æ—¶é’Ÿ"><a href="#æ—¶é’Ÿ" class="headerlink" title="æ—¶é’Ÿ"></a>æ—¶é’Ÿ</h2><p>ä¼‘çœ ï¼š</p>
<ul>
<li>æ—¶é’ŸçŠ¶æ€ä¿å­˜ï¼šä¿å­˜å…³é”®çš„æ—¶é’ŸçŠ¶æ€å’Œå¯„å­˜å™¨ä¿¡æ¯ã€‚åŒ…æ‹¬å¤„ç†å™¨æ—¶é’Ÿé¢‘ç‡ã€å¤–è®¾æ—¶é’Ÿé…ç½®ã€ä¸­æ–­æ§åˆ¶å™¨çŠ¶æ€ç­‰ã€‚</li>
<li>ç¦ç”¨æ—¶é’Ÿæºï¼šä¾‹å¦‚å¤„ç†å™¨ä¸»æ—¶é’Ÿã€å¤–è®¾æ—¶é’Ÿç­‰ã€‚ç¦ç”¨è¿™äº›æ—¶é’Ÿæºæœ‰åŠ©äºé™ä½ç³»ç»ŸåŠŸè€—å¹¶å‡å°‘ç”µæµæ¶ˆè€—ã€‚</li>
<li>RTCå®šæ—¶å™¨ã€‚é€šå¸¸RTCæ˜¯æœ‰ç‹¬ç«‹ç”µæºåŸŸçš„ï¼ŒRTCå°†ä»¥ä½åŠŸè€—æ¨¡å¼ä¾›ç”µ</li>
</ul>
<p>å”¤é†’</p>
<ul>
<li>æ¢å¤æ—¶é’Ÿæºï¼šå°†ç¦ç”¨çš„æ—¶é’Ÿæºå°†è¢«é‡æ–°å¯ç”¨ï¼Œå¤„ç†å™¨ä¸»æ—¶é’Ÿå’Œå¤–è®¾æ—¶é’Ÿä¼šé‡æ–°é…ç½®ã€‚</li>
<li>æ—¶é’ŸçŠ¶æ€æ¢å¤ï¼šåŒ…æ‹¬å¤„ç†å™¨æ—¶é’Ÿé¢‘ç‡ã€å¤–è®¾æ—¶é’Ÿé…ç½®ã€ä¸­æ–­æ§åˆ¶å™¨çŠ¶æ€ç­‰ã€‚</li>
<li>æ—¶é’Ÿç³»ç»Ÿç¨³å®šï¼šåœ¨å”¤é†’åï¼Œç³»ç»Ÿä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ä»¥ç¡®ä¿æ—¶é’Ÿç³»ç»Ÿç¨³å®šï¼ˆå¯¹åº”æ—¶é’Ÿæ§åˆ¶å™¨çš„stableæ ‡å¿—ä½ç½®ä½å³å¯ï¼‰ã€‚</li>
</ul>
<h2 id="CPU-Core"><a href="#CPU-Core" class="headerlink" title="CPU Core"></a>CPU Core</h2><p>ä¸åŒçš„å¤„ç†å™¨æ¶æ„å’Œç¡¬ä»¶è®¾è®¡å¯èƒ½ä¼šæœ‰ä¸åŒçš„æ‰ç”µçº§åˆ«å’ŒåŠŸè€—ç®¡ç†ç­–ç•¥ï¼Œåœ¨ç‰¹å®šçš„åº”ç”¨ä¸­ï¼Œéœ€è¦æŸ¥é˜…ç›¸å…³çš„å¤„ç†å™¨æ‰‹å†Œã€ç¡¬ä»¶è§„æ ¼å’Œæ“ä½œç³»ç»Ÿæ–‡æ¡£ï¼Œä»¥äº†è§£è¯¦ç»†çš„æ‰ç”µè¡Œä¸ºå’Œé…ç½®æ–¹æ³•ã€‚</p>
<p>å¯¹äºè¾ƒé«˜çº§åˆ«çš„å¤„ç†å™¨å°†å­˜åœ¨ä»¥ä¸‹çº§åˆ«çš„çŠ¶æ€ï¼šNormalã€Idleã€Sleepã€Stand Byã€Power Downï¼Œåœ¨ä¸åŒçš„ç­‰çº§ä¸‹å°†æ‰§è¡Œä¸åŒç­‰çº§çš„ä¼‘çœ æ“ä½œã€‚åœ¨è¯¥ç« èŠ‚ä¸‹ï¼Œå¯¹äºcpu coreæœ€å¤§èŠ‚çœåŠŸè€—çš„ç‚¹åœ¨äº<code>æ‰ç”µ</code>ã€‚Suspend-to-RAMï¼Œç³»ç»Ÿçš„çŠ¶æ€ä¼šä¿å­˜åˆ°å†…å­˜ä¸­ï¼ŒCPUæ ¸å¿ƒå°†è¢«ç¦ç”¨å¹¶è¿›å…¥ä½åŠŸè€—çŠ¶æ€ï¼Œå½“ç³»ç»Ÿå”¤é†’æ—¶ï¼ŒCPUæ ¸å¿ƒé‡æ–°ä¸Šç”µå¹¶æ¢å¤æ­£å¸¸è¿è¡Œã€‚</p>
<h2 id="GPIO"><a href="#GPIO" class="headerlink" title="GPIO"></a>GPIO</h2><p>ä¼‘çœ ï¼š</p>
<ul>
<li><p>å°½é‡å¯¹æ‰€æœ‰pinéƒ½è¿›è¡Œè®¾ç½®</p>
</li>
<li><p>GPIOå†…éƒ¨PULLçŠ¶æ€ä¸å¤–éƒ¨PULLçŠ¶æ€ä¸€è‡´çš„ç®¡è„šï¼šè¾“å…¥PULLçŠ¶æ€ï¼ˆGPIO_INPUT | GPIO_PULL_UP/DOWNï¼‰</p>
<p>ä¾‹å¦‚ï¼šIOå†…éƒ¨åªæœ‰ä¸Šæ‹‰ç”µé˜»ï¼ŒæŸ¥çœ‹åŸç†å›¾å¤–è®¾å¯¹åº”ç®¡è„šä¸Šæ‹‰ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸ºè¾“å…¥ä¸Šæ‹‰</p>
<p>æˆ–è€…å¯ä»¥éµå¾ªå¦ä¸€ç§åŸåˆ™ï¼š</p>
<ul>
<li>å¦‚æœè¯¥IOå£å¸¦ä¸Šæ‹‰ï¼Œè¯·è®¾ç½®ä¸ºé«˜ç”µå¹³è¾“å‡ºæˆ–è€…é«˜é˜»æ€è¾“å…¥ï¼ˆGPIO_OUTPUT_HIGH| GPIO_PULL_HIZï¼‰</li>
<li>å¦‚æœè¯¥IOå£å¸¦ä¸‹æ‹‰ï¼Œè¯·è®¾ç½®ä¸ºä½ç”µå¹³è¾“å‡ºæˆ–è€…é«˜é˜»æ€è¾“å…¥ï¼ˆGPIO_OUTPUT_LOW | GPIO_PULL_HIZï¼‰</li>
</ul>
</li>
<li><p>å¤–éƒ¨æ¥ä¸Šä¸‹æ‹‰ç”µé˜»æˆ–æ¥ç”µæºæ¥åœ°ï¼Œå¹¶ä¸”ä¸å†…éƒ¨ä¸Šä¸‹æ‹‰çŠ¶æ€ä¸ä¸€è‡´çš„ç®¡è„šï¼šè¾“å…¥NO PULLçŠ¶æ€ï¼ˆGPIO_INPUT | GPIO_PULL_HIZï¼‰</p>
<p>å…·ä½“éœ€è¦æ ¹æ®è®¾å¤‡çš„åŸç†å›¾æ¥åˆ¤æ–­</p>
</li>
<li><p>æ‚¬ç©ºç®¡è„šï¼šè¾“å‡ºä½ç”µå¹³å¹¶ä¸” NO PULL çŠ¶æ€ï¼ˆGPIO_OUTPUT_LOW | GPIO_PULL_HIZï¼‰</p>
</li>
<li><p>ä¸­æ–­å¼•è„šé™¤å”¤é†’ä¸­æ–­æºä¿ç•™å¤–å…¶ä»–éœ€è¦å¤±èƒ½ï¼ˆå…³ä¸­æ–­ï¼‰</p>
</li>
</ul>
<p>å”¤é†’ï¼š</p>
<ul>
<li>æ™®é€šå¼•è„šï¼šæ­£å¸¸è¾“å…¥è¾“å‡ºçŠ¶æ€ï¼Œæ®æƒ…å†µåˆ¤æ–­</li>
<li>æ€»çº¿å¼•è„šï¼šå¯ä»¥åœ¨ä¼‘çœ å‰é€šè¿‡ç›¸å…³å‡½æ•°è®°å½•çŠ¶æ€ï¼Œå”¤é†’æ—¶æ¢å¤å³å¯ï¼ˆè¯¥éƒ¨åˆ†åŸºæœ¬æ˜¯é…ç½®ä¸ºFUNCåŠŸèƒ½ï¼‰</li>
<li>ä¸­æ–­å¼•è„šï¼šä½¿èƒ½ä¸­æ–­</li>
</ul>
<h2 id="å¤–è®¾"><a href="#å¤–è®¾" class="headerlink" title="å¤–è®¾"></a>å¤–è®¾</h2><p>å¤–è®¾çš„ä¼‘çœ å”¤é†’å–å†³äºå…·ä½“çš„äº§å“ã€‚ä½†æ˜¯ä¸€èˆ¬å­˜åœ¨äºåµŒå…¥å¼è®¾å¤‡äº§å“çš„å¤–è®¾åŒ…æ‹¬ï¼šLCDã€Cameraã€WIFIã€BTã€CODECæˆ–å…¶å®ƒä¼ æ„Ÿå™¨ã€‚é€šå¸¸å¤–è®¾æ—¶é’Ÿå…³é—­ã€æ‰ç”µå¤–è®¾å°†ä¸ä¼šå·¥ä½œï¼ŒåŠŸè€—ä¹Ÿéšä¹‹é™ä½</p>
<h1 id="åŠŸè€—æµ‹é‡"><a href="#åŠŸè€—æµ‹é‡" class="headerlink" title="åŠŸè€—æµ‹é‡"></a>åŠŸè€—æµ‹é‡</h1><h2 id="æµ‹é‡æ¡ä»¶"><a href="#æµ‹é‡æ¡ä»¶" class="headerlink" title="æµ‹é‡æ¡ä»¶"></a>æµ‹é‡æ¡ä»¶</h2><p>å¯¹åŠŸè€—è¿›è¡Œæµ‹é‡çš„æ—¶å€™ï¼Œéœ€è¦å°†usbæ–­å¼€ï¼Œä½¿ç”¨ç”µæ± ä¾›ç”µ</p>
<h2 id="æµ‹é‡æŒ‡æ ‡"><a href="#æµ‹é‡æŒ‡æ ‡" class="headerlink" title="æµ‹é‡æŒ‡æ ‡"></a>æµ‹é‡æŒ‡æ ‡</h2><p>åŠŸè€—æµ‹é‡çš„æ—¶å€™éœ€è¦å¯¹ç³»ç»Ÿåœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæµ‹é‡ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ol>
<li>é™æ€åŠŸè€—ï¼šæŒ‡è®¾å¤‡å¤„äºç©ºé—²æˆ–ä½è´Ÿè½½çŠ¶æ€æ—¶çš„åŠŸè€—ã€‚å®ƒæ˜¯è®¾å¤‡åœ¨æ²¡æœ‰è¿›è¡Œä»»ä½•æ“ä½œæˆ–æ‰§è¡Œä»»åŠ¡æ—¶çš„æœ€å°åŠŸè€—æ°´å¹³ã€‚</li>
<li>åŠ¨æ€åŠŸè€—ï¼šæŒ‡è®¾å¤‡åœ¨æ‰§è¡Œå„ç§ä»»åŠ¡å’Œå·¥ä½œè´Ÿè½½æ—¶çš„åŠŸè€—ã€‚å®ƒå–å†³äºè®¾å¤‡çš„å·¥ä½œè´Ÿè½½ã€å¤„ç†å™¨ä½¿ç”¨ç‡ã€å¤–è®¾æ´»åŠ¨ç­‰ã€‚</li>
<li>ä¼‘çœ åŠŸè€—ï¼šæŒ‡è®¾å¤‡è¿›å…¥ä¼‘çœ æ¨¡å¼æ—¶çš„åŠŸè€—ã€‚</li>
<li>å”¤é†’åŠŸè€—ï¼šæŒ‡è®¾å¤‡ä»ä¼‘çœ çŠ¶æ€å”¤é†’æ—¶çš„åŠŸè€—ã€‚å”¤é†’æ—¶å¯èƒ½ä¼šæœ‰ä¸€äº›é¢å¤–çš„åŠŸè€—ï¼Œä¾‹å¦‚é‡æ–°å¯åŠ¨CPUæ ¸å¿ƒã€æ¢å¤å¤–è®¾ç­‰ã€‚</li>
<li>å³°å€¼åŠŸè€—ï¼šæŒ‡è®¾å¤‡åœ¨æ‰§è¡Œé«˜è´Ÿè½½æˆ–ç‰¹å®šä»»åŠ¡æ—¶çš„æœ€å¤§åŠŸè€—æ°´å¹³ã€‚</li>
</ol>
<h1 id="Linuxç”µæºç®¡ç†"><a href="#Linuxç”µæºç®¡ç†" class="headerlink" title="Linuxç”µæºç®¡ç†"></a>Linuxç”µæºç®¡ç†</h1><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta"># cat /sys/power/state  <span class="comment">//æŸ¥çœ‹å†…æ ¸æ”¯æŒå“ªå‡ ç§ä¼‘çœ æ–¹å¼</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta"># echo standby &gt; /sys/power/state  <span class="comment">// å‘½ä»¤ç³»ç»Ÿè¿›å…¥standbyä¼‘çœ </span></span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p><code>freeze</code>:  å†»ç»“I/Oè®¾å¤‡ï¼Œå°†å®ƒä»¬ç½®äºä½åŠŸè€—çŠ¶æ€ï¼Œä½¿å¤„ç†å™¨è¿›å…¥ç©ºé—²çŠ¶æ€ã€‚å”¤é†’æœ€å¿«ï¼Œè€—ç”µæ¯”å…¶å®ƒstandbyï¼Œ memï¼Œdiskæ–¹å¼é«˜ã€‚</p>
</li>
<li><p><code>standby</code>ï¼šè¯·æ±‚ç³»ç»Ÿè¿›å…¥ Suspend-to-IdleçŠ¶æ€ã€‚åœ¨è¯¥çŠ¶æ€ä¸‹ï¼Œç³»ç»Ÿä»…å…³é—­ CPU æ ¸å¿ƒå¹¶ä¿æŒå…¶ä»–ç¡¬ä»¶è¿è¡Œï¼Œä»¥å®ç°æ›´ä½çš„åŠŸè€—ã€‚</p>
</li>
<li><p><code>mem</code>ï¼šè¯·æ±‚ç³»ç»Ÿè¿›å…¥ Suspend-to-RAMçŠ¶æ€ã€‚åœ¨è¯¥çŠ¶æ€ä¸‹ï¼Œç³»ç»Ÿçš„çŠ¶æ€ä¼šä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶å…³é—­ä¸å¿…è¦çš„ç¡¬ä»¶è®¾å¤‡ã€‚è¿›å…¥ç­‰å¾…æ¨¡å¼ï¼Œå”¤é†’è¾ƒæ…¢ï¼Œè€—ç”µæ¯”diskæ–¹å¼é«˜ã€‚</p>
</li>
<li><p><code>disk</code>ï¼šè¯·æ±‚ç³»ç»Ÿè¿›å…¥ Suspend-to-DiskçŠ¶æ€ã€‚åœ¨è¯¥çŠ¶æ€ä¸‹ï¼Œç³»ç»Ÿçš„çŠ¶æ€ä¼šä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå¹¶å®Œå…¨å…³é—­ç³»ç»Ÿã€‚</p>
</li>
</ul>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>Qï¼šæ—¶é’Ÿä¸åŠŸè€—çš„å…³ç³»ï¼Ÿ</p>
<p>Aï¼šSocä¸­å„ä¸ªè®¾å¤‡åœ¨å·¥ä½œæ—¶ï¼Œæ—¶é’Ÿé¢‘ç‡è¶Šé«˜åŠŸè€—è¶Šå¤§ã€å‘çƒ­è¶Šå¤§ã€è¶Šå®¹æ˜“ä¸ç¨³å®šï¼Œéœ€è¦æ•£çƒ­æ¡ä»¶è¶Šè‹›åˆ»ï¼›<br>Socå†…éƒ¨æœ‰å¾ˆå¤šå¤–è®¾ï¼Œè¿™äº›å¤–è®¾ä¸ä½¿ç”¨çš„æ—¶å€™æœ€å¥½å…³æ‰</p>
</li>
<li><p>Qï¼šä¼‘çœ ä¹‹åæ²¡æœ‰æŒ‰é”®ã€æ²¡æœ‰è§¦å±ä¸­æ–­è§¦å‘ï¼Œä¹Ÿæ²¡æœ‰rtcå”¤é†’ï¼Œä½†æ˜¯åˆšåˆšä¼‘çœ ä¹‹åå°±è¢«å”¤é†’ï¼Ÿ</p>
<p>Aï¼šwifi-irqä¸­æ–­åœ¨ä¼‘çœ æ—¶éœ€è¦é…ç½®æˆä¸‹æ‹‰æˆ–è€…è¾“å‡ºä½ï¼Œä¸è®©å…¶å”¤é†’å³å¯</p>
</li>
<li><p>Qï¼šå”¤é†’ä¹‹åæŸä¸ªåŠŸèƒ½ä¸èƒ½æ­£å¸¸ä½¿ç”¨ï¼Ÿ</p>
<p>Aï¼šå”¤é†’ä¹‹åç›¸å…³IOçš„çŠ¶æ€è®¾ç½®å¯èƒ½å‡ºç°é”™è¯¯ï¼Œåœ¨ä¼‘çœ å‰é€šè¿‡<code>get_gpio_func</code>è·å–åˆ°å¹¶è®°å½•ä¿è¯ä¸€è‡´ï¼›å¦‚æœè¿˜æ˜¯ä¸æˆåŠŸå¯ä»¥è€ƒè™‘ä¼‘çœ æ—¶IOçŠ¶æ€çš„è®¾ç½®ï¼Œæ˜¯å¦æ˜¯ä¼‘çœ æ—¶æŸäº›IOçŠ¶æ€ç»„åˆå¯¹å¤–è®¾äº§ç”Ÿäº†éæ³•çš„å‘½ä»¤å¯¼è‡´é”™è¯¯ï¼ŒIOçŠ¶æ€è®¾ç½®åŸåˆ™åªæ˜¯ä¸€èˆ¬è§„åˆ™</p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://www.eefocus.com/article/491902.html">MCUä½åŠŸè€—è®¾è®¡çš„5ç‚¹æ³¨æ„è¦ç‚¹</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/568050822">ä¸€æ–‡ææ‡‚linuxç³»ç»Ÿä¼‘çœ å”¤é†’</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Function</category>
      </categories>
      <tags>
        <tag>Suspend Resume</tag>
      </tags>
  </entry>
  <entry>
    <title>IOå¤šè·¯å¤ç”¨</title>
    <url>/2023/07/09/computerSystem/pattern/IOmux/</url>
    <content><![CDATA[<h1 id="æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦"></a>æ–‡ä»¶æè¿°ç¬¦</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æ–‡ä»¶æè¿°ç¬¦ï¼šFile Descriptorï¼Œç®€ç§°FDï¼Œå½“åº”ç”¨ç¨‹åºè¯·æ±‚å†…æ ¸æ‰“å¼€/æ–°å»ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç”¨äºå¯¹åº”è¿™ä¸ªæ‰“å¼€/æ–°å»ºçš„æ–‡ä»¶ã€‚FDæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°çš„ç´¢å¼•å€¼ã€‚</p>
<p>æ¯ä¸€ä¸ªè¿›ç¨‹åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ¯ä¸ªè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦çš„ç¼–å·éƒ½æ˜¯ä»0å¼€å§‹ï¼Œè¿›ç¨‹å¯åŠ¨ï¼Œé»˜è®¤éƒ½ä¼šæ‰“å¼€æ ‡å‡†è¾“å…¥(fd=0)ï¼Œæ ‡å‡†è¾“å‡º(fd=1)ï¼Œæ ‡å‡†é”™è¯¯è¿™ä¸‰ä¸ªæ–‡ä»¶(fd=2)ï¼Œä¹‹åå†æ‰“å¼€çš„æ–‡ä»¶çš„æè¿°ç¬¦ä»ç¼–å·3å¼€å§‹</p>
<h2 id="æœ€å¤§ä¸ªæ•°é™åˆ¶"><a href="#æœ€å¤§ä¸ªæ•°é™åˆ¶" class="headerlink" title="æœ€å¤§ä¸ªæ•°é™åˆ¶"></a>æœ€å¤§ä¸ªæ•°é™åˆ¶</h2><p><img src="/images/computerSystem/pattern/iomux-1.png" alt="image"></p>
<p>æŒ‰ç…§å¯¹äºæ–‡ä»¶æè¿°ç¬¦æ¦‚å¿µçš„ç†è§£ï¼Œå…¶æœ€å¤§ä¸ªæ•°é™åˆ¶åº”è¯¥å–å†³äºç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚ä½†æ˜¯å†…æ ¸é€šå¸¸ä¼šæœ‰ç³»ç»Ÿçº§é™åˆ¶ï¼Œå¯¹å•ä¸ªè¿›ç¨‹æ‰“å¼€æœ€å¤§æ–‡ä»¶æ•°åšé™åˆ¶ï¼ˆé€šå¸¸æ˜¯1024ï¼Œå¯ä»¥é€šè¿‡ <code>ulimit -n</code> å‘½ä»¤æŸ¥çœ‹ï¼‰</p>
<p>åœ¨ä½¿ç”¨å®Œæ–‡ä»¶æè¿°ç¬¦ä¹‹åéœ€è¦å°†å…¶é‡Šæ”¾ï¼ˆcloseå‡½æ•°ï¼‰ç»™æ“ä½œç³»ç»Ÿï¼Œå¦åˆ™æ–‡ä»¶æè¿°ç¬¦å°†ä¸€ç›´å­˜åœ¨ã€‚</p>
<h2 id="æ“ä½œå‡½æ•°"><a href="#æ“ä½œå‡½æ•°" class="headerlink" title="æ“ä½œå‡½æ•°"></a>æ“ä½œå‡½æ•°</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">sizeof</span>(<span class="keyword">struct</span> fd_set) = <span class="number">1024</span>	<span class="comment">// æŒ‰bitæ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªseté›†åˆï¼Œå°†set 1024ä¸ªæ ‡å¿—ä½ç½®0</span></span><br><span class="line"><span class="type">void</span> FD_ZERO(fd_set *<span class="built_in">set</span>);</span><br><span class="line"><span class="comment">// å°†æ–‡ä»¶æè¿°ç¬¦fdå¯¹åº”çš„æ ‡å¿—ä½åœ¨seté›†åˆä¸­æ¸…ç©ºï¼ˆ=0ï¼‰</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">FD_CLR</span><span class="params">(<span class="type">int</span> fd, fd_set *<span class="built_in">set</span>)</span>;</span><br><span class="line"><span class="comment">// å°†æ–‡ä»¶æè¿°ç¬¦fdå¯¹åº”çš„æ ‡å¿—ä½åœ¨seté›†åˆä¸­ç½®ä½ï¼ˆ=1ï¼‰</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">FD_SET</span><span class="params">(<span class="type">int</span> fd, fd_set *<span class="built_in">set</span>)</span>;</span><br><span class="line"><span class="comment">// åˆ¤æ–­seté›†åˆä¸­fdå¯¹åº”çš„æ ‡å¿—ä½æ˜¯å¦ç½®ä½ï¼ˆ==1ï¼Ÿï¼‰</span></span><br><span class="line"><span class="type">int</span>  <span class="title function_">FD_ISSET</span><span class="params">(<span class="type">int</span> fd, fd_set *<span class="built_in">set</span>)</span>;</span><br></pre></td></tr></tbody></table></figure>



<h2 id="ç½‘ç»œæ–‡ä»¶æè¿°ç¬¦"><a href="#ç½‘ç»œæ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="ç½‘ç»œæ–‡ä»¶æè¿°ç¬¦"></a>ç½‘ç»œæ–‡ä»¶æè¿°ç¬¦</h2><p>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå¯¹äºæœåŠ¡å™¨ç«¯æœ‰ä¸¤ç±»æ–‡ä»¶æè¿°ç¬¦ï¼š<code>ç›‘å¬æ–‡ä»¶æè¿°ç¬¦ï¼ˆListen FDï¼‰</code> <code>é€šä¿¡æ–‡ä»¶æè¿°ç¬¦ï¼ˆCommunication FDï¼‰</code>,è€Œå¯¹äºæ¯ä¸€ç§æ–‡ä»¶æè¿°ç¬¦åˆå¯¹åº”ä¸¤ä¸ªè¯»å†™ç¼“å†²åŒºï¼šRead Bufferã€Write Buffer</p>
<table>
<thead>
<tr>
<th></th>
<th>Listen FD</th>
<th>Communication FD</th>
</tr>
</thead>
<tbody><tr>
<td>ä½œç”¨</td>
<td>ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œæ£€æµ‹åˆ°ä¹‹åè°ƒç”¨ accept å°±å¯ä»¥å»ºç«‹æ–°çš„è¿æ¥</td>
<td>è´Ÿè´£å’Œå»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯æ•°æ®é€šä¿¡</td>
</tr>
<tr>
<td>ä¸ªæ•°</td>
<td>1ä¸ª</td>
<td>å–å†³äºä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯ï¼ˆNä¸ªï¼‰</td>
</tr>
<tr>
<td>æµç¨‹</td>
<td>è°ƒç”¨acceptå‡½æ•°ï¼Œç›‘å¬FDçš„è¯»ç¼“å†²åŒºæ˜¯å¦æœ‰æ•°æ®ã€‚<br>-  æœ‰æ•°æ®è¯´æ˜å®¢æˆ·ç«¯æœ‰è¯·æ±‚ï¼Œæ¥è§¦é˜»å¡ï¼Œå»ºç«‹è¿æ¥<br>-  æ²¡æœ‰æ•°æ®ï¼Œé˜»å¡ï¼Œç»§ç»­ç›‘å¬</td>
<td>1. å‘é€æ•°æ®ï¼ˆwrite / sendï¼‰<br>    å°†æ•°æ®å†™å…¥å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å†™ç¼“å†²åŒºï¼Œå†…æ ¸æ£€æµ‹åˆ°å†™ç¼“å†²åŒºæœ‰æ•°æ®ï¼Œå°†æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯<br>2. æ¥æ”¶æ•°æ®ï¼ˆread / recvï¼‰<br>    å§‹ç»ˆç›‘å¬å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦çš„è¯»ç¼“å†²åŒºï¼Œå½“æ£€æµ‹åˆ°æœ‰æ•°æ®ï¼Œè¯»å‡ºï¼</td>
</tr>
</tbody></table>
<p><img src="/images/computerSystem/pattern/iomux-2.png" alt="image"></p>
<h1 id="IOå¤šè·¯å¤ç”¨æ–¹æ³•å¯¹æ¯”"><a href="#IOå¤šè·¯å¤ç”¨æ–¹æ³•å¯¹æ¯”" class="headerlink" title="IOå¤šè·¯å¤ç”¨æ–¹æ³•å¯¹æ¯”"></a>IOå¤šè·¯å¤ç”¨æ–¹æ³•å¯¹æ¯”</h1><table>
<thead>
<tr>
<th></th>
<th>select</th>
<th>poll</th>
<th>epoll</th>
</tr>
</thead>
<tbody><tr>
<td>åº•å±‚åŸç†</td>
<td>çº¿æ€§è¡¨ï¼ˆè½®è¯¢ï¼‰</td>
<td>çº¿æ€§è¡¨ï¼ˆè½®è¯¢ï¼‰</td>
<td>çº¢é»‘æ ‘ï¼ˆäº‹ä»¶é€šçŸ¥è§¦å‘ï¼‰</td>
</tr>
<tr>
<td>æ•ˆç‡</td>
<td>è¾ƒä½</td>
<td>è¾ƒä½</td>
<td>æœ€é«˜</td>
</tr>
<tr>
<td>è¿æ¥ä¸Šé™</td>
<td>1024</td>
<td>å–å†³äºç³»ç»Ÿ</td>
<td>å–å†³äºç³»ç»Ÿ</td>
</tr>
<tr>
<td>å¹³å°é™åˆ¶</td>
<td>è·¨å¹³å°ï¼ˆlinux / window / macâ€¦ï¼‰</td>
<td>linux</td>
<td>linux</td>
</tr>
</tbody></table>
<h1 id="selectå‡½æ•°"><a href="#selectå‡½æ•°" class="headerlink" title="selectå‡½æ•°"></a>selectå‡½æ•°</h1><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/select.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* According to earlier standards */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">select</span><span class="params">(<span class="type">int</span> nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, <span class="keyword">struct</span> timeval *timeout)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The time structures involved are defined in &lt;sys/time.h&gt;</span></span><br><span class="line"><span class="comment">//  struct timeval {</span></span><br><span class="line"><span class="comment">//       long    tv_sec;         /* seconds */</span></span><br><span class="line"><span class="comment">//       long    tv_usec;        /* microseconds */</span></span><br><span class="line"><span class="comment">//  };</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><ul>
<li><p>nfdsï¼ˆæŒ‡ç¤ºå†…æ ¸éœ€è¦æ£€æµ‹æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°+1ï¼‰</p>
<p>selecté»˜è®¤æœ€å¤§æ£€æµ‹ä¸ªæ•°æ˜¯1024ï¼Œè¿™æ˜¯ç”±äºå†…æ ¸è¿›ç¨‹æœ€å¤§å¯ä»¥ç»´æŠ¤1024ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¯ä»¥ä¿®æ”¹ï¼‰ã€‚ä½†æ˜¯æŒ‡å®šç¬¬ä¸€ä¸ªå‚æ•°selectå‡½æ•°åœ¨éå†æ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™ä¸ç”¨å…¨éƒ¨éå†ï¼Œåªéœ€è¦éå†nfdsä¸ªå³å¯ã€‚åœ¨windowsä¸­ï¼Œè¿™ä¸ªå‚æ•°æ˜¯æ— æ•ˆçš„ï¼ŒæŒ‡å®š-1å³å¯</p>
</li>
<li><p>readfdsï¼ˆè¯»ç¼“å†²åŒºçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼‰</p>
<p>åªæ£€æµ‹è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„è¯»ç¼“å†²åŒºæ˜¯å¦å¯è¯»</p>
</li>
<li><p>writefdsï¼ˆå†™ç¼“å†²åŒºçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼‰</p>
<p>åªæ£€æµ‹è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„è¯»ç¼“å†²åŒºæ˜¯å¦å¯å†™</p>
</li>
<li><p>exceptfdsï¼ˆéœ€è¦å¼‚å¸¸æ£€æµ‹æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼‰</p>
</li>
<li><p>timeoutï¼ˆè¶…æ—¶æ—¶é•¿ï¼‰</p>
<p>è¯¥å‡½æ•°æœ¬èº«æ˜¯é˜»å¡çš„ï¼Œå½“åŠ å…¥timeoutå‚æ•°ä¹‹åå³ä½¿æ²¡æœ‰å¯è¯»ã€å¯å†™ã€å¼‚å¸¸çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¾¾åˆ°timeoutæ—¶é•¿å‡½æ•°ä¹Ÿå°†è§£é™¤é˜»å¡è¿”å›ã€‚å½“è¢«è®¾ç½®ä¸ºNULLï¼Œå°†é˜»å¡ç›´è‡³æ£€æµ‹åˆ°æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€æ”¹å˜</p>
</li>
</ul>
<h2 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h2><p>readfdsã€writefdsã€execptfdsæ˜¯ä¼ å…¥ä¼ å‡ºå‚æ•°ã€‚ä¼ å…¥fd_setç±»å‹æŒ‡é’ˆï¼Œæœ€ç»ˆå¯è¯»ã€å¯å†™ã€å¼‚å¸¸çš„æ–‡ä»¶æè¿°ç¬¦åŒæ ·å†™å›ç”¨æˆ·ä¼ å…¥çš„æŒ‡é’ˆæŒ‡å‘çš„ç©ºé—´å†…ï¼ˆä¸€å®šå°äºç­‰äºä¼ å…¥æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼‰</p>
<ul>
<li>å¤§äº0ï¼šè¡¨ç¤ºä¸‰ä¸ªé›†åˆä¸­æ€»å…±è¢«ç½®ä½çš„ä½æ•°ä¹‹å’Œ</li>
<li>ç­‰äº0ï¼štimeout=0 &amp;&amp; ä¸‰ä¸ªé›†åˆæ²¡æœ‰è¢«æ£€æµ‹åˆ°</li>
<li>å°äº0ï¼šselectå‡ºé”™ï¼Œæ ¹æ®errnoåˆ¤æ–­å‡ºé”™åŸå› </li>
</ul>
<h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><ol>
<li>åˆå§‹åŒ–readã€writeã€exceptä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼ˆFD_ZEROï¼‰</li>
<li>å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®åˆ°selectå‡½æ•°ä¸­ï¼Œäº¤ä»˜å†…æ ¸æ£€æµ‹</li>
<li>å†…æ ¸é¦–å…ˆä¸€ä»½éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œåœ¨æ£€æµ‹å¯¹åº”çš„è¯»å†™ç¼“å†²åŒº</li>
<li>å½“æ£€æµ‹åˆ°å¯è¯»/å¯å†™å°†æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„æ ‡å¿—ä½å†™å›fd_setå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆä¸­</li>
<li>ç”¨æˆ·å¤„ç†</li>
</ol>
<h1 id="pollå‡½æ•°"><a href="#pollå‡½æ•°" class="headerlink" title="pollå‡½æ•°"></a>pollå‡½æ•°</h1><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;poll.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">poll</span><span class="params">(<span class="keyword">struct</span> pollfd *fds, <span class="type">nfds_t</span> nfds, <span class="type">int</span> timeout)</span>;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> {</span></span><br><span class="line">     <span class="type">int</span>   fd;         <span class="comment">/* file descriptor */</span></span><br><span class="line">     <span class="type">short</span> events;     <span class="comment">/* requested events */</span> (ä¼ å…¥)è¦ç›‘è§†çš„äº‹ä»¶ï¼ˆè¾“å…¥äº‹ä»¶ã€è¾“å‡ºäº‹ä»¶ã€é”™è¯¯äº‹ä»¶ç­‰ï¼‰</span><br><span class="line">     <span class="type">short</span> revents;    <span class="comment">/* returned events */</span>  (ä¼ å‡º)å®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼ˆç”±ç³»ç»Ÿå¡«å……ï¼‰</span><br><span class="line"> };</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å‚æ•°-1"><a href="#å‚æ•°-1" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><ul>
<li>struct pollfd fds<ul>
<li>fdï¼šè¢«æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦</li>
<li>eventsï¼šå§”æ‰˜ç»™å†…æ ¸æ£€æµ‹çš„äº‹ä»¶</li>
<li>reventsï¼šå®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼Œå†…æ ¸çš„è¿”å›å€¼</li>
</ul>
</li>
<li>nfdsï¼šfdsæ•°ç»„ä¸­çš„ç»“æ„ä½“æ•°é‡ã€‚<ul>
<li><code>POLLIN</code>ï¼šè¡¨ç¤ºæœ‰æ•°æ®å¯è¯»ï¼ˆè¾“å…¥äº‹ä»¶ï¼‰ã€‚</li>
<li><code>POLLOUT</code>ï¼šè¡¨ç¤ºå¯ä»¥å†™æ•°æ®ï¼ˆè¾“å‡ºäº‹ä»¶ï¼‰ã€‚</li>
<li><code>POLLERR</code>ï¼šè¡¨ç¤ºå‘ç”Ÿé”™è¯¯ã€‚</li>
<li><code>POLLHUP</code>ï¼šè¡¨ç¤ºå‘ç”ŸæŒ‚èµ·äº‹ä»¶ã€‚</li>
<li><code>POLLNVAL</code>ï¼šè¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦æ— æ•ˆã€‚</li>
</ul>
</li>
<li>timeoutï¼šï¼šæŒ‡å®šè¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰<ul>
<li>-1ï¼šæ°¸ä¹…é˜»å¡ï¼Œç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿã€‚</li>
<li>0ï¼šç«‹å³è¿”å›ï¼Œæ— è®ºæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿã€‚</li>
<li>å¤§äº0ï¼šè¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œpollå‡½æ•°ä¼šç­‰å¾…æŒ‡å®šçš„æ¯«ç§’æ•°ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´è¿˜æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œåˆ™è¿”å›ã€‚</li>
</ul>
</li>
</ul>
<h1 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h1><h2 id="æµç¨‹-1"><a href="#æµç¨‹-1" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><ol>
<li>åˆ›å»ºepollå®ä¾‹ï¼ˆepoll_createï¼‰</li>
<li>æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶ï¼ˆepoll_ctlï¼‰</li>
<li>ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼ˆepoll_waitï¼‰</li>
<li>å¤„ç†äº‹ä»¶ï¼ˆè‡ªå®šä¹‰ï¼‰</li>
</ol>
<h2 id="ç›¸å…³å‡½æ•°åŠç»“æ„ä½“"><a href="#ç›¸å…³å‡½æ•°åŠç»“æ„ä½“" class="headerlink" title="ç›¸å…³å‡½æ•°åŠç»“æ„ä½“"></a>ç›¸å…³å‡½æ•°åŠç»“æ„ä½“</h2><ul>
<li><p>epoll_create</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_create</span><span class="params">(<span class="type">int</span> size)</span>;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªepollå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ä¸€é¢—çº¢é»‘æ ‘</li>
<li>å‚æ•°sizeï¼šLinux 2.6.8ä¹‹åè¿™ä¸ªå‚æ•°è¢«å¿½ç•¥ï¼Œå¤§äº0å³å¯ã€‚ä¹‹å‰çš„ç‰ˆæœ¬è¯¥å‚æ•°æŒ‡å®šäº†çº¢é»‘æ ‘èŠ‚ç‚¹ä¸ªæ•°</li>
<li>è¿”å›å€¼ï¼šä¸€ä¸ªepollå®ä¾‹</li>
</ul>
</li>
<li><p>epoll_ctl</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_ctl</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> op, <span class="type">int</span> fd, <span class="keyword">struct</span> epoll_event *event)</span>;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>ä½œç”¨ï¼šå°†è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦å’Œå…³æ³¨çš„äº‹ä»¶æ³¨å†Œåˆ°epollå®ä¾‹ä¸­</li>
<li>å‚æ•°ï¼š<ul>
<li>epfdï¼šepollå®ä¾‹ï¼Œå³é€šè¿‡epoll_createåˆ›å»ºå‡ºæ¥çš„è¿”å›å€¼</li>
<li>opï¼šæ“ä½œç±»å‹ï¼Œå¯ä»¥æ˜¯<code>EPOLL_CTL_ADD</code>ï¼ˆæ·»åŠ æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€<code>EPOLL_CTL_MOD</code>ï¼ˆä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦ï¼‰æˆ–<code>EPOLL_CTL_DEL</code>ï¼ˆåˆ é™¤æ–‡ä»¶æè¿°ç¬¦ï¼‰</li>
<li>fdï¼šè¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦</li>
<li>eventï¼šæŒ‡å®šå…³æ³¨çš„äº‹ä»¶ç±»å‹ï¼ˆè§ä¸‹æ–‡ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><p>epoll_wait</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_wait</span><span class="params">(<span class="type">int</span> epfd, <span class="keyword">struct</span> epoll_event *events, <span class="type">int</span> maxevents, <span class="type">int</span> timeout)</span>;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>ä½œç”¨ï¼šç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼Œè¯¥å‡½æ•°ä¼šé˜»å¡ç¨‹åºæ‰§è¡Œï¼Œç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿæˆ–è¶…æ—¶ã€‚</p>
</li>
<li><p>å‚æ•°</p>
<ul>
<li>epfdï¼šepoll_createå®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦</li>
<li>eventsï¼šï¼šæŒ‡å‘struct epoll_eventç»“æ„ä½“æ•°ç»„çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨äº‹ä»¶çš„ç»“æœï¼ˆä¼ å‡ºå‚æ•°ï¼‰</li>
<li>maxeventsï¼ševentsæ•°ç»„çš„å¤§å°ï¼Œè¡¨ç¤ºæœ€å¤§å¯ä»¥å­˜å‚¨å¤šå°‘ä¸ªäº‹ä»¶ã€‚</li>
<li>timeoutï¼šç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ã€‚ä¼ å…¥-1è¡¨ç¤ºæ°¸ä¹…ç­‰å¾…ï¼Œä¼ å…¥0è¡¨ç¤ºç«‹å³è¿”å›ï¼Œä¼ å…¥æ­£æ•´æ•°è¡¨ç¤ºç­‰å¾…æŒ‡å®šçš„æ¯«ç§’æ•°ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p>struct epoll_event</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> {</span></span><br><span class="line">    <span class="type">uint32_t</span> events;  	<span class="comment">// äº‹ä»¶ç±»å‹</span></span><br><span class="line">    <span class="type">epoll_data_t</span> data;  <span class="comment">// ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">epoll_data</span> {</span></span><br><span class="line">    <span class="type">void</span>        *ptr;</span><br><span class="line">   	<span class="type">int</span>          fd;</span><br><span class="line"> 	<span class="type">uint32_t</span>     u32;</span><br><span class="line"> 	<span class="type">uint64_t</span>     u64;</span><br><span class="line">} <span class="type">epoll_data_t</span>;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>å‚æ•°<ul>
<li>eventsï¼šäº‹ä»¶ç±»å‹ï¼ŒEPOLLIN / EPOLLOUT / EPOLLRDHUP / EPOLLPRI / EPOLLERR</li>
<li>dataï¼šç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼ˆè”åˆä½“ç»“æ„ï¼Œåªèƒ½ä½¿ç”¨ä¸€ä¸ªï¼Œé€šå¸¸ä½¿ç”¨fdï¼‰ã€‚è¿™ä¸ªå‚æ•°å¿…é¡»æ˜¯ç”¨æˆ·æ¥æŒ‡å®šï¼Œæœ€ç»ˆè¿”å›çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥å‚æ•°åˆ¤æ–­æ–‡ä»¶æè¿°ç¬¦çš„indexæˆ–è€…å…¶å®ƒæ•°æ®ç±»å‹</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><p><a href="https://subingwen.cn/linux/socket/">å¥—æ¥å­—ï¼šsocket</a></p>
</li>
<li><p><a href="https://www.bilibili.com/video/BV1fg411376j">IOå¤šè·¯å¤ç”¨-[å¤šçº¿ç¨‹ç½‘ç»œå¹¶å‘é€šä¿¡ select/poll]</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/alantu2018/p/8612722.html">linux selectå‡½æ•°è¯¦è§£</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>pattern</category>
      </categories>
      <tags>
        <tag>IO å¤šè·¯å¤ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title>I2C</title>
    <url>/2023/07/01/computerSystem/protocol/I2C/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>I2Cï¼šInter-Integrated Circuitï¼Œå†…éƒ¨é›†æˆç”µè·¯ã€‚ä½œä¸ºä¸€ç§å¹¿æ³›ä½¿ç”¨çš„ä¸²è¡Œé€šä¿¡åè®®ï¼Œé€šè¿‡åŒçº¿æ¥å£ä½¿å¤šä¸ªç”µå­è®¾å¤‡èƒ½å¤Ÿå½¼æ­¤é€šä¿¡ã€‚å®ƒç”±é£åˆ©æµ¦åŠå¯¼ä½“ï¼ˆç°åœ¨çš„æ©æ™ºæµ¦åŠå¯¼ä½“ï¼‰åœ¨ä¸Šä¸–çºª80å¹´ä»£åˆå¼€å‘ï¼Œå¹¶ä¸”åæ¥æˆä¸ºäº†ä¸šç•Œäº‹å®ä¸Šçš„æ ‡å‡†ã€‚</p>
<p>BUSï¼šæ€»çº¿ã€‚æ—©æœŸçš„è®¡ç®—æœºä½“ç§¯åºå¤§ï¼Œè¿çº¿å¤æ‚ï¼Œæ‰€æœ‰æ•°æ®éƒ½é€šè¿‡å®é™…çš„ç”µç¼†ä¼ è¾“ï¼Œè¿™å˜å¾—éå¸¸æ··ä¹±ã€‚æŠŠè¿™äº›å¤§æ†çš„æ‚ä¹±çš„ç”µç¼†çº¿ï¼Œæœ‰åºçš„å¸ƒç½®åœ¨ä¸€ä¸ªå…¬å…±çº¿æ’ä¸Šï¼Œè¿™äº›è§„åˆ™æ’åˆ—åœ¨ä¸€èµ·çš„å…¬å…±çº¿æŸå°±æ˜¯æœ¯è¯­â€œæ€»çº¿â€çš„æ—©æœŸæ¥æºï¼Œç”¨BUSè¡¨ç¤ºã€‚åœ¨è®¡ç®—ä½“ç³»ç»“æ„ä¸­ï¼Œ æ€»çº¿ï¼ˆBusï¼‰æ˜¯è®¡ç®—æœºå†…éƒ¨ç»„ä»¶ä¹‹é—´æˆ–è®¡ç®—æœºä¹‹é—´ä¼ é€ä¿¡æ¯çš„å…¬å…±é€šä¿¡å¹²çº¿ï¼Œå®ƒæ˜¯ç”±å¯¼çº¿ç»„æˆçš„ä¼ è¾“è·¯å¾„ã€‚</p>
<h2 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h2><ul>
<li><p><strong>å·¥ä½œæ¨¡å¼</strong>ï¼šåŠåŒå·¥ï¼ŒæŸä¸€æ—¶åˆ»è¦ä¹ˆå‘è¦ä¹ˆæ”¶</p>
</li>
<li><p><strong>æ€»çº¿æ¥å£</strong>ï¼šåŒçº¿ï¼Œä¸²è¡Œæ•°æ®çº¿ï¼ˆSDAï¼‰ã€ä¸²è¡Œæ—¶é’Ÿçº¿ï¼ˆSCLï¼‰</p>
</li>
<li><p><strong>å¯»å€</strong>ï¼šæ€»çº¿ä¸Šçš„æ¯ä¸ªè®¾å¤‡éƒ½æœ‰å”¯ä¸€çš„åœ°å€ï¼Œå…è®¸ä¸»è®¾å¤‡ä¸ç‰¹å®šä»è®¾å¤‡é€šä¿¡ã€‚åœ°å€ç©ºé—´æ”¯æŒæœ€å¤š128ä¸ªè®¾å¤‡ï¼Œä½†ç”±äºä¸€äº›ä¿ç•™åœ°å€ï¼Œå¯ç”¨èŒƒå›´ä¼šå‡å°‘ã€‚</p>
</li>
<li><p><strong>è®¾å¤‡åŠŸèƒ½</strong>ï¼šåŠŸèƒ½å…è®¸çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªè®¾å¤‡éƒ½å¯ä»¥åšä¸»è®¾å¤‡æˆ–ä»è®¾å¤‡ï¼ˆå¯æ”¶å¯å‘ï¼‰</p>
</li>
<li><p><strong>åŒæ­¥é€šä¿¡</strong>ï¼šæ€»çº¿ä¸Šçš„é€šä¿¡æ˜¯åŒæ­¥çš„ï¼Œæ„å‘³ç€æ—¶é’Ÿä¿¡å·ç”±ä¸»è®¾å¤‡äº§ç”Ÿï¼Œæ•°æ®æŒ‰ä½åœ¨æ•°æ®çº¿ä¸Šä¸æ—¶é’ŸåŒæ­¥ä¼ è¾“</p>
</li>
<li><p><strong>ä½çº§ç¡®è®¤</strong>ï¼šåœ¨å‘é€æ¯ä¸ªå­—èŠ‚çš„æ•°æ®åï¼Œæ¥æ”¶è®¾å¤‡é€šè¿‡æ‹‰ä½æ•°æ®çº¿ï¼ˆSDAï¼‰æ¥ç¡®è®¤æˆåŠŸæ¥æ”¶ã€‚å¦‚æœæ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œåˆ™è¡¨ç¤ºå‘ç”Ÿé”™è¯¯ã€‚</p>
</li>
<li><p><strong>å¤šä¸»æ”¯æŒ</strong>ï¼šæ”¯æŒå¤šä¸»é€šä¿¡ï¼Œå…è®¸å¤šä¸ªä¸»è®¾å¤‡åŒæ—¶å­˜åœ¨äºåŒä¸€æ€»çº¿ä¸Šã€‚é€šè¿‡ä¸»è®¾å¤‡ä»²è£æœºåˆ¶ï¼Œç¡®å®šå“ªä¸ªä¸»è®¾å¤‡åœ¨ä»»ä½•æ—¶åˆ»æ§åˆ¶æ€»çº¿ã€‚</p>
</li>
<li><p><strong>ä¼ è¾“é€Ÿç‡</strong>ï¼šæ ‡å‡†æ¨¡å¼ä¸‹å¯è¾¾ 100kbit/sï¼Œå¿«é€Ÿæ¨¡å¼ä¸‹å¯è¾¾ 400kbit/sï¼Œ é«˜é€Ÿæ¨¡å¼ä¸‹å¯è¾¾ 3.4Mbit/s</p>
</li>
<li><p><strong>æœ€å¤§è®¾å¤‡é‡</strong>ï¼šè¿æ¥åˆ°ç›¸åŒæ€»çº¿çš„ IIC æ•°é‡åªå—åˆ°æ€»çº¿çš„æœ€å¤§ç”µå®¹ 400pF é™åˆ¶ï¼ˆ128ä¸ªå”¯ä¸€è®¾å¤‡åœ°å€ï¼‰</p>
</li>
<li><p><strong>å…¶å®ƒ</strong>ï¼šç‰‡ä¸Šçš„æ»¤æ³¢å™¨å¯ä»¥æ»¤å»æ€»çº¿æ•°æ®çº¿ä¸Šçš„æ¯›åˆºæ³¢ ä¿è¯æ•°æ®å®Œæ•´</p>
</li>
</ul>
<h1 id="æ‹“æ‰‘ç»“æ„"><a href="#æ‹“æ‰‘ç»“æ„" class="headerlink" title="æ‹“æ‰‘ç»“æ„"></a>æ‹“æ‰‘ç»“æ„</h1><p><img src="/images/computerSystem/protocol/I2C/I2C-1.png" alt="image"></p>
<p>I2Cåè®®é‡‡ç”¨ä¸»â€”â€”ä»æ¶æ„ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾å¤‡ï¼ˆä¸»è®¾å¤‡ï¼‰å¯åŠ¨å’Œæ§åˆ¶é€šä¿¡ï¼Œè€Œä¸€ä¸ªæˆ–å¤šä¸ªè®¾å¤‡ï¼ˆä»è®¾å¤‡ï¼‰å“åº”ä¸»è®¾å¤‡çš„å‘½ä»¤ã€‚I2Cä½¿ç”¨çš„ä¸¤æ ¹é€šä¿¡çº¿æ˜¯ä¸²è¡Œæ•°æ®çº¿ï¼ˆSDAï¼‰å’Œä¸²è¡Œæ—¶é’Ÿçº¿ï¼ˆSCLï¼‰ã€‚æ€»çº¿ç©ºé—²æ—¶ï¼Œä¸¤æ¡çº¿è·¯éƒ½æ˜¯é«˜ç”µå¹³ã€‚è¿æ¥åˆ°æ€»çº¿çš„å™¨ä»¶è¾“å‡ºçº§å¿…é¡»æ˜¯æ¼æå¼€è·¯æˆ–é›†ç”µæå¼€è·¯æ‰èƒ½æ‰§è¡Œçº¿ä¸çš„åŠŸèƒ½</p>
<h1 id="åè®®"><a href="#åè®®" class="headerlink" title="åè®®"></a>åè®®</h1><h2 id="æ•°æ®æœ‰æ•ˆæ€§"><a href="#æ•°æ®æœ‰æ•ˆæ€§" class="headerlink" title="æ•°æ®æœ‰æ•ˆæ€§"></a>æ•°æ®æœ‰æ•ˆæ€§</h2><p><img src="/images/computerSystem/protocol/I2C/I2C-2.png" alt="image"></p>
<p>SDAä¸Šçš„æ•°æ®å¿…é¡»åœ¨SCLçš„é«˜ç”µå¹³å‘¨æœŸä¿æŒç¨³å®šï¼ŒSDAé«˜æˆ–ä½ç”µå¹³çŠ¶æ€åªæœ‰åœ¨ SCL æ—¶é’Ÿä¿¡å·æ˜¯ä½ç”µå¹³æ—¶æ‰èƒ½æ”¹å˜</p>
<h2 id="èµ·å§‹ç»“æŸæ¡ä»¶"><a href="#èµ·å§‹ç»“æŸæ¡ä»¶" class="headerlink" title="èµ·å§‹ç»“æŸæ¡ä»¶"></a>èµ·å§‹ç»“æŸæ¡ä»¶</h2><p><img src="/images/computerSystem/protocol/I2C/I2C-3.png" alt="image"></p>
<p>åœ¨5.1ä¸­å¯¹äºæ•°æ®æœ‰æ•ˆæ€§åšäº†è§„èŒƒï¼Œæ—¶é’Ÿçº¿é«˜ç”µå¹³æ•°æ®çº¿ä¸èƒ½åŠ¨ã€‚å› æ­¤å¯¹äºèµ·å§‹å’Œç»“æŸæ¡ä»¶ä¸€å®šæ˜¯åœ¨SCLé«˜ç”µå¹³ï¼Œå…·ä½“æ˜¯è¿™æ ·è§„å®šçš„ï¼šSCLé«˜ç”µå¹³ï¼ŒSDAç”±é«˜åˆ°ä½ç”µå¹³çš„åˆ‡æ¢è¡¨ç¤ºå¼€å§‹ä¼ è¾“ï¼›SCLé«˜ç”µå¹³ï¼ŒSDAæœ‰ä½åˆ°é«˜çš„ç”µå¹³åˆ‡æ¢è¡¨ç¤ºä¼ è¾“ç»“æŸã€‚</p>
<p>èµ·å§‹ç»“æŸæ¡ä»¶ä¸€èˆ¬æ˜¯ç”±ä¸»æœºäº§ç”Ÿï¼Œæ€»çº¿åœ¨èµ·å§‹æ¡ä»¶åè¢«è®¤ä¸ºå¤„äºå¿™ï¼ˆBUSYï¼‰çš„çŠ¶æ€ï¼Œåœ¨åœæ­¢æ¡ä»¶çš„æŸæ®µæ—¶é—´åæ€»çº¿è¢«è®¤ä¸ºå†æ¬¡å¤„äºç©ºé—²ï¼ˆIDLEï¼‰çŠ¶æ€</p>
<h2 id="ä¼ è¾“å•å…ƒ"><a href="#ä¼ è¾“å•å…ƒ" class="headerlink" title="ä¼ è¾“å•å…ƒ"></a>ä¼ è¾“å•å…ƒ</h2><p> I2Cæ€»çº¿ä¸Šçš„ä¸»è®¾å¤‡ä¸ä»è®¾å¤‡ä¹‹é—´ä»¥å­—èŠ‚(8ä½)ä¸ºå•ä½è¿›è¡ŒåŒå‘çš„æ•°æ®ä¼ è¾“ï¼Œå¹¶ä¸”æ¯ä¸ªå­—èŠ‚åé¢å¿…é¡»è·Ÿä¸€ä¸ªå“åº”ä½ã€‚</p>
<h2 id="æ€»çº¿æ“ä½œ"><a href="#æ€»çº¿æ“ä½œ" class="headerlink" title="æ€»çº¿æ“ä½œ"></a>æ€»çº¿æ“ä½œ</h2><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p><img src="/images/computerSystem/protocol/I2C/I2C-4.png" alt="image"></p>
<ul>
<li>èµ·å§‹æ¡ä»¶</li>
<li>masterå°†7ä½ä»è®¾å¤‡åœ°å€ + 1ä½è¯»å†™æ ‡å¿—ä½ å†™åˆ°æ€»çº¿</li>
<li>ä»è®¾å¤‡é€šè¿‡å‘é€ç¡®è®¤ä½ (ACK) ä½œä¸ºåé¦ˆæ¥å“åº”æ€»çº¿ä¸Šå­˜åœ¨å…·æœ‰æ­£ç¡®åœ°å€çš„ä»è®¾å¤‡å¹¶ç­‰å¾…è¿›ä¸€æ­¥é€šä¿¡çš„ä¸»è®¾å¤‡</li>
<li>é€šä¿¡</li>
<li>ç»“æŸæ¡ä»¶</li>
</ul>
<h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><ul>
<li><p>master write to slave</p>
</li>
<li><p>master read from slave</p>
</li>
<li><p>è¯»å†™æ–¹å‘äº¤å‰ï¼Œé‡å¤ä¼ è¾“ï¼ˆä¸»è®¾å¤‡å¾€ä»è®¾å¤‡ä¸­å†™æ•°æ®ï¼Œç„¶åé‡å¯èµ·å§‹æ¡ä»¶ï¼Œç´§æ¥ç€ä»ä»è®¾å¤‡ä¸­è¯»å–æ•°æ®ï¼›æˆ–è€…æ˜¯ä¸»è®¾å¤‡ä»ä»è®¾å¤‡ä¸­è¯»æ•°æ®ï¼Œç„¶åé‡å¯èµ·å§‹æ¡ä»¶ï¼Œç´§æ¥ç€ä¸»è®¾å¤‡å¾€ä»è®¾å¤‡ä¸­å†™æ•°æ®ï¼‰</p>
<table>
<thead>
<tr>
<th>START</th>
<th>ADDR</th>
<th>R/W</th>
<th>ACK</th>
<th>DATA</th>
<th>ACK</th>
<th>START</th>
<th>ADDR</th>
<th>R/W</th>
<th>ACK</th>
<th>DATA</th>
<th>ACK</th>
<th>STOP</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>XX</td>
<td>XX</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>XX</td>
<td>XX</td>
<td></td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="å†™å…¥æ–¹å¼"><a href="#å†™å…¥æ–¹å¼" class="headerlink" title="å†™å…¥æ–¹å¼"></a>å†™å…¥æ–¹å¼</h2><p>åœ¨I2Cé€šä¿¡ä¸­ï¼Œæœ‰ä¸¤ç§å¸¸è§çš„å†™å…¥æ–¹å¼ï¼šå­—èŠ‚å†™å…¥ï¼ˆByte Writeï¼‰å’Œé¡µå†™å…¥ï¼ˆPage Writeï¼‰ã€‚å…·ä½“ä½¿ç”¨å“ªç§å†™å…¥æ–¹å¼å–å†³äºä»è®¾å¤‡çš„æ”¯æŒå’Œåº”ç”¨éœ€æ±‚ã€‚æœ‰äº›ä»è®¾å¤‡å¯èƒ½åªæ”¯æŒå­—èŠ‚å†™å…¥ï¼Œè€Œæœ‰äº›è®¾å¤‡å¯èƒ½æ”¯æŒé¡µå†™å…¥ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å‚è€ƒä»è®¾å¤‡çš„è§„æ ¼å’Œæ–‡æ¡£ï¼Œç¡®å®šåˆé€‚çš„å†™å…¥æ–¹å¼ã€‚</p>
<h3 id="å­—èŠ‚å†™å…¥ï¼ˆByte-Writeï¼‰"><a href="#å­—èŠ‚å†™å…¥ï¼ˆByte-Writeï¼‰" class="headerlink" title="å­—èŠ‚å†™å…¥ï¼ˆByte Writeï¼‰"></a>å­—èŠ‚å†™å…¥ï¼ˆByte Writeï¼‰</h3><p>å­—èŠ‚å†™å…¥ï¼šå­—èŠ‚å†™å…¥æ˜¯ä¸€ç§é€ä¸ªå­—èŠ‚å†™å…¥æ•°æ®çš„æ–¹å¼ã€‚åœ¨å­—èŠ‚å†™å…¥ä¸­ï¼Œæ¯ä¸ªæ•°æ®å­—èŠ‚éƒ½ä¼šå¸¦æœ‰ä¸€ä¸ªACKï¼ˆåº”ç­”ï¼‰ä¿¡å·ï¼Œè¡¨ç¤ºæ¥æ”¶æ–¹æ­£ç¡®æ¥æ”¶äº†æ•°æ®ã€‚ä¸»æœºå‘é€ä¸€ä¸ªå­—èŠ‚åï¼Œç­‰å¾…ä»è®¾å¤‡å‘é€ACKä¿¡å·ï¼Œç„¶åå†å‘é€ä¸‹ä¸€ä¸ªå­—èŠ‚ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºå•ä¸ªå­—èŠ‚çš„æ•°æ®ä¼ è¾“æˆ–è€…åœ¨å¯„å­˜å™¨ä¸­å†™å…¥å•ä¸ªå­—èŠ‚çš„æƒ…å†µã€‚</p>
<h3 id="é¡µå†™å…¥ï¼ˆPage-Writeï¼‰"><a href="#é¡µå†™å…¥ï¼ˆPage-Writeï¼‰" class="headerlink" title="é¡µå†™å…¥ï¼ˆPage Writeï¼‰"></a>é¡µå†™å…¥ï¼ˆPage Writeï¼‰</h3><p>é¡µå†™å…¥ï¼šé¡µå†™å…¥æ˜¯ä¸€ç§æ‰¹é‡å†™å…¥æ•°æ®çš„æ–¹å¼ã€‚åœ¨é¡µå†™å…¥ä¸­ï¼Œä¸»æœºå¯ä»¥è¿ç»­å†™å…¥å¤šä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œè€Œä¸éœ€è¦æ¯ä¸ªå­—èŠ‚éƒ½ç­‰å¾…ACKä¿¡å·ã€‚ä¸»æœºå‘é€ä¸€ç³»åˆ—å­—èŠ‚åï¼Œç­‰å¾…ä»è®¾å¤‡å‘é€ä¸€ä¸ªACKä¿¡å·ï¼Œè¡¨ç¤ºæ¥æ”¶æ–¹æ­£ç¡®æ¥æ”¶äº†ä¸€ç»„å­—èŠ‚ã€‚è¿™ç§æ–¹å¼å¯ä»¥æé«˜å†™å…¥æ•°æ®çš„æ•ˆç‡ï¼Œå°¤å…¶åœ¨å†™å…¥å¤§é‡æ•°æ®æ—¶ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºé¡µå†™å…¥ï¼Œæœ‰ä¸€ä¸ªé¡µçš„å¤§å°é™åˆ¶ã€‚é¡µçš„å¤§å°æ˜¯æŒ‡ä»è®¾å¤‡æ”¯æŒä¸€æ¬¡è¿ç»­å†™å…¥çš„æœ€å¤§å­—èŠ‚æ•°ã€‚è¶…è¿‡é¡µçš„å¤§å°è¿›è¡Œå†™å…¥æ“ä½œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–é”™è¯¯ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨é¡µå†™å…¥æ—¶ï¼Œéœ€è¦ç¡®ä¿å†™å…¥çš„æ•°æ®é‡ä¸è¶…è¿‡ä»è®¾å¤‡è§„å®šçš„é¡µå¤§å°ã€‚</p>
<h1 id="å¼€å‘æ³¨æ„äº‹é¡¹"><a href="#å¼€å‘æ³¨æ„äº‹é¡¹" class="headerlink" title="å¼€å‘æ³¨æ„äº‹é¡¹"></a>å¼€å‘æ³¨æ„äº‹é¡¹</h1><ul>
<li>ç”µå¹³å…¼å®¹æ€§ï¼šç¡®ä¿I2Cæ€»çº¿ä¸Šçš„æ‰€æœ‰è®¾å¤‡å’Œä¸»æ§åˆ¶å™¨çš„ç”µå¹³å…¼å®¹ã€‚ç¡®è®¤è®¾å¤‡å’Œä¸»æ§åˆ¶å™¨ä½¿ç”¨ç›¸åŒçš„ç”µæºç”µå‹å’Œç”µå¹³æ ‡å‡†ï¼ˆå¦‚3.3Vã€5Vç­‰ï¼‰ï¼Œä»¥é¿å…ç”µå¹³ä¸åŒ¹é…å¯¼è‡´çš„é€šä¿¡é—®é¢˜ã€‚</li>
<li>ç”µæºç¨³å®šæ€§ï¼šæä¾›ç¨³å®šçš„ç”µæºä¾›åº”ç»™I2Cè®¾å¤‡ï¼Œç¡®ä¿ç”µæºç”µå‹å’Œç”µæµæ»¡è¶³è®¾å¤‡çš„è¦æ±‚ã€‚ç”µæºçš„æ³¢åŠ¨å’Œå™ªå£°å¯èƒ½ä¼šå¯¹I2Cé€šä¿¡äº§ç”Ÿå¹²æ‰°ï¼Œå¯¼è‡´é€šä¿¡é”™è¯¯æˆ–æ•…éšœã€‚</li>
<li>ç”µç¼†é•¿åº¦å’Œå¸ƒçº¿ï¼šI2Cé€šä¿¡çš„å¯é æ€§ä¸ç”µç¼†é•¿åº¦å’Œå¸ƒçº¿æœ‰å…³ã€‚ç¡®ä¿ç”µç¼†é•¿åº¦ä¸è¶…è¿‡I2Cæ ‡å‡†è§„å®šçš„æœ€å¤§é•¿åº¦ï¼Œå¹¶é¿å…ç”µç¼†è¿‡é•¿æˆ–æ‰­æ›²çš„æƒ…å†µã€‚åŒæ—¶ï¼Œå¸ƒçº¿åº”é¿å…ä¸ç”µæºçº¿ã€é«˜é¢‘å¹²æ‰°æºç­‰ä¿¡å·ç›¸äº’å¹²æ‰°ã€‚</li>
<li>I2Cåœ°å€å†²çªï¼šI2Cè®¾å¤‡çš„åœ°å€åº”å”¯ä¸€ï¼Œä¸å¾—å‡ºç°åœ°å€å†²çªã€‚åœ¨è®¾è®¡æ—¶ï¼Œä»”ç»†é€‰æ‹©å’Œåˆ†é…æ¯ä¸ªI2Cè®¾å¤‡çš„åœ°å€ï¼Œç¡®ä¿å„è®¾å¤‡åœ°å€ä¸é‡å¤ã€‚</li>
<li>æ—¶é’Ÿé¢‘ç‡é€‰æ‹©ï¼šæ ¹æ®I2Cè®¾å¤‡çš„è¦æ±‚å’Œæ€»çº¿é•¿åº¦ï¼Œé€‰æ‹©åˆé€‚çš„æ—¶é’Ÿé¢‘ç‡ã€‚è¿‡é«˜çš„æ—¶é’Ÿé¢‘ç‡å¯èƒ½å¯¼è‡´ä¿¡å·å¤±çœŸæˆ–é€šä¿¡é”™è¯¯ï¼Œè€Œè¿‡ä½çš„æ—¶é’Ÿé¢‘ç‡å¯èƒ½å¯¼è‡´é€šä¿¡é€Ÿåº¦è¾ƒæ…¢ã€‚</li>
<li>é”™è¯¯å¤„ç†å’Œè¶…æ—¶æœºåˆ¶ï¼šåœ¨I2Cé€šä¿¡ä¸­ï¼Œå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ï¼Œå¦‚<strong>è®¾å¤‡æœªå“åº”ã€æ€»çº¿å†²</strong>çªç­‰ã€‚åœ¨å¼€å‘ä¸­ï¼Œåº”å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†å’Œè¶…æ—¶æœºåˆ¶ï¼Œä¾‹å¦‚è®¾ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´å’Œé”™è¯¯å¤„ç†ç­–ç•¥ï¼Œä»¥ç¡®ä¿ç¨‹åºçš„é²æ£’æ€§å’Œå¯é æ€§ã€‚</li>
<li>é€‚å½“çš„å»¶æ—¶ï¼šI2Cé€šä¿¡éœ€è¦ä¸€äº›å»¶æ—¶ä»¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„ç¨³å®šæ€§ã€‚åœ¨ç¼–ç¨‹æ—¶ï¼Œæ ¹æ®å…·ä½“è®¾å¤‡çš„è¦æ±‚å’ŒI2Cæ ‡å‡†ï¼Œé€‚å½“æ·»åŠ å»¶æ—¶ä»¥ç¡®ä¿æ•°æ®çš„æ­£ç¡®ä¼ è¾“ã€‚</li>
<li>ç”µå®¹é™åˆ¶ï¼šI2Cæ€»çº¿ä¸Šçš„ç”µå®¹è´Ÿè½½åº”åœ¨è§„å®šèŒƒå›´å†…ã€‚è¿‡é«˜çš„ç”µå®¹è´Ÿè½½å¯èƒ½å¯¼è‡´ä¿¡å·æ³¢å½¢å˜å½¢å’Œä¼ è¾“é”™è¯¯ã€‚åœ¨è®¾è®¡ä¸­ï¼Œéœ€è¦æ ¹æ®I2Cæ ‡å‡†å’Œè®¾å¤‡è§„æ ¼è¡¨çš„è¦æ±‚ï¼Œæ§åˆ¶ç”µå®¹è´Ÿè½½å¹¶æ·»åŠ å¿…è¦çš„ç”µå®¹è¡¥å¿ã€‚</li>
<li>é€‚å½“çš„è½¯ä»¶å®ç°ï¼šç¼–å†™I2Cé€šä¿¡çš„è½¯ä»¶å®ç°æ—¶ï¼Œéœ€è¦ç¡®ä¿æ­£ç¡®åœ°æ“ä½œI2Cæ§åˆ¶å™¨å’Œè®¾å¤‡çš„å¯„å­˜å™¨ã€‚éµå¾ªI2Cé€šä¿¡çš„åè®®å’Œæµç¨‹ï¼Œæ­£ç¡®è®¾ç½®èµ·å§‹æ¡ä»¶ã€åœ°å€ã€è¯»å†™ä½å’Œæ•°æ®ä¼ è¾“ã€‚</li>
</ul>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>ä»è®¾å¤‡çš„è®¾å¤‡åœ°å€æ˜¯è‡ªå®šä¹‰çš„å—ï¼Ÿ</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒI2Cè®¾å¤‡çš„åœ°å€æ˜¯ç”±è®¾å¤‡åˆ¶é€ å•†æä¾›çš„ï¼Œå¹¶ç”±å¼€å‘äººå‘˜åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­è¿›è¡Œé…ç½®å’Œä½¿ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒI2Cè®¾å¤‡çš„åœ°å€æ˜¯ä¸€ä¸ª7ä½çš„å€¼ï¼Œæœ‰æ—¶ä¹Ÿå¯ä»¥æ˜¯10ä½ã€‚7ä½åœ°å€æ¨¡å¼ä¸‹ï¼Œåœ°å€èŒƒå›´æ˜¯ä»0x00åˆ°0x7Fï¼Œå…¶ä¸­ä¸€äº›åœ°å€æ˜¯ä¿ç•™åœ°å€æˆ–ç”¨äºç‰¹å®šç›®çš„çš„é¢„å®šä¹‰åœ°å€ã€‚</p>
</li>
<li><p>ä¸ºä»€ä¹ˆI2Cæ€»çº¿ä¸èƒ½å¤ªé•¿ï¼Ÿ</p>
<p>è¿‡é•¿çš„æ€»çº¿é•¿åº¦å¯èƒ½ä¼šå¼•èµ·ä¿¡å·å¤±çœŸã€æ—¶åºé—®é¢˜ä»¥åŠé€šä¿¡é”™è¯¯ã€‚è¿™æ˜¯ç”±äºI2Cæ€»çº¿ä½¿ç”¨çš„æ˜¯å¼€æ¼æ¶æ„å’Œç”µå®¹è´Ÿè½½çš„ç‰¹æ€§æ‰€å†³å®šçš„ã€‚</p>
<p>I2Cæ€»çº¿çš„é•¿åº¦é™åˆ¶æ˜¯ç”±æ€»çº¿çš„ç”µå®¹è´Ÿè½½å’Œé€šä¿¡é€Ÿç‡å†³å®šçš„ã€‚è¾ƒé•¿çš„æ€»çº¿é•¿åº¦ä¼šå¼•å…¥é¢å¤–çš„ç”µå®¹è´Ÿè½½ï¼Œè¿™ä¼šå¯¼è‡´ä¿¡å·çš„ä¸Šå‡å’Œä¸‹é™æ—¶é—´å˜æ…¢ï¼Œä»è€Œå½±å“ä¿¡å·çš„ç¨³å®šæ€§å’Œæ­£ç¡®ä¼ è¾“ã€‚æ­¤å¤–ï¼Œæ€»çº¿é•¿åº¦è¿‡é•¿ä¹Ÿä¼šå¢åŠ ä¿¡å·çš„ä¼ è¾“å»¶è¿Ÿï¼Œå¯¼è‡´æ—¶åºé—®é¢˜ã€‚</p>
<p>æ ¹æ®I2Cæ ‡å‡†è§„èŒƒï¼Œå¯¹äºæ ‡å‡†æ¨¡å¼ï¼ˆStandard Modeï¼‰çš„I2Cæ€»çº¿ï¼Œæ€»çº¿é•¿åº¦åº”åœ¨3-5ç±³èŒƒå›´å†…ã€‚å¯¹äºé«˜é€Ÿæ¨¡å¼ï¼ˆHigh-Speed Modeï¼‰çš„I2Cæ€»çº¿ï¼Œæ€»çº¿é•¿åº¦åˆ™æ›´çŸ­ï¼Œé€šå¸¸ä¸è¶…è¿‡1ç±³ã€‚</p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://d1.amobbs.com/bbs_upload782111/files_24/ourdev_522629.pdf">å‘¨ç«‹åŠŸI2Cæ€»çº¿è§„èŒƒ</a></li>
<li><a href="https://www.nxp.com/docs/en/user-guide/UM10204.pdf">I2C-bus specification and user manual</a></li>
<li><a href="https://www.analog.com/en/technical-articles/i2c-primer-what-is-i2c-part-1.html">I2C Primer: What is I2C? (Part 1)</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>protocol</category>
      </categories>
      <tags>
        <tag>I2C</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸­æ–­åŠå¼‚å¸¸åŸç†</title>
    <url>/2023/09/17/computerSystem/pattern/interrupt/</url>
    <content><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>åœ¨è®¡ç®—æœºä½“ç³»ç»“æ„ä½“ä¸­ï¼ŒCPUä¸å¤–è®¾çš„å·¥ä½œé€Ÿåº¦ä¸åŒ¹é…ä¸€ç›´æ˜¯å­˜åœ¨çš„æ€§èƒ½ç“¶é¢ˆç‚¹ï¼Œè€Œå¦‚ä½•ä½¿CPUä¸å¤–è®¾æ­£å¸¸çš„åè°ƒå·¥ä½œæˆä¸ºäº†é‡è¦é—®é¢˜ã€‚å½“ç„¶å­˜åœ¨åƒè½®è¯¢è¿™æ ·çš„è§£å†³åŠæ³•ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å»è¯¢é—®ä¸€æ¬¡ï¼Œä½†æ˜¯è¿™æ ·æ— ç–‘ä¼šé™ä½å¤„ç†æ•ˆç‡ã€‚ä¸­æ–­æ˜¾ç„¶æ˜¯æ›´æœ‰æ•ˆçš„è§£å†³åŠæ³•ã€‚</p>
<h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><p>ä¸­æ–­ï¼ˆInterruptï¼‰æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸è®¡ç®—æœºåœ¨æ‰§è¡Œå½“å‰ä»»åŠ¡çš„åŒæ—¶å“åº”å’Œå¤„ç†æ¥è‡ªå¤–éƒ¨è®¾å¤‡æˆ–å…¶ä»–æºçš„äº‹ä»¶ã€‚</p>
<h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><h3 id="æŒ‰ä¸­æ–­æ¥æº"><a href="#æŒ‰ä¸­æ–­æ¥æº" class="headerlink" title="æŒ‰ä¸­æ–­æ¥æº"></a>æŒ‰ä¸­æ–­æ¥æº</h3><ul>
<li><p>ç¡¬ä»¶ä¸­æ–­</p>
<p>ç¡¬ä»¶ä¸­æ–­æ˜¯ç”±è®¡ç®—æœºç¡¬ä»¶ç”Ÿæˆçš„ï¼Œé€šå¸¸æ˜¯å¤–éƒ¨è®¾å¤‡è¯·æ±‚ CPU å¤„ç†çš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œé”®ç›˜ã€é¼ æ ‡ã€å®šæ—¶å™¨ã€ç½‘ç»œé€‚é…å™¨ç­‰è®¾å¤‡å¯ä»¥è§¦å‘ç¡¬ä»¶ä¸­æ–­ã€‚é€šå¸¸é€šè¿‡ä¸­æ–­æ§åˆ¶å™¨ï¼ˆå¦‚ PIC æˆ– APICï¼‰è¿›è¡Œç®¡ç†å’Œåˆ†å‘ï¼Œç„¶åç”±æ“ä½œç³»ç»Ÿå¤„ç†ã€‚</p>
</li>
<li><p>è½¯ä»¶ä¸­æ–­</p>
<p>ä¹Ÿç§°ä¸ºå¼‚å¸¸æˆ–é™·é˜±ï¼Œæ˜¯ç”±è®¡ç®—æœºç¨‹åºç”Ÿæˆçš„ï¼Œé€šå¸¸è¡¨ç¤ºç¨‹åºæ‰§è¡ŒæœŸé—´çš„å¼‚å¸¸æƒ…å†µã€‚ä¾‹å¦‚ï¼Œé™¤é›¶é”™è¯¯ã€è¶Šç•Œè®¿é—®ç­‰æƒ…å†µå¯ä»¥è§¦å‘è½¯ä»¶ä¸­æ–­ã€‚é€šå¸¸ç”±ç¨‹åºæ‰§è¡ŒæŒ‡ä»¤ï¼ˆå¦‚ <code>int</code> æŒ‡ä»¤æˆ–ç³»ç»Ÿè°ƒç”¨ï¼‰æ¥è§¦å‘ï¼Œå¹¶ç”±æ“ä½œç³»ç»Ÿæˆ–ç¨‹åºæœ¬èº«è¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ul>
<h3 id="åŒæ­¥æ–¹å¼"><a href="#åŒæ­¥æ–¹å¼" class="headerlink" title="åŒæ­¥æ–¹å¼"></a>åŒæ­¥æ–¹å¼</h3><ul>
<li><p>åŒæ­¥ä¸­æ–­</p>
<p>è½¯ä»¶ä¸­æ–­é€šå¸¸æ˜¯åŒæ­¥ä¸­æ–­ã€‚åŒæ­¥ä¸­æ–­æ˜¯ä¸ç¨‹åºæ‰§è¡Œç›¸å…³çš„ã€å¯é¢„æµ‹çš„ä¸­æ–­ï¼Œé€šå¸¸ç”±ç¨‹åºä¸­çš„å¼‚å¸¸æƒ…å†µå¼•å‘ã€‚</p>
</li>
<li><p>å¼‚æ­¥ä¸­æ–­</p>
<p>ç¡¬ä»¶ä¸­æ–­é€šå¸¸æ˜¯å¼‚æ­¥ä¸­æ–­ã€‚å¼‚æ­¥ä¸­æ–­æ˜¯ä¸ç¨‹åºæ‰§è¡Œæ— å…³çš„ã€ä¸å¯é¢„æµ‹çš„ä¸­æ–­ï¼Œé€šå¸¸ç”±å¤–éƒ¨äº‹ä»¶æˆ–è®¾å¤‡è§¦å‘ã€‚</p>
</li>
</ul>
<h2 id="ä¸­æ–­ä¸å¼‚å¸¸åŒºåˆ«"><a href="#ä¸­æ–­ä¸å¼‚å¸¸åŒºåˆ«" class="headerlink" title="ä¸­æ–­ä¸å¼‚å¸¸åŒºåˆ«"></a>ä¸­æ–­ä¸å¼‚å¸¸åŒºåˆ«</h2><table>
<thead>
<tr>
<th></th>
<th>ä¸­æ–­</th>
<th>å¼‚å¸¸</th>
</tr>
</thead>
<tbody><tr>
<td>ä¾‹å­</td>
<td>æ•²å‡»é”®ç›˜ã€æ’å…¥usb</td>
<td>é™¤0ã€ç¼ºé¡µä¸­æ–­</td>
</tr>
<tr>
<td>æ¥æº</td>
<td>é€šå¸¸æ˜¯ç¡¬ä»¶</td>
<td>é€šå¸¸æ˜¯è½¯ä»¶ç”±äºç¼–ç¨‹å¤±è¯¯å¯¼è‡´</td>
</tr>
<tr>
<td>å¤„ç†</td>
<td>do_IRQ</td>
<td>ç»™è¿›ç¨‹å‘é€ä¿¡å·</td>
</tr>
<tr>
<td>ä½ç½®</td>
<td>æ ¹æ®æ¶æ„æœ‰æ‰€ä¸åŒï¼Œä½†æ¯ä¸€ç§å›ºå®š</td>
<td>å¯å±è”½ä¸­æ–­çš„ä¸­æ–­å‘é‡åˆ™æ˜¯å¯é…çš„</td>
</tr>
</tbody></table>
<h2 id="å¤„ç†æµç¨‹"><a href="#å¤„ç†æµç¨‹" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h2><ul>
<li>ä¸­æ–­è§¦å‘åŠæ£€æµ‹ã€‚æ»¡è¶³ä¸­æ–­è§¦å‘æ¡ä»¶ä¸­æ–­æ¥åˆ°ï¼Œå¹¶æ£€æµ‹æ˜¯å“ªç§åŸå› çš„ä¸­æ–­</li>
<li>ç°åœºä¿å­˜ã€‚ä¿å­˜å¯„å­˜å™¨çš„å€¼ï¼ˆä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼‰å¹¶å±è”½ä¸­æ–­ï¼Œç¡®ä¿ä¸­æ–­æ­£å¸¸æ‰§è¡Œå’Œæ¢å¤</li>
<li>è·³å…¥ä¸­æ–­å‘é‡è¡¨ã€‚æ ¹æ®åŸå› è¿›å…¥ä¸­æ–­å‘é‡è¡¨æŸ¥çœ‹å¯¹åº”çš„ä¸­æ–­å¤„ç†æµç¨‹</li>
<li>ä¸­æ–­å¤„ç†ç¨‹åº</li>
<li>æ¢å¤ç°åœºã€‚æ¸…æ¥šä¸­æ–­æ ‡å¿—ä½å¹¶æ¢å¤å¯„å­˜å™¨çš„å€¼</li>
</ul>
<h2 id="proc-x2F-interrupts"><a href="#proc-x2F-interrupts" class="headerlink" title="proc/interrupts"></a>proc/interrupts</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">cat /proc/interrupts</span><br></pre></td></tr></tbody></table></figure>

<p>procæ˜¯ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿå­˜åœ¨äºå†…æ ¸ä¸­ã€‚é€šè¿‡ä¸Šè¿°å‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿä¸­ä¸­æ–­å·ã€ä¸ªæ•°ã€åå­—ç­‰ç­‰å†…å®¹ã€‚è¿™ä¸ªæ˜¯å’Œä½“ç³»ç›¸å…³çš„ï¼Œshow_interruptsï¼ˆï¼‰å‡½æ•°å®ç°çš„ã€‚</p>
<h1 id="ä¸­æ–­æ§åˆ¶æ–¹æ³•"><a href="#ä¸­æ–­æ§åˆ¶æ–¹æ³•" class="headerlink" title="ä¸­æ–­æ§åˆ¶æ–¹æ³•"></a>ä¸­æ–­æ§åˆ¶æ–¹æ³•</h1><p><img src="/images/computerSystem/pattern/interrupt.png" alt="image"></p>
<h1 id="ä¸­æ–­ä¸Šä¸‹åŠéƒ¨"><a href="#ä¸­æ–­ä¸Šä¸‹åŠéƒ¨" class="headerlink" title="ä¸­æ–­ä¸Šä¸‹åŠéƒ¨"></a>ä¸­æ–­ä¸Šä¸‹åŠéƒ¨</h1><p>ä¸­æ–­çš„æ‰§è¡Œä¼šæ‰“æ–­ç³»ç»Ÿæ­£å¸¸çš„è¿è¡Œï¼Œå› æ­¤ä¸ºäº†æé«˜ç³»ç»Ÿçš„å“åº”åº¦å’Œæ•ˆç‡å°±éœ€è¦ä¸­æ–­ç¨‹åºçš„æ‰§è¡Œå°½å¯èƒ½è¦å¿«é€Ÿï¼Œä¸­æ–­æ¢å¤ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯å®é™…ä¸­æœ‰äº›ä¸­æ–­çš„å·¥ä½œå°±ä¼šå¯¼è‡´é˜»å¡ï¼Œå› æ­¤å¯ä»¥å°†è¿™éƒ¨åˆ†å†…å®¹ç­‰åˆ°ç³»ç»Ÿä¸å¿™çš„æ—¶å€™æ‰§è¡Œã€‚å› æ­¤å°†ä¸­æ–­å¤„ç†è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸ŠåŠéƒ¨ï¼ˆTop Halfï¼‰å’Œä¸‹åŠéƒ¨ï¼ˆBottom Halfï¼‰ã€‚</p>
<ul>
<li>ä¸ŠåŠéƒ¨ï¼šæ—¶é—´æ•æ„Ÿã€ç¡¬ä»¶ç›¸å…³ã€åŸå­æ‰§è¡Œä¸å¸Œæœ›è¢«å…¶å®ƒä¸­æ–­æ‰“æ–­</li>
<li>ä¸‹åŠéƒ¨ï¼šæ‰§è¡Œè€—æ—¶é•¿</li>
</ul>
<h2 id="ä¸‹åŠéƒ¨å®ç°æ–¹å¼"><a href="#ä¸‹åŠéƒ¨å®ç°æ–¹å¼" class="headerlink" title="ä¸‹åŠéƒ¨å®ç°æ–¹å¼"></a>ä¸‹åŠéƒ¨å®ç°æ–¹å¼</h2><ul>
<li>è½¯ä¸­æ–­ï¼ˆä¸­æ–­ä¸Šä¸‹æ–‡ã€‚é™æ€åˆ›å»ºï¼Œæ“ä½œå¤šå¤„ç†å™¨å˜é‡éœ€è¦æ³¨æ„ï¼‰</li>
<li>taskletï¼ˆä¸­æ–­ä¸Šä¸‹æ–‡ã€‚ä¸èƒ½å¹¶å‘æ‰§è¡Œï¼Œå¦‚æœä¸èƒ½ç¡®å®šæ˜¯å¦æ˜¯å¤šå¤„ç†å™¨ï¼Œé€‰æ‹©è¿™ä¸ªï¼‰</li>
<li>å·¥ä½œé˜Ÿåˆ—ï¼ˆè¿›ç¨‹ä¸Šä¸‹æ–‡ã€‚æ‰§è¡Œæ—¶é—´å¯ä»¥æ¨è¿Ÿåˆ°è¿›ç¨‹ä¸Šä¸‹æ–‡å®Œæˆï¼Œæ¨èï¼ï¼ï¼‰</li>
</ul>
<h2 id="å·¥ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ–¹å¼"><a href="#å·¥ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ–¹å¼"></a>å·¥ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ–¹å¼</h2><figure class="highlight d"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*å®šä¹‰å·¥ä½œé˜Ÿåˆ—å’Œå…³è”å‡½æ•°*/</span></span><br><span class="line"><span class="keyword">struct</span> work_struct my_wq;</span><br><span class="line"><span class="keyword">struct</span> work_struct my_delay_wq;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä¸­æ–­å¤„ç†åº•åŠéƒ¨*/</span></span><br><span class="line"><span class="keyword">void</span> xxx_do_work(unsigned <span class="built_in">long</span>)</span><br><span class="line">{</span><br><span class="line">}</span><br><span class="line"><span class="keyword">void</span> xxx_do_delay_work(unsigned <span class="built_in">long</span>)</span><br><span class="line">{</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä¸­æ–­å¤„ç†é¡¶åŠéƒ¨*/</span></span><br><span class="line">irqreturn_t xxx_interrupt(<span class="keyword">int</span> irq,<span class="keyword">void</span> *dev_id)</span><br><span class="line">{</span><br><span class="line">schedule_work(&amp;my_wq);</span><br><span class="line">schedule_delay_work(&amp;my_delay_wq);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è®¾å¤‡é©±åŠ¨æ¨¡å—åŠ è½½å‡½æ•°*/</span></span><br><span class="line"><span class="keyword">int</span> xxx_init(<span class="keyword">void</span>)</span><br><span class="line">{</span><br><span class="line">request = request_irq(xxx_wq,xxx_interrupt,IRQF_DISABLED,<span class="string">"XXX"</span>,NULL);</span><br><span class="line">...</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å·¥ä½œé˜Ÿåˆ—(å¯ä»¥æ˜¯ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—ï¼ŒæŒ‡å®šæ—¶é—´)</span></span><br><span class="line">INIT_WORK(&amp;my_wq,(<span class="keyword">void</span>(*)(<span class="keyword">void</span> *))xxx_do_work,NULL)</span><br><span class="line">INIT_DELAYED_WORK(&amp;my_delay_wq,(<span class="keyword">void</span>(*)(<span class="keyword">void</span> *))xxx_do_delay_work,NULL)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è®¾å¤‡é©±åŠ¨æ¨¡å—å¸è½½å‡½æ•°*/</span></span><br><span class="line"><span class="keyword">void</span> xxx_exit(<span class="keyword">void</span>)</span><br><span class="line">{</span><br><span class="line"><span class="comment">//é‡Šæ”¾ä¸­æ–­</span></span><br><span class="line">free_irq(xxx_irq,xxx_interrupt);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="ä¸­æ–­æè¿°ç¬¦"><a href="#ä¸­æ–­æè¿°ç¬¦" class="headerlink" title="ä¸­æ–­æè¿°ç¬¦"></a>ä¸­æ–­æè¿°ç¬¦</h1><p>Linuxä¸­æ–­æœºåˆ¶çš„æ ¸å¿ƒæ•°æ®ç»“æ„ irq_descï¼Œ å®ƒå®Œæ•´åœ°æè¿°äº†ä¸€æ¡ä¸­æ–­çº¿ ï¼ˆæˆ–å¯ç®€å•ç†è§£ä¸º â€œä¸€ä¸ªä¸­æ–­æºâ€ ï¼‰</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">irq_desc</span> {</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">irq_common_data</span>  <span class="title">irq_common_data</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">irq_data</span>     <span class="title">irq_data</span>;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> __percpu   *kstat_irqs;</span><br><span class="line">    <span class="type">irq_flow_handler_t</span>  handle_irq;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_IRQ_PREFLOW_FASTEOI</span></span><br><span class="line">    <span class="type">irq_preflow_handler_t</span>   preflow_handler;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">irqaction</span>    *<span class="title">action</span>;</span>    <span class="comment">/* IRQ action list */</span><span class="comment">//è¯¥ä¸­æ–­çº¿çš„ä¸­æ–­æœåŠ¡ç¨‹åº</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        status_use_accessors;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        core_internal_state__do_not_mess_with_it;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        depth;      <span class="comment">/* nested irq disables */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        wake_depth; <span class="comment">/* nested wake enables */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        irq_count;  <span class="comment">/* For detecting broken IRQs */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span>       last_unhandled; <span class="comment">/* Aging timer for unhandled count */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        irqs_unhandled;</span><br><span class="line">    <span class="type">atomic_t</span>        threads_handled;</span><br><span class="line">    <span class="type">int</span>         threads_handled_last;</span><br><span class="line">    <span class="type">raw_spinlock_t</span>      lock;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">cpumask</span>      *<span class="title">percpu_enabled</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">    <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cpumask</span>    *<span class="title">affinity_hint</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">irq_affinity_notify</span> *<span class="title">affinity_notify</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_GENERIC_PENDING_IRQ</span></span><br><span class="line">    <span class="type">cpumask_var_t</span>       pending_mask;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span>       threads_oneshot;</span><br><span class="line">    <span class="type">atomic_t</span>        threads_active;</span><br><span class="line">    <span class="type">wait_queue_head_t</span>       wait_for_threads;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_PM_SLEEP</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        nr_actions;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        no_suspend_depth;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        cond_suspend_depth;                                                                                                                                               </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>        force_resume_depth;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_PROC_FS</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">proc_dir_entry</span>   *<span class="title">dir</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="type">int</span>         parent_irq;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">module</span>       *<span class="title">owner</span>;</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>      *name;</span><br><span class="line">} ____cacheline_internodealigned_in_smp;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h1 id="ä¸­æ–­åˆå§‹åŒ–æµç¨‹"><a href="#ä¸­æ–­åˆå§‹åŒ–æµç¨‹" class="headerlink" title="ä¸­æ–­åˆå§‹åŒ–æµç¨‹"></a>ä¸­æ–­åˆå§‹åŒ–æµç¨‹</h1><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// kernel/init/main.c (version-4.4.94)</span></span><br><span class="line">asmlinkage __visible <span class="type">void</span> __init <span class="title function_">start_kernel</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    local_irq_disable();</span><br><span class="line">    early_boot_irqs_disabled = <span class="literal">true</span>;</span><br><span class="line">    ...</span><br><span class="line"> 	trap_init();</span><br><span class="line">	<span class="comment">/* init some links before init_ISA_irqs() */</span></span><br><span class="line">    early_irq_init();</span><br><span class="line">    init_IRQ();</span><br><span class="line">	...</span><br><span class="line">    WARN(!irqs_disabled(), <span class="string">"Interrupts were enabled early\n"</span>);</span><br><span class="line">    early_boot_irqs_disabled = <span class="literal">false</span>;</span><br><span class="line">    local_irq_enable();		<span class="comment">// å¼€å¯æœ¬åœ°ä¸­æ–­</span></span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="trap-init"><a href="#trap-init" class="headerlink" title="trap_init"></a>trap_init</h2><p>ä¸­æ–­åˆå§‹åŒ–å‡½æ•°å…¥å£ <code>trap_init()</code>ï¼Œä¸åŒä½“ç³»ç»“æ„ä¸‹çš„å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å®Œæˆçš„åŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼Œå®Œæˆå¡«å†™IDTæè¿°ç¬¦æ„æˆä¸­æ–­å‘é‡è¡¨çš„åŠŸèƒ½ã€‚</p>
<h3 id="MIPSä¸­æ–­å¼‚å¸¸ç±»å‹"><a href="#MIPSä¸­æ–­å¼‚å¸¸ç±»å‹" class="headerlink" title="MIPSä¸­æ–­å¼‚å¸¸ç±»å‹"></a>MIPSä¸­æ–­å¼‚å¸¸ç±»å‹</h3><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">///arch/mips/include/asm/mipsregs.h</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Cause.ExcCode trap codes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_INT			0	<span class="comment">/* Interrupt pending */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_MOD			1	<span class="comment">/* TLB modified fault */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_TLBL		2	<span class="comment">/* TLB miss on load or ifetch */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_TLBS		3	<span class="comment">/* TLB miss on a store */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_ADEL		4	<span class="comment">/* Address error on a load or ifetch */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_ADES		5	<span class="comment">/* Address error on a store */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_IBE			6	<span class="comment">/* Bus error on an ifetch */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_DBE			7	<span class="comment">/* Bus error on a load or store */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_SYS			8	<span class="comment">/* System call */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_BP			9	<span class="comment">/* Breakpoint */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_RI			10	<span class="comment">/* Reserved instruction exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_CPU			11	<span class="comment">/* Coprocessor unusable */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_OV			12	<span class="comment">/* Arithmetic overflow */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_TR			13	<span class="comment">/* Trap instruction */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_MSAFPE		14	<span class="comment">/* MSA floating point exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_FPE			15	<span class="comment">/* Floating point exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_TLBRI		19	<span class="comment">/* TLB Read-Inhibit exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_TLBXI		20	<span class="comment">/* TLB Execution-Inhibit exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_MSADIS		21	<span class="comment">/* MSA disabled exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_MDMX		22	<span class="comment">/* MDMX unusable exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_WATCH		23	<span class="comment">/* Watch address reference */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_MCHECK		24	<span class="comment">/* Machine check */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_THREAD		25	<span class="comment">/* Thread exceptions (MT) */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_DSPDIS		26	<span class="comment">/* DSP disabled exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_GE			27	<span class="comment">/* Virtualized guest exception (VZ) */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXCCODE_CACHEERR	30	<span class="comment">/* Parity/ECC occured on a core */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Implementation specific trap codes used by MIPS cores */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIPS_EXCCODE_TLBPAR	16	<span class="comment">/* TLB parity error exception */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Implementation specific trap codes used by Loongson cores */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOONGSON_EXCCODE_GSEXC	16	<span class="comment">/* Loongson-specific exception */</span></span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="x86ä¸­æ–­å¼‚å¸¸ç±»å‹"><a href="#x86ä¸­æ–­å¼‚å¸¸ç±»å‹" class="headerlink" title="x86ä¸­æ–­å¼‚å¸¸ç±»å‹"></a>x86ä¸­æ–­å¼‚å¸¸ç±»å‹</h3><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// /arch/x86/include/asm/trapnr.h</span></span><br><span class="line"><span class="comment">/* Interrupts/Exceptions */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_DE		 0	<span class="comment">/* Divide-by-zero */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_DB		 1	<span class="comment">/* Debug */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_NMI	 2	<span class="comment">/* Non-maskable Interrupt */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_BP		 3	<span class="comment">/* Breakpoint */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_OF		 4	<span class="comment">/* Overflow */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_BR		 5	<span class="comment">/* Bound Range Exceeded */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_UD		 6	<span class="comment">/* Invalid Opcode */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_NM		 7	<span class="comment">/* Device Not Available */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_DF		 8	<span class="comment">/* Double Fault */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_OLD_MF	 9	<span class="comment">/* Coprocessor Segment Overrun */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_TS		10	<span class="comment">/* Invalid TSS */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_NP		11	<span class="comment">/* Segment Not Present */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_SS		12	<span class="comment">/* Stack Segment Fault */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_GP		13	<span class="comment">/* General Protection Fault */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_PF		14	<span class="comment">/* Page Fault */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_SPURIOUS	15	<span class="comment">/* Spurious Interrupt */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_MF		16	<span class="comment">/* x87 Floating-Point Exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_AC		17	<span class="comment">/* Alignment Check */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_MC		18	<span class="comment">/* Machine Check */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_XF		19	<span class="comment">/* SIMD Floating-Point Exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_VE		20	<span class="comment">/* Virtualization Exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_CP		21	<span class="comment">/* Control Protection Exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_VC		29	<span class="comment">/* VMM Communication Exception */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X86_TRAP_IRET	32	<span class="comment">/* IRET Exception */</span></span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="ARMä¸­æ–­å¼‚å¸¸ç±»å‹"><a href="#ARMä¸­æ–­å¼‚å¸¸ç±»å‹" class="headerlink" title="ARMä¸­æ–­å¼‚å¸¸ç±»å‹"></a>ARMä¸­æ–­å¼‚å¸¸ç±»å‹</h3><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// ./arch/arm/kernel/entry-armv.S</span></span><br><span class="line">__vectors_start:</span><br><span class="line">    W(b)    vector_rst						<span class="comment">// å¤ä½å¼‚å¸¸</span></span><br><span class="line">    W(b)    vector_und						<span class="comment">// æœªå®šä¹‰æŒ‡ä»¤å¼‚å¸¸</span></span><br><span class="line">    W(ldr)  pc, __vectors_start + <span class="number">0x1000</span>	<span class="comment">// è½¯ä»¶ä¸­æ–­</span></span><br><span class="line">    W(b)    vector_pabt						<span class="comment">// ä¸­æ­¢ï¼ˆé¢„å–ï¼‰</span></span><br><span class="line">    W(b)    vector_dabt						<span class="comment">// ä¸­æ­¢ï¼ˆæ•°æ®ï¼‰</span></span><br><span class="line">    W(b)    vector_addrexcptn				<span class="comment">// ä¿ç•™</span></span><br><span class="line">    W(b)    vector_irq						<span class="comment">// ä¸€èˆ¬ä¸­æ–­è¯·æ±‚</span></span><br><span class="line">    W(b)    vector_fiq     					<span class="comment">// å¿«é€Ÿä¸­æ–­è¯·æ±‚</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="MIPSå®ç°è¿‡ç¨‹"><a href="#MIPSå®ç°è¿‡ç¨‹" class="headerlink" title="MIPSå®ç°è¿‡ç¨‹"></a>MIPSå®ç°è¿‡ç¨‹</h3><p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºå³ä¸ºmipså¯¹äºtrap_initå‡½æ•°çš„å®ç°ï¼ˆåªä¿ç•™å…³é”®ä»£ç ï¼‰ã€‚å…¶ä¸»è¦ä½œç”¨æ˜¯åˆ¤æ–­å¯„å­˜å™¨æˆ–è€…ç³»ç»Ÿç›¸å…³å˜é‡çš„å€¼æ¥è®¾ç½®ä¸­æ–­å‘é‡è¡¨ï¼Œè€Œä¸­æ–­å‘é‡è¡¨æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå…¶åœ¨genex.Sæ±‡ç¼–ä¸­è¿›è¡Œäº†å¼•ç”¨ã€‚è€Œåœ¨æ±‡ç¼–ä¸­ï¼Œé€šè¿‡æŒ‡ä»¤mfc0æŠŠæ§åˆ¶å¯„å­˜å™¨CP0_CAUSEå€¼æ‹·è´åˆ°é€šç”¨å¯„å­˜å™¨k1ã€‚CP0_CAUSEä¿å­˜äº†è¿™æ¬¡ä¸­æ–­å‘ç”Ÿçš„åŸå› ã€‚ç”¨andiæŒ‡ä»¤æŠŠk1çš„å€¼åŠ ä¸Š0x7cï¼Œç„¶åç”¨æŒ‡ä»¤ldåŠ è½½å…·ä½“ä¸€ä¸ªä¸­æ–­å¤„ç†ç¨‹åºçš„å…¥å£åœ°å€exception_handlers(k1)ã€‚exception_handlerså°±æ˜¯æˆ‘ä»¬è®°å½•çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼Œæ ¹æ®k1çš„å€¼æ‰¾åˆ°å½“å‰ç³»ç»Ÿéœ€è¦æ‰§è¡Œå“ªä¸ªä¸­æ–­å¤„ç†ç¨‹åºã€‚ç„¶åä½¿ç”¨æŒ‡ä»¤jrè·³è½¬åˆ°è¿™ä¸ªä¸­æ–­å¤„ç†ç¨‹åºã€‚</p>
<p>k0å’Œk1æ˜¯ä¸ºMIPSç³»ç»Ÿæ‰€ä¿ç•™ï¼Œä¸“é—¨ä¿ç•™ç»™ç³»ç»Ÿå‘ç”Ÿä¸­æ–­æ—¶ç¨‹åºä½¿ç”¨çš„å¯„å­˜å™¨ã€‚è¿™é‡Œçš„â€kâ€ä»£è¡¨keepã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// kernel/arch/mips/kernel/traps.c</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> exception_handlers[<span class="number">32</span>];</span><br><span class="line"><span class="type">void</span> __init *<span class="title function_">set_except_vector</span><span class="params">(<span class="type">int</span> n, <span class="type">void</span> *addr)</span></span><br><span class="line">{</span><br><span class="line">    ...</span><br><span class="line">    old_handler = xchg(&amp;exception_handlers[n], handler);</span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line"><span class="type">void</span> __init <span class="title function_">trap_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// æŠŠexcept_vec3_genericå‡½æ•°æŒ‡é’ˆæ”¾åœ¨åœ°å€ä¸º KSEG0 ï¼‹ 0x180 å¤„ï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯ä¸­æ–­å¼‚å¸¸çš„å…¥å£åœ°å€ã€‚</span></span><br><span class="line">    set_handler(<span class="number">0x180</span>, &amp;except_vec3_generic, <span class="number">0x80</span>);</span><br><span class="line">    ...</span><br><span class="line">    set_except_vector(<span class="number">0</span>, using_rollback_handler() ? rollback_handle_int: handle_int);</span><br><span class="line">    set_except_vector(<span class="number">1</span>, handle_tlbm);</span><br><span class="line">    set_except_vector(<span class="number">2</span>, handle_tlbl);</span><br><span class="line">    set_except_vector(<span class="number">3</span>, handle_tlbs);</span><br><span class="line">    set_except_vector(<span class="number">4</span>, handle_adel);</span><br><span class="line">    set_except_vector(<span class="number">5</span>, handle_ades);                                  </span><br><span class="line">    set_except_vector(<span class="number">6</span>, handle_ibe);</span><br><span class="line">    set_except_vector(<span class="number">7</span>, handle_dbe);</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// kernel/arch/mips/kernel/genex.S</span></span><br><span class="line">NESTED(except_vec3_generic, <span class="number">0</span>, sp) </span><br><span class="line">    .<span class="built_in">set</span>    push</span><br><span class="line">    .<span class="built_in">set</span>    noat</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> R5432_CP0_INTERRUPT_WAR</span></span><br><span class="line">    mfc0    k0, CP0_INDEX</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    mfc0    k1, CP0_CAUSE</span><br><span class="line">    andi    k1, k1, <span class="number">0x7c</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_64BIT</span></span><br><span class="line">    dsll    k1, k1, <span class="number">1</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    ld   k0, exception_handlers(k1)</span><br><span class="line">    jr  k0  </span><br><span class="line">    .<span class="built_in">set</span>    pop</span><br><span class="line">    <span class="title function_">END</span><span class="params">(except_vec3_generic)</span>      </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment">// handle_int</span></span><br><span class="line">BUILD_ROLLBACK_PROLOGUE handle_int</span><br><span class="line"><span class="title function_">NESTED</span><span class="params">(handle_int, PT_SIZE, sp)</span> </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_TRACE_IRQFLAGS</span></span><br><span class="line">    <span class="comment">/*  </span></span><br><span class="line"><span class="comment">    â”†* Check to see if the interrupted code has just disabled</span></span><br><span class="line"><span class="comment">    â”†* interrupts and ignore this interrupt for now if so.                                                                                                                                </span></span><br><span class="line"><span class="comment">    â”†*</span></span><br><span class="line"><span class="comment">    â”†* local_irq_disable() disables interrupts and then calls</span></span><br><span class="line"><span class="comment">    â”†* trace_hardirqs_off() to track the state. If an interrupt is taken</span></span><br><span class="line"><span class="comment">    â”†* after interrupts are disabled but before the state is updated</span></span><br><span class="line"><span class="comment">    â”†* it will appear to restore_all that it is incorrectly returning with</span></span><br><span class="line"><span class="comment">    â”†* interrupts disabled</span></span><br><span class="line"><span class="comment">    â”†*/</span></span><br><span class="line">    .<span class="built_in">set</span>    push</span><br><span class="line">    .<span class="built_in">set</span>    noat</span><br><span class="line">	...</span><br><span class="line">    # Check <span class="keyword">if</span> already on IRQ <span class="built_in">stack</span></span><br><span class="line">    PTR_LI  t1, ~<span class="params">(_THREAD_SIZE<span class="number">-1</span>)</span></span><br><span class="line">    and t1, t1, sp</span><br><span class="line">    beq t0, t1, 2f</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Switch to IRQ stack */</span></span><br><span class="line">    li  t1, _IRQ_STACK_START</span><br><span class="line">    PTR_ADD sp, t0, t1</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Save task's sp on IRQ stack so that unwinding can follow it */</span></span><br><span class="line">    LONG_S  s1, 0<span class="params">(sp)</span></span><br><span class="line">2:</span><br><span class="line">    jal plat_irq_dispatch</span><br><span class="line">    <span class="comment">/* Restore sp */</span></span><br><span class="line">    move    sp, s1</span><br><span class="line"></span><br><span class="line">    j   ret_from_irq</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_CPU_MICROMIPS</span></span><br><span class="line">    nop</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="title function_">END</span><span class="params">(handle_int)</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="early-irq-init"><a href="#early-irq-init" class="headerlink" title="early_irq_init"></a>early_irq_init</h2><p>early_irq_initå±äºä¸ç¡¬ä»¶å’Œå¹³å°æ— å…³çš„é€šç”¨é€»è¾‘å±‚ï¼Œä¸ºirq_desc[]ä¸­ä¸ªå…ƒç´ çš„æŸäº›æˆå‘˜å¡«å……é»˜è®¤å€¼ã€‚</p>
<p>å®Œæˆåè°ƒç”¨ä½“ç³»ç›¸å…³çš„arch_early_irq_initå‡½æ•°å®Œæˆè¿›ä¸€æ­¥çš„åˆå§‹åŒ–å·¥ä½œï¼Œä¸è¿‡ARM / MIPSä½“ç³»æ²¡æœ‰å®ç°è¯¥å‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// kernel/irq/irqdesc.c</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">irq_desc</span> <span class="title">irq_desc</span>[<span class="title">NR_IRQS</span>] __<span class="title">cacheline_aligned_in_smp</span> =</span> {</span><br><span class="line">    [<span class="number">0</span> ... NR_IRQS<span class="number">-1</span>] = { </span><br><span class="line">        .handle_irq = handle_bad_irq,</span><br><span class="line">        .depth      = <span class="number">1</span>,</span><br><span class="line">        .lock       = __RAW_SPIN_LOCK_UNLOCKED(irq_desc-&gt;lock),</span><br><span class="line">    }   </span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __init <span class="title function_">early_irq_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> count, i, node = first_online_node;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">irq_desc</span> *<span class="title">desc</span>;</span></span><br><span class="line">    init_irq_default_affinity();</span><br><span class="line"></span><br><span class="line">    printk(KERN_INFO <span class="string">"NR_IRQS:%d\n"</span>, NR_IRQS);</span><br><span class="line"></span><br><span class="line">    desc = irq_desc;</span><br><span class="line">    count = ARRAY_SIZE(irq_desc);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; count; i++) {</span><br><span class="line">        desc[i].kstat_irqs = alloc_percpu(<span class="type">unsigned</span> <span class="type">int</span>);</span><br><span class="line">        alloc_masks(&amp;desc[i], GFP_KERNEL, node);</span><br><span class="line">        raw_spin_lock_init(&amp;desc[i].lock);</span><br><span class="line">        lockdep_set_class(&amp;desc[i].lock, &amp;irq_desc_lock_class);</span><br><span class="line">        desc_set_defaults(i, &amp;desc[i], node, <span class="literal">NULL</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> arch_early_irq_init();</span><br><span class="line">}   </span><br></pre></td></tr></tbody></table></figure>

<h2 id="init-IRQ"><a href="#init-IRQ" class="headerlink" title="init_IRQ"></a>init_IRQ</h2><p>åˆå§‹åŒ–ä¸åŒSOCçš„ä¸­æ–­å¤„ç†å™¨ç­‰æ“ä½œ</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">void</span> __init <span class="title function_">init_IRQ</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NR_IRQS; i++)</span><br><span class="line">        irq_set_noprobe(i);</span><br><span class="line"></span><br><span class="line">    arch_init_irq();		<span class="comment">// è°ƒç”¨ä¸åŒå‚å®¶åŸºäºMIPSæ¶æ„å®ç°çš„ä¸­æ–­åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    for_each_possible_cpu(i) {</span><br><span class="line">        <span class="type">int</span> irq_pages = IRQ_STACK_SIZE / PAGE_SIZE;</span><br><span class="line">        <span class="type">void</span> *s = (<span class="type">void</span> *)__get_free_pages(GFP_KERNEL, irq_pages);</span><br><span class="line"></span><br><span class="line">        irq_stack[i] = s;</span><br><span class="line">        pr_debug(<span class="string">"CPU%d IRQ stack at 0x%p - 0x%p\n"</span>, i,</span><br><span class="line">            irq_stack[i], irq_stack[i] + IRQ_STACK_SIZE);</span><br><span class="line">    }   </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://zhuanlan.zhihu.com/p/336641609">ä»0å¼€å§‹å­¦ARM-å¼‚å¸¸åŠä¸­æ–­å¤„ç†ã€å¼‚å¸¸å‘é‡è¡¨ã€swi</a></li>
<li><a href="https://ty-chen.github.io/linux-kernel-interrupt/">Linuxæ“ä½œç³»ç»Ÿå­¦ä¹ ç¬”è®°ï¼ˆåäº”ï¼‰ä¸­æ–­</a></li>
<li><a href="https://blog.csdn.net/lqx4_3/article/details/6373081">ç§»æ¤linuxå†…æ ¸å¹³å°ç›¸å…³ä¹‹ ä¸­æ–­</a></li>
<li>Linuxå†…æ ¸è®¾è®¡ä¸å®ç°ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰</li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>pattern</category>
      </categories>
      <tags>
        <tag>ä¸­æ–­æœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>IIS</title>
    <url>/2023/04/05/computerSystem/protocol/IIS/</url>
    <content><![CDATA[<p>ADCå°†æ¨¡æ‹Ÿä¿¡å·è½¬æ¢ä¸ºæ•°å­—ä¿¡å·ï¼Œè€Œæ•°å­—ä¿¡å·çš„éŸ³é¢‘æ•°æ®åˆ™æ˜¯æŒ‰ç…§ä¸€å®šæ ‡å‡†ï¼ˆç¡¬ä»¶ä¼ è¾“åè®®ï¼‰ä¼ å…¥SOCä¸­è¿›è¡Œå¤„ç†ï¼›åŒç†DACå°†æ•°å­—ä¿¡å·è½¬æ¢ä¸ºæ¨¡æ‹Ÿä¿¡å·ï¼Œæ¨¡æ‹Ÿä¿¡å·çš„éŸ³é¢‘æ•°æ®ä¹Ÿæ˜¯æŒ‰ç…§åŒæ ·çš„æ ‡å‡†å°†æ•°æ®ä¼ è¾“åˆ°å–‡å­è¿›è¡Œå£°éŸ³çš„æ’­æ”¾</p>
<h1 id="æ•°å­—éŸ³é¢‘ä¿¡å·ä¼ è¾“æ ‡å‡†"><a href="#æ•°å­—éŸ³é¢‘ä¿¡å·ä¼ è¾“æ ‡å‡†" class="headerlink" title="æ•°å­—éŸ³é¢‘ä¿¡å·ä¼ è¾“æ ‡å‡†"></a>æ•°å­—éŸ³é¢‘ä¿¡å·ä¼ è¾“æ ‡å‡†</h1><h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h2><p>æ•°å­—éŸ³é¢‘ä¿¡å·ä¼ è¾“æ ‡å‡†ä¹Ÿå¯ä»¥ç§°ä½œéŸ³é¢‘ç¡¬ä»¶ä¼ è¾“åè®®ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>I2Sï¼šIntegrated Interchip Soundï¼Œé›†æˆç”µè·¯å†…éƒ¨éŸ³é¢‘</li>
<li>PCMï¼šPulse Code Modulationï¼Œè„‰å†²ç¼–ç è°ƒåˆ¶</li>
<li>PDMï¼šPulse Density Modulationï¼Œè„‰å†²å¯†åº¦è°ƒåˆ¶</li>
<li>S/PDIFï¼šSony/Philips Digital Interfaceï¼Œç´¢å°¼/é£åˆ©æµ¦æ•°å­—æ¥å£</li>
</ul>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p>PCMï¼šå•å£°é“ï¼Œæ—¶å»¶å°ã€‚æ‰“ç”µè¯ä¹‹é—´çš„æ•°æ®ï¼›</p>
<p>I2Sï¼šåŒå£°é“ï¼Œé€Ÿåº¦å¿«ã€‚ä¸»è¦ç”¨äºä¼ è¾“éŸ³ä¹ï¼›</p>
<p>PDMï¼šå°ºå¯¸å—é™çš„åœºæ™¯ã€‚æ‰‹æœºcpuåˆ°è“ç‰™çš„é€šè¯å®æ—¶éŸ³é¢‘ï¼›</p>
<p>S/PDIFï¼šç”¨äºæ¿é—´é•¿è·ç¦»åŠéœ€è¦ç”µç¼†è¿æ¥çš„åœºåˆ</p>
<h1 id="I2SåŸºç¡€"><a href="#I2SåŸºç¡€" class="headerlink" title="I2SåŸºç¡€"></a>I2SåŸºç¡€</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>I2S(Inter-IC Sound)æ€»çº¿,  åˆç§°é›†æˆç”µè·¯å†…ç½®éŸ³é¢‘æ€»çº¿ï¼Œæ˜¯é£åˆ©æµ¦åŠå¯¼ä½“å…¬å¸(ç°ä¸ºæ©æ™ºæµ¦åŠå¯¼ä½“å…¬å¸)é’ˆå¯¹æ•°å­—éŸ³é¢‘è®¾å¤‡ä¹‹é—´çš„éŸ³é¢‘æ•°æ®ä¼ è¾“è€Œåˆ¶å®šçš„ä¸€ç§æ€»çº¿æ ‡å‡†ã€‚</p>
<p>è¯¥æ€»çº¿ä¸“é—¨ç”¨äºéŸ³é¢‘è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œå¹¿æ³›åº”ç”¨äºå„ç§å¤šåª’ä½“ç³»ç»Ÿã€‚</p>
<p>å®ƒé‡‡ç”¨äº†ç‹¬ç«‹çš„å¯¼çº¿ä¼ è¾“æ—¶é’Ÿä¸æ•°æ®ä¿¡å·çš„è®¾è®¡ï¼Œé€šè¿‡å°†æ•°æ®å’Œæ—¶é’Ÿä¿¡å·åˆ†ç¦»ï¼Œé¿å…äº†å› æ—¶å·®è¯±å‘çš„å¤±çœŸï¼Œä¸ºç”¨æˆ·èŠ‚çœäº†è´­ä¹°æŠµæŠ—éŸ³é¢‘æŠ–åŠ¨çš„ä¸“ä¸šè®¾å¤‡çš„è´¹ç”¨ã€‚</p>
<h2 id="ä¿¡å·å®šä¹‰"><a href="#ä¿¡å·å®šä¹‰" class="headerlink" title="ä¿¡å·å®šä¹‰"></a>ä¿¡å·å®šä¹‰</h2><h3 id="WS"><a href="#WS" class="headerlink" title="WS"></a>WS</h3><p>WSï¼šWord Selectï¼Œå·¦å³å£°é“é€‰æ‹©ä¿¡å·ï¼ˆä¹Ÿç§°å¸§æ—¶é’Ÿ Left Right Clockï¼‰</p>
<p>æ ‡å‡†I2Så®šä¹‰ï¼šWS=0ï¼Œè¡¨ç¤ºæ­£åœ¨ä¼ è¾“å·¦å£°é“çš„æ•°æ®ï¼›WS=1ï¼Œè¡¨ç¤ºæ­£åœ¨ä¼ è¾“å³å£°é“çš„æ•°æ®ã€‚</p>
<h3 id="SCK"><a href="#SCK" class="headerlink" title="SCK"></a>SCK</h3><p>SCKï¼šSerial Clockï¼Œä¸²è¡Œæ—¶é’Ÿä¿¡å·ï¼ˆä¹Ÿç§°ä½æ—¶é’ŸBit Clockï¼‰</p>
<p>SCKæ˜¯æ¨¡å—å†…çš„åŒæ­¥ä¿¡å·ï¼Œä»æ¨¡å¼æ—¶ç”±å¤–éƒ¨æä¾›ï¼Œä¸»æ¨¡å¼æ—¶ç”±æ¨¡å—å†…éƒ¨è‡ªå·±äº§ç”Ÿã€‚å¯¹åº”æ•°å­—éŸ³é¢‘çš„æ¯ä¸€ä½æ•°æ®ï¼ŒSCKéƒ½æœ‰ä¸€ä¸ªè„‰å†²ã€‚</p>
<h3 id="SD"><a href="#SD" class="headerlink" title="SD"></a>SD</h3><p>SDï¼šSerial Dataï¼Œä¸²è¡Œæ•°æ®ä¿¡å·ï¼ˆåˆ†æ—¶å¤ç”¨ï¼‰</p>
<p>SDä»¥äºŒè¿›åˆ¶è¡¥ç å½¢å¼åœ¨æ•°æ®çº¿ä¸Šä¼ è¾“ï¼Œå¹¶ä¸”æŒ‰ç…§ç”±é«˜ä½(MSB)åˆ°ä½ä½(LSB)ä¾æ¬¡è¿›è¡Œä¼ è¾“ã€‚ä¹‹æ‰€ä»¥è¿™æ ·è®¾è®¡æ˜¯ä¸ºäº†ä¿è¯é‡è¦çš„æ•°æ®èƒ½å¤Ÿä¿å­˜ä¸‹æ¥ã€‚å› ä¸ºå‘é€è®¾å¤‡å’Œæ¥æ”¶è®¾å¤‡çš„å­—é•¿å¯èƒ½ä¸ä¸€æ ·ï¼Œå¦‚æœæ¥æ”¶è®¾å¤‡æ¥å—çš„å­—é•¿æ¯”è§„å®šçš„å­—é•¿é•¿çš„è¯å°±ä¼šäº§ç”Ÿæˆªæ–­ï¼Œå°†è¶…å‡ºå­—é•¿éƒ¨åˆ†å¿½ç•¥ï¼Œç›¸åå¦‚æœæ¥æ”¶è®¾å¤‡æ¥æ”¶çš„å­—é•¿æ¯”è§„å®šå­—é•¿çŸ­å°±ä¼šå°†ç©ºä½è¡¥0ã€‚è¿™æ ·ç¡®ä¿äº†æœ€é«˜æœ‰æ•ˆä½èƒ½å¤Ÿä¼ è¾“ã€‚</p>
<ul>
<li>LSBï¼šLeast Significant Bitï¼Œæœ€ä½æœ‰æ•ˆä½</li>
<li>MSBï¼šMost Significant Bitï¼Œæœ€é«˜æœ‰æ•ˆä½</li>
</ul>
<blockquote>
<p>å‘é€å™¨å¯ä»¥åœ¨æ—¶é’Ÿè„‰å†²çš„å‰æ²¿æˆ–åæ²¿å‘é€æ•°æ®,ï¼Œè¿™å¯ä»¥åœ¨ç›¸åº”çš„æ§åˆ¶å¯„å­˜å™¨ä¸­é…ç½®ã€‚ä½†æ˜¯æ¥æ”¶å™¨ä»…åœ¨æ—¶é’Ÿè„‰å†²çš„å‰æ²¿é”å­˜ä¸²è¡Œæ•°æ®å’Œ WSã€‚</p>
</blockquote>
<h3 id="MCLK"><a href="#MCLK" class="headerlink" title="MCLK"></a>MCLK</h3><p>é™¤æ­¤ä¹‹å¤–ï¼Œé€šå¸¸è¿˜æœ‰è¿˜æœ‰ä¸€ä¸ªSYSCLKï¼ˆMCLKï¼‰ï¼Œç”¨äºæä¾›ç»™éŸ³é¢‘åŠŸæ”¾å·¥ä½œæ—¶é’Ÿï¼Œé€šå¸¸æ˜¯2/4/8å€çš„BCLK</p>
<h2 id="ç³»ç»Ÿæ¡†å›¾"><a href="#ç³»ç»Ÿæ¡†å›¾" class="headerlink" title="ç³»ç»Ÿæ¡†å›¾"></a>ç³»ç»Ÿæ¡†å›¾</h2><ul>
<li>åªæœ‰ä¸€ä¸ªä¸»è®¾å¤‡ï¼Œå¹¶ä¸”SCKå’ŒWSä¿¡å·ä¸€å®šæ˜¯ä¸»è®¾å¤‡äº§ç”Ÿ</li>
<li>åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œé€šå¸¸æœ‰å¤šä¸ªå‘é€å™¨å’Œæ¥æ”¶å™¨ï¼Œæ­¤æ—¶é€šå¸¸æœ‰å¤–éƒ¨æ§åˆ¶å™¨è¿›è¡Œæ§åˆ¶</li>
</ul>
<p><img src="/images/computerSystem/protocol/i2s/I2S-1.png" alt="image"></p>
<h1 id="å…¸å‹I2Sæ—¶åºå›¾"><a href="#å…¸å‹I2Sæ—¶åºå›¾" class="headerlink" title="å…¸å‹I2Sæ—¶åºå›¾"></a>å…¸å‹I2Sæ—¶åºå›¾</h1><blockquote>
<p>è¯´æ˜ï¼šæœ¬éƒ¨åˆ†çš„ä½œå›¾æ˜¯ä»¥ä½å®½ä¸º16bitä¸ºä¾‹è¿›è¡Œè¯´æ˜</p>
<p>å¯ä»¥å‚è€ƒæ–‡ç« å°¾TI CODECæ–‡ä¸­å¯¹äºæ—¶åºçš„æè¿°</p>
</blockquote>
<p>éšç€æŠ€æœ¯çš„å‘å±•ï¼ŒI2Sä¹Ÿå‡ºç°äº†ä¸€äº›å˜ç§ï¼Œä½†æ˜¯æ¢æ±¤ä¸æ¢è¯åè®®æ ¸å¿ƒæ˜¯ä¸å˜çš„ã€‚</p>
<p>æ ¹æ®SDç›¸è¾ƒäºLRCLKçš„ä½ç½®çš„ä¸åŒåˆ†ä¸ºä¸‰ç§æ¨¡å¼ï¼šI2Sæ ¼å¼ï¼ˆPHILIPSæ¨¡å¼ï¼‰ã€å·¦å¯¹é½æ ¼å¼ï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ã€å³å¯¹é½æ ¼å¼ï¼ˆæ—¥æœ¬æ ¼å¼/SONYæ ¼å¼ï¼‰</p>
<h2 id="å…±é€šç‰¹æ€§"><a href="#å…±é€šç‰¹æ€§" class="headerlink" title="å…±é€šç‰¹æ€§"></a>å…±é€šç‰¹æ€§</h2><ol>
<li><p>WSå«å­—é€‰æ‹©ï¼Œå³æ¯ä¸€ä¸ªé«˜ä½ç”µå¹³æŒç»­æ—¶é—´å†…ä¼ è¾“çš„æ˜¯ä¸€ä¸ªå­—ï¼ˆ32bitï¼‰çš„æ•°æ®ï¼›</p>
</li>
<li><p>SCKå«ä½æ—¶é’Ÿï¼Œç”¨äºåŒæ­¥æ•°æ®ä¼ è¾“ï¼Œæ³¢å½¢ä¸ºæ–¹æ³¢ï¼ˆå¯¹åº”WSä¸€ä¸ªå‘¨æœŸæœ€å¤§æœ‰64ä¸ªæ–¹æ³¢ï¼‰</p>
</li>
<li><p>WSçš„é¢‘ç‡ç­‰äºé‡‡æ ·é¢‘ç‡ã€‚å‡è®¾é‡‡æ ·é¢‘ç‡44.1khzï¼Œå³1ç§’å†…æœ‰44100é‡‡æ ·ç‚¹ï¼ˆ44100ä¸ªå‘¨æœŸï¼‰</p>
</li>
<li><p>SCKçš„é¢‘ç‡ = å£°é“æ•° * é‡‡æ ·é¢‘ç‡ * é‡‡æ ·ä½æ•°ã€‚</p>
</li>
</ol>
<h2 id="I2Sæ ¼å¼"><a href="#I2Sæ ¼å¼" class="headerlink" title="I2Sæ ¼å¼"></a>I2Sæ ¼å¼</h2><ul>
<li><p>å·¦å£°é“çš„MSBåœ¨å­—æ—¶é’Ÿä¸‹é™æ²¿åçš„ç¬¬äºŒä¸ªä½æ—¶é’Ÿä¸Šå‡æ²¿æœ‰æ•ˆã€‚ åŒæ ·ï¼Œå³å£°é“çš„MSBåœ¨å­—æ—¶é’Ÿä¸Šå‡æ²¿åçš„ç¬¬äºŒä¸ªä½æ—¶é’Ÿä¸Šå‡æ²¿æœ‰æ•ˆ</p>
</li>
<li><p>SCKå»¶è¿Ÿä¸€ä¸ªæ—¶é’Ÿä½å¼€å§‹ä¼ è¾“æ•°æ®ï¼ˆä¸ºæ¥æ”¶å™¨æä¾›äº†æ—¶é—´æ¥å­˜å‚¨å·²ç»æ¥æ”¶çš„å­—ï¼Œå¹¶æ¸…é™¤ä¸‹ä¸€ä¸ªå­—çš„è¾“å…¥å¯„å­˜å™¨ï¼‰</p>
</li>
</ul>
<p><img src="/images/computerSystem/protocol/i2s/I2S-2.png" alt="image"></p>
<h2 id="å·¦å¯¹é½"><a href="#å·¦å¯¹é½" class="headerlink" title="å·¦å¯¹é½"></a>å·¦å¯¹é½</h2><ul>
<li>å·¦å¯¹é½æ¨¡å¼ä¸‹ï¼Œå³å£°é“çš„ MSB åœ¨å­—æ—¶é’Ÿä¸‹é™æ²¿ä¹‹åçš„ä½æ—¶é’Ÿä¸Šå‡æ²¿æœ‰æ•ˆã€‚ åŒæ ·ï¼Œå·¦å£°é“çš„MSBåœ¨å­—æ—¶é’Ÿä¸Šå‡æ²¿ä¹‹åçš„ä½æ—¶é’Ÿä¸Šå‡æ²¿æœ‰æ•ˆ</li>
</ul>
<p><img src="/images/computerSystem/protocol/i2s/I2S-3.png" alt="image"></p>
<h2 id="å³å¯¹é½"><a href="#å³å¯¹é½" class="headerlink" title="å³å¯¹é½"></a>å³å¯¹é½</h2><ul>
<li><p>å³å¯¹é½æ¨¡å¼ï¼Œå·¦å£°é“çš„ LSB åœ¨å­—æ—¶é’Ÿä¸‹é™æ²¿ä¹‹å‰çš„ä½æ—¶é’Ÿä¸Šå‡æ²¿æœ‰æ•ˆã€‚ åŒæ ·ï¼Œå³å£°é“çš„ LSB åœ¨å­—æ—¶é’Ÿä¸Šå‡æ²¿ä¹‹å‰çš„ä½æ—¶é’Ÿä¸Šå‡æ²¿æœ‰æ•ˆã€‚</p>
</li>
<li><p>æ¥æ”¶è®¾å¤‡å¿…é¡»äº‹å…ˆçŸ¥é“å¾…ä¼ æ•°æ®çš„å­—é•¿</p>
</li>
</ul>
<p><img src="/images/computerSystem/protocol/i2s/I2S-4.png" alt="image"></p>
<h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><ul>
<li><p>å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„æ•°æ®æ ¼å¼è¦ä¸€è‡´ï¼ŒåŒä¸ºå·¦å¯¹é½ã€å³å¯¹é½æˆ–I2Sæ ¼å¼</p>
</li>
<li><p>æ ‡å‡†å·¦å¯¹é½å’Œæ ‡å‡†å³å¯¹é½æ¨¡å¼çš„LRCK/WSé«˜ä½ç”µå¹³å¯¹åº”çš„å·¦å³å£°é“ä¸æ ‡å‡†I2Sæ¨¡å¼çš„è§„å®šç›¸åã€‚I2Sï¼š0ï¼šLï¼Œ1ï¼šRï¼›å·¦å¯¹é½/å³å¯¹é½ï¼š0ï¼šRï¼Œ1ï¼šLï¼›</p>
</li>
</ul>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="http://users.ece.utexas.edu/~bevans/courses/realtime/lectures/10_Data_Conversion/AP_Understanding_PDM_Digital_Audio.pdf">Understanding PDM Digital Audio</a> </li>
<li><a href="https://www.sparkfun.com/datasheets/BreakoutBoards/I2SBUS.pdf">I2S Bus Specification</a></li>
<li><a href="https://www.elprocus.com/i2s-protocol/">I2S Protocol : Working, Differences &amp; Its Applications</a></li>
<li><a href="https://www.crifan.com/common_audio_interface_tdm_pdm_i2s_pcm/">éŸ³é¢‘æ¥å£ï¼šTDMï¼ŒPDMï¼ŒI2Sï¼ŒPCM ç®€ä»‹</a></li>
<li><a href="https://www.ti.com.cn/cn/lit/ds/symlink/tlv320aic31.pdf">TI CODECæ‰‹å†Œ</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>protocol</category>
      </categories>
      <tags>
        <tag>I2S</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡µä¸­æ–­æœºåˆ¶è¯¦è§£</title>
    <url>/2023/09/01/computerSystem/pattern/%E9%A1%B5%E4%B8%AD%E6%96%AD/</url>
    <content><![CDATA[<h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>â€œé¡µä¸­æ–­â€ï¼ˆPage Faultï¼‰æ˜¯æŒ‡åœ¨è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä¸­ï¼Œå½“ç¨‹åºè¯•å›¾è®¿é—®å½“å‰æœªåˆ†é…ç‰©ç†å†…å­˜çš„è™šæ‹Ÿå†…å­˜é¡µé¢æ—¶æ‰€å¼•å‘çš„ä¸€ç§ä¸­æ–­ã€‚è¿™ç§ä¸­æ–­æ˜¯ç”±ç¡¬ä»¶æˆ–æ“ä½œç³»ç»Ÿå†…æ ¸ç”Ÿæˆçš„ï¼Œå®ƒä»¬ä½¿å¾—æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œå¿…è¦çš„æ“ä½œä»¥æ»¡è¶³é¡µé¢çš„è®¿é—®éœ€æ±‚ã€‚</p>
<p>ä¸æ™®é€šä¸­æ–­ä¸€æ ·ï¼Œå½“å‘ç”Ÿé¡µä¸­æ–­çš„æ—¶å€™ä¹Ÿä¼šè¿›å…¥åˆ°ç›¸åº”çš„ä¸­æ–­å¤„ç†æµç¨‹ä¸­ï¼Œè¿›è€Œå®ç°æŸäº›æ“ä½œç³»ç»Ÿçš„èµ‹äºˆç”¨æˆ·çš„åŠŸèƒ½ã€‚æˆ‘ä»¬çŸ¥é“å¯¹äºè™šæ‹Ÿç©ºé—´çš„å†…å­˜ï¼Œå…¶å…±ä¼šç»å†ä¸‰ä¸ªé˜¶æ®µï¼šæœªæ˜ å°„æœªåˆ†é…ã€å·²æ˜ å°„æœªåˆ†é…ã€å·²æ˜ å°„å·²åˆ†é…ã€‚è€Œé¡µä¸­æ–­çš„ä¸­æ–­å¤„ç†è¿‡ç¨‹å°†å®ç°è™šæ‹Ÿå†…å­˜çŠ¶æ€ä»å·²æ˜ å°„æœªåˆ†é…è½¬å‘å·²æ˜ å°„å·²åˆ†é…ã€‚</p>
<h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><ul>
<li><p>è™šæ‹Ÿå†…å­˜æ”¯æŒ</p>
<p>é¡µä¸­æ–­æœºåˆ¶æ˜¯æ”¯æŒè™šæ‹Ÿå†…å­˜çš„å…³é”®æœºåˆ¶ã€‚å½“ç¨‹åºè®¿é—®è™šæ‹Ÿå†…å­˜ä¸­çš„æŸä¸€é¡µï¼Œè€Œè¯¥é¡µå½“å‰æœªåŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘é¡µä¸­æ–­ã€‚æ“ä½œç³»ç»Ÿé€šè¿‡è¿™ä¸ªæœºåˆ¶ï¼Œèƒ½å¤Ÿå°†è™šæ‹Ÿå†…å­˜é¡µé¢ä»ç£ç›˜åŠ è½½åˆ°ç‰©ç†å†…å­˜ï¼Œä»è€Œæ»¡è¶³ç¨‹åºçš„å†…å­˜éœ€æ±‚ã€‚</p>
</li>
<li><p>å†…å­˜ç®¡ç†</p>
<p>æœ‰æ•ˆçš„ç®¡ç†å†…å­˜çš„æ¢å…¥æ¢å‡ºï¼Œæé«˜å†…å­˜çš„ä½¿ç”¨æ•ˆç‡</p>
</li>
<li><p>å†…å­˜ä¿æŠ¤</p>
<p>å¦‚æœç¨‹åºè¯•å›¾è®¿é—®æ²¡æœ‰æƒé™çš„è™šæ‹Ÿé¡µåˆ™ä¼šè§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æ£€æµ‹å¹¶å¤„ç†è¿™ç§æƒ…å†µï¼Œé˜²æ­¢ç¨‹åºè®¿é—®æ— æƒé™çš„å†…å­˜åŒºåŸŸã€‚</p>
</li>
<li><p>å†…å­˜åˆ†é…</p>
<p>å¯¹äºç”¨æˆ·ç”³è¯·å†…å­˜ç©ºé—´ä»¥åŠç›¸å…³åŠŸèƒ½ï¼ˆmmapã€forkã€execveï¼‰åº•å±‚éƒ½æ˜¯é€šè¿‡é¡µä¸­æ–­æœºåˆ¶å®ç°çš„</p>
</li>
</ul>
<h1 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h1><ul>
<li><p>ç¼ºé¡µä¸­æ–­ï¼ˆPage Fault on Demandï¼‰</p>
<p>å½“ç¨‹åºè®¿é—®ä¸€ä¸ªè™šæ‹Ÿå†…å­˜é¡µé¢ï¼Œä½†è¯¥é¡µé¢å½“å‰æœªåŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘ç¼ºé¡µä¸­æ–­ã€‚æ“ä½œç³»ç»Ÿä¼šæ ¹æ®éœ€è¦å°†ç¼ºå¤±çš„é¡µé¢ä»ç£ç›˜åŠ è½½åˆ°ç‰©ç†å†…å­˜ï¼Œä»¥æ»¡è¶³ç¨‹åºçš„è®¿é—®éœ€æ±‚ã€‚</p>
</li>
<li><p>å†™ä¿æŠ¤ä¸­æ–­ï¼ˆPage Fault for Writeï¼‰</p>
<p>å½“ç¨‹åºè¯•å›¾å†™å…¥ä¸€ä¸ªåªè¯»çš„è™šæ‹Ÿå†…å­˜é¡µé¢æ—¶ï¼Œä¼šè§¦å‘å†™ä¿æŠ¤ä¸­æ–­ã€‚æ“ä½œç³»ç»Ÿå¯ä»¥é€šè¿‡å°†é¡µé¢æ ‡è®°ä¸ºå¯å†™ï¼Œæˆ–è€…è¿›è¡Œå†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰æ“ä½œæ¥å¤„ç†è¿™ç§æƒ…å†µã€‚</p>
</li>
<li><p>éæ³•è®¿é—®ä¸­æ–­ï¼ˆPage Fault for Non-Existent Memoryï¼‰</p>
<p>å½“ç¨‹åºè¯•å›¾è®¿é—®è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­æœªåˆ†é…çš„éƒ¨åˆ†æ—¶ï¼Œä¼šå¼•å‘éæ³•è®¿é—®ä¸­æ–­ã€‚æ“ä½œç³»ç»Ÿé€šå¸¸ä¼šå“åº”è¿™ç§ä¸­æ–­å¹¶å¤„ç†è®¿é—®é”™è¯¯ã€‚</p>
</li>
<li><p>é¡µé¢å¤§å°ä¸­æ–­ï¼ˆPage Size Faultï¼‰</p>
<p>åœ¨ä¸€äº›ä½“ç³»ç»“æ„ä¸­ï¼Œä¸åŒçš„è™šæ‹Ÿå†…å­˜é¡µé¢å¯ä»¥æœ‰ä¸åŒçš„å¤§å°ã€‚å¦‚æœç¨‹åºè¯•å›¾è®¿é—®ä¸åŒ¹é…é¡µé¢å¤§å°çš„åœ°å€ï¼Œä¼šè§¦å‘é¡µé¢å¤§å°ä¸­æ–­ã€‚</p>
</li>
</ul>
<p>åœ¨æ“ä½œç³»ç»Ÿä¸­æœ€é‡è¦ä¸”æœ€å¸¸ç”¨çš„ä¸­æ–­ç±»å‹å°±æ˜¯ç¼ºé¡µä¸­æ–­å’Œå†™ä¿æŠ¤ä¸­æ–­ï¼Œè¿™ä¸¤ä¸ªä¸­æ–­æ”¯æ’‘èµ·äº†éœ€è¦ç³»ç»Ÿçš„è°ƒç”¨çš„æ ¸å¿ƒåŸç†</p>
<h1 id="ç»“æ„ä½“è¯´æ˜"><a href="#ç»“æ„ä½“è¯´æ˜" class="headerlink" title="ç»“æ„ä½“è¯´æ˜"></a>ç»“æ„ä½“è¯´æ˜</h1><h2 id="mm-struct"><a href="#mm-struct" class="headerlink" title="mm_struct"></a>mm_struct</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">398</span> <span class="class"><span class="keyword">struct</span> <span class="title">mm_struct</span> {</span></span><br><span class="line">  <span class="number">399</span>   <span class="class"><span class="keyword">struct</span> <span class="title">vm_area_struct</span> * <span class="title">mmap</span>;</span>     <span class="comment">// è™šæ‹Ÿåœ°å€ç©ºé—´ç»“æ„ä½“ï¼ŒåŒå‘é“¾è¡¨åŒ…å«çº¢é»‘æ ‘èŠ‚ç‚¹è®¿é—®åˆ°ä¸èƒ½è®¿é—®çš„åŒºåŸŸã€‚</span></span><br><span class="line">  <span class="number">400</span>   <span class="class"><span class="keyword">struct</span> <span class="title">rb_root</span> <span class="title">mm_rb</span>;</span>             <span class="comment">// çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">  <span class="number">401</span>   <span class="class"><span class="keyword">struct</span> <span class="title">vm_area_struct</span> * <span class="title">mmap_cache</span>;</span>   <span class="comment">// mmapçš„é«˜é€Ÿç¼“å†²å™¨ï¼ŒæŒ‡çš„æ˜¯mmapæœ€åæŒ‡å‘çš„ä¸€ä¸ªè™šæ‹Ÿåœ°å€åŒºé—´</span></span><br><span class="line">  <span class="number">402</span> <span class="meta">#<span class="keyword">ifdef</span> CONFIG_MMU                                                                                                              </span></span><br><span class="line">  <span class="number">403</span>   <span class="type">unsigned</span> <span class="title function_">long</span> <span class="params">(*get_unmapped_area)</span> <span class="params">(<span class="keyword">struct</span> file *filp,</span></span><br><span class="line"><span class="params">  <span class="number">404</span>         <span class="type">unsigned</span> <span class="type">long</span> addr, <span class="type">unsigned</span> <span class="type">long</span> len,</span></span><br><span class="line"><span class="params">  <span class="number">405</span>         <span class="type">unsigned</span> <span class="type">long</span> pgoff, <span class="type">unsigned</span> <span class="type">long</span> flags)</span>;</span><br><span class="line">  <span class="number">406</span>   <span class="type">void</span> (*unmap_area) (<span class="keyword">struct</span> mm_struct *mm, <span class="type">unsigned</span> <span class="type">long</span> addr);</span><br><span class="line">  <span class="number">407</span> <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="number">408</span>   <span class="type">unsigned</span> <span class="type">long</span> mmap_base;             <span class="comment">// mmapåŒºåŸŸçš„åŸºåœ°å€</span></span><br><span class="line">  <span class="number">409</span>   <span class="type">unsigned</span> <span class="type">long</span> mmap_legacy_base;      <span class="comment">// è‡ªåº•å‘ä¸Šçš„é…ç½®</span></span><br><span class="line">  <span class="number">410</span>   <span class="type">unsigned</span> <span class="type">long</span> task_size;             <span class="comment">// è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´å¤§å°</span></span><br><span class="line">  <span class="number">411</span>   <span class="type">unsigned</span> <span class="type">long</span> cached_hole_size;      <span class="comment">// ç¼“å†²å™¨çš„æœ€å¤§çš„å¤§å°</span></span><br><span class="line">  <span class="number">412</span>   <span class="type">unsigned</span> <span class="type">long</span> free_area_cache;       <span class="comment">// ä¸å—çº¦æŸçš„ç©ºé—´å¤§å°</span></span><br><span class="line">  <span class="number">413</span>   <span class="type">unsigned</span> <span class="type">long</span> highest_vm_end;        <span class="comment">// è™šæ‹Ÿåœ°å€ç©ºé—´æœ€å¤§ç»“å°¾åœ°å€</span></span><br><span class="line">  <span class="number">414</span>   <span class="type">pgd_t</span> * pgd;                         <span class="comment">// é¡µè¡¨çš„å…¨å±€ç›®å½•</span></span><br><span class="line">  <span class="number">415</span>   <span class="type">atomic_t</span> mm_users;        			 <span class="comment">// ç”¨æˆ·æ•°é‡</span></span><br><span class="line">  <span class="number">416</span>   <span class="type">atomic_t</span> mm_count;      			 <span class="comment">// æœ‰å¤šå°‘ç”¨æˆ·å¼•ç”¨mm_struct</span></span><br><span class="line">  <span class="number">417</span>   <span class="type">atomic_long_t</span> nr_ptes;  			 <span class="comment">// é¡µè¡¨</span></span><br><span class="line">  <span class="number">418</span>   <span class="type">int</span> map_count;        			     <span class="comment">// è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸ªæ•°</span></span><br><span class="line">  <span class="number">419</span> </span><br><span class="line">  <span class="number">420</span>   <span class="type">spinlock_t</span> page_table_lock;   		 <span class="comment">// ä¿æŠ¤é¡µè¡¨å’Œç”¨æˆ·</span></span><br><span class="line">  <span class="number">421</span>   <span class="class"><span class="keyword">struct</span> <span class="title">rw_semaphore</span> <span class="title">mmap_sem</span>;</span>        <span class="comment">// è¯»å†™ä¿¡å·</span></span><br><span class="line">  <span class="number">422</span> </span><br><span class="line">  <span class="number">423</span>   <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">mmlist</span>;</span>    <span class="comment">/* List of maybe swapped mm's.  These are globally strung</span></span><br><span class="line"><span class="comment">  424              * together off init_mm.mmlist, and are protected</span></span><br><span class="line"><span class="comment">  425              * by mmlist_lock</span></span><br><span class="line"><span class="comment">  426              */</span></span><br><span class="line">  <span class="number">428</span> </span><br><span class="line">  <span class="number">429</span>   <span class="type">unsigned</span> <span class="type">long</span> hiwater_rss;  		<span class="comment">/* High-watermark of RSS usage */</span> </span><br><span class="line">  <span class="number">430</span>   <span class="type">unsigned</span> <span class="type">long</span> hiwater_vm; 			<span class="comment">/* High-water virtual memory usage */</span></span><br><span class="line">  <span class="number">431</span> </span><br><span class="line">  <span class="number">432</span>   <span class="type">unsigned</span> <span class="type">long</span> total_vm;   				<span class="comment">// æ˜ å°„çš„æ€»é¡µæ•°</span></span><br><span class="line">  <span class="number">433</span>   <span class="type">unsigned</span> <span class="type">long</span> locked_vm;  				<span class="comment">// å·²è®¾ç½®PG_mlockedçš„é¡µé¢</span></span><br><span class="line">  <span class="number">434</span>   <span class="type">unsigned</span> <span class="type">long</span> pinned_vm;  				<span class="comment">// é‡æ–°è®¡æ•°æ°¸ä¹…å¢åŠ </span></span><br><span class="line">  <span class="number">435</span>   <span class="type">unsigned</span> <span class="type">long</span> shared_vm;  				<span class="comment">// å…±äº«é¡µé¢</span></span><br><span class="line">  <span class="number">436</span>   <span class="type">unsigned</span> <span class="type">long</span> exec_vm;    				<span class="comment">// å¯æ‰§è¡Œå¯å†™é¡µé¢</span></span><br><span class="line">  <span class="number">437</span>   <span class="type">unsigned</span> <span class="type">long</span> stack_vm; </span><br><span class="line">  <span class="number">438</span>   <span class="type">unsigned</span> <span class="type">long</span> def_flags;</span><br><span class="line">  <span class="number">439</span>   <span class="type">unsigned</span> <span class="type">long</span> start_code, end_code, start_data, end_data;               <span class="comment">//å¼€å§‹ä»£ç æ®µï¼Œç»“æŸä»£ç ã€‚å¼€å§‹æ•°æ®ï¼Œç»“æŸæ•°æ®</span></span><br><span class="line">  <span class="number">440</span>   <span class="type">unsigned</span> <span class="type">long</span> start_brk, brk, start_stack;                              <span class="comment">//å †çš„å¼€å§‹å’Œç»“æŸã€‚</span></span><br><span class="line">  <span class="number">441</span>   <span class="type">unsigned</span> <span class="type">long</span> arg_start, arg_end, env_start, env_end;                   <span class="comment">//å‚æ•°çš„èµ·å§‹å’Œç»“æŸï¼Œç¯å¢ƒå˜é‡çš„èµ·å§‹å’Œç»ˆç‚¹</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<h2 id="vm-area-struct"><a href="#vm-area-struct" class="headerlink" title="vm_area_struct"></a>vm_area_struct</h2><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vm_area_struct</span> {</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mm_struct</span> *<span class="title">vm_mm</span>;</span>    <span class="comment">// æŒ‡å‘è¿›ç¨‹çš„ mm_struct ç»“æ„</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> vm_start;      <span class="comment">// è™šæ‹Ÿå†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> vm_end;        <span class="comment">// è™šæ‹Ÿå†…å­˜åŒºåŸŸçš„ç»“æŸåœ°å€</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">vm_area_struct</span> *<span class="title">vm_next</span>;</span>  <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ª vm_area_struct ç»“æ„</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">vm_area_struct</span> *<span class="title">vm_prev</span>;</span>  <span class="comment">// æŒ‡å‘å‰ä¸€ä¸ª vm_area_struct ç»“æ„</span></span><br><span class="line"></span><br><span class="line">    <span class="type">pgprot_t</span> vm_page_prot;       <span class="comment">// é¡µé¢ä¿æŠ¤å±æ€§</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> vm_flags;      <span class="comment">// è™šæ‹Ÿå†…å­˜åŒºåŸŸçš„æ ‡å¿—ä½</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹æ˜¯ä¸€äº›åœ¨å†…æ ¸ä¸­è¿›è¡Œå†…éƒ¨ç®¡ç†çš„å­—æ®µï¼Œç”¨äºå°† vm_area_struct æ’å…¥çº¢é»‘æ ‘ç­‰</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rb_node</span> <span class="title">vm_rb</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rb_node</span> <span class="title">vm_rb_subtree_last</span>;</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><blockquote>
<p>æœ¬èŠ‚ç›¸å…³çš„æºç å–è‡ªLinux-4.4ï¼ˆMIPSï¼‰åªä¿ç•™äº†å…³é”®æ®µè½ä»£ç </p>
</blockquote>
<h2 id="æ•´ä½“è°ƒç”¨æµç¨‹"><a href="#æ•´ä½“è°ƒç”¨æµç¨‹" class="headerlink" title="æ•´ä½“è°ƒç”¨æµç¨‹"></a>æ•´ä½“è°ƒç”¨æµç¨‹</h2><ol>
<li><p>åœ¨ Linux ç³»ç»Ÿä¸Šï¼Œé¡µä¸­æ–­æœåŠ¡ç¨‹åºçš„åç§°æ˜¯ do_page_fault</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// fault.c</span></span><br><span class="line">asmlinkage <span class="type">void</span> __kprobes <span class="title function_">do_page_fault</span><span class="params">(<span class="keyword">struct</span> pt_regs *regs, <span class="type">unsigned</span> <span class="type">long</span> write, <span class="type">unsigned</span> <span class="type">long</span> address)</span></span><br><span class="line">{</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">ctx_state</span> <span class="title">prev_state</span>;</span></span><br><span class="line">    prev_state = exception_enter();</span><br><span class="line">    __do_page_fault(regs, write, address);</span><br><span class="line">    exception_exit(prev_state);                          </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å†…æ ¸æ€ç”¨æˆ·æ€ä¸Šä¸‹æ–‡åˆ‡æ¢</p>
<ul>
<li>å¯¹äºexception_enterå‡½æ•°ï¼Œå…¶æµç¨‹ä¸ºï¼šæ£€æŸ¥ä¸Šä¸‹æ–‡è·Ÿè¸ªæ˜¯å¦å¯ç”¨ï¼›å¦‚æœå¯ç”¨ï¼Œè¯»å–å…ˆå‰ä¸Šä¸‹æ–‡çŠ¶æ€ï¼›å¦‚æœå…ˆå‰çŠ¶æ€æ˜¯å†…æ ¸æ€ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸æ˜¯å†…æ ¸æ€åˆ™è°ƒç”¨context_tracking_exité€šçŸ¥ä¸Šä¸‹æ–‡è·Ÿè¸ªå­ç³»ç»Ÿå¤„ç†å™¨æ­£åœ¨é€€å‡ºç”¨æˆ·æ¨¡å¼å¹¶è¿›å…¥å†…æ ¸æ¨¡å¼ã€‚</li>
<li>å¯¹äºexception_exitå‡½æ•°ï¼ŒåŸºæœ¬æµç¨‹ä¸ä¸Šè¿°ä¸€è‡´ã€‚åªæ˜¯æœ€åcontext_tracking_enterå‡½æ•°å°†é€šçŸ¥ä¸Šä¸‹æ–‡è·Ÿè¸ªå­ç³»ç»Ÿå¤„ç†å™¨å°†ä»å†…æ ¸æ¨¡å¼é€€å‡ºå¹¶è¿›å…¥éå†…æ ¸æ¨¡å¼å³å…ˆå‰çš„ä¸Šä¸‹æ–‡æ¨¡å¼ï¼ˆç”¨æˆ·æ¨¡å¼ï¼‰</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// context_tracking.h</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="keyword">enum</span> ctx_state <span class="title function_">exception_enter</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{       </span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">ctx_state</span> <span class="title">prev_ctx</span>;</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> (!context_tracking_is_enabled())		<span class="comment">// åˆ¤æ–­ä¸Šä¸‹æ–‡è·Ÿè¸ªæ˜¯å¦å¯ç”¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    prev_ctx = this_cpu_read(context_tracking.state);	<span class="comment">// è¯»å–å…ˆå‰ä¸Šä¸‹æ–‡çŠ¶æ€ï¼Œå†…æ ¸æ€/ç”¨æˆ·æ€ï¼Ÿ</span></span><br><span class="line">    <span class="keyword">if</span> (prev_ctx != CONTEXT_KERNEL)						<span class="comment">// ä¸æ˜¯å†…æ ¸æ€ç›´æ¥é€€å‡ºä¸Šä¸€çŠ¶æ€</span></span><br><span class="line">        context_tracking_exit(prev_ctx);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> prev_ctx;</span><br><span class="line">}                                                                                                                                                                                         </span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">exception_exit</span><span class="params">(<span class="keyword">enum</span> ctx_state prev_ctx)</span></span><br><span class="line">{   </span><br><span class="line">    <span class="keyword">if</span> (context_tracking_is_enabled()) {</span><br><span class="line">        <span class="keyword">if</span> (prev_ctx != CONTEXT_KERNEL)</span><br><span class="line">            context_tracking_enter(prev_ctx);</span><br><span class="line">    }</span><br><span class="line">} </span><br><span class="line"></span><br><span class="line"><span class="comment">// context_tracking_state.h</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ctx_state</span> {</span>                                          </span><br><span class="line">    CONTEXT_DISABLED = <span class="number">-1</span>,  <span class="comment">/* returned by ct_state() if unknown */</span></span><br><span class="line">    CONTEXT_KERNEL = <span class="number">0</span>,</span><br><span class="line">    CONTEXT_USER,</span><br><span class="line">    CONTEXT_GUEST,</span><br><span class="line">} state; </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>é¡µä¸­æ–­çš„ä¸‹å±‚å°è£…__do_page_fault</p>
<ul>
<li>find_vmaé€šè¿‡å¤±æ•ˆåœ°å€addræ¥æŸ¥æ‰¾vmaï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°vmaï¼Œè¯´æ˜addråœ°å€è¿˜æ²¡æœ‰åœ¨è¿›ç¨‹åœ°å€ç©ºé—´ä¸­åˆ†é…ä»»ä½•ä¸€ä¸ªVMAçš„çº¿æ€§åŒºï¼Œè¿™å°†æ˜¯ä¸€ç§ä¸¥é‡çš„é”™è¯¯ï¼Œè¿”å›VM_FAULT_BADMAPé”™è¯¯ï¼Œå†…æ ¸å°†ä¼šæ€æ‰è¯¥è¿›ç¨‹</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// https://elixir.bootlin.com/linux/latest/source/arch/mips/mm/fault.c</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __do_page_fault(<span class="keyword">struct</span> pt_regs *regs, <span class="type">unsigned</span> <span class="type">long</span> write, <span class="type">unsigned</span> <span class="type">long</span> address)</span><br><span class="line">{</span><br><span class="line"><span class="comment">// ä¸ºäº†è·å¾—æœ‰å…³å†…æ ¸ææ…Œã€å†…æ ¸oopsã€ä¸å¯å±è”½ä¸­æ–­æˆ–å…¶ä»–äº‹ä»¶çš„é€šçŸ¥ï¼Œè°ƒç”¨è€…éœ€è¦å°†å…¶è‡ªèº«æ’å…¥åˆ°é“¾ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (notify_die(DIE_PAGE_FAULT, <span class="string">"page fault"</span>, regs, <span class="number">-1</span>, current-&gt;thread.trap_nr, SIGSEGV) == NOTIFY_STOP)                              <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">// æŸ¥æ‰¾VMA</span></span><br><span class="line">    vma = find_vma(mm, address);</span><br><span class="line"><span class="comment">// åˆ¤æ–­VMAæ˜¯å¦æœ‰å†™æƒé™</span></span><br><span class="line">     <span class="keyword">if</span> (!(vma-&gt;vm_flags &amp; VM_WRITE))</span><br><span class="line">         xxx;</span><br><span class="line"><span class="comment">// é¡µä¸­æ–­çš„æ ¸å¿ƒå¤„ç†å‡½æ•°</span></span><br><span class="line">    fault = handle_mm_fault(mm, vma, address, flags);</span><br><span class="line"><span class="comment">// ç›¸å…³gotoå¤„ç†å‡½æ•°</span></span><br><span class="line">    xxx</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>æ ¸å¿ƒå‡½æ•°handle_pte_fault</p>
<p>å¯¹äºè™šæ‹Ÿåœ°å€çš„æ˜ å°„è¿‡ç¨‹ï¼Œé¦–å…ˆæ£€æŸ¥è¡¨é¡¹ä¸­Pä½ï¼ˆPRESENTï¼‰ï¼Œè¯¥é¡¹è¡¨ç¤ºç‰©ç†é¡µé¢æ˜¯å¦å­˜åœ¨åœ¨å†…å­˜ä¸­ã€‚å¦‚æœP=0é‚£ä¹ˆå…¶ä»–å„ä¸ªå­—æ®µéƒ½æ¯«æ— æ„ä¹‰ï¼Œå¹¶ä¸”pte_noneæ£€æŸ¥é¡µè¡¨é¡¹ä¹Ÿä¸ºç©ºè¯´æ˜é¡µè¡¨é¡¹æœªå»ºç«‹ï¼Œå¦‚æœpte_noneéç©ºè¯´æ˜æ˜ å°„å·²ç»å»ºç«‹ï¼Œåªæ˜¯ç‰©ç†é¡µé¢ä¸åœ¨å†…å­˜ä¸­ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// mm/memory.c</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">handle_pte_fault</span><span class="params">(<span class="keyword">struct</span> mm_struct *mm, <span class="keyword">struct</span> vm_area_struct *vma, <span class="type">unsigned</span> <span class="type">long</span> address, <span class="type">pte_t</span> *pte, <span class="type">pmd_t</span> *pmd, <span class="type">unsigned</span> <span class="type">int</span> flags)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// å†…å­˜å±éšœ</span></span><br><span class="line">    barrier();</span><br><span class="line">    <span class="comment">//pteé¡µè¡¨é¡¹PRESENTæœªç½®ä½ï¼Œè¯´æ˜PTEè¿˜æ²¡æœ‰æ˜ å°„ç‰©ç†é¡µé¢ï¼ˆæ²¡æœ‰é¡µé¢æˆ–é¡µé¢è¢«äº¤æ¢å‡ºå»ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (!pte_present(entry)) {</span><br><span class="line">         <span class="comment">// åˆ¤æ–­é¡µè¡¨é¡¹æ˜¯å¦ä¸ºç©ºï¼ˆæ˜ å°„ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (pte_none(entry)) {</span><br><span class="line">            <span class="comment">// åˆ¤æ–­VMAæ˜¯å¦æ˜¯åŒ¿åæ˜ å°„</span></span><br><span class="line">            <span class="keyword">if</span> (vma_is_anonymous(vma))</span><br><span class="line">                <span class="comment">// vmaæ˜¯åŒ¿åæ˜ å°„çº¿æ€§åŒºï¼ŒåŒ¿åæ˜ å°„</span></span><br><span class="line">                <span class="keyword">return</span> do_anonymous_page(mm, vma, address,  pte, pmd, flags);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">// vmaæ˜¯æ–‡ä»¶æ˜ å°„çº¿æ€§åŒºï¼Œæ–‡ä»¶æ˜ å°„</span></span><br><span class="line">                <span class="keyword">return</span> do_fault(mm, vma, address, pte, pmd, flags, entry);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//PTEéç©ºï¼Œä»swapåˆ†åŒºè¯»å›é¡µé¢</span></span><br><span class="line">        <span class="keyword">return</span> do_swap_page(mm, vma, address,  pte, pmd, flags, entry);</span><br><span class="line">    } </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (pte_protnone(entry))</span><br><span class="line">        <span class="comment">//éä¸€è‡´æ€§å†…å­˜è®¿é—®ï¼ˆNUMAï¼‰ä¸‹çš„é¡µè¡¨æ˜ å°„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">return</span> do_numa_page(mm, vma, address, entry, pte, pmd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (flags &amp; FAULT_FLAG_WRITE) {</span><br><span class="line">        <span class="keyword">if</span> (!pte_write(entry))	<span class="comment">// PTEåªè¯»</span></span><br><span class="line">            <span class="keyword">return</span> do_wp_page(mm, vma, address, pte, pmd, ptl, entry); <span class="comment">//å†™æ—¶å¤åˆ¶ï¼Œforkçˆ¶å­è¿›ç¨‹</span></span><br><span class="line">        entry = pte_mkdirty(entry);		<span class="comment">// pteå¯å†™æ—¶ï¼Œæ ‡è®°ä¸ºè„ï¼Œ</span></span><br><span class="line">    }    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// /æ ‡è®°pteé¡¹åˆšåˆšè¢«è®¿é—®è¿‡ï¼Œä»¥å…é¡µé¢è¢«æ¢å‡º</span></span><br><span class="line">    entry = pte_mkyoung(entry);</span><br><span class="line">    <span class="keyword">if</span> (ptep_set_access_flags(vma, address, pte, entry, flags &amp; FAULT_FLAG_WRITE)) {</span><br><span class="line">        update_mmu_cache(vma, address, pte);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">if</span> (flags &amp; FAULT_FLAG_WRITE)</span><br><span class="line">            flush_tlb_fix_spurious_fault(vma, address);         <span class="comment">// flush tlb cache                  </span></span><br><span class="line">    }   </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h2 id="åŒ¿åæ˜ å°„-do-anonymous-page"><a href="#åŒ¿åæ˜ å°„-do-anonymous-page" class="headerlink" title="åŒ¿åæ˜ å°„(do_anonymous_page)"></a>åŒ¿åæ˜ å°„(do_anonymous_page)</h2><ul>
<li><p>è°ƒç”¨æ—¶æœºï¼šPTEä¸å­˜åœ¨ä¸”Flagsæ˜¯åŒ¿åæ˜ å°„</p>
</li>
<li><p>å¤„ç†é€»è¾‘ï¼š</p>
<ul>
<li><p>è¯»æ“ä½œ</p>
<p>ä½¿ç”¨ é›¶é¡µï¼ˆBSSæ®µï¼‰ è¿›è¡Œæ˜ å°„ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºåªè¯»ã€‚å› ä¸ºè¿™é‡Œå·²ç»æ˜¯ç¼ºé¡µå¼‚å¸¸çš„è¯·æ±‚è°ƒé¡µçš„å¤„ç†ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯æœ¬è¿›ç¨‹ç¬¬ä¸€æ¬¡è®¿é—®è¿™ä¸ªé¡µï¼Œåˆ†é…å…¨é›¶å³å¯ã€‚</p>
</li>
<li><p>å†™æ“ä½œ</p>
<p>ç”³è¯·ä¸€å—æ–°çš„ç‰©ç†å†…å­˜é¡µï¼Œç„¶åæ ¹æ®ç‰©ç†å†…å­˜é¡µçš„åœ°å€ç”Ÿæˆæ˜ å°„å…³ç³»ï¼Œå†å¯¹é¡µè¡¨é¡¹è¿›è¡Œæ˜ å°„ï¼Œå¢åŠ è¿›ç¨‹åŒ¿åé¡µé¢çš„è®¡æ•°ï¼ŒæŠŠåŒ¿åé¡µé¢æ·»åŠ åˆ°RMAPç³»ç»Ÿå’ŒLRUå¯¹åº”é“¾è¡¨é‡Œï¼Œä»¥ç”¨äºåç»­è¿›è¡Œå†…å­˜å›æ”¶ã€‚</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">do_anonymous_page</span><span class="params">(<span class="keyword">struct</span> mm_struct *mm, <span class="keyword">struct</span> vm_area_struct *vma,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">long</span> address, <span class="type">pte_t</span> *page_table, <span class="type">pmd_t</span> *pmd,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">int</span> flags)</span></span><br><span class="line">{</span><br><span class="line"><span class="comment">// //å¦‚æœpage_tableä¹‹å‰ç”¨æ¥å»ºç«‹äº†ä¸´æ—¶å†…æ ¸æ˜ å°„ï¼Œåˆ™é‡Šæ”¾è¯¥æ˜ å°„</span></span><br><span class="line">    pte_unmap(page_table);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜ å°„è™šæ‹Ÿå†…å­˜vmaæ˜¯å¦åœ¨ä¸åŒè¿›ç¨‹é—´å…±äº«</span></span><br><span class="line">    <span class="keyword">if</span> (vma-&gt;vm_flags &amp; VM_SHARED)</span><br><span class="line">        <span class="keyword">return</span> VM_FAULT_SIGBUS;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/* Use the zero-page for reads, VMAåªè¯»æƒ…å†µ */</span></span><br><span class="line">    <span class="keyword">if</span> (!(flags &amp; FAULT_FLAG_WRITE) &amp;&amp; !mm_forbids_zeropage(mm)) {</span><br><span class="line">        <span class="comment">// åˆ›å»ºé¡µè¡¨é¡¹ï¼ˆä½¿ç”¨å…¨0é¡µï¼Œå¹¶è®¾ç½®å±æ€§æ ‡è®°ï¼‰</span></span><br><span class="line">        entry = pte_mkspecial(pfn_pte(my_zero_pfn(address), vma-&gt;vm_page_prot));</span><br><span class="line">        <span class="comment">// åœ¨ç»™å®šçš„è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œæ‰¾åˆ°è™šæ‹Ÿåœ°å€ address å¯¹åº”çš„é¡µè¡¨é¡¹ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥é¡µè¡¨é¡¹çš„æŒ‡é’ˆ</span></span><br><span class="line">        page_table = pte_offset_map_lock(mm, pmd, address, &amp;ptl);</span><br><span class="line">        <span class="keyword">if</span> (!pte_none(*page_table))</span><br><span class="line">            <span class="keyword">goto</span> unlock;</span><br><span class="line">        <span class="comment">/* Deliver the page fault to userland, check inside PT lockï¼Œä¼ é€’page faultåˆ°ç”¨æˆ·ç©ºé—´ */</span></span><br><span class="line">        <span class="keyword">if</span> (userfaultfd_missing(vma)) {</span><br><span class="line">            pte_unmap_unlock(page_table, ptl);</span><br><span class="line">            <span class="keyword">return</span> handle_userfault(vma, address, flags,  VM_UFFD_MISSING);</span><br><span class="line">        }    </span><br><span class="line">        <span class="keyword">goto</span> setpte;</span><br><span class="line">    }    </span><br><span class="line">    </span><br><span class="line">	<span class="comment">/* ä»¥ä¸‹æ˜¯VMAå¯å†™çš„æƒ…å†µ */</span></span><br><span class="line">    <span class="comment">// ä¸ºè¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„VMAå‡†å¤‡struct anon_vmaç»“æ„</span></span><br><span class="line">    <span class="keyword">if</span> (unlikely(anon_vma_prepare(vma)))</span><br><span class="line">        <span class="keyword">goto</span> oom; </span><br><span class="line">    <span class="comment">// åˆ†é…å¯ç§»åŠ¨çš„åŒ¿åé¡µé¢ï¼Œåº•å±‚é€šè¿‡alloc_page</span></span><br><span class="line">    page = alloc_zeroed_user_highpage_movable(vma, address);</span><br><span class="line">    <span class="keyword">if</span> (!page)</span><br><span class="line">        <span class="keyword">goto</span> oom; </span><br><span class="line">	<span class="comment">// è¯·æ±‚çš„å†…å­˜åˆ†é…è¿›è¡Œèµ„æºè®¡æ•°ï¼Œä»¥æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å†…å­˜èµ„æºå¯ä¾›ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (mem_cgroup_try_charge(page, mm, GFP_KERNEL, &amp;memcg))</span><br><span class="line">        <span class="keyword">goto</span> oom_free_page;</span><br><span class="line">   <span class="comment">// å†…æ ¸å®ï¼Œç”¨äºè®¾ç½®é¡µè¡¨é¡¹ä¸­çš„ "uptodate" æ ‡å¿—ä½ï¼Œè¡¨ç¤ºé¡µé¢å·²ç»æ›´æ–°å¹¶ä¸”åŒ…å«äº†æœ‰æ•ˆæ•°æ®ã€‚åœ¨é¡µç¼“å­˜å’Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œä¸­ï¼Œè¿™ä¸ªæ ‡å¿—ç”¨äºè·Ÿè¸ªé¡µé¢çš„æœ‰æ•ˆæ€§çŠ¶æ€ã€‚</span></span><br><span class="line">    __SetPageUptodate(page);</span><br><span class="line">    <span class="comment">// åˆ›å»ºé¡µè¡¨é¡¹ PTE</span></span><br><span class="line">    entry = mk_pte(page, vma-&gt;vm_page_prot);</span><br><span class="line">    <span class="keyword">if</span> (vma-&gt;vm_flags &amp; VM_WRITE)</span><br><span class="line">        <span class="comment">// è®¾ç½®é¡µè¡¨é¡¹å¯å†™</span></span><br><span class="line">        entry = pte_mkwrite(pte_mkdirty(entry))</span><br><span class="line">    <span class="comment">// è·å– PTE åœ°å€</span></span><br><span class="line">    page_table = pte_offset_map_lock(mm, pmd, address, &amp;ptl);</span><br><span class="line">    <span class="keyword">if</span> (!pte_none(*page_table))</span><br><span class="line">        <span class="keyword">goto</span> release;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Deliver the page fault to userland, check inside PT lockï¼Œä¼ é€’page faultåˆ°ç”¨æˆ·ç©ºé—´*/</span></span><br><span class="line">    <span class="keyword">if</span> (userfaultfd_missing(vma)) {</span><br><span class="line">        pte_unmap_unlock(page_table, ptl);</span><br><span class="line">        mem_cgroup_cancel_charge(page, memcg);</span><br><span class="line">        page_cache_release(page);</span><br><span class="line">        <span class="keyword">return</span> handle_userfault(vma, address, flags,</span><br><span class="line">                    VM_UFFD_MISSING);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å¢åŠ mmçš„rssæˆå‘˜åŠ ä¸€ï¼Œç”¨äºè®°å½•åˆ†é…ç»™æœ¬è¿›ç¨‹çš„ç‰©ç†é¡µæ€»æ•°</span></span><br><span class="line">    inc_mm_counter_fast(mm, MM_ANONPAGES);</span><br><span class="line">    <span class="comment">// å»ºç«‹çº¿æ€§åŒºå’ŒåŒ¿åé¡µçš„åå‘æ˜ å°„</span></span><br><span class="line">    page_add_new_anon_rmap(page, vma, address);</span><br><span class="line">    mem_cgroup_commit_charge(page, memcg, <span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// å°†ä¸€ä¸ªé¡µé¢æ·»åŠ åˆ° LRUï¼ˆLeast Recently Usedï¼‰ç¼“å­˜ä¸­çš„ä¸æ´»è·ƒé“¾è¡¨æˆ–ä¸å¯é©±é€é“¾è¡¨</span></span><br><span class="line">    lru_cache_add_active_or_unevictable(page, vma);</span><br><span class="line">setpte:</span><br><span class="line">    <span class="comment">// /å°†pteé¡µè¡¨é¡¹å€¼entryè®¾ç½®åˆ°ç¡¬ä»¶page_tableé¡µè¡¨é¡¹</span></span><br><span class="line">    set_pte_at(mm, address, page_table, entry);</span><br><span class="line">    <span class="comment">/* No need to invalidate - it was non-present beforeï¼Œæ›´æ–°MMU Cache */</span></span><br><span class="line">    update_mmu_cache(vma, address, page_table);</span><br><span class="line">unlock:</span><br><span class="line">    pte_unmap_unlock(page_table, ptl);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// å¼‚å¸¸å¤„ç†</span></span><br><span class="line">release:</span><br><span class="line">    mem_cgroup_cancel_charge(page, memcg);</span><br><span class="line">    page_cache_release(page);</span><br><span class="line">    <span class="keyword">goto</span> unlock;</span><br><span class="line">oom_free_page:</span><br><span class="line">    page_cache_release(page);</span><br><span class="line">oom:</span><br><span class="line">    <span class="keyword">return</span> VM_FAULT_OOM;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ–‡ä»¶æ˜ å°„-do-fault"><a href="#æ–‡ä»¶æ˜ å°„-do-fault" class="headerlink" title="æ–‡ä»¶æ˜ å°„(do_fault)"></a>æ–‡ä»¶æ˜ å°„(do_fault)</h2><ul>
<li>è°ƒç”¨æ¡ä»¶ï¼šPTEä¸å­˜åœ¨ï¼Œè¯¥vmaé‡Œçš„é¡µæ˜¯æ–‡ä»¶é¡µæˆ–è€…å…±äº«åŒ¿åé¡µ</li>
<li>è°ƒç”¨æµç¨‹ï¼š<ul>
<li>æŠŠæ–‡ä»¶é¡µä»å­˜å‚¨è®¾å¤‡ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿè¯»åˆ°æ–‡ä»¶çš„ç¼“å­˜ ï¼ˆPage Cacheï¼‰</li>
<li>è®¾ç½®è¿›ç¨‹çš„é¡µè¡¨é¡¹PTEï¼ŒæŠŠè™šæ‹Ÿé¡µæ˜ å°„åˆ°æ–‡ä»¶çš„é¡µç¼“å­˜ç‰©ç†é¡µï¼ˆPage Cacheï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">do_fault</span><span class="params">(<span class="keyword">struct</span> mm_struct *mm, <span class="keyword">struct</span> vm_area_struct *vma,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">long</span> address, <span class="type">pte_t</span> *page_table, <span class="type">pmd_t</span> *pmd,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">int</span> flags, <span class="type">pte_t</span> orig_pte)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// ç¼ºé¡µç”±è¯»å†…å­˜å¯¼è‡´</span></span><br><span class="line">    <span class="keyword">if</span> (!(flags &amp; FAULT_FLAG_WRITE))</span><br><span class="line">        <span class="keyword">return</span> do_read_fault(mm, vma, address, pmd, pgoff, flags, orig_pte);</span><br><span class="line">    <span class="comment">// ç¼ºé¡µç”±å†™å†…å­˜å¯¼è‡´ï¼Œä¸”æ˜¯éå…±äº«æ˜ å°„</span></span><br><span class="line">    <span class="keyword">if</span> (!(vma-&gt;vm_flags &amp; VM_SHARED))</span><br><span class="line">        <span class="keyword">return</span> do_cow_fault(mm, vma, address, pmd, pgoff, flags, orig_pte);</span><br><span class="line">    <span class="comment">// ç¼ºé¡µç”±å†™å†…å­˜å¯¼è‡´ï¼Œä¸”æ˜¯å…±äº«æ˜ å°„</span></span><br><span class="line">    <span class="keyword">return</span> do_shared_fault(mm, vma, address, pmd, pgoff, flags, orig_pte);</span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure>

<h3 id="do-read-fault"><a href="#do-read-fault" class="headerlink" title="do_read_fault"></a>do_read_fault</h3><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">do_read_fault</span><span class="params">(<span class="keyword">struct</span> mm_struct *mm, <span class="keyword">struct</span> vm_area_struct *vma,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">long</span> address, <span class="type">pmd_t</span> *pmd,</span></span><br><span class="line"><span class="params">        <span class="type">pgoff_t</span> pgoff, <span class="type">unsigned</span> <span class="type">int</span> flags, <span class="type">pte_t</span> orig_pte)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// do_fault_aroundå‡½æ•° å»ºç«‹æ˜ å°„å…³ç³»ï¼Œè€Œä¸ä¼šåˆ›å»ºé¡µé¢é«˜é€Ÿç¼“å­˜</span></span><br><span class="line">    <span class="comment">// æå‰å»ºç«‹è¿›ç¨‹åœ°å€ç©ºé—´ä¸é¡µé¢é«˜é€Ÿç¼“å­˜çš„æ˜ å°„å…³ç³»æœ‰åˆ©äºå‡å°å› ä¸ºå‘ç”Ÿç¼ºé¡µçš„æ¬¡æ•°ï¼Œæé«˜äº†æ•ˆç‡</span></span><br><span class="line">    <span class="keyword">if</span> (vma-&gt;vm_ops-&gt;map_pages &amp;&amp; fault_around_bytes &gt;&gt; PAGE_SHIFT &gt; <span class="number">1</span>) {</span><br><span class="line">        do_fault_around(vma, address, pte, pgoff, flags);</span><br><span class="line">        <span class="keyword">if</span> (!pte_same(*pte, orig_pte))</span><br><span class="line">            <span class="keyword">goto</span> unlock_out;</span><br><span class="line">        pte_unmap_unlock(pte, ptl);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// do_faultæ˜¯çœŸæ­£ä¸ºå¼‚å¸¸åœ°å€åˆ†é…ç‰©ç†é¡µé¢                                               </span></span><br><span class="line">    ret = __do_fault(vma, address, pgoff, flags, <span class="literal">NULL</span>, &amp;fault_page);</span><br><span class="line">    <span class="comment">//ä¸ºç‰©ç†é¡µé¢å’Œç¼ºé¡µå¼‚å¸¸å‘ç”Ÿçš„è™šæ‹Ÿåœ°å€å»ºç«‹æ˜ å°„å…³ç³»ï¼Œå³ä½¿ç”¨è¿™ä¸ªç‰©ç†é¡µé¢æ¥åˆ›å»ºä¸€ä¸ªPTEï¼Œç„¶åè®¾ç½®PTEï¼Œç„¶åé‡Šæ”¾é¡µé”ï¼Œå¹¶ä¸”å”¤é†’ç­‰å¾…è¿™ä¸ªé¡µé”çš„è¿›ç¨‹</span></span><br><span class="line">    do_set_pte(vma, address, fault_page, pte, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="do-cow-fault"><a href="#do-cow-fault" class="headerlink" title="do_cow_fault"></a>do_cow_fault</h3><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">do_cow_fault</span><span class="params">(<span class="keyword">struct</span> mm_struct *mm, <span class="keyword">struct</span> vm_area_struct *vma,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">long</span> address, <span class="type">pmd_t</span> *pmd,</span></span><br><span class="line"><span class="params">        <span class="type">pgoff_t</span> pgoff, <span class="type">unsigned</span> <span class="type">int</span> flags, <span class="type">pte_t</span> orig_pte)</span></span><br><span class="line">{</span><br><span class="line">	<span class="comment">// å‡†å¤‡ anon_vma ç»“æ„ä½“</span></span><br><span class="line">    <span class="keyword">if</span> (unlikely(anon_vma_prepare(vma)))</span><br><span class="line">        <span class="keyword">return</span> VM_FAULT_OOM;</span><br><span class="line">	<span class="comment">// ç”³è¯·é¡µ</span></span><br><span class="line">    new_page = alloc_page_vma(GFP_HIGHUSER_MOVABLE, vma, address);</span><br><span class="line">	<span class="comment">// å°†å†…å®¹è¯»å–åˆ°é¡µä¸Š</span></span><br><span class="line">    ret = __do_fault(vma, address, pgoff, flags, new_page, &amp;fault_page);</span><br><span class="line">	<span class="comment">// å¦‚æœfaulté¡µé¢å­˜åœ¨ï¼Œå°†å…¶æ‹·è´åˆ°newé¡µé¢ä¸Š</span></span><br><span class="line">    <span class="keyword">if</span> (fault_page)</span><br><span class="line">        copy_user_highpage(new_page, fault_page, address, vma);</span><br><span class="line">    <span class="comment">// è®¾ç½®é¡µè¡¨é¡¹ä¸­çš„ "uptodate" æ ‡å¿—ä½ï¼Œè¡¨ç¤ºé¡µé¢å·²ç»æ›´æ–°å¹¶ä¸”åŒ…å«äº†æœ‰æ•ˆæ•°æ®</span></span><br><span class="line">    __SetPageUptodate(new_page);</span><br><span class="line">	<span class="comment">// è®¾ç½®PTE</span></span><br><span class="line">    do_set_pte(vma, address, new_page, pte, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="do-share-fault"><a href="#do-share-fault" class="headerlink" title="do_share_fault"></a>do_share_fault</h3><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">do_shared_fault</span><span class="params">(<span class="keyword">struct</span> mm_struct *mm, <span class="keyword">struct</span> vm_area_struct *vma,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">long</span> address, <span class="type">pmd_t</span> *pmd,</span></span><br><span class="line"><span class="params">        <span class="type">pgoff_t</span> pgoff, <span class="type">unsigned</span> <span class="type">int</span> flags, <span class="type">pte_t</span> orig_pte)</span></span><br><span class="line">{</span><br><span class="line">	<span class="comment">// é€šè¿‡vma-&gt;vm_ops-&gt;faultå›è°ƒå‡½æ•°æ¥è¯»å–æ–‡ä»¶å†…å®¹åˆ°vmf-&gt;pageé‡Œ</span></span><br><span class="line">    ret = __do_fault(vma, address, pgoff, flags, <span class="literal">NULL</span>, &amp;fault_page);</span><br><span class="line">    <span class="comment">// é€šçŸ¥è¿›ç¨‹åœ°å€ç©ºé—´ï¼Œé¡µé¢å°†å˜æˆå¯å†™çš„ã€‚å¦‚æœä¸€ä¸ªé¡µé¢å˜æˆå¯å†™çš„ï¼Œé‚£ä¹ˆè¿›ç¨‹å¯èƒ½éœ€è¦ç­‰å¾…è¿™ä¸ªé¡µé¢çš„å†…å®¹å›å†™æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (vma-&gt;vm_ops-&gt;page_mkwrite) {</span><br><span class="line">        unlock_page(fault_page);</span><br><span class="line">        tmp = do_page_mkwrite(vma, fault_page, address);</span><br><span class="line">        <span class="keyword">if</span> (unlikely(!tmp ||</span><br><span class="line">                (tmp &amp; (VM_FAULT_ERROR | VM_FAULT_NOPAGE)))) {</span><br><span class="line">            page_cache_release(fault_page);</span><br><span class="line">            <span class="keyword">return</span> tmp;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å°†æ–°ç”Ÿæˆçš„PTE entryè®¾ç½®åˆ°ç¡¬ä»¶é¡µè¡¨ä¸­</span></span><br><span class="line">    do_set_pte(vma, address, fault_page, pte, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// å°†pageæ ‡è®°ä¸ºdirty</span></span><br><span class="line">    <span class="keyword">if</span> (set_page_dirty(fault_page))</span><br><span class="line">        dirtied = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// é€šè¿‡balance_dirty_pages_ratelimited()æ¥å¹³è¡¡å¹¶å›å†™ä¸€éƒ¨åˆ†è„é¡µ</span></span><br><span class="line">    <span class="keyword">if</span> ((dirtied || vma-&gt;vm_ops-&gt;page_mkwrite) &amp;&amp; mapping)</span><br><span class="line">        balance_dirty_pages_ratelimited(mapping);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å…¬å…±å‡½æ•°-do-fault"><a href="#å…¬å…±å‡½æ•°-do-fault" class="headerlink" title="å…¬å…±å‡½æ•°(_do_fault)"></a>å…¬å…±å‡½æ•°(_do_fault)</h3><p>ä¸»è¦å®Œæˆç¼ºé¡µå¯¹åº”æ–‡ä»¶é¡µç¼“å­˜ï¼ˆfile cacheï¼‰çš„è·å–</p>
<p>å¯¹äºå›è°ƒå‡½æ•°filemap_fault() ï¼Œä¼šåˆ¤æ–­å†…å­˜ä¸­æœ‰æ²¡æœ‰ä»¥å‰è®¿é—®åç•™ä¸‹çš„æ–‡ä»¶é¡µç¼“å­˜ï¼ˆfile cacheï¼‰ï¼Œå¦‚æœè¿˜æœ‰ï¼Œåˆ™ç›´æ¥æŠŠç•™å­˜çš„ file cache èµ‹ç»™ vmfâ€”&gt;pageã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™éœ€è¦å…ˆæ–°ç”³è¯·é¡µä½œä¸º file cacheï¼Œå†ä»ç£ç›˜ä¸­è¯»å–æ–‡ä»¶çš„æ•°æ®åˆ° file cacheã€‚file cache çš„å­˜åœ¨ä½¿å¾—ç¬¬äºŒæ¬¡æ˜ å°„åŒä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¯»å–ä¼šæ¯”ç¬¬ä¸€æ¬¡å¿«å¾ˆå¤š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> __do_fault(<span class="keyword">struct</span> vm_area_struct *vma, <span class="type">unsigned</span> <span class="type">long</span> address,</span><br><span class="line">            <span class="type">pgoff_t</span> pgoff, <span class="type">unsigned</span> <span class="type">int</span> flags,</span><br><span class="line">            <span class="keyword">struct</span> page *cow_page, <span class="keyword">struct</span> page **page)</span><br><span class="line">{</span><br><span class="line">	<span class="comment">// è°ƒç”¨æ–‡ä»¶æ˜ å°„é¡µçš„è™šæ‹Ÿåœ°å€åŒºåŸŸçš„ fault é’©å­å‡½æ•°</span></span><br><span class="line">    <span class="comment">// ä¸€èˆ¬æ–‡ä»¶ç³»ç»Ÿå¯¹åº” filemap_fault() å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ vm_ops ä¸€èˆ¬å®šä¹‰ä¸º generic_file_vm_ops</span></span><br><span class="line">    ret = vma-&gt;vm_ops-&gt;fault(vma, &amp;vmf);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å†™æ—¶å¤åˆ¶-do-wp-page"><a href="#å†™æ—¶å¤åˆ¶-do-wp-page" class="headerlink" title="å†™æ—¶å¤åˆ¶(do_wp_page)"></a>å†™æ—¶å¤åˆ¶(do_wp_page)</h2><ul>
<li><p>è°ƒç”¨æ¡ä»¶ï¼šPTEé¡µè¡¨é¡¹å­˜åœ¨ä¸”PRESENTå·²ç½®ä½ï¼›æ­¤æ¬¡æ“ä½œä¸ºå†™æ“ä½œä¸”PTEæ²¡æœ‰å†™æƒé™</p>
</li>
<li><p>å¤„ç†é€»è¾‘</p>
<p>å¯¹çº¿æ€§åœ°å€å¯¹åº”çš„ç‰©ç†é¡µé¢è¿›è¡Œæ£€éªŒï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨å…±äº«ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç›´æ¥è®¾ç½®pteä¸ºå¯è¯»å¯å†™ï¼Œç„¶ååˆ·æ–°é¡µç¼“å†²ä¹‹åè¿”å›ï¼›å¦‚æœæœ‰å…±äº«ï¼Œåˆ™é€šè¿‡get_free_pageå‡½æ•°å–å¾—ä¸€é¡µæ–°çš„ç‰©ç†é¡µé¢ï¼Œç„¶åå–æ¶ˆå…±äº«ï¼Œå°†æ–°çš„é¡µè¡¨é¡¹è®¾ç½®ä¸ºè¿™ä¸ªæ–°é¡µçš„åœ°å€ï¼Œåˆ·æ–°ç¼“å†²ï¼Œç„¶åå°†æ—§é¡µé¢çš„å†…å®¹å¤åˆ¶åˆ°æ–°é¡µé¢ã€‚</p>
</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">do_wp_page</span><span class="params">(<span class="keyword">struct</span> mm_struct *mm, <span class="keyword">struct</span> vm_area_struct *vma,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">long</span> address, <span class="type">pte_t</span> *page_table, <span class="type">pmd_t</span> *pmd,</span></span><br><span class="line"><span class="params">        <span class="type">spinlock_t</span> *ptl, <span class="type">pte_t</span> orig_pte)</span></span><br><span class="line">    __<span class="title function_">releases</span><span class="params">(ptl)</span></span><br><span class="line">{</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">page</span> *<span class="title">old_page</span>;</span></span><br><span class="line"></span><br><span class="line">    old_page = vm_normal_page(vma, address, orig_pte);</span><br><span class="line">    <span class="keyword">if</span> (!old_page) {</span><br><span class="line">		<span class="comment">// å¤„ç†å¯å†™å¹¶ä¸”å…±äº«çš„ç‰¹æ®Šæ˜ å°„é¡µé¢ï¼ˆåŒ…æ‹¬VM_MIXEDMAPæˆ–VM_PFNMAPé¡µé¢ï¼‰ï¼Œå¹¶è°ƒç”¨wp_page_reuseå‡½æ•°æ¥å¤ç”¨ç¼ºé¡µå¼‚å¸¸é¡µé¢</span></span><br><span class="line">        <span class="keyword">if</span> ((vma-&gt;vm_flags &amp; (VM_WRITE|VM_SHARED)) == (VM_WRITE|VM_SHARED))</span><br><span class="line">            <span class="keyword">return</span> wp_pfn_shared(mm, vma, address, page_table, ptl, orig_pte, pmd);</span><br><span class="line">        pte_unmap_unlock(page_table, ptl);</span><br><span class="line">        <span class="keyword">return</span> wp_page_copy(mm, vma, address, page_table, pmd, orig_pte, old_page);</span><br><span class="line">    }                                                                                                                             </span><br><span class="line">    <span class="keyword">if</span> (PageAnon(old_page) &amp;&amp; !PageKsm(old_page)) {</span><br><span class="line">        <span class="keyword">if</span> (reuse_swap_page(old_page)) {</span><br><span class="line">            <span class="comment">// wp_page_reuseï¼šå¤„ç†å¯ä»¥å¤ç”¨çš„é¡µé¢</span></span><br><span class="line">            <span class="keyword">return</span> wp_page_reuse(mm, vma, address, page_table, ptl, orig_pte, old_page, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (unlikely((vma-&gt;vm_flags &amp; (VM_WRITE|VM_SHARED)) == (VM_WRITE|VM_SHARED))) {</span><br><span class="line">        <span class="keyword">return</span> wp_page_shared(mm, vma, address, page_table, pmd, ptl, orig_pte, old_page);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¤„ç†å†™æ—¶å¤åˆ¶ï¼Œåˆ†é…æ–°çš„pageï¼Œæ‹·è´æ—§é¡µé¢åˆ°æ–°é¡µé¢ï¼Œå¹¶æ ¹æ®vm_page_protç”Ÿæˆæ–°çš„pteï¼Œæ·»åŠ åˆ°ç¡¬ä»¶é¡µè¡¨</span></span><br><span class="line">    <span class="keyword">return</span> wp_page_copy(mm, vma, address, page_table, pmd, orig_pte, old_page);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="do-numa-page"><a href="#do-numa-page" class="headerlink" title="do_numa_page"></a>do_numa_page</h2><p>éä¸€è‡´æ€§å†…å­˜è®¿é—®ï¼ˆNUMAï¼‰ä¸‹çš„é¡µè¡¨æ˜ å°„æ“ä½œ</p>
<h2 id="do-swap-page"><a href="#do-swap-page" class="headerlink" title="do_swap_page"></a>do_swap_page</h2><p>æ­¤æ—¶pteçš„å†…å®¹æ‰€å¯¹åº”çš„é¡µé¢åœ¨swapç©ºé—´ä¸­ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”±pteå¾—åˆ°swap entryï¼Œå†ç”±swap entryå¾—åˆ°pageï¼Œå†ç”±pteä»¥åŠpte entryæ·»åŠ åˆ°pteé¡µè¡¨</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><table>
<thead>
<tr>
<th>å¼‚å¸¸æ¥æº</th>
<th>ç›¸å…³å‡½æ•°è°ƒç”¨</th>
<th>ä¸­æ–­åŠ¨ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td>é¡µé¢æœªæ˜ å°„</td>
<td>do_anonymous_page</td>
<td>åˆ†é…ç‰©ç†é¡µé¢å¹¶åœ¨é¡µè¡¨ä¸­è®¾ç½®ä»è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„</td>
</tr>
<tr>
<td>å†™åªè¯»é¡µé¢</td>
<td>do_wp_page</td>
<td>å¦‚æœå†™æ—¶å¤åˆ¶å°±å¤åˆ¶ä¸€é¡µå¹¶æ ‡è®°å¯å†™è¿”å›è¿›ç¨‹ï¼›å¦‚æœå¼‚å¸¸å‘é€SIGSEGV</td>
</tr>
<tr>
<td>é¡µé¢åœ¨ç£ç›˜ä¸­</td>
<td></td>
<td>ä»ç£ç›˜æŒ‰éœ€åŠ è½½</td>
</tr>
<tr>
<td>æ²¡æœ‰è®¿é—®æƒé™</td>
<td></td>
<td>å‘é€SIGSEGVä¿¡å·</td>
</tr>
</tbody></table>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><a href="https://www.cntofu.com/book/114/Interrupts/interrupts-5.md">Interrupts and Interrupt Handling Part 5</a></li>
<li><a href="https://www.cnblogs.com/jikexianfeng/articles/5647994.html">ç¼ºé¡µå¼‚å¸¸è¯¦è§£</a></li>
<li><a href="https://blog.csdn.net/jasonactions/article/details/114886549">ç¼ºé¡µä¸­æ–­å¤„ç† - handle_pte_fault</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/607537244">å¼‚å¸¸å¤„ç†æµç¨‹2-page fault</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>pattern</category>
      </categories>
      <tags>
        <tag>é¡µä¸­æ–­</tag>
      </tags>
  </entry>
  <entry>
    <title>MIPI &amp;&amp; D-PHY</title>
    <url>/2023/05/30/computerSystem/protocol/mipi_dphy/</url>
    <content><![CDATA[<h1 id="MIPIåŸºç¡€"><a href="#MIPIåŸºç¡€" class="headerlink" title="MIPIåŸºç¡€"></a>MIPIåŸºç¡€</h1><p><img src="/images/computerSystem/protocol/mipi/mipi-1.png" alt="image"></p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul>
<li>å«ä¹‰ï¼šMIPIï¼ˆMobile Industry Processor Interfaceï¼‰ç§»åŠ¨è¡Œä¸šå¤„ç†å™¨æ¥å£</li>
<li>MIPIè”ç›Ÿï¼šä¸€å®¶å¼€æ”¾çš„ä¼šå‘˜åˆ¶ç»„ç»‡ï¼Œ2003å¹´7æœˆï¼Œç”±TIã€STã€ARMã€Nokiaå››å®¶å…¬å¸å…±åŒæˆç«‹ã€‚</li>
<li>MIPIåè®®ï¼šMIPIåè®®æœ¬è´¨æ˜¯å¤šä¸ªåè®®æ—ï¼Œéšç€MIPIçš„è§„èŒƒçš„ä¸æ–­çš„æ›´æ–°æ”¹è¿›ï¼Œç›®å‰è¾ƒä¸ºæˆç†Ÿçš„æ¥å£åŒ…æ‹¬æ‘„åƒå¤´æ¥å£CSIã€æ˜¾ç¤ºæ¥å£DSIï¼Œè€Œå¯¹äºå…¶ä¸­æ¯ä¸€ç§åˆåˆ†åˆ«åœ¨ç‰©ç†å±‚å’Œåè®®å±‚åšå‡ºäº†ç›¸åº”çš„è§„èŒƒã€‚è¯¥åè®®æœ€åˆåˆ¶å®šç›®çš„æ˜¯æŠŠæ‰‹æœºå†…éƒ¨å„ç§æ¥å£ï¼ˆæ˜¾ç¤ºå±ã€æ‘„åƒå¤´ã€å°„é¢‘ç­‰ï¼‰æ ‡å‡†åŒ–ï¼Œå‡å°‘æ‰‹æœºè®¾è®¡çš„å¤æ‚åº¦å’Œå¢åŠ è®¾è®¡çš„çµæ´»æ€§ã€‚</li>
</ul>
<h2 id="ä¸“æœ‰åè¯"><a href="#ä¸“æœ‰åè¯" class="headerlink" title="ä¸“æœ‰åè¯"></a>ä¸“æœ‰åè¯</h2><ul>
<li><p>DCSï¼šDisplay Command Setï¼Œæ˜¾ç¤ºå‘½ä»¤é›†åˆã€‚ç”¨äºæ˜¾ç¤ºæ¨¡å—å‘½ä»¤æ¨¡å¼ä¸‹çš„æ ‡å‡†åŒ–å‘½ä»¤é›†</p>
</li>
<li><p>DBIï¼šDisplay Bus Interfaceï¼Œæ˜¾ç¤ºæ€»çº¿æ¥å£ã€‚ä¸å…·æœ‰æ˜¾ç¤ºæ§åˆ¶å™¨å’Œå¸§ç¼“å†²å™¨çš„æ˜¾ç¤ºæ¨¡å—çš„å¹¶è¡Œæ¥å£</p>
</li>
<li><p>DPIï¼šDisplay Pixel Interfaceï¼Œæ˜¾ç¤ºåƒç´ æ¥å£ã€‚ä¸æ˜¾ç¤ºæ¨¡å—çš„å¹¶è¡Œæ¥å£ï¼Œä¸å¸¦æ˜¾ç¤ºæ§åˆ¶å™¨æˆ–å¸§ç¼“å†²å™¨</p>
</li>
<li><p>DSIï¼šDisplay Serial Interfaceï¼Œæ˜¾ç¤ºä¸²è¡Œæ¥å£ã€‚ä¸»æœºå¤„ç†å™¨ä¸æ˜¾ç¤ºæ¨¡å—ä¹‹é—´çš„é«˜é€Ÿä¸²è¡Œæ¥å£</p>
</li>
<li><p>CSIï¼šCamera Serial Interfaceï¼Œç›¸æœºä¸²è¡Œæ¥å£ã€‚ä¸»æœºå¤„ç†å™¨ä¸æ‘„åƒå¤´æ¨¡å—ä¹‹é—´çš„é«˜é€Ÿä¸²è¡Œæ¥å£</p>
</li>
<li><p>PHYï¼šPhysicalï¼Œç‰©ç†å±‚ã€‚ç‰©ç†å±‚è§„èŒƒäº†ä¼ è¾“ä»‹è´¨ã€ç”µæ°”ç‰¹æ€§ã€IOç”µè·¯ã€å’ŒåŒæ­¥æœºåˆ¶ã€‚é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯æŒ‡å®šç‰©ç†å±‚æ„å»ºçš„è§„åˆ™ï¼Œæ¯”å¦‚æŒ‡å®šå¦‚ä½•æ‹¿åˆ°æ•°æ®ã€æ€æ ·ç¼–ç ã€è½¬åŒ–æˆæ€æ ·çš„ç”µä¿¡å·ã€é€šè¿‡å¤šå°‘æ ¹/ç»„é€šé“é€å‡ºå»ç­‰ç­‰ã€‚</p>
<ul>
<li>C-PHYï¼š100Mbits/sï¼ŒCæ˜¯ç½—é©¬æ•°å­—ï¼ˆæ‹‰ä¸æ–‡æ•°å­—ï¼‰ä¸­100 </li>
<li>D-PHYï¼š 500Mbits/sï¼ŒDæ˜¯ç½—é©¬æ•°å­—ï¼ˆæ‹‰ä¸æ–‡æ•°å­—ï¼‰ä¸­500 </li>
<li>M-PHYï¼š1000Mbits/sï¼ŒMæ˜¯ç½—é©¬æ•°å­—ï¼ˆæ‹‰ä¸æ–‡æ•°å­—ï¼‰ä¸­1000</li>
</ul>
</li>
<li><p>APPIï¼šAbstracted PHY-Protocol Interfaceï¼ŒæŠ½è±¡ç‰©ç†åè®®æ¥å£</p>
</li>
<li><p>PPIï¼šPHY-Protocol Interfaceï¼Œ ç‰©ç†åè®®æ¥å£</p>
</li>
<li><p>SoTï¼šStart of Transmissionï¼Œä¼ è¾“å¼€å§‹</p>
</li>
<li><p>EoTï¼šEnd of Transmissionï¼Œä¼ è¾“ç»“æŸ</p>
</li>
</ul>
<h2 id="MIPIå±‚æ¬¡"><a href="#MIPIå±‚æ¬¡" class="headerlink" title="MIPIå±‚æ¬¡"></a>MIPIå±‚æ¬¡</h2><blockquote>
<p>æœ¬éƒ¨åˆ†æ–‡å­—è¯´æ˜å‡æ¥è‡ªå®˜æ–¹æ–‡æ¡£è¯´æ˜</p>
</blockquote>
<p><img src="/images/computerSystem/protocol/mipi/mipi-2.png" alt="image"></p>
<h3 id="DSI"><a href="#DSI" class="headerlink" title="DSI"></a>DSI</h3><ul>
<li><p>PHY layer</p>
<p>PHY å±‚æŒ‡å®šä¼ è¾“ä»‹è´¨ï¼ˆç”µå¯¼ä½“ï¼‰ã€è¾“å…¥/è¾“å‡ºç”µè·¯å’Œä»ä¸²è¡Œæ¯”ç‰¹æµä¸­æ•è·â€œ1â€å’Œâ€œ0â€çš„æ—¶é’Ÿæœºåˆ¶ã€‚ è§„èŒƒçš„è¿™ä¸€éƒ¨åˆ†è®°å½•äº†ä¼ è¾“ä»‹è´¨çš„ç‰¹æ€§ã€ä¿¡å·çš„ç”µæ°”å‚æ•°ä»¥åŠæ—¶é’Ÿå’Œæ•°æ®é€šé“ä¹‹é—´çš„æ—¶åºå…³ç³»ã€‚</p>
<p>ä¼ è¾“å¼€å§‹ (SoT) å’Œä¼ è¾“ç»“æŸ (EoT) çš„ä¿¡ä»¤æœºåˆ¶ä»¥åŠå¯ä»¥åœ¨ä¼ è¾“å’Œæ¥æ”¶ PHY ä¹‹é—´ä¼ é€çš„å…¶ä»–â€œå¸¦å¤–â€ä¿¡æ¯è¢«æŒ‡å®šã€‚ ä½çº§å’Œå­—èŠ‚çº§åŒæ­¥æœºåˆ¶ä½œä¸º PHY çš„ä¸€éƒ¨åˆ†åŒ…å«åœ¨å†…ã€‚</p>
</li>
<li><p>Lane Management Layer</p>
<p>DSI é€šè¿‡é€šé“æ‰©å±•ä»¥æé«˜æ€§èƒ½ã€‚ æ ¹æ®åº”ç”¨çš„å¸¦å®½è¦æ±‚ï¼Œæ•°æ®ä¿¡å·çš„æ•°é‡å¯ä»¥æ˜¯ 1ã€2ã€3 æˆ– 4ã€‚ æ¥å£çš„å‘é€ç«¯å°†è¾“å‡ºæ•°æ®æµåˆ†é…åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé€šé“ï¼ˆâ€œåˆ†é…å™¨â€åŠŸèƒ½ï¼‰ã€‚ åœ¨æ¥æ”¶ç«¯ï¼Œæ¥å£ä»é€šé“æ”¶é›†å­—èŠ‚å¹¶å°†å®ƒä»¬åˆå¹¶åˆ°ä¸€ä¸ªé‡æ–°ç»„åˆçš„æ•°æ®æµä¸­ï¼Œæ¢å¤åŸå§‹æµåºåˆ—ï¼ˆâ€œåˆå¹¶â€åŠŸèƒ½ï¼‰ã€‚</p>
</li>
<li><p>Protocol Layer</p>
<p>åœ¨æœ€ä½çº§åˆ«ï¼ŒDSI åè®®è§„å®šäº†é€šè¿‡æ¥å£çš„ä½å’Œå­—èŠ‚çš„é¡ºåºå’Œå€¼ã€‚ å®ƒæŒ‡å®šå¦‚ä½•å°†å­—èŠ‚ç»„ç»‡æˆç§°ä¸ºæ•°æ®åŒ…çš„å®šä¹‰ç»„ã€‚ è¯¥åè®®å®šä¹‰äº†æ¯ä¸ªæ•°æ®åŒ…æ‰€éœ€çš„æ ‡å¤´ï¼Œä»¥åŠå¦‚ä½•ç”Ÿæˆå’Œè§£é‡Šæ ‡å¤´ä¿¡æ¯ã€‚ æ¥å£çš„å‘é€ç«¯å°†æŠ¥å¤´å’Œé”™è¯¯æ£€æŸ¥ä¿¡æ¯é™„åŠ åˆ°æ­£åœ¨å‘é€çš„æ•°æ®ä¸Šã€‚ åœ¨æ¥æ”¶æ–¹ï¼Œæ ‡å¤´è¢«å‰¥ç¦»å¹¶ç”±æ¥æ”¶æ–¹ä¸­çš„ç›¸åº”é€»è¾‘è§£é‡Šã€‚ é”™è¯¯æ£€æŸ¥ä¿¡æ¯å¯ç”¨äºæµ‹è¯•ä¼ å…¥æ•°æ®çš„å®Œæ•´æ€§ã€‚ DSI åè®®è¿˜è®°å½•äº†å¦‚ä½•æ ‡è®°æ•°æ®åŒ…ä»¥ä½¿ç”¨å•ä¸ª DSI å°†å¤šä¸ªå‘½ä»¤æˆ–æ•°æ®æµäº¤ç»‡åˆ°ä¸åŒçš„ç›®çš„åœ°ã€‚</p>
</li>
<li><p>App Layer</p>
<p>è¯¥å±‚æè¿°äº†æ•°æ®æµä¸­åŒ…å«çš„æ•°æ®çš„æ›´é«˜çº§åˆ«çš„ç¼–ç å’Œè§£é‡Šã€‚ æ ¹æ®æ˜¾ç¤ºå­ç³»ç»Ÿæ¶æ„ï¼Œå®ƒå¯èƒ½åŒ…å«å…·æœ‰è§„å®šæ ¼å¼çš„åƒç´ ï¼Œæˆ–ç”±æ˜¾ç¤ºæ¨¡å—å†…çš„æ˜¾ç¤ºæ§åˆ¶å™¨è§£é‡Šçš„å‘½ä»¤ã€‚ DSI è§„èŒƒæè¿°äº†åƒç´ å€¼ã€å‘½ä»¤å’Œå‘½ä»¤å‚æ•°åˆ°æ•°æ®åŒ…ç»„ä»¶ä¸­å­—èŠ‚çš„æ˜ å°„ã€‚ ï¼ˆDCS specificationæ–‡æ¡£ï¼‰</p>
</li>
</ul>
<h3 id="CSI-2"><a href="#CSI-2" class="headerlink" title="CSI-2"></a>CSI-2</h3><ul>
<li><p>PHY layerï¼šåŒDSI</p>
</li>
<li><p>Protocol Layerï¼šæŒ‡å®šå¦‚ä½•æ ‡è®°å’Œäº¤é”™å¤šä¸ªæ•°æ®æµï¼Œä»¥ä¾¿å¯ä»¥æ­£ç¡®åœ°é‡å»ºæ¯ä¸ªæ•°æ®æµã€‚</p>
<ul>
<li>åƒç´ /å­—èŠ‚æ‰“åŒ…/è§£åŒ…å±‚ï¼ˆPixel/Byte Packing/Unpacking Layerï¼‰</li>
</ul>
<p>  CSI-2 æ”¯æŒå…·æœ‰ä»æ¯åƒç´  6 åˆ° 24 ä½çš„ä¸åŒåƒç´ æ ¼å¼çš„å›¾åƒåº”ç”¨ç¨‹åºã€‚ åœ¨å‘é€å™¨ä¸­ï¼Œè¯¥å±‚åœ¨å°†æ•°æ®å‘é€åˆ°ä½çº§åè®®å±‚ä¹‹å‰å°†æ¥è‡ªåº”ç”¨å±‚çš„åƒç´ æ‰“åŒ…æˆå­—èŠ‚ã€‚ åœ¨æ¥æ”¶å™¨ä¸­ï¼Œè¯¥å±‚åœ¨å°†æ•°æ®å‘é€åˆ°åº”ç”¨å±‚ä¹‹å‰å°†æ¥è‡ªä½çº§åè®®å±‚çš„å­—èŠ‚è§£å‹ç¼©ä¸ºåƒç´ ã€‚ è¯¥å±‚ä»¥ä¸å˜çš„æ–¹å¼ä¼ è¾“æ¯åƒç´ å…«ä½æ•°æ®ã€‚</p>
<ul>
<li>ä½çº§åè®®å±‚ï¼ˆLow Level Protocolï¼‰</li>
</ul>
<p>  ä½çº§åè®® (LLP) åŒ…æ‹¬ä¸º SoTï¼ˆä¼ è¾“å¼€å§‹ï¼‰å’Œ EoTï¼ˆä¼ è¾“ç»“æŸï¼‰äº‹ä»¶ä¹‹é—´ä¼ è¾“çš„ä¸²è¡Œæ•°æ®å»ºç«‹ bit508 çº§å’Œå­—èŠ‚çº§åŒæ­¥ä»¥åŠå°†æ•°æ®ä¼ é€’åˆ°ä¸‹ä¸€å±‚çš„æ–¹æ³•ã€‚ LLP çš„æœ€å°æ•°æ®ç²’åº¦æ˜¯ä¸€ä¸ªå­—èŠ‚ã€‚ LLP è¿˜åŒ…æ‹¬å­—èŠ‚å†…ä½å€¼è§£é‡Šçš„åˆ†é…ï¼Œå³â€œEndianâ€åˆ†é…ã€‚</p>
<ul>
<li>é€šé“ç®¡ç†å±‚ï¼ˆLane Management ï¼‰ï¼šåŒDSI</li>
</ul>
</li>
<li><p>APP layerï¼šè¯¥å±‚æè¿°äº†æ›´é«˜çº§åˆ«çš„æ•°æ®ç¼–ç å’Œè§£é‡ŠåŒ…å«åœ¨æ•°æ®æµä¸­ã€‚ CSI-2 è§„èŒƒæè¿°äº†åƒç´ å€¼åˆ°å­—èŠ‚ã€‚</p>
</li>
</ul>
<h2 id="å·®åˆ†-x2F-å•ç«¯ä¿¡å·"><a href="#å·®åˆ†-x2F-å•ç«¯ä¿¡å·" class="headerlink" title="å·®åˆ†/å•ç«¯ä¿¡å·"></a>å·®åˆ†/å•ç«¯ä¿¡å·</h2><ul>
<li>å•ç«¯ä¿¡å·ï¼šå•ç«¯ä¿¡å·æ˜¯ç›¸å¯¹äºå·®åˆ†ä¿¡å·è€Œè¨€çš„ï¼Œå•ç«¯è¾“å…¥æŒ‡ä¿¡å·æœ‰ä¸€ä¸ªå‚è€ƒç«¯å’Œä¸€ä¸ªä¿¡å·ç«¯æ„æˆï¼Œå‚è€ƒç«¯ä¸€èˆ¬ä¸ºåœ°ç«¯</li>
<li>å·®åˆ†ä¿¡å·ï¼šä¸¤æ ¹çº¿ä¸Šéƒ½ä¼ è¾“ä¿¡å·ï¼Œè¿™ä¸¤ä¸ªä¿¡å·çš„æŒ¯å¹…ç›¸ç­‰ï¼Œç›¸ä½ç›¸åï¼ˆå¤§å°ç­‰ã€æ–¹å‘åï¼‰ï¼Œä¹Ÿç§°å·®æ¨¡ä¿¡å·</li>
<li>å…±æ¨¡ä¿¡å·ï¼šä¸¤ä¸ªä¿¡å·æŒ¯å¹…ç›¸ç­‰ï¼Œç›¸ä½ç›¸åŒï¼ˆå¹²æ‰°ä¿¡å·ï¼‰</li>
</ul>
<p><img src="/images/computerSystem/protocol/mipi/mipi-3.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦ä¾§ä¸ºå·®åˆ†ä¿¡å·ï¼Œå³ä¾§ä¸ºå•ç«¯ä¿¡å·ã€‚å¯¹äºå·®åˆ†ä¿¡å·V+ç”µæµæµå‘åœ°ã€V-ç”µæµç”±åœ°æµå‡ºã€‚å¯¹äºåŒä¸€ä¸ªåœ°æ¥è®²ï¼Œå¦‚æœå­˜åœ¨å…±æ¨¡è¯¯å·®ï¼Œä¸¤æ ¹çº¿éƒ½æœ‰åšå·®å€¼å°±æŠµæ¶ˆæ‰äº†ï¼Œå¯¹äºç”µç£å¹²æ‰°ç”±äºç›¸ä½ç›¸åç£åœºæŠµæ¶ˆã€‚å› æ­¤å·®åˆ†ä¿¡å·ç‰¹ç‚¹ï¼šæ˜“åˆ†è¾¨å°ä¿¡å·ï¼ŒæŠ—å¹²æ‰°èƒ½åŠ›å¼ºï¼›ä½†åŒæ—¶ç”±äºä½¿ç”¨äº†ä¸¤æ ¹çº¿æˆæœ¬è¾ƒé«˜</p>
<h1 id="PHY"><a href="#PHY" class="headerlink" title="PHY"></a>PHY</h1><h2 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>PHYå±‚è§„èŒƒäº†ä¼ è¾“ä»‹è´¨ã€ç”µæ°”ç‰¹æ€§ã€IOç”µè·¯ã€å’ŒåŒæ­¥æœºåˆ¶ã€‚é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯æŒ‡å®šç‰©ç†å±‚æ„å»ºçš„è§„åˆ™ï¼Œæ¯”å¦‚æŒ‡å®šå¦‚ä½•æ‹¿åˆ°æ•°æ®ã€æ€æ ·ç¼–ç ã€è½¬åŒ–æˆæ€æ ·çš„ç”µä¿¡å·ã€é€šè¿‡å¤šå°‘æ ¹/ç»„é€šé“é€å‡ºå»ç­‰ç­‰ã€‚é€šè¿‡æ ‡å‡†åŒ–ä¸åŒåˆ¶é€ å•†çš„äº§å“ä¹‹é—´çš„æ¥å£æ¥é™ä½ç§»åŠ¨è®¾å¤‡çš„è®¾è®¡æˆæœ¬ï¼Œä»è€Œç¼©çŸ­äº§å“ä¸Šå¸‚æ—¶é—´ã€‚</p>
<h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><p><img src="/images/computerSystem/protocol/mipi/mipi-4.png" alt="image"></p>
<h1 id="D-PHY"><a href="#D-PHY" class="headerlink" title="D-PHY"></a>D-PHY</h1><p>D-PHY æè¿°äº†ä¸€ç§æºåŒæ­¥ã€é«˜é€Ÿã€ä½åŠŸè€—ã€ä½æˆæœ¬çš„ PHYï¼Œç‰¹åˆ«é€‚ç”¨äºç§»åŠ¨åº”ç”¨ã€‚</p>
<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h3 id="Lane"><a href="#Lane" class="headerlink" title="Lane"></a>Lane</h3><p>Laneæœ¬æ„æ˜¯èˆªé“ã€è½¦é“ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†å…¶å¼•ç”³ä¸ºä¸¤ä¸ªæ¨¡å—é—´ä¼ è¾“æ•°æ®çš„é€šé“ã€‚</p>
<p>å¯¹äºä¸€ç»„ä¿¡å·æ¥è®²ï¼Œä¸»ä»ç«¯ï¼ˆæ”¶å‘ç«¯ï¼‰å„æœ‰ä¸€ä¸ªLaneæ¨¡å—ï¼Œå¹¶ä¸”æ¨¡å—é—´ä½¿ç”¨ä¸€ç»„å·®åˆ†ä¿¡å·è¿›è¡Œè¿æ¥ï¼Œä¹Ÿå°±æ˜¯2æ¡lineå³V+ ã€V-ã€‚è€ŒLaneæ¨¡å—å’Œä¸­é—´çš„è¿çº¿ä½œä¸ºæ•´ä¸ªç‰©ç†å±‚æ ¸å¿ƒï¼Œå…±åŒæ„æˆäº†å®Œæ•´çš„æ•°æ®æ•°æ®ä¼ è¾“é€šé“ã€‚</p>
<p>D-PHYåè®®è§„å®šäº†å¿…é¡»æ‹¥æœ‰ä¸€æ¡æ—¶é’Ÿé€šé“ï¼ˆClock Laneï¼šClock+ã€Clock-ï¼‰å’Œä¸€æ¡æˆ–è€…å¤šæ¡æ•°æ®é€šé“ï¼ˆData Laneï¼šD+ã€D-ï¼‰</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul>
<li><p>ä¸»ä»æ¨¡å¼ï¼ˆmasteræä¾›æ—¶é’Ÿï¼‰</p>
</li>
<li><p>æ—¶é’Ÿé€šé“ Clock Laneï¼šå•å‘ç”±masterè‡³slave</p>
</li>
<li><p>æ•°æ®é€šé“ Data Laneï¼šæ•°æ®å¯å•å‘ã€å¯åŒå‘ï¼ˆåŠåŒå·¥ï¼‰ï¼Œå…¶ä¸­tokenæ§åˆ¶äº†ä¼ è¾“æ–¹å‘ï¼Œå¹¶ä¸”å½“åœ¨åå‘ä¼ è¾“æ•°æ®çš„æ—¶å€™ï¼ˆSlave To Masterï¼‰ï¼Œå¸¦å®½åªæœ‰æ­£å‘ä¼ è¾“ï¼ˆMaster To Slaveï¼‰çš„å››åˆ†ä¹‹ä¸€</p>
</li>
</ul>
<h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p><img src="/images/computerSystem/protocol/mipi/mipi-5.png" alt="image"></p>
<p>ä¸Šå›¾æ˜¯é€šç”¨é€šé“æ¨¡å—æ¶æ„ï¼Œä¸ºäº†é€šç”¨æ€§å’Œå±‚æ¬¡æŠ½è±¡ï¼Œå°†LPã€HSéƒ½åšäº†åŒå‘çš„å±•ç¤ºã€‚è€Œåœ¨å®é™…è®¾è®¡æˆ–è€…å¼€å‘ä¸­ï¼Œæ ¹æ®å®é™…éœ€æ±‚åªè®¾è®¡æˆ–é…ç½®å•é¡¹ä¼ è¾“éƒ½æ˜¯okçš„</p>
<h2 id="ä¼ è¾“æ¨¡å¼"><a href="#ä¼ è¾“æ¨¡å¼" class="headerlink" title="ä¼ è¾“æ¨¡å¼"></a>ä¼ è¾“æ¨¡å¼</h2><ul>
<li><p>é«˜é€Ÿæ¨¡å¼ï¼ˆHigh Speedï¼ŒHSï¼‰</p>
<p>High-Speed ä¹Ÿå« Burst Modeï¼Œç”¨äºé«˜é€Ÿçš„æ•°æ®ä¼ è¾“ï¼Œå…¶å®å°±æ˜¯å›¾åƒæ•°æ®ä¼ è¾“ï¼›åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œååç‡å¯ä»¥è¾¾åˆ° 2500 Mbpsï¼Œä¹Ÿå°±æ˜¯ 2.5Gbps/per Laneï¼›</p>
</li>
<li><p>ä½é€Ÿæ¨¡å¼ï¼ˆLow Powerï¼ŒLPï¼‰</p>
<p>Low-Power æ¨¡å¼ç”¨äºä¸€äº›æ§åˆ¶ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œä¼ ä¸€äº›æŒ‡ä»¤ä¹‹ç±»çš„ï¼›åœ¨è¿™ç§æ¨¡å¼ä¸‹çš„æœ€å¤§é€Ÿç‡æ˜¯ 10Mbpsï¼›</p>
<p>data laneå·®åˆ†çº¿ç”µå¹³çš„é«˜ä½è¡¨æ˜äº†å½“å‰å¤„äºä½•ç§çŠ¶æ€ï¼Œå‘é€æ–¹é€šè¿‡é©±åŠ¨å·®åˆ†çº¿ä¸€ç³»åˆ—çš„çŠ¶æ€å˜åŒ–ï¼Œè¿›å…¥ä¸åŒçš„å·¥ä½œæ¨¡å¼</p>
</li>
</ul>
<p>æ— è®ºæ˜¯HSæ¨¡å¼è¿˜æ˜¯LPæ¨¡å¼ï¼Œéƒ½é‡‡ç”¨LSB fisrtã€MSB lastçš„ä¼ è¾“æ–¹å¼ã€‚ä¸¤ç§æ¨¡å¼çš„ç»“åˆä¿è¯äº†MIPIæ€»çº¿åœ¨éœ€è¦ä¼ è¾“å¤§é‡æ•°æ®ï¼ˆå¦‚å›¾åƒï¼‰æ—¶å¯ä»¥é«˜é€Ÿä¼ è¾“ï¼Œè€Œåœ¨ä¸éœ€è¦å¤§æ•°æ®é‡ä¼ è¾“æ—¶åˆèƒ½å¤Ÿå‡å°‘åŠŸè€—ã€‚</p>
<p><img src="/images/computerSystem/protocol/mipi/mipi-6.png" alt="image"></p>
<table>
<thead>
<tr>
<th></th>
<th>HSæ¨¡å¼</th>
<th>LPæ¨¡å¼</th>
</tr>
</thead>
<tbody><tr>
<td>ä¼ è¾“æ¨¡å¼</td>
<td>ä½å‹å·®åˆ†ä¿¡å·ä¼ è¾“</td>
<td>å•ç«¯ä¿¡å·ä¼ è¾“</td>
</tr>
<tr>
<td>ä¿¡å·ç”µå¹³</td>
<td>100mV ~ 300mV</td>
<td>0 ~ 1.2V</td>
</tr>
<tr>
<td>ä¼ è¾“é€Ÿåº¦</td>
<td>80Mbps ~ 1Gbpsï¼ˆv1.0ï¼‰<br>80Mbps ~ 1.5Gbpsï¼ˆv1.1ï¼‰<br>2.5Gbpsï¼ˆv1.2ï¼‰<br>10Gbps ~ 14Gbpsï¼ˆv3.0ï¼‰</td>
<td>&lt;10Mbps</td>
</tr>
<tr>
<td>åŠŸè€—</td>
<td>é«˜</td>
<td>ä½</td>
</tr>
</tbody></table>
<h2 id="LaneçŠ¶æ€æè¿°"><a href="#LaneçŠ¶æ€æè¿°" class="headerlink" title="LaneçŠ¶æ€æè¿°"></a>LaneçŠ¶æ€æè¿°</h2><p>åœ¨ High-Speed æ¨¡å¼ä¸‹ï¼ŒLane ä¸Šä¼ è¾“çš„æ˜¯å·®åˆ†ä¿¡å·ï¼›</p>
<p>åœ¨ Low-Power æ¨¡å¼ä¸‹ï¼ŒLane ä¸Šçš„ 2 æ ¹çº¿æ˜¯ç‹¬ç«‹çš„ä¿¡å·ï¼Œä¸å†æ˜¯å·®åˆ†çš„å«ä¹‰äº†ï¼›</p>
<p><img src="/images/computerSystem/protocol/mipi/mipi-7.png" alt="image"></p>
<h2 id="æ•°æ®Laneæ“ä½œæ¨¡å¼"><a href="#æ•°æ®Laneæ“ä½œæ¨¡å¼" class="headerlink" title="æ•°æ®Laneæ“ä½œæ¨¡å¼"></a>æ•°æ®Laneæ“ä½œæ¨¡å¼</h2><p>åœ¨æ­£å¸¸æ“ä½œæœŸé—´ï¼Œæ•°æ®é€šé“å°†å¤„äºæ§åˆ¶æˆ–é«˜é€Ÿæ¨¡å¼ã€‚</p>
<h3 id="é«˜é€Ÿæ¨¡å¼ï¼ˆHigh-Speed-Modeï¼‰"><a href="#é«˜é€Ÿæ¨¡å¼ï¼ˆHigh-Speed-Modeï¼‰" class="headerlink" title="é«˜é€Ÿæ¨¡å¼ï¼ˆHigh-Speed Modeï¼‰"></a>é«˜é€Ÿæ¨¡å¼ï¼ˆHigh-Speed Modeï¼‰</h3><p>é«˜é€Ÿæ•°æ®ä¼ è¾“ä»¥çªå‘ï¼ˆburstï¼‰æ–¹å¼å‘ç”Ÿã€‚ä¼ è¾“ä»åœæ­¢çŠ¶æ€å¼€å§‹ï¼Œå¹¶ä»¥åœæ­¢çŠ¶æ€ç»“æŸã€‚åœ¨çªå‘ä¹‹é—´çš„ä¸­é—´æ—¶é—´å†…ï¼Œæ•°æ®é€šé“åº”ä¿æŒåœæ­¢çŠ¶æ€ï¼Œé™¤éé€šé“ä¸Šå‡ºç° turnaround æˆ– escape è¯·æ±‚ã€‚åœ¨HS æ•°æ®çªå‘æœŸé—´ï¼Œæ—¶é’Ÿé€šé“åº”å¤„äºé«˜é€Ÿæ¨¡å¼ï¼Œä¸ºä»ç«¯æä¾› DDR æ—¶é’Ÿ</p>
<p><img src="/images/computerSystem/protocol/mipi/mipi-8.png" alt="image"></p>
<p>ä¼ è¾“å¼€å§‹ï¼ˆSOTï¼‰è‡³ ä¼ è¾“ç»“æŸ ï¼ˆEOTï¼‰åºåˆ—ï¼š</p>
<ul>
<li>é©±åŠ¨ åœæ­¢ çŠ¶æ€ï¼ˆLP-11ï¼‰</li>
<li>é©±åŠ¨ HS-Rqst çŠ¶æ€æŒç»­TLPSæ—¶é—´ (LP-01)</li>
<li>é©±åŠ¨ Bridge çŠ¶æ€æŒç»­HS-PREPAREæ—¶é—´ï¼ˆLP-00ï¼‰</li>
<li>åŒæ—¶å¯ç”¨é«˜é€Ÿé©±åŠ¨å™¨å’Œç¦ç”¨ä½åŠŸè€—é©±åŠ¨å™¨</li>
<li>é©±åŠ¨ HS-0 æŒç»­THS-ZEROæ—¶é—´</li>
<li>é‡‡æ ·å¼€å§‹ï¼ï¼ï¼</li>
<li>â€¦â€¦</li>
<li>å®Œæˆæœ‰æ•ˆè½½è·æ•°æ®çš„ä¼ è¾“</li>
<li>åœ¨æœ€åä¸€ä¸ªæœ‰æ•ˆè½½è·æ•°æ®ä½ä¹‹åç«‹å³åˆ‡æ¢å·®åˆ†çŠ¶æ€å¹¶ä¿æŒè¯¥çŠ¶æ€ä¸€æ®µæ—¶é—´ THS-TRAIL</li>
<li>ç¦ç”¨ HS-TXï¼Œå¯ç”¨ LP-TXï¼Œå¹¶é©±åŠ¨åœæ­¢çŠ¶æ€ (LP-11) ä¸€æ®µæ—¶é—´ THS-EXI</li>
</ul>
<h3 id="æ§åˆ¶æ¨¡å¼ï¼ˆControl-Modeï¼‰"><a href="#æ§åˆ¶æ¨¡å¼ï¼ˆControl-Modeï¼‰" class="headerlink" title="æ§åˆ¶æ¨¡å¼ï¼ˆControl Modeï¼‰"></a>æ§åˆ¶æ¨¡å¼ï¼ˆControl Modeï¼‰</h3><p>low powerä¸‹çš„ä¸€ç§æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡å˜åŒ–ä¸åŒçš„stateè¿›å…¥å…¶å®ƒæ¨¡å¼ã€‚è¿™ä¸ªç›®å‰æ²¡æœ‰çœ‹åˆ°æ›´å¤šç›¸å…³èµ„æ–™ã€‚</p>
<h4 id="åŒå‘æ•°æ®ä¼ è¾“-Data-Lane-Turnaround"><a href="#åŒå‘æ•°æ®ä¼ è¾“-Data-Lane-Turnaround" class="headerlink" title="åŒå‘æ•°æ®ä¼ è¾“ Data Lane Turnaround"></a>åŒå‘æ•°æ®ä¼ è¾“ Data Lane Turnaround</h4><p><img src="/images/computerSystem/protocol/mipi/mipi-9.png" alt="image"></p>
<p>D-PHYåŒå‘é€šé“æ”¯æŒTurnAroundæ“ä½œï¼Œå³åè½¬æ“ä½œåŒå‘ä¼ è¾“ã€‚è™½ç„¶æ•°æ®åå‘ä¼ è¾“ä½†æ˜¯master/slaveè§’è‰²ä¸å˜ï¼Œmasterå‘slaveå»è¯»æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨æ§åˆ¶æ¨¡å¼ä¸‹æ‰§è¡Œçš„ï¼ï¼ï¼</p>
<p>æµç¨‹ï¼š</p>
<ul>
<li>é©±åŠ¨åœæ­¢çŠ¶æ€ LP11</li>
<li>é©±åŠ¨ LP-Rqst çŠ¶æ€ (LP-10) æŒç»­ TLPX æ—¶é—´</li>
<li>é©±åŠ¨æ¡¥æ€ (LP-00) æ—¶é—´ TLPX æ—¶é—´</li>
<li>é©±åŠ¨ LP-10 çŠ¶æ€ TLPX æ—¶é—´</li>
<li>é©±åŠ¨æ¡¥æ€ (LP-00) æ—¶é—´ TTA-GOæ—¶é—´</li>
<li>åœæ­¢é©±åŠ¨çº¿è·¯å¹¶ä½¿ç”¨å…¶ LP-RX è§‚å¯Ÿçº¿è·¯çŠ¶æ€ä»¥æŸ¥çœ‹ç¡®è®¤Wait ACKï¼ˆæ¥æ”¶ LP-00ï¼‰</li>
<li>æ¥æ”¶ LP-10</li>
<li>æ¥æ”¶ LP-11</li>
</ul>
<h3 id="é€ƒé€¸æ¨¡å¼ï¼ˆEscape-modeï¼‰"><a href="#é€ƒé€¸æ¨¡å¼ï¼ˆEscape-modeï¼‰" class="headerlink" title="é€ƒé€¸æ¨¡å¼ï¼ˆEscape modeï¼‰"></a>é€ƒé€¸æ¨¡å¼ï¼ˆEscape modeï¼‰</h3><p>low powerä¸‹çš„ç‰¹æ®Šæ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹åˆ«çš„åŠŸèƒ½ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¿›å…¥ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼šLPDTï¼ˆä½åŠŸè€—æ•°æ®ä¼ è¾“æ¨¡å¼ï¼‰, ULPS(è¶…ä½åŠŸè€—æ¨¡å¼)ã€Triggerã€‚ä¸€æ—¦è¿›å…¥Escape modeæ¨¡å¼ï¼Œå‘é€ç«¯å¿…é¡»å‘é€1ä¸ª8-bitçš„å‘½ä»¤æ¥å“åº”è¯·æ±‚çš„åŠ¨ä½œï¼ˆå¯¹äºEscape Modeæµç¨‹æ¥è®²ï¼Œæœ€ç»ˆéœ€è¦å‘é€ä¸€ä¸ªEntry Commandï¼Œè€ŒTable 8å°±æ˜¯3ä¸ªå‘½ä»¤ï¼‰</p>
<ul>
<li>è¿›å…¥Escape Modeæµç¨‹ï¼šLP-11ã€LP-10ã€LP-00ã€LP-01ã€LP-00ã€[Entry Command]</li>
<li>é€€å‡ºEscape Modeæµç¨‹ï¼šLP-00ã€LP-10ã€LP-11</li>
</ul>
<p><img src="/images/computerSystem/protocol/mipi/mipi-10.png" alt="image"></p>
<h4 id="LPDT"><a href="#LPDT" class="headerlink" title="LPDT"></a>LPDT</h4><p><img src="/images/computerSystem/protocol/mipi/mipi-11.png" alt="image"></p>
<p>è¿™ä¸ªæ¨¡å¼ä¸‹å‘¢ï¼Œæ•°æ®å¯ä»¥åœ¨ä½é€Ÿæƒ…å†µä¸‹è¿›è¡Œä¼ è¾“ï¼ŒLane å¯ä»¥æš‚åœå‘é€</p>
<h4 id="RESET"><a href="#RESET" class="headerlink" title="RESET"></a>RESET</h4><p><img src="/images/computerSystem/protocol/mipi/mipi-12.png" alt="image"></p>
<h2 id="Calibrationæ ¡å‡†"><a href="#Calibrationæ ¡å‡†" class="headerlink" title="Calibrationæ ¡å‡†"></a>Calibrationæ ¡å‡†</h2><p>å½“ä»¥é«˜äº 1.5 Gbps çš„é€Ÿåº¦è¿è¡Œæˆ–æ›´æ”¹ä¸ºè¶…è¿‡ 1.5 Gbps çš„ä»»ä½•é€Ÿç‡æ—¶ï¼Œåº”åœ¨æ­£å¸¸æ“ä½œä¸­çš„é«˜é€Ÿæ•°æ®ä¼ è¾“ä¹‹å‰å‘é€åˆå§‹å»åç§»åºåˆ—ã€‚å¯¹äºå‘¨æœŸæ€§å»åç§»æ ¡å‡†ï¼Œå‘é€å™¨åº”åœ¨å‘é€ deskewåºåˆ—ä¹‹å‰å®Œæˆå½“å‰çªå‘</p>
<p>å½“ä»¥ 1.5 Gbps æˆ–ä»¥ä¸‹é€Ÿç‡è¿è¡Œæ—¶ï¼Œåˆå§‹å»åç§»åºåˆ—çš„ä¼ è¾“æ˜¯å¯é€‰çš„ã€‚å‘¨æœŸæ€§å»åç§»æ˜¯å¯é€‰çš„ï¼Œä¸æ•°æ®é€Ÿç‡æ— å…³ã€‚å½“æ”¹å˜çŠ¶æ€æ—¶ï¼Œä¾‹å¦‚ä» ULPS åˆ° HSï¼Œä»»ä½•å»åç§»åºåˆ—çš„ä¼ è¾“éƒ½æ˜¯å¯é€‰çš„ï¼Œå‰ææ˜¯ HS æ“ä½œä»¥å…ˆå‰å·²ä¼ è¾“åˆå§‹å»åç§»åºåˆ—çš„é€Ÿç‡æ¢å¤ã€‚</p>
<h2 id="æ—¶é’ŸLaneæ“ä½œæ¨¡å¼"><a href="#æ—¶é’ŸLaneæ“ä½œæ¨¡å¼" class="headerlink" title="æ—¶é’ŸLaneæ“ä½œæ¨¡å¼"></a>æ—¶é’ŸLaneæ“ä½œæ¨¡å¼</h2><p><img src="/images/computerSystem/protocol/mipi/mipi-13.png" alt="image"></p>
<h3 id="High-Speed"><a href="#High-Speed" class="headerlink" title="High Speed"></a>High Speed</h3><p>å¯åŠ¨é«˜é€Ÿæ—¶é’Ÿä¼ è¾“çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>é©±åŠ¨åœæ­¢çŠ¶æ€ (LP-11)</li>
<li>é©±åŠ¨ HS-Req çŠ¶æ€ (LP-01) æ—¶é—´ TLPX</li>
<li>é©±åŠ¨æ¡¥çŠ¶æ€ (LP-00) æ—¶é—´ TCLK-PREPARE</li>
<li>å¯ç”¨é«˜é€Ÿé©±åŠ¨å™¨å¹¶åŒæ—¶ç¦ç”¨ä½åŠŸè€—é©±åŠ¨å™¨ã€‚é©±åŠ¨ HS-0 ä¸€æ®µæ—¶é—´ TCLK-ZERO</li>
<li>åœ¨ä»»ä½•æ•°æ®é€šé“å¯åŠ¨ä¹‹å‰ï¼Œåœ¨ TCLK-PRE æ—¶é—´æ®µå†…é©±åŠ¨é«˜é€Ÿæ—¶é’Ÿä¿¡å·ï¼ŒData Laneå¼€å§‹å·¥ä½œ</li>
</ul>
<p>å°†æ—¶é’Ÿé€šé“åˆ‡æ¢åˆ°ä½åŠŸè€—æ¨¡å¼çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>é©±åŠ¨é«˜é€Ÿæ—¶é’Ÿä¿¡å·ï¼ˆåˆ‡æ¢ HS-0/HS-1ï¼‰</li>
<li>æœ€åä¸€ä¸ªæ•°æ®é€šé“è¿›å…¥ä½åŠŸè€—æ¨¡å¼</li>
<li>ç»§ç»­é©±åŠ¨é«˜é€Ÿæ—¶é’Ÿä¿¡å·ä¸€æ®µæ—¶é—´ TCLK-POST å¹¶ä»¥ HS-0 çŠ¶æ€ç»“æŸ</li>
<li>é©±åŠ¨ HS-0 ä¸€æ®µæ—¶é—´ TCLK-TRA</li>
<li>ç¦ç”¨ HS-TXï¼Œå¯ç”¨ LP-TXï¼Œå¹¶é©±åŠ¨åœæ­¢çŠ¶æ€ (LP-11) ä¸€æ®µæ—¶é—´ THS-EXI</li>
</ul>
<h3 id="Low-Powerï¼ˆULPSï¼‰"><a href="#Low-Powerï¼ˆULPSï¼‰" class="headerlink" title="Low Powerï¼ˆULPSï¼‰"></a>Low Powerï¼ˆULPSï¼‰</h3><p>ä¼ è¾“è¿‡ç¨‹ï¼š</p>
<ul>
<li>LP-11ï¼ŒTX-Stop </li>
<li>LP-10ï¼ŒTX-ULPS-Rqst</li>
<li>LP-00ï¼ŒTX-ULPS</li>
<li>LP-10ï¼ŒTX-ULPS-Exit</li>
</ul>
<h2 id="çŠ¶æ€æœº"><a href="#çŠ¶æ€æœº" class="headerlink" title="çŠ¶æ€æœº"></a>çŠ¶æ€æœº</h2><p><img src="/images/computerSystem/protocol/mipi/mipi-14.png" alt="image"></p>
<h2 id="æ£€æµ‹ï¼ˆP50ï¼‰"><a href="#æ£€æµ‹ï¼ˆP50ï¼‰" class="headerlink" title="æ£€æµ‹ï¼ˆP50ï¼‰"></a>æ£€æµ‹ï¼ˆP50ï¼‰</h2><p>å­˜åœ¨ä¸‰ç§ä¸åŒçš„æœºåˆ¶æ¥æ£€æµ‹é“¾è·¯æ•…éšœã€‚æ€»çº¿äº‰ç”¨å’Œ é”™è¯¯æ£€æµ‹åŠŸèƒ½åŒ…å«åœ¨ D-PHY ä¸­ã€‚è¿™äº›åŠŸèƒ½åº”è¯¥æ£€æµ‹è®¸å¤šå…¸å‹æ•…éšœã€‚ç„¶è€Œï¼Œæœ‰äº›æ•…éšœæ— æ³•åœ¨ D-PHY å†…æ£€æµ‹åˆ°ï¼Œéœ€è¦åè®®çº§è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="äº‰ç”¨æ£€æµ‹"><a href="#äº‰ç”¨æ£€æµ‹" class="headerlink" title="äº‰ç”¨æ£€æµ‹"></a>äº‰ç”¨æ£€æµ‹</h3><h3 id="åºåˆ—é”™è¯¯æ£€æµ‹"><a href="#åºåˆ—é”™è¯¯æ£€æµ‹" class="headerlink" title="åºåˆ—é”™è¯¯æ£€æµ‹"></a>åºåˆ—é”™è¯¯æ£€æµ‹</h3><p>â€¢ SoT Error<br>â€¢ SoT Sync Error<br>â€¢ EoT Sync Error<br>â€¢ Escape Entry Command Error<br>â€¢ LP Transmission Sync Error<br>â€¢ False Control Error</p>
<h3 id="åè®®çœ‹é—¨ç‹—å®šæ—¶å™¨ï¼ˆèµ„æ–™æ€§ï¼‰"><a href="#åè®®çœ‹é—¨ç‹—å®šæ—¶å™¨ï¼ˆèµ„æ–™æ€§ï¼‰" class="headerlink" title="åè®®çœ‹é—¨ç‹—å®šæ—¶å™¨ï¼ˆèµ„æ–™æ€§ï¼‰"></a>åè®®çœ‹é—¨ç‹—å®šæ—¶å™¨ï¼ˆèµ„æ–™æ€§ï¼‰</h3><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li>mipi csi å¦‚ä½•ç†è§£è™šæ‹Ÿé€šé“?</li>
</ol>
<p>   åœ¨MIPI CSIï¼ˆCamera Serial Interfaceï¼‰ä¸­ï¼Œè™šæ‹Ÿé€šé“ï¼ˆVirtual Channelï¼‰æ˜¯ä¸€ç§ç”¨äºåœ¨å•ä¸ªç‰©ç†é€šé“ä¸Šä¼ è¾“å¤šä¸ªæ•°æ®æµçš„æœºåˆ¶ã€‚</p>
<p>   MIPI CSIæ ‡å‡†å…è®¸å°†å•ä¸ªç‰©ç†é€šé“åˆ’åˆ†ä¸ºå¤šä¸ªè™šæ‹Ÿé€šé“ï¼Œæ¯ä¸ªè™šæ‹Ÿé€šé“å¯ä»¥ç‹¬ç«‹ä¼ è¾“ä¸åŒçš„æ•°æ®æµæˆ–æ•°æ®ç±»å‹ã€‚é€šè¿‡è™šæ‹Ÿé€šé“çš„ä½¿ç”¨ï¼Œå¯ä»¥å®ç°å¹¶è¡Œä¼ è¾“å¤šä¸ªæ•°æ®æµï¼Œæé«˜å¸¦å®½åˆ©ç”¨ç‡å’Œç³»ç»Ÿçš„çµæ´»æ€§ã€‚</p>
<p>   åœ¨MIPI CSIä¸­ï¼Œè™šæ‹Ÿé€šé“çš„æ•°é‡å’Œé…ç½®æ˜¯æ ¹æ®å…·ä½“çš„åº”ç”¨éœ€æ±‚è¿›è¡Œå®šä¹‰å’Œé…ç½®çš„ã€‚æ¯ä¸ªè™šæ‹Ÿé€šé“å¯ä»¥ä¼ è¾“ä¸åŒçš„å›¾åƒæ•°æ®æµï¼Œä¾‹å¦‚ä¸»æ‘„åƒå¤´æ•°æ®ã€è¾…åŠ©æ‘„åƒå¤´æ•°æ®ã€æ·±åº¦å›¾åƒæ•°æ®ç­‰ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è™šæ‹Ÿé€šé“ä¼ è¾“å…¶ä»–ä¸å›¾åƒç›¸å…³çš„æ•°æ®ï¼Œå¦‚å…ƒæ•°æ®ã€æ—¶é—´æˆ³ã€å›¾åƒæ ‡ç­¾ç­‰ã€‚</p>
<p>   é€šè¿‡è™šæ‹Ÿé€šé“çš„ä½¿ç”¨ï¼Œå¯ä»¥çµæ´»åœ°ç»„ç»‡å’Œä¼ è¾“å¤šç§ç±»å‹çš„æ•°æ®ï¼Œä»è€Œæ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤šæ‘„åƒå¤´ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„è™šæ‹Ÿé€šé“å°†å„ä¸ªæ‘„åƒå¤´çš„æ•°æ®è¿›è¡Œåˆ†ç¦»å’Œä¼ è¾“ã€‚</p>
<p>   éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™šæ‹Ÿé€šé“çš„ä½¿ç”¨éœ€è¦åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´è¿›è¡Œåå•†å’Œé…ç½®ï¼Œä»¥ç¡®ä¿æ•°æ®èƒ½å¤Ÿæ­£ç¡®åœ°è·¯ç”±åˆ°ç›¸åº”çš„è™šæ‹Ÿé€šé“ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦éµå¾ªMIPI CSIæ ‡å‡†å¹¶è¿›è¡Œæ­£ç¡®çš„é…ç½®å’Œå¤„ç†ï¼Œä»¥å®ç°æ•°æ®çš„æ­£ç¡®ä¼ è¾“å’Œè§£æã€‚</p>
<p>   æ€»è€Œè¨€ä¹‹ï¼ŒMIPI CSIä¸­çš„è™šæ‹Ÿé€šé“æ˜¯ä¸€ç§åœ¨å•ä¸ªç‰©ç†é€šé“ä¸Šä¼ è¾“å¤šä¸ªæ•°æ®æµçš„æœºåˆ¶ï¼Œé€šè¿‡åˆ’åˆ†å’Œé…ç½®è™šæ‹Ÿé€šé“ï¼Œå¯ä»¥å®ç°å¹¶è¡Œä¼ è¾“ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæé«˜å¸¦å®½åˆ©ç”¨ç‡å’Œç³»ç»Ÿçš„çµæ´»æ€§ã€‚</p>
<ol start="2">
<li><p>mipi  ULPSå’ŒLPDTçš„åŒºåˆ«?</p>
<p>åœ¨MIPIï¼ˆMobile Industry Processor Interfaceï¼‰æ ‡å‡†ä¸­ï¼ŒULPSï¼ˆUltra Low Power Saveï¼‰å’ŒLPDTï¼ˆLow Power Data Transmissionï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„ä½åŠŸè€—æ¨¡å¼ï¼Œç”¨äºåœ¨ç§»åŠ¨è®¾å¤‡ä¸­å®ç°èŠ‚èƒ½å’Œå»¶é•¿ç”µæ± å¯¿å‘½ã€‚</p>
<ol>
<li>ULPSï¼ˆUltra Low Power Saveï¼‰ï¼šULPSæ˜¯ä¸€ç§æ›´ä¸ºæç«¯çš„ä½åŠŸè€—æ¨¡å¼ï¼Œæ—¨åœ¨å°†è®¾å¤‡çš„åŠŸè€—é™è‡³æœ€ä½é™åº¦ã€‚åœ¨ULPSæ¨¡å¼ä¸‹ï¼Œè®¾å¤‡çš„ç”µæºæ¶ˆè€—æä½ï¼Œä¸»è¦é€šè¿‡å‡å°‘ç”µå‹å’Œå…³é—­éå¿…è¦çš„æ¨¡å—æ¥å®ç°ã€‚è¿™å¯èƒ½åŒ…æ‹¬å…³é—­ä¸ä½¿ç”¨çš„ä¼ æ„Ÿå™¨ã€é™ä½ä¸»é¢‘ã€è¿›å…¥æ·±åº¦ç¡çœ çŠ¶æ€ç­‰æªæ–½ã€‚ULPSæ¨¡å¼é€šå¸¸ç”¨äºæç«¯ä½åŠŸè€—è¦æ±‚çš„åœºæ™¯ï¼Œä¾‹å¦‚å¾…æœºæ¨¡å¼æˆ–é•¿æ—¶é—´ä¸ä½¿ç”¨æ—¶çš„ç”µæºç®¡ç†ã€‚</li>
<li>LPDTï¼ˆLow Power Data Transmissionï¼‰ï¼šLPDTæ˜¯ä¸€ç§åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å®ç°ä½åŠŸè€—çš„æ¨¡å¼ã€‚åœ¨LPDTæ¨¡å¼ä¸‹ï¼Œæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­é‡‡ç”¨ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¥é™ä½åŠŸè€—ï¼Œå¦‚é™ä½ä¼ è¾“é€Ÿç‡ã€å‡å°‘ç”µå‹ã€é‡‡ç”¨æ›´èŠ‚èƒ½çš„ä¼ è¾“åè®®ç­‰ã€‚LPDTæ¨¡å¼åœ¨éœ€è¦è¿›è¡Œæ•°æ®ä¼ è¾“çš„åŒæ—¶ï¼Œå°½é‡å‡å°‘åŠŸè€—çš„æ¶ˆè€—ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºéœ€è¦åœ¨ä¼ è¾“æ•°æ®çš„åŒæ—¶ä¿æŒè¾ƒä½åŠŸè€—çš„åœºæ™¯ï¼Œä¾‹å¦‚å®æ—¶æ•°æ®ä¼ è¾“ã€å›¾åƒä¼ è¾“ç­‰ã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒULPSå’ŒLPDTéƒ½æ˜¯æ ¹æ®MIPIæ ‡å‡†ä¸­çš„è¦æ±‚å’Œè§„èŒƒæ¥å®šä¹‰çš„ï¼Œå…·ä½“å®ç°å’Œæ”¯æŒç¨‹åº¦å¯èƒ½å› è®¾å¤‡å’Œå‚å•†è€Œæœ‰æ‰€ä¸åŒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè®¾å¤‡åˆ¶é€ å•†æ ¹æ®å…·ä½“éœ€æ±‚å’Œç¡¬ä»¶èƒ½åŠ›ï¼Œé€‰æ‹©å’Œå®ç°é€‚å½“çš„ä½åŠŸè€—æ¨¡å¼ä»¥å¹³è¡¡æ€§èƒ½å’ŒåŠŸè€—ä¹‹é—´çš„å…³ç³»ï¼Œä»¥æä¾›æ›´é•¿çš„ç”µæ± å¯¿å‘½å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://caxapa.ru/thumbs/799244/mipi_D_PHY_specification_v1_2.pdf">Specification for D-PHY</a></li>
<li><a href="https://www.bilibili.com/video/BV1Tv411j7Q6/">MIPIè®¾è®¡åŸºç¡€</a></li>
<li><a href="https://www.bilibili.com/video/BV1e4411q7CC/">å·®åˆ†ä¿¡å·ä¸å•ç«¯ä¿¡å·çš„å·®åˆ«</a></li>
<li><a href="https://blog.csdn.net/zhoutaopower/article/details/123662047">MIPI ç³»åˆ—ä¹‹ D-PHY</a></li>
<li><a href="https://picture.iczhiku.com/resource/eetop/WHISUkJqgiqojbxm.pdf">MIPI DSI</a></li>
<li><a href="https://caxapa.ru/thumbs/799244/MIPI_Alliance_Specification_for_Camera_S.pdf">MIPI CSI-2</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>protocol</category>
      </categories>
      <tags>
        <tag>MIPI</tag>
        <tag>D-PHY</tag>
      </tags>
  </entry>
  <entry>
    <title>SPI</title>
    <url>/2023/07/15/computerSystem/protocol/spi/</url>
    <content><![CDATA[<h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><p>SPIï¼šSerial Peripheral Interface ä¸²è¡Œå¤–è®¾æ¥å£ï¼Œç”¨äºåœ¨å¾®æ§åˆ¶å™¨å’Œå¤–éƒ¨è®¾å¤‡ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚SPI æ¥å£å¹¿æ³›åº”ç”¨äºåµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯ä¸å¤–å›´è®¾å¤‡è¿›è¡Œé€šä¿¡ï¼Œå¦‚ä¼ æ„Ÿå™¨ã€å­˜å‚¨å™¨ã€æ˜¾ç¤ºå±å’Œé€šä¿¡æ¨¡å—ç­‰ã€‚</p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul>
<li><p>ä¼ è¾“ä¿¡å·ï¼šMSIOã€MOSIã€SCKLã€CS</p>
</li>
<li><p>ä¸»ä»ç»“æ„ã€‚SPI é€šä¿¡ç”±ä¸€ä¸ªä¸»è®¾å¤‡ï¼ˆMasterï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªä»è®¾å¤‡ï¼ˆSlaveï¼‰ç»„æˆã€‚ä¸»è®¾å¤‡æ§åˆ¶é€šä¿¡çš„æ—¶åºå’Œæ•°æ®ä¼ è¾“ï¼Œè€Œä»è®¾å¤‡æŒ‰ç…§ä¸»è®¾å¤‡çš„å‘½ä»¤å“åº”æ•°æ®ä¼ è¾“ã€‚</p>
</li>
<li><p>åŒæ­¥åè®®ã€‚SPI ä½¿ç”¨ä¸€ä¸ªæ—¶é’Ÿä¿¡å·ï¼ˆSCLKï¼‰æ¥åŒæ­¥æ•°æ®çš„ä¼ è¾“ã€‚ä¸»è®¾å¤‡äº§ç”Ÿæ—¶é’Ÿä¿¡å·ï¼Œæ§åˆ¶æ•°æ®ä¼ è¾“çš„é€Ÿç‡å’Œæ—¶åºï¼Œè€Œä»è®¾å¤‡æ ¹æ®æ—¶é’Ÿä¿¡å·é‡‡æ ·å’Œå‘é€æ•°æ®ã€‚</p>
</li>
<li><p>å…¨åŒå·¥ä¼ è¾“ï¼ˆåŒå‘ä¼ è¾“ï¼‰ã€‚æ•°æ®å¯ä»¥åŒæ—¶åœ¨ä¸»è®¾å¤‡å’Œä»è®¾å¤‡ä¹‹é—´åŒå‘ä¼ è¾“ã€‚ä¸»è®¾å¤‡é€šè¿‡ MOSIï¼ˆMaster Out Slave Inï¼‰çº¿è·¯å‘é€æ•°æ®ï¼Œè€Œä»è®¾å¤‡é€šè¿‡ MISOï¼ˆMaster In Slave Outï¼‰çº¿è·¯æ¥æ”¶æ•°æ®ã€‚</p>
</li>
<li><p>å¤šè®¾å¤‡æ”¯æŒï¼šSPI æ¥å£å¯ä»¥è¿æ¥å¤šä¸ªä»è®¾å¤‡ï¼Œæ¯ä¸ªä»è®¾å¤‡ä½¿ç”¨ä¸€ä¸ªç‰‡é€‰ä¿¡å·ï¼ˆSSï¼‰æ¥é€‰æ‹©ä¸å…¶é€šä¿¡çš„ä»è®¾å¤‡ã€‚ä¸»è®¾å¤‡é€šè¿‡é€‰æ‹©ç‰¹å®šçš„ç‰‡é€‰ä¿¡å·æ¥ä¸ç‰¹å®šçš„ä»è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</p>
</li>
<li><p>ä¼ è¾“é€Ÿç‡ã€‚SPI æ¥å£çš„ä¼ è¾“é€Ÿç‡å¯ä»¥é€šè¿‡è°ƒæ•´æ—¶é’Ÿé¢‘ç‡æ¥æ§åˆ¶ï¼Œæ”¯æŒé«˜é€Ÿä¼ è¾“ã€‚ä¼ è¾“é€Ÿç‡å¯ä»¥æ ¹æ®å®é™…åº”ç”¨éœ€æ±‚è¿›è¡Œé…ç½®ï¼Œä½†å—ç¡¬ä»¶å’Œè®¾å¤‡çš„é™åˆ¶ã€‚</p>
</li>
</ul>
<h2 id="ä¿¡å·å®šä¹‰"><a href="#ä¿¡å·å®šä¹‰" class="headerlink" title="ä¿¡å·å®šä¹‰"></a>ä¿¡å·å®šä¹‰</h2><ul>
<li>SCKï¼šSerial Clockï¼Œä¸²è¡Œæ—¶é’Ÿ</li>
<li>MOSIï¼šMaster Output Slave Inputï¼Œä¸»å‘ä»æ”¶</li>
<li>MISOï¼šMaster Input Slave Outputï¼Œä¸»æ”¶ä»å‘</li>
<li>CS/SSï¼šSlave Select / Chip Selectï¼Œç‰‡é€‰ä¿¡å·</li>
</ul>
<h2 id="ç³»ç»Ÿæ¡†å›¾"><a href="#ç³»ç»Ÿæ¡†å›¾" class="headerlink" title="ç³»ç»Ÿæ¡†å›¾"></a>ç³»ç»Ÿæ¡†å›¾</h2><p><img src="/images/computerSystem/protocol/spi/spi-0.png" alt="image"></p>
<p>å¯¹äºSPIæ¥è®²ï¼Œé€šå¸¸æ˜¯ä¸€ä¸»ï¼ˆMCUï¼‰å¤šä»ï¼ˆå¤–è®¾ï¼‰ï¼Œè€Œå¤šä¸ªä»æœºæ˜¯é€šè¿‡CSç‰‡é€‰ä¿¡å·çº¿æ¥é€‰æ‹©å…·ä½“å’Œå“ªä¸€ä¸ªè®¾å¤‡è¿›è¡Œé€šä¿¡ï¼Œä»æœºä¹Ÿå°†è§„å®šç‰‡é€‰ä¿¡å·çº¿æ˜¯é«˜ç”µå¹³æœ‰æ•ˆè¿˜æ˜¯ä½ç”µå¹³æœ‰æ•ˆ</p>
<h1 id="é€šä¿¡è¿‡ç¨‹"><a href="#é€šä¿¡è¿‡ç¨‹" class="headerlink" title="é€šä¿¡è¿‡ç¨‹"></a>é€šä¿¡è¿‡ç¨‹</h1><p>ä¸åŒäºI2Cï¼ŒSPIåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¸éœ€è¦å‘é€èµ·å§‹ä¿¡å·ã€ç»“æŸä¿¡å·ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦ç­‰å¾…åº”ç­”ä¿¡å·ï¼Œå®ƒçš„æ•°æ®çº¿åªå‘é€æ•°æ®ï¼Œä¸€ä¸ªbyteæ¥ç€ä¸€ä¸ªbyteçš„æ•°æ®è¿›è¡Œå‘é€ã€‚æ˜¾è€Œæ˜“è§ï¼Œå®ƒçš„é€Ÿåº¦ç›¸è¾ƒäºI2Cä¸€å®šæ˜¯æ›´å¿«çš„ï¼Œä½†æ˜¯å´ä¸èƒ½ä¿è¯æ•°æ®çš„å¯é æ€§ï¼ˆä¸èƒ½ç¡®è®¤ä»æœºæ˜¯å¦çœŸæ­£æ”¶åˆ°æ•°æ®ï¼‰ã€‚å¦å¤–ï¼Œåœ¨ç©ºé—²çŠ¶æ€çš„ä¿æŒå’Œæ•°æ®å‘é€æ—¶çš„æ—¶é’ŸçŠ¶æ€ä¸Šï¼Œspiä¸i2cä¹Ÿæ˜¯å­˜åœ¨å·®å¼‚çš„ã€‚</p>
<h2 id="ç›¸ä½ææ€§"><a href="#ç›¸ä½ææ€§" class="headerlink" title="ç›¸ä½ææ€§"></a>ç›¸ä½ææ€§</h2><ul>
<li><p>æ—¶é’Ÿææ€§ï¼ˆClock Polarityï¼‰ï¼šå®šä¹‰äº†åœ¨æ—¶é’Ÿä¿¡å·åœ¨ç©ºé—²çŠ¶æ€ä¸‹çš„çŠ¶æ€</p>
<ul>
<li>0ï¼šåœ¨æ—¶é’Ÿä¿¡å·çš„ç©ºé—²çŠ¶æ€æ—¶ï¼Œæ•°æ®çº¿ä¸Šä¿æŒä½ç”µå¹³ï¼ˆ0ï¼‰ï¼Œè€Œåœ¨æ—¶é’Ÿä¿¡å·æ¿€æ´»æ—¶ä¼ è¾“æ•°æ®ã€‚</li>
<li>1ï¼šåœ¨æ—¶é’Ÿä¿¡å·çš„ç©ºé—²çŠ¶æ€æ—¶ï¼Œæ•°æ®çº¿ä¸Šä¿æŒé«˜ç”µå¹³ï¼ˆ1ï¼‰ï¼Œè€Œåœ¨æ—¶é’Ÿä¿¡å·æ¿€æ´»æ—¶ä¼ è¾“æ•°æ®ã€‚</li>
</ul>
</li>
<li><p>æ—¶é’Ÿç›¸ä½ï¼ˆClock Phaseï¼‰ï¼šå®šä¹‰äº†æ•°æ®ä¿¡å·é‡‡æ ·å¯¹åº”çš„æ—¶é’Ÿä¿¡å·çš„çŠ¶æ€ï¼ˆä¸Šå‡æ²¿/ä¸‹é™æ²¿é‡‡æ ·ï¼‰</p>
<ul>
<li>0ï¼šæ—¶é’Ÿä¸Šå‡æ²¿é‡‡æ ·</li>
<li>1ï¼šæ—¶é’Ÿä¸‹é™æ²¿é‡‡æ ·</li>
</ul>
</li>
</ul>
<p>æ ¹æ®ç›¸ä½ææ€§çš„æ¯ç§çŠ¶æ€ï¼Œå› æ­¤å¯¹äºspiæœ‰å››ç§å·¥ä½œæ¨¡å¼ï¼Œå…·ä½“é€‰æ‹©å“ªä¸€ç§æ¨¡å¼å–å†³äºä»æœºæ”¯æŒå“ªä¸€ç§ã€‚ï¼ˆI2Cç›¸ä½ææ€§æ˜¯å›ºå®šçš„ï¼‰</p>
<h2 id="è®¾è®¡ç›®çš„"><a href="#è®¾è®¡ç›®çš„" class="headerlink" title="è®¾è®¡ç›®çš„"></a>è®¾è®¡ç›®çš„</h2><ul>
<li>å…¼å®¹æ€§ï¼šä¸åŒçš„è®¾å¤‡å¯èƒ½å¯¹SPIçš„ææ€§å’Œç›¸ä½æœ‰ä¸åŒçš„è¦æ±‚ï¼Œé€‰æ‹©é€‚å½“çš„ç»„åˆå¯ä»¥ç¡®ä¿è®¾å¤‡ä¹‹é—´çš„å…¼å®¹æ€§ã€‚</li>
<li>æ—¶åºæ§åˆ¶ï¼šææ€§å’Œç›¸ä½çš„é€‰æ‹©å½±å“äº†æ•°æ®ä¼ è¾“çš„æ—¶åºå’ŒåŒæ­¥æ–¹å¼ã€‚é€šè¿‡è°ƒæ•´ææ€§å’Œç›¸ä½ï¼Œå¯ä»¥æ»¡è¶³å…·ä½“åº”ç”¨çš„æ—¶åºè¦æ±‚ï¼Œç¡®ä¿æ•°æ®çš„æ­£ç¡®ä¼ è¾“ã€‚</li>
<li>ä¿¡å·å®Œæ•´æ€§ï¼šæ­£ç¡®çš„ææ€§å’Œç›¸ä½ç»„åˆå¯ä»¥å‡å°‘å™ªå£°å’Œæ—¶é’ŸæŠ–åŠ¨å¯¹æ•°æ®ä¼ è¾“çš„å½±å“ï¼Œæé«˜ä¿¡å·çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚</li>
</ul>
<h1 id="æ—¶åº"><a href="#æ—¶åº" class="headerlink" title="æ—¶åº"></a>æ—¶åº</h1><h2 id="CPOL-x3D-0-CPHA-x3D-0"><a href="#CPOL-x3D-0-CPHA-x3D-0" class="headerlink" title="CPOL = 0,CPHA = 0"></a>CPOL = 0,CPHA = 0</h2><p>ç©ºé—²çŠ¶æ€ä½ç”µå¹³ï¼Œä¸Šå‡æ²¿é‡‡æ ·ä¸‹é™æ²¿ä»æœºè¯»æ•°æ®</p>
<p><img src="/images/computerSystem/protocol/spi/spi-1.png" alt="image"></p>
<h2 id="CPOL-x3D-0-CPHA-x3D-1"><a href="#CPOL-x3D-0-CPHA-x3D-1" class="headerlink" title="CPOL = 0,CPHA = 1"></a>CPOL = 0,CPHA = 1</h2><p>ç©ºé—²çŠ¶æ€ä½ç”µå¹³ï¼Œä¸‹é™æ²¿é‡‡æ ·ä¸Šå‡æ²¿ä»æœºè¯»æ•°æ®</p>
<p><img src="/images/computerSystem/protocol/spi/spi-2.png" alt="image"></p>
<h2 id="CPOL-x3D-1-CPHA-x3D-0"><a href="#CPOL-x3D-1-CPHA-x3D-0" class="headerlink" title="CPOL = 1,CPHA = 0"></a>CPOL = 1,CPHA = 0</h2><p>ç©ºé—²çŠ¶æ€é«˜ç”µå¹³ï¼Œä¸Šå‡æ²¿é‡‡æ ·ä¸‹é™æ²¿ä»æœºè¯»æ•°æ®</p>
<p><img src="/images/computerSystem/protocol/spi/spi-3.png" alt="image"></p>
<h2 id="CPOL-x3D-1-CPHA-x3D-1"><a href="#CPOL-x3D-1-CPHA-x3D-1" class="headerlink" title="CPOL = 1,CPHA = 1"></a>CPOL = 1,CPHA = 1</h2><p>ç©ºé—²çŠ¶æ€é«˜ç”µå¹³ï¼Œä¸‹é™æ²¿é‡‡æ ·ä¸Šå‡æ²¿ä»æœºè¯»æ•°æ®</p>
<p><img src="/images/computerSystem/protocol/spi/spi-4.png" alt="image"></p>
<h1 id="SPI-controller"><a href="#SPI-controller" class="headerlink" title="SPI controller"></a>SPI controller</h1><blockquote>
<p>è¿™ä¸ªæ˜¯ <a href="https://www.ti.com/lit/ug/sprugp2a/sprugp2a.pdf?ts=1689464223160&amp;ref_url=https%253A%252F%252Fwww.google.es%252F">TI SPI User Guide</a>ä¸­çš„æ§åˆ¶å™¨çš„æ¡†å›¾</p>
</blockquote>
<p><img src="/images/computerSystem/protocol/spi/spi-5.png" alt="image"></p>
<h2 id="æ•°æ®é€šè·¯"><a href="#æ•°æ®é€šè·¯" class="headerlink" title="æ•°æ®é€šè·¯"></a>æ•°æ®é€šè·¯</h2><p>é€šè¿‡è¯»å›¾å¯ä»¥å‘ç°ï¼Œå¯¹äºæ§åˆ¶å†…éƒ¨é€šè·¯å­˜åœ¨bufferå’Œç§»ä½å¯„å­˜å™¨ã€‚</p>
<ol>
<li>å‘é€æ•°æ®æ—¶ï¼Œä¸»è®¾å¤‡å°†è¦å‘é€çš„æ•°æ®é€ä½åŠ è½½åˆ°ç§»ä½å¯„å­˜å™¨ä¸­ï¼Œç„¶åé€šè¿‡ç§»ä½å¯„å­˜å™¨æŒ‰ç…§æ—¶é’Ÿä¿¡å·çš„èŠ‚å¥é€ä½å‘é€ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒFIFOç¼“å†²åŒºå¯ä»¥ç”¨äºå­˜å‚¨å¤šä¸ªå¾…å‘é€çš„æ•°æ®å­—èŠ‚ï¼Œä»¥ä¾¿åœ¨ç§»ä½å¯„å­˜å™¨ä¸­é€ä½ç§»åŠ¨æ•°æ®ä¹‹å‰ï¼Œæä¾›æ•°æ®çš„ä¾›åº”ã€‚</li>
<li>æ¥æ”¶æ•°æ®æ—¶ï¼Œæ•°æ®çº¿ä¸Šçš„ä½è¢«ç§»ä½å¯„å­˜å™¨æ¥æ”¶å’Œå­˜å‚¨ã€‚å¦‚æœå­˜åœ¨FIFOç¼“å†²åŒºï¼Œæ¥æ”¶åˆ°çš„æ•°æ®å­—èŠ‚å¯ä»¥å…ˆå­˜å‚¨åœ¨FIFOä¸­ï¼Œä»¥ä¾¿åœ¨ä¸»è®¾å¤‡å‡†å¤‡å¥½è¯»å–æ—¶è¿›è¡Œä¼ è¾“</li>
</ol>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul>
<li><p><code>æ—¶é’Ÿ</code></p>
<p>SPIæ§åˆ¶å™¨äº§ç”Ÿæ—¶é’Ÿä¿¡å·ï¼Œç”¨äºåŒæ­¥æ•°æ®ä¼ è¾“ã€‚å®ƒé€šå¸¸æä¾›å¯é…ç½®çš„æ—¶é’Ÿé¢‘ç‡é€‰é¡¹ï¼Œä»¥é€‚åº”ä¸åŒçš„é€šä¿¡é€Ÿç‡éœ€æ±‚</p>
</li>
<li><p><code>æ•°æ®ç¼“å†²åŒº</code></p>
<p>SPIæ§åˆ¶å™¨æä¾›æ•°æ®ç¼“å†²åŒºï¼Œç”¨äºå­˜å‚¨è¦å‘é€æˆ–æ¥æ”¶çš„æ•°æ®ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯„å­˜å™¨æˆ–ä¸€ä¸ªFIFOï¼ˆFirst-In-First-Outï¼‰ç¼“å†²åŒºã€‚</p>
</li>
<li><p><code>é€šä¿¡æ¨¡å¼é€‰æ‹©</code></p>
<p>æ ¹æ®ä»æœºçš„éœ€æ±‚é…ç½®ææ€§å’Œç›¸ä½ä»¥é€‚åº”å…¶ä¼ è¾“æ¨¡å¼</p>
</li>
<li><p><code>ä¸­æ–­DMA</code></p>
<p>ä¸ºäº†æé«˜ä¼ è¾“æ•ˆç‡ï¼Œæ§åˆ¶å™¨é€šå¸¸æœ‰ä¸­æ–­DMAç›¸å…³çš„é…ç½®ç­‰ç­‰</p>
</li>
</ul>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://www.analog.com/media/en/analog-dialogue/volume-52/number-3/introduction-to-spi-interface.pdf">Introduction to SPI Interface</a></li>
<li><a href="https://www.ti.com/lit/ug/sprugp2a/sprugp2a.pdf">KeyStone Architecture Serial Peripheral Interface</a></li>
<li><a href="https://www.bilibili.com/video/BV1NK411X7mV/">SPIé€šä¿¡åŸç†åŠåº”ç”¨</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>protocol</category>
      </categories>
      <tags>
        <tag>SPI</tag>
      </tags>
  </entry>
  <entry>
    <title>Uart</title>
    <url>/2023/08/10/computerSystem/protocol/uart/</url>
    <content><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>UARTï¼šUniversal Asynchronous Receiver/Transmitterï¼Œé€šç”¨å¼‚æ­¥æ”¶å‘ä¼ è¾“å™¨ã€‚ä¸€ç§å¸¸ç”¨çš„ä¸²è¡Œé€šä¿¡åè®®ï¼Œç”¨äºåœ¨ç”µå­è®¾å¤‡ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚å®ƒæ˜¯ä¸€ç§å¼‚æ­¥é€šä¿¡æ–¹å¼ï¼Œæ„å‘³ç€æ•°æ®æ²¡æœ‰å›ºå®šçš„æ—¶é’Ÿä¿¡å·æ¥åŒæ­¥å‘é€å’Œæ¥æ”¶ç«¯çš„æ•°æ®ã€‚ç›¸æ¯”åŒæ­¥é€šä¿¡åè®®ï¼ˆå¦‚SPIå’ŒI2Cï¼‰ï¼ŒUARTä¸éœ€è¦åœ¨æ•°æ®ä¼ è¾“ä¸­ä¼ é€’æ—¶é’Ÿä¿¡å·ï¼Œä»è€Œæ›´åŠ ç®€å•ä¸”é€‚ç”¨äºå„ç§è®¾å¤‡å’Œç¯å¢ƒã€‚</p>
<h2 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h2><ul>
<li><p>ç‚¹å¯¹ç‚¹ï¼šuartåè®®åªèƒ½ä½œç”¨äºä¸¤ä¸ªå•ç‚¹è®¾å¤‡ä¹‹é—´ï¼Œé€šå¸¸æ²¡æœ‰æ˜ç¡®æ„ä¹‰ä¸Šçš„ä¸»ä»å…³ç³»</p>
</li>
<li><p>å¼‚æ­¥é€šä¿¡ï¼šå¼‚æ­¥é€šä¿¡ä½“ç°åœ¨æ²¡æœ‰æ—¶é’Ÿçš„æ§åˆ¶ï¼Œè€Œæ˜¯æŒ‰ç…§åˆ«çš„æ–¹å¼è¿›è¡Œæ•°æ®çš„ç¡®è®¤ï¼ˆéœ€è¦åå•†å›ºå®šæ³¢ç‰¹ç‡Baud Rateï¼‰</p>
</li>
<li><p>å…¨åŒå·¥é€šä¿¡ï¼šä½¿ç”¨ä¸¤ä¸ªUARTé€šé“ï¼Œä¸€ä¸ªç”¨äºå‘é€ï¼ˆTXï¼‰ä¸€ä¸ªç”¨äºæ¥æ”¶ï¼ˆRXï¼‰ã€‚</p>
</li>
<li><p>é€Ÿç‡çµæ´»æ€§ï¼šUARTé€šä¿¡çš„æ³¢ç‰¹ç‡å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œçµæ´»é…ç½®ï¼Œå…è®¸åœ¨ä¸åŒçš„ä¼ è¾“é€Ÿç‡ä¸‹è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p>
</li>
<li><p>æ•°æ®æ ¼å¼çµæ´»æ€§ï¼šå¯ä»¥æŒ‰éœ€é…ç½®æ•°æ®ä½æ•°ã€åœæ­¢ä½æ•°ã€æ ¡éªŒä½ç­‰ç­‰</p>
</li>
</ul>
<h2 id="é€»è¾‘æ¡†å›¾"><a href="#é€»è¾‘æ¡†å›¾" class="headerlink" title="é€»è¾‘æ¡†å›¾"></a>é€»è¾‘æ¡†å›¾</h2><p><img src="/images/computerSystem/protocol/uart/uart-1.png" alt="image"></p>
<h1 id="æ•°æ®ä¼ è¾“"><a href="#æ•°æ®ä¼ è¾“" class="headerlink" title="æ•°æ®ä¼ è¾“"></a>æ•°æ®ä¼ è¾“</h1><h2 id="uartæ”¶å‘æ§åˆ¶å™¨ä¹‹é—´"><a href="#uartæ”¶å‘æ§åˆ¶å™¨ä¹‹é—´" class="headerlink" title="uartæ”¶å‘æ§åˆ¶å™¨ä¹‹é—´"></a>uartæ”¶å‘æ§åˆ¶å™¨ä¹‹é—´</h2><p>åœ¨UARTä¸­ï¼Œä¼ è¾“çš„æ–¹å¼æ˜¯æ•°æ®åŒ…çš„å½¢å¼ã€‚æ•°æ®åŒ…ç”±èµ·å§‹ä½ã€æ•°æ®å¸§ã€å¥‡å¶æ ¡éªŒä½å’Œåœæ­¢ä½ç»„æˆ</p>
<p><img src="/images/computerSystem/protocol/uart/uart-2.png" alt="image"></p>
<ul>
<li><p>èµ·å§‹ä½</p>
<p>UART æ•°æ®ä¼ è¾“çº¿åœ¨ä¸ä¼ è¾“æ•°æ®æ—¶é€šå¸¸ä¿æŒåœ¨é«˜ç”µå¹³ã€‚ä¸ºäº†å¼€å§‹æ•°æ®ä¼ è¾“ï¼Œå‘é€ UART å°†ä¼ è¾“çº¿ä»é«˜ç”µå¹³æ‹‰è‡³ä½ç”µå¹³ï¼ŒæŒç»­1ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚å½“æ¥æ”¶UARTæ£€æµ‹åˆ°é«˜ç”µå¹³åˆ°ä½ç”µå¹³çš„è½¬å˜æ—¶ï¼Œå®ƒå¼€å§‹ä»¥æ³¢ç‰¹ç‡çš„é¢‘ç‡è¯»å–æ•°æ®å¸§ä¸­çš„ä½ã€‚</p>
</li>
<li><p>æ•°æ®å¸§</p>
<p>æ•°æ®å¸§åŒ…å«æ­£åœ¨ä¼ è¾“çš„å®é™…æ•°æ®ã€‚å¦‚æœä½¿ç”¨å¥‡å¶æ ¡éªŒä½ï¼Œå®ƒçš„é•¿åº¦å¯ä»¥æ˜¯5-8 ä½ã€‚å¦‚æœä¸ä½¿ç”¨å¥‡å¶æ ¡éªŒä½ï¼Œåˆ™æ•°æ®å¸§å¯ä»¥æ˜¯9 ä½ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ•°æ®é¦–å…ˆä»¥æœ€ä½æœ‰æ•ˆä½å‘é€ã€‚</p>
</li>
<li><p>å¥‡å¶æ ¡éªŒä½</p>
<p>å¥‡å¶æ ¡éªŒæè¿°äº†æ•°å­—çš„å¶æ•°æˆ–å¥‡æ•°ã€‚å¥‡å¶æ ¡éªŒä½æ˜¯UART_RX åˆ¤æ–­æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å‘ç”Ÿå˜åŒ–çš„ä¸€ç§æ–¹å¼ã€‚ä½å¯èƒ½å› ç”µç£è¾å°„ã€ä¸åŒ¹é…çš„æ³¢ç‰¹ç‡æˆ–é•¿è·ç¦»æ•°æ®ä¼ è¾“è€Œæ”¹å˜ã€‚<br>å¦‚æœå¥‡å¶æ ¡éªŒä½ä¸º 0ï¼ˆå¶æ ¡éªŒï¼‰ï¼Œåˆ™æ•°æ®å¸§ä¸­çš„ 1 æˆ–é€»è¾‘é«˜ä½æ€»è®¡åº”ä¸ºå¶æ•°ã€‚å¦‚æœå¥‡å¶æ ¡éªŒä½ä¸º 1ï¼ˆå¥‡æ ¡éªŒï¼‰ï¼Œåˆ™æ•°æ®å¸§ä¸­çš„ 1 ä½æˆ–é€»è¾‘é«˜ç”µå¹³æ€»è®¡åº”ä¸ºå¥‡æ•°ã€‚å½“å¥‡å¶æ ¡éªŒä½ä¸æ•°æ®åŒ¹é…æ—¶ï¼ŒUART å°±çŸ¥é“ä¼ è¾“æ²¡æœ‰é”™è¯¯ã€‚ä½†å¦‚æœå¥‡å¶æ ¡éªŒä½ä¸º 0ï¼Œå¹¶ä¸”æ€»æ•°ä¸ºå¥‡æ•°ï¼Œæˆ–è€…å¥‡å¶æ ¡éªŒä½ä¸º 1ï¼Œå¹¶ä¸”æ€»æ•°ä¸ºå¶æ•°ï¼Œåˆ™ UART çŸ¥é“æ•°æ®å¸§ä¸­çš„ä½å·²æ›´æ”¹ã€‚</p>
</li>
<li><p>ç»“æŸä½</p>
<p>ä¸ºäº†å‘å‡ºæ•°æ®åŒ…ç»“æŸçš„ä¿¡å·ï¼Œå‘é€ UART å°†æ•°æ®ä¼ è¾“çº¿ä»ä½ç”µå‹é©±åŠ¨åˆ°é«˜ç”µå‹ï¼ŒæŒç»­æ—¶é—´ä¸º1-2ä½ã€‚</p>
</li>
</ul>
<h2 id="æ§åˆ¶å™¨ä¸æ€»çº¿"><a href="#æ§åˆ¶å™¨ä¸æ€»çº¿" class="headerlink" title="æ§åˆ¶å™¨ä¸æ€»çº¿"></a>æ§åˆ¶å™¨ä¸æ€»çº¿</h2><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°æ®åœ¨æ§åˆ¶å™¨ä¹‹å‰æ•°æ®æ˜¯ä¸²è¡Œä¼ è¾“çš„ã€‚ä½†æ˜¯å½“æ•°æ®ä»å†…å®¹åˆ°æ•°æ®æ€»çº¿ï¼Œæ•°æ®æ€»çº¿åˆ°uartå‘é€å™¨ä¹‹é—´æ•°æ®æ˜¯å¹¶è¡Œä¼ è¾“çš„ï¼Œç›¸åº”çš„æ•°æ®æ¥æ”¶å™¨åˆ°æ•°æ®æ€»çº¿æ•°æ®çš„å‘é€ä¹Ÿæ˜¯å¹¶è¡Œçš„ã€‚</p>
<h1 id="æ³¢ç‰¹ç‡"><a href="#æ³¢ç‰¹ç‡" class="headerlink" title="æ³¢ç‰¹ç‡"></a>æ³¢ç‰¹ç‡</h1><p>å¯¹äºå¼‚æ­¥é€šä¿¡éœ€è¦è§£å†³çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼šå½“å‘é€æ–¹è¿ç»­å‘é€äº†å¤šä¸ªé€»è¾‘1ï¼Œæ¥æ”¶æ–¹å¦‚ä½•ç¡®è®¤å…¶å…·ä½“ä¸ªæ•°ã€‚åŒæ­¥é€šä¿¡å¾ˆå¥½è§£å†³å³é€šè¿‡æ—¶é’ŸåŒæ­¥ï¼Œå¯¹äºä¸²å£é€šä¿¡ä½¿ç”¨æ³¢ç‰¹ç‡å³å¯è§£å†³è¯¥é—®é¢˜ã€‚</p>
<p>æ³¢ç‰¹ç‡ï¼ˆBaud Rateï¼‰æ˜¯è¡¡é‡ä¸²è¡Œé€šä¿¡ä¼ è¾“é€Ÿç‡çš„å•ä½ï¼Œè¡¨ç¤ºæ¯ç§’é’Ÿä¼ è¾“çš„æ¯”ç‰¹æ•°ã€‚å®ƒç”¨äºå®šä¹‰æ•°æ®ä¼ è¾“é€Ÿåº¦ï¼Œå³åœ¨å•ä½æ—¶é—´å†…å‘é€çš„äºŒè¿›åˆ¶ä½æ•°ã€‚æ³¢ç‰¹ç‡æ˜¯ä¸²è¡Œé€šä¿¡ä¸­ä¸€ä¸ªé‡è¦çš„å‚æ•°ï¼Œéœ€è¦å‘é€æ–¹å’Œæ¥æ”¶æ–¹äº‹å…ˆçº¦å®šç›¸åŒçš„æ³¢ç‰¹ç‡ï¼Œä»¥ç¡®ä¿æ•°æ®çš„æ­£ç¡®ä¼ è¾“ã€‚</p>
<p>æ³¢ç‰¹ç‡é€šå¸¸ä»¥æ¯ç§’ä¼ è¾“çš„ä½æ•°æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼š9600ã€115200ã€38400ç­‰ã€‚æ¯ä¸ªæ³¢ç‰¹ç‡éƒ½ä»£è¡¨æ¯ç§’ä¼ è¾“çš„æ¯”ç‰¹æ•°ï¼Œä¾‹å¦‚ï¼šæ³¢ç‰¹ç‡115200è¡¨ç¤ºæ¯ç§’ä¼ è¾“115200ä¸ªä½ï¼›åˆ™å¯¹åº”ä¼ è¾“1bitçš„æ—¶é—´ä¹Ÿå¯ä»¥è®¡ç®—å‡ºæ¥ï¼Œè¿™æ ·æ¥æ”¶æ–¹ç»Ÿè®¡æ¥æ”¶æŸä¸ªç”µå¹³çš„æ—¶é•¿å³å¯è®¡ç®—å‡ºå…·ä½“æœ‰å‡ ä¸ªæ•°æ®ã€‚æ³¢ç‰¹ç‡å’Œæ•°æ®ä¼ è¾“é€Ÿåº¦ä¹‹é—´çš„å…³ç³»æ˜¯çº¿æ€§çš„ã€‚ä¾‹å¦‚ï¼Œæ³¢ç‰¹ç‡ä¸º9600æ—¶ï¼Œæ¯ç§’ä¼ è¾“çš„ä½æ•°ä¸º9600 bpsï¼ˆbits per secondï¼‰ï¼Œè€Œä¸€ä¸ªå…¸å‹çš„8ä½æ•°æ®å¸§åŒ…å«äº†ä¸€ä¸ªèµ·å§‹ä½ã€8ä½æ•°æ®ä½ã€ä¸€ä¸ªå¯é€‰çš„æ ¡éªŒä½å’Œä¸€ä¸ªæˆ–å¤šä¸ªåœæ­¢ä½ï¼Œå› æ­¤æ€»çš„æ•°æ®ä¼ è¾“é€Ÿç‡å°†é«˜äº9600 bpsï¼Œä½†9600 bpsæ˜¯é€šä¿¡é€Ÿç‡çš„åŸºå‡†ã€‚</p>
<h1 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h1><p>ä¼˜ç‚¹</p>
<ul>
<li>ä»…éœ€è¦ä¸¤æ ¹çº¿å³å¯è¿›è¡Œå…¨åŒå·¥æ•°æ®ä¼ è¾“ï¼ˆç”µæºçº¿é™¤å¤–ï¼‰</li>
<li>ä¸éœ€è¦æ—¶é’Ÿæˆ–ä»»ä½•å…¶ä»–å®šæ—¶ä¿¡å·</li>
<li>å¥‡å¶æ ¡éªŒä½ç¡®ä¿å°†åŸºæœ¬é”™è¯¯æ£€æŸ¥é›†æˆåˆ°æ•°æ®åŒ…å¸§ä¸­</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li>å¸§ä¸­æ•°æ®çš„å¤§å°æ˜¯æœ‰é™çš„</li>
<li>ä¸å¹¶è¡Œé€šä¿¡ç›¸æ¯”ï¼Œæ•°æ®ä¼ è¾“é€Ÿåº¦è¾ƒä½</li>
<li>å‘é€å™¨å’Œæ¥æ”¶å™¨å¿…é¡»åŒæ„ä¼ è¾“è§„åˆ™å¹¶é€‰æ‹©åˆé€‚çš„æ³¢ç‰¹ç‡</li>
</ul>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://www.analog.com/en/analog-dialogue/articles/uart-a-hardware-communication-protocol.html">A Hardware Communication Protocol Understanding UART</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>protocol</category>
      </categories>
  </entry>
  <entry>
    <title>DDRåŸºç¡€ä¸åŸç†</title>
    <url>/2023/04/05/computerSystem/storage/DDR/</url>
    <content><![CDATA[<p><a href="https://yanglieee.com/2023/02/07/computerSystem/%E5%AD%98%E5%82%A8%E4%BD%93%E7%B3%BB/">å‰é¢çš„æ–‡ç« </a>å¯¹SRAMçš„Cacheåšäº†è¯¦ç»†åˆ†æï¼Œè€Œè¿™éƒ¨åˆ†å°†å¯¹å¦ä¸€ç§éšæœºå­˜å–å™¨åŠ¨æ€éšæœºå­˜å‚¨å™¨DRAMåšè¿›ä¸€æ­¥è¯´æ˜ã€‚æœ¬æ–‡å¤§éƒ¨åˆ†æ˜¯åŸºäºBranchEducationçš„è§†é¢‘å†…å®¹å’Œå…¶å®ƒæ–‡ç« è¿›è¡Œè¡Œæ–‡çš„ï¼Œæ–‡ç« æˆªå›¾å…¨éƒ¨æ¥è‡ªè§†é¢‘ï¼Œéƒ¨åˆ†æ˜¯è‡ªå·±æ‰€ç”»ï¼Œè§†é¢‘è¿æ¥æ”¾åœ¨æœ€åçš„å‚è€ƒèµ„æ–™éƒ¨åˆ†ã€‚</p>
<h1 id="DRAM"><a href="#DRAM" class="headerlink" title="DRAM"></a>DRAM</h1><p>DRAMï¼šDynamic Random Access Memoryï¼ŒåŠ¨æ€éšæœºå­˜å‚¨å™¨ã€‚</p>
<p>åœ¨DRAMçš„åˆ†ç±»ä¸­ï¼ŒSDRAMï¼ˆSynchronous DRAMï¼‰åŒæ­¥åŠ¨æ€éšæœºå­˜å‚¨å™¨åœ¨å„ä¸ªè¡Œä¸šåˆ™å è¾ƒå¤§çš„æ¯”ä¾‹ã€‚è€Œæˆ‘ä»¬ç»å¸¸å¬åˆ°çš„DDRï¼ˆDouble Data Rate SDRAMï¼‰å³åŒå€é€Ÿç‡SDRAMåˆ™åˆæ˜¯SDRAMä¸­çš„ä¸»è¦ä»£è¡¨ï¼Œæœ¬ç¯‡å°†ç€é‡å¯¹DDRåŸç†è¿›è¡Œåˆ†æ</p>
<p>DRAMæ˜¯ç¨‹åºè¿è¡Œçš„å’Œä¸´æ—¶æ•°æ®å­˜å‚¨çš„åª’ä»‹ï¼Œæ— è®ºæ˜¯è®¡ç®—æœºè¿˜æ˜¯æ‰‹æœºçš„å‚æ•°ä¸»å­˜å¤§å°å³æŒ‡çš„æ˜¯DRAMçš„å¤§å°ã€‚åœ¨å·¥ä½œä¸­æˆ‘ä»¬å…¶å®å¾ˆå°‘åŒºåˆ†DDRå’ŒDRAMï¼Œä¸¥æ ¼æ¥è¯´DDRåªèƒ½æ˜¯DRAMä¸­çš„ä¸€ç§ï¼Œwhateverï¼Œå·¥ä½œä¸­ä¸å½±å“æ­£å¸¸ç†è§£å’Œä½¿ç”¨å°±å¥½ã€‚</p>
<h1 id="DDR-SDRAM"><a href="#DDR-SDRAM" class="headerlink" title="DDR SDRAM"></a>DDR SDRAM</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><blockquote>
<p>Wikiï¼š<a href="https://en.wikipedia.org/wiki/DDR_SDRAM">è‹±æ–‡</a>ï¼›<a href="https://zh.m.wikipedia.org/wiki/DDR_SDRAM">ä¸­æ–‡</a></p>
</blockquote>
<ul>
<li><p>DDR SDRAMï¼šDouble Data Rate Synchronous Dynamic Random Access Memoryï¼ŒåŒå€æ•°æ®ç‡åŒæ­¥åŠ¨æ€éšæœºå­˜å–å­˜å‚¨å™¨ã€‚ä¹‹æ‰€ä»¥â€œåŒæ­¥â€æ˜¯æŒ‡å†…å­˜çš„å·¥ä½œéœ€è¦åŒæ­¥æ—¶é’Ÿï¼Œå‘½ä»¤çš„å‘é€å’Œæ•°æ®çš„ä¼ è¾“éƒ½è¦ä»¥æ­¤ä¸ºåŸºå‡†ï¼›â€œåŠ¨æ€â€åˆ™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦ä¸ºå…¶æä¾›ç”µå‹å®šæ—¶åˆ·æ–°æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œæ‰ç”µåˆ™æ•°æ®ä¸¢å¤±ï¼›â€œåŒå€â€åˆ™æ˜¯ç”±äºå…¶åœ¨æ—¶é’Ÿçš„ä¸Šå‡æ²¿å’Œä¸‹é™æ²¿éƒ½å¯ä»¥è¿›è¡Œæ•°æ®çš„ä¼ è¾“</p>
</li>
<li><p>LPDDR SDRAMï¼šLow-Power Double Data Rate SDRAMï¼Œæ˜¯ä¸€ç§åŠŸè€—è¾ƒä½çš„åŒæ­¥åŠ¨æ€éšæœºå­˜å–å­˜å‚¨å™¨ï¼Œä¸»è¦ç”¨äºç§»åŠ¨è®¡ç®—æœºå’Œæ‰‹æœºç­‰è®¾å¤‡ã€‚è¾ƒæ—§çš„å˜ä½“ä¹Ÿç§°ä¸ºç§»åŠ¨ DDRï¼Œç¼©å†™ä¸º mDDRã€‚ç°ä»£ LPDDR SDRAM ä¸DDR SDRAMæˆªç„¶ä¸åŒï¼Œå…·æœ‰å¤šç§å·®å¼‚ï¼Œç”šè‡³LPDDR æŠ€æœ¯æ ‡å‡†æ˜¯ç‹¬ç«‹äº DDR æ ‡å‡†å¼€å‘çš„ã€‚ï¼ˆæœ¬ç¯‡ä¸å¯¹æ­¤åšè¯¦ç»†è¯´æ˜ï¼‰</p>
</li>
</ul>
<h2 id="å„ç‰ˆæœ¬å‚æ•°å¯¹æ¯”"><a href="#å„ç‰ˆæœ¬å‚æ•°å¯¹æ¯”" class="headerlink" title="å„ç‰ˆæœ¬å‚æ•°å¯¹æ¯”"></a>å„ç‰ˆæœ¬å‚æ•°å¯¹æ¯”</h2><table>
<thead>
<tr>
<th align="center">DDR SDRAM Standard</th>
<th align="center">Bus clock (MHz)</th>
<th align="center">Internal rate (MHz)</th>
<th align="center">Prefetch (min burst)</th>
<th align="center">Transfer Rate (MT/s)</th>
<th align="center">Voltage</th>
<th align="center"><a href="https://zh.m.wikipedia.org/wiki/DIMM">DIMM</a> pins</th>
<th align="center"><a href="https://zh.m.wikipedia.org/wiki/SO-DIMM">SO-DIMM</a> pins</th>
<th align="center"><a href="https://zh.m.wikipedia.org/w/index.php?title=MicroDIMM&amp;action=edit&amp;redlink=1">MicroDIMM</a> pins</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>DDR</strong></td>
<td align="center">100â€“200</td>
<td align="center">100â€“200</td>
<td align="center">2n</td>
<td align="center">200â€“400</td>
<td align="center">2.5/2.6</td>
<td align="center">184</td>
<td align="center">200</td>
<td align="center">172</td>
</tr>
<tr>
<td align="center"><a href="https://zh.m.wikipedia.org/wiki/DDR2_SDRAM">DDR2</a></td>
<td align="center">200â€“533</td>
<td align="center">100â€“266</td>
<td align="center">4n</td>
<td align="center">400â€“1066</td>
<td align="center">1.8</td>
<td align="center">240</td>
<td align="center">200</td>
<td align="center">214</td>
</tr>
<tr>
<td align="center"><a href="https://zh.m.wikipedia.org/wiki/DDR3_SDRAM">DDR3</a></td>
<td align="center">400â€“1066</td>
<td align="center">100â€“266</td>
<td align="center">8n</td>
<td align="center">800â€“2400</td>
<td align="center">1.5</td>
<td align="center">240</td>
<td align="center">204</td>
<td align="center">214</td>
</tr>
<tr>
<td align="center"><a href="https://zh.m.wikipedia.org/wiki/DDR4_SDRAM">DDR4</a></td>
<td align="center">800â€“1200</td>
<td align="center">200â€“300</td>
<td align="center">16n</td>
<td align="center">1600â€“5067</td>
<td align="center">1.2</td>
<td align="center">288</td>
<td align="center">260</td>
<td align="center">214</td>
</tr>
</tbody></table>
<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><ul>
<li><p>channelï¼šé€šé“ï¼Œå±äºæ§åˆ¶å™¨ç«¯çš„æ¦‚å¿µã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªé€šé“å¯¹åº”ä¸€ä¸ªDDRæ§åˆ¶å™¨ï¼Œæ¯ä¸ªé€šé“æ‹¥æœ‰ä¸€ç»„åœ°å€çº¿ã€æ§åˆ¶çº¿å’Œæ•°æ®çº¿</p>
</li>
<li><p>SIMMï¼šSingle In-line Memory Moduleï¼Œå•åˆ—å†…å­˜æ¨¡ç»„ã€‚å†…å­˜æ¨¡ç»„ç”µè·¯æ¿ä¸ä¸»æ¿æ’æ§½çš„æ¥å£åªæœ‰ä¸€åˆ—å¼•è„š</p>
</li>
<li><p>DIMMï¼šDouble In-line Memory Moduleï¼ŒåŒåˆ—å†…å­˜æ¨¡ç»„ï¼Œä¸»æ¿ä¸Šçš„ä¸€ä¸ªå†…å­˜æ’æ§½ï¼Œå†…å­˜æ¨¡ç»„ç”µè·¯æ¿ä¸ä¸»æ¿æ’æ§½çš„æ¥å£æœ‰ä¸¤åˆ—å¼•è„šã€‚ä¸€ä¸ªChannelå¯ä»¥åŒ…æ‹¬å¤šä¸ªDIMMã€‚</p>
</li>
<li><p>Rankï¼šCPUåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå–æ•°æ®çš„å¤§å°å–å†³äºæ•°æ®æ€»çº¿çš„ä½å®½ï¼ˆè¿™ä¸ªä½å®½è¢«ç§°ä¸ºç‰©ç† Bankï¼ˆPhysical Bank)ï¼Œé€šå¸¸å†…å­˜é¢—ç²’éƒ½æ²¡æœ‰P-Bankå¤§å°çš„ä½å®½ï¼Œè¿™æ—¶å°±éœ€è¦å¤šä¸ªå†…å­˜é¢—ç²’ç»„åˆèµ·æ¥æ»¡è¶³CPUçš„ä¸€æ¬¡è®¿å­˜ã€‚å‡è®¾P-Bank=64bitå³64ä½æ•°æ®æ€»çº¿ï¼Œè€Œå†…å­˜é¢—ç²’Chipçš„ä½å®½æ˜¯8bitï¼Œåˆ™8ä¸ªchipç»„æˆäº†ä¸€ä¸ªRankã€‚</p>
</li>
<li><p>Chipï¼š1ä¸ªchipå¤§å¤šæ˜¯4bit/8bit/16bitç­‰ï¼Œå¤šä¸ªchipç»„æˆä¸€ä¸ªrankï¼Œé…åˆå®Œæˆä¸€æ¬¡è®¿é—®çš„ä½å®½è¦æ±‚ã€‚è¿™å°±æ˜¯é¢—ç²’ã€‚å†…å­˜é¢—ç²’å…±äº«åœ°å€å’Œå‘½ä»¤æ€»çº¿ï¼Œå„è‡ªæœ‰è‡ªå·±çš„æ•°æ®æ€»çº¿</p>
</li>
<li><p>Bankï¼šä¹Ÿç§°Logic Banké€»è¾‘Bankï¼Œä¸ç‰©ç†bankçš„æ¦‚å¿µç›¸å¯¹åº”ã€‚ç”±äºæˆæœ¬ã€æŠ€æœ¯ä»¥åŠSDRAMå·¥ä½œåŸç†çš„é™åˆ¶ï¼Œåšä¸€ä¸ªå…¨å®¹é‡çš„Bankä¸å¤ªç°å®ï¼ˆå¯»å€å†²çªï¼‰ï¼Œæ‰€ä»¥åœ¨å¯»å€æ—¶éœ€è¦å…ˆé€‰ä¸­Bankï¼Œåœ¨æ ¹æ®è¡Œåˆ—é€‰ä¸­æ•°æ®ã€‚DDR2ã€DDR3å·²ç»æœ‰8ä¸ªBank </p>
</li>
<li><p>row/columnï¼šè¡Œåˆ—ï¼Œå­˜å‚¨çš„æœ€å°å•å…ƒï¼Œæ¯ä¸€ä¸ªè¡Œåˆ—äº¤å‰ç‚¹å­˜å‚¨äº†1bitçš„æ•°æ®ã€‚</p>
</li>
</ul>
<p>ç¬¼ç»Ÿä¸Šè®²ä»å¤§åˆ°å°ä¸ºï¼š<strong>channel ï¼ DIMM ï¼ rank ï¼ chip ï¼ bank ï¼ row/column</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/images/computerSystem/storage/ddr-1.png" alt="image"></p>
<h2 id="å†…å­˜å¤§å°"><a href="#å†…å­˜å¤§å°" class="headerlink" title="å†…å­˜å¤§å°"></a>å†…å­˜å¤§å°</h2><p>SDRAMæ€»å­˜å‚¨å®¹é‡ = è¡Œæ•° x åˆ—æ•° x L-Bankæ•°é‡  = å­˜å‚¨å•å…ƒä¸ªæ•° x å­˜å‚¨å•å…ƒå®¹é‡ï¼ˆ4bit/8bit/16bitï¼‰</p>
<h1 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h1><blockquote>
<p>Tipsï¼šåˆ¤æ–­MOSç®¡æ˜¯Næ²Ÿé“è¿˜æ˜¯Pæ²Ÿé“ï¼Œé‡ŒNå¤–Pï¼Œå³ç®­å¤´æŒ‡å‘Gæ˜¯NMOSï¼Œåä¹‹æ˜¯PMOS</p>
</blockquote>
<p>åˆ©ç”¨äº†ç”µå®¹èƒ½å¤Ÿä¿æŒç”µè·åŠå…¶å……æ”¾ç”µçš„ç‰¹æ€§ã€‚ç›®å‰å¸‚åœºæœ€å¸¸ç”¨çš„å­˜å‚¨1bitæ•°æ®çš„SDRAMçš„ç»“æ„æ˜¯ç”±ä¸€ä¸ªMOSç®¡ã€ä¸€ä¸ªç”µå®¹å’Œä¸¤æ ¹å¯¼çº¿ç»„æˆçš„ã€‚ç”µå®¹ä¸€æ®µè¿æ¥æ™¶ä½“ç®¡ä¸€ç«¯å¦ä¸€ç«¯æ¥åœ°ã€å­—çº¿è¿æ¥MOSç®¡çš„æ …æï¼Œä½çº¿è¿æ¥åˆ°æ™¶ä½“ç®¡é€šé“çš„å¦ä¸€ç«¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/images/computerSystem/storage/ddr-2.png" alt="image"></p>
<ul>
<li><p>å†™</p>
<p>å½“å­—çº¿ï¼ˆWLï¼‰ç”µå‹ä¸ºé€»è¾‘1æ—¶å¼€å…³æ‰“å¼€ï¼Œå­˜å‚¨å•å…ƒé€‰é€šï¼Œå¦‚æœæ­¤æ—¶ä½çº¿ï¼ˆBLï¼‰ä¸ºé«˜ç”µå‹ï¼Œåˆ™å‘ç”µå®¹ä¸­å……ç”µï¼Œåˆ™å°±æ˜¯å‘å­˜å‚¨å•å…ƒä¸­å†™1ï¼›ç›¸åå¦‚æœWL=1ï¼ŒBL=0ç”µå®¹æ”¾ç”µï¼Œè¿™å°±æ˜¯å‘å­˜å‚¨å•å…ƒä¸­å†™0</p>
</li>
<li><p>è¯»</p>
<p>å½“å­—çº¿ï¼ˆWLï¼‰ç”µå‹ä¸ºé€»è¾‘1æ—¶å¼€å…³æ‰“å¼€ï¼Œæ­¤æ—¶åœ¨ä½çº¿ä¸Šè¿æ¥ç”µé‡è®¡å°±å¯ä»¥æµ‹é‡ç”µå®¹ä¸­å­˜å‚¨çš„çš„å€¼ã€‚å¦‚æœç”µå®¹æ”¾ç”µï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºè¿™ä¸ªå•å…ƒé‡ŒåŸæ¥å­˜çš„å€¼æ˜¯ 1ï¼Œå¦‚æœç”µå®¹ä¸æ”¾ç”µï¼Œåˆ™è¡¨ç¤ºåŸæ¥çš„å€¼æ˜¯ 0ã€‚å¯è§å½“DRAMè¿›è¡Œæ•°æ®è¯»å–çš„æ—¶å€™ä¼šä½¿å­˜å‚¨å•å…ƒä¸­çš„1å˜æˆ0ï¼Œæ˜¯æœ‰ç ´åæ€§çš„ï¼Œè€Œå®é™…ä¸­æˆ‘ä»¬éœ€è¦è¯»å‡ºç»§ç»­ä¿æŒæ•°æ®æˆ–ç”µè·ï¼Œåé¢æœ‰å¯¹æ­¤çš„è§£å†³åŠæ³•ï¼ˆæ„Ÿåº”æ”¾å¤§å™¨ï¼‰</p>
</li>
</ul>
<p>å½“å­—çº¿å…³é—­çš„æ—¶å€™å°±ä¸è¿›è¡Œä»»ä½•è¯»å†™æ“ä½œäº†ï¼Œæ™¶ä½“ç®¡ä¹Ÿç´§è·Ÿç€è¢«å…³é—­ï¼Œç”µå®¹å™¨ä¸ä½çº¿éš”ç¦»ä»è€Œä¿å­˜äº†ä¹‹å‰å†™å…¥çš„æ•°æ®æˆ–ç”µè·ã€‚ä½†æ˜¯ç”±äºæ™¶ä½“ç®¡ååˆ†å°ï¼Œå­˜å‚¨åœ¨ç”µå®¹å™¨ä¸­çš„ç”µè·ä¼šåœ¨é€šé“ä¸Šæ…¢æ…¢æ³„éœ²ï¼Œå› æ­¤åˆéœ€è¦å¦å¤–çš„æŠ€æœ¯æ¥å¯¹æ­¤è¿›è¡Œä¿®å¤ï¼ˆRechargeï¼‰</p>
<h1 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h1><p>ä¸‹å›¾æ˜¯å¯¹ä¸€ä¸ªbankçš„ä¸€éƒ¨åˆ†ä½œå›¾è¿›è¡Œè¯´æ˜ã€‚è¡Œè¯‘ç å™¨ã€åˆ—é€‰æ‹©å¤ç”¨å™¨ä¹‹æ‰€ä»¥è¿™æ ·è®¾è®¡æ˜¯å› ä¸ºï¼šå½“æ•°æ®è¿›è¡Œè¯»å†™çš„æ—¶å€™ï¼Œåªéœ€è¦æ‰“å¼€æŸä¸€ä¸ªå›ºå®šè¡Œï¼ˆå…¶å®ƒè¡Œå…³é—­ï¼‰å³å¯ï¼Œè¿™æ ·å­è¯¥è¡Œæ‰€åœ¨çš„ç”µå®¹å°†è¿æ¥åˆ°ä½çº¿ä¸Šï¼Œè€Œåœ¨è¿›è¡Œåˆ—é€‰æ‹©çš„æ—¶å€™ï¼Œç”±äºæ˜¯è¿›è¡Œå¤šæ¯”ç‰¹çš„é€‰æ‹©ï¼ˆ4bit/8bitï¼‰æ‰€ä»¥è¦è¿™é‡Œçš„åˆ—å¤šè·¯å¤ç”¨å™¨ç›¸å½“äºåˆ—ä¸­çš„ç¬¬å‡ ç»„ï¼ˆç»„æ•°*ä½å®½ï¼‰</p>
<p><img src="/images/computerSystem/storage/ddr-3.png" alt="image"></p>
<h2 id="è¯»-x2F-å†™"><a href="#è¯»-x2F-å†™" class="headerlink" title="è¯»/å†™"></a>è¯»/å†™</h2><h3 id="é€šç”¨æµç¨‹"><a href="#é€šç”¨æµç¨‹" class="headerlink" title="é€šç”¨æµç¨‹"></a>é€šç”¨æµç¨‹</h3><blockquote>
<p>é¢„å……ç”µç”µå‹æ ¹æ®DDRæ¯ä¸€ä»£æ˜¯æœ‰æ‰€ä¸åŒçš„ï¼Œä½†ä¸€å®šæ˜¯å……ç”µç”µå‹çš„ä¸€åŠ</p>
</blockquote>
<ol>
<li>é€‰æ‹©bankï¼›</li>
<li>å…³é—­æ‰€æœ‰è¡Œï¼›å…³é—­æ‰€æœ‰å­—çº¿ï¼Œéš”ç¦»æ‰€æœ‰ç”µå®¹</li>
<li>é¢„å……ç”µï¼›å°†æ‰€æœ‰ä½çº¿çš„ç”µå‹å‡å€¼ä¾›ç”µç”µå‹ä¸€åŠï¼ˆDDR5ï¼š0.55Vï¼›DDR4ï¼š0.6Vï¼›DDR3ï¼š0.75Vï¼‰</li>
<li>è¡Œé€‰æ‹©ï¼›å­—çº¿ä¸Šç”µæ‰“å¼€MOSç®¡å½¢æˆçš„å¼€å…³ï¼Œç”µå®¹è¿æ¥åˆ°å¯¹åº”çš„ä½çº¿</li>
<li>åˆ—é€‰æ‹©ï¼›ä½çº¿é€šè¿‡å¤šè·¯å¤ç”¨é€‰æ‹©å™¨è¿æ¥åˆ°æ•°æ®çº¿ä¸Š</li>
</ol>
<h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><ul>
<li><p>è¯»ï¼ˆä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼‰</p>
<p>è¡Œé€‰æ‹©æ—¶ï¼Œå½“å­—çº¿é€‰ä¸­åï¼Œè¯¥è¡Œæ‰€åœ¨çš„ç”µå®¹è¢«è¿æ¥åˆ°å¯¹åº”çš„ä½çº¿ã€‚å¦‚æœç”µå®¹å­˜å‚¨çš„æ•°æ®æ˜¯1ï¼ˆç”µå®¹å‹å·®æ˜¯ä¾›ç”µç”µå‹1.1 / 1.2 / 1.4ï¼‰ï¼Œç”±äºä½çº¿é¢„å……ç”µåç”µå‹è‡³ä¾›ç”µç”µå‹çš„ä¸€åŠï¼Œæ‰€ä»¥ç”µè·å°†ä»ç”µå®¹æµå‘ä½çº¿ï¼Œè¿›è€Œä½çº¿ç”µå‹å¢åŠ ï¼Œè¿™æ—¶ä½çº¿ä¸‹é¢æ‰€è¿æ¥çš„æ„Ÿåº”æ”¾å¤§å™¨èƒ½æ„Ÿå—åˆ°è¿™ç§è½»å¾®çš„å˜åŒ–æˆ–æ‰°åŠ¨ï¼Œå¹¶æ”¾å¤§è¿™ä¸€å˜åŒ–ï¼Œå°†ä½çº¿ç”µå‹å†å¢åŠ åˆ°ä¾›ç”µç”µå‹ï¼ˆ1.1 / 1.2 / 1.4ï¼‰ï¼›ç›¸åï¼Œå¦‚æœå­˜å‚¨çš„æ˜¯0ï¼Œç”µè·å°†ä»ä½çº¿æµå‘ç”µå®¹ï¼Œä½çº¿ç”µå‹é™ä½ï¼Œæ„Ÿåº”æ”¾å¤§å™¨æ”¾å¤§è¿™ä¸€å˜åŒ–ï¼Œå°†ä½çº¿ç”µå‹é™ä½è‡³0Vã€‚è¿™æ ·å°±ä¿è¯äº†æ—¢èƒ½å¤Ÿé€šè¿‡ä½çº¿è¯»å–æ•°æ®åˆä¿è¯ç”µå®¹æ•°æ®ä¸ä¸¢å¤±</p>
</li>
<li><p>å†™</p>
<p>å†™æµç¨‹ä¸è¯»ç±»ä¼¼ï¼Œä½†å½“è¦å†™å…¥çš„æ•°æ®â€“&gt;æ•°æ®æ€»çº¿â€“&gt;å†™é©±åŠ¨å™¨å™¨â€“&gt;å¤šè·¯é€‰æ‹©å¤ç”¨å™¨â€“&gt;æ„Ÿåº”æ”¾å¤§å™¨â€”&gt;ä½çº¿ è¿™æ ·æµç¨‹ä¸‹æ¥çš„æ—¶å€™ï¼Œç”±äºå†™é©±åŠ¨å™¨çš„å­˜åœ¨ï¼Œå®ƒæ¯”æ„Ÿåº”æ”¾å¤§å™¨å¼ºå¤§çš„å¤šï¼Œè¿™å°†ä¼šå¯¼è‡´å†™é©±åŠ¨å™¨å‡ºæ¥çš„æ•°æ®ç›´æ¥è¦†ç›–æ‰ä½çº¿ä¸ŠåŸæœ‰çš„æ•°æ®</p>
</li>
</ul>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>å‡è®¾32ä½åœ°å€æ€»çº¿ï¼Œ32ä¸ªbankï¼Œ65536ï¼ˆ2^16^ï¼‰è¡Œï¼Œ8192ï¼ˆ2^13^ï¼‰åˆ—ï¼Œ8bitddré¢—ç²’</p>
<ul>
<li>0-4ï¼Œ5ä½åœ°å€å°†é€‰æ‹©æŸä¸ªbank</li>
<li>è¡Œå…³é—­ + é¢„å……ç”µ</li>
<li>5-21ï¼Œ16ä½é€‰æ‹©æŸä¸ªè¡Œ</li>
<li>22-31ï¼Œ10bité€‰æ‹©æŸä¸ªç»„ï¼ˆæ¯ä¸€ç»„8åˆ—ï¼Œè¿™ä¸ªç”±L-bankä½å®½å†³å®šï¼‰</li>
</ul>
<h2 id="åˆ·æ–°Refresh"><a href="#åˆ·æ–°Refresh" class="headerlink" title="åˆ·æ–°Refresh"></a>åˆ·æ–°Refresh</h2><p>refreshæ¯ä¸€è¡Œçš„åˆ·æ–°æ—¶é—´æ˜¯50nsã€‚è€Œæ•´ä¸ªbankåˆ·æ–°çš„æ—¶é—´é—´éš”æ˜¯64ms/æ¬¡ï¼ˆå°äºç”µè·æ³„éœ²1-&gt;0çš„æœ€çŸ­æ—¶é—´ï¼‰</p>
<h3 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h3><p>ç”±äºSDRAMæœ€å°å­˜å‚¨å•å…ƒç”µè·¯å½¢å¼æ˜¯ç”µå®¹ï¼Œç”µå®¹æ˜¯æœ‰è‡ªæ”¾ç”µçš„ç‰¹æ€§ã€‚é•¿æ—¶é—´å­˜å‚¨ç”µå®¹ç”µè·ä¼šæ¼ç”µï¼Œæ•…éœ€è¦åˆ·æ–°å’Œé¢„å……ç”µè¿›è¡Œè¡¥å……ã€‚</p>
<h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><ul>
<li>è‡ªåŠ¨åˆ·æ–°ï¼ˆAuto Refreshï¼Œç®€ç§°AR/REFï¼Œéœ€è¦CKï¼ŒCKEé«˜ï¼‰</li>
<li>è‡ªåˆ·æ–°ï¼ˆSelf Refreshï¼Œç®€ç§°SR/SRE-SRFï¼ŒSDRAMå†…éƒ¨äº§ç”Ÿï¼Œä¸ä¾èµ–CKï¼ŒCKEä½ï¼Œç”¨äºä¼‘çœ æ¨¡å¼æˆ–ä½åŠŸè€—ï¼‰</li>
</ul>
<h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol>
<li>å…³é—­æ‰€æœ‰è¡Œ</li>
<li>é¢„å……ç”µ</li>
<li>æ‰“å¼€è¡Œï¼Œæ„Ÿåº”æ”¾å¤§å¹¶å¡«å……ç”µè·</li>
<li>ä»ç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œé‡å¤ç¬¬3æ­¥éª¤</li>
</ol>
<h1 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h1><ul>
<li>CASï¼šColumn Address Selectï¼Œåˆ—åœ°å€é€‰æ‹©</li>
<li>RASï¼šRow Address Selectï¼Œè¡Œåœ°å€é€‰æ‹©</li>
<li>CAS Latencyï¼š(CLï¼‰CASå»¶è¿Ÿã€‚æŒ‡çš„æ˜¯ä»è¡Œæ‰“å¼€åˆ°åˆ°æ¥æ”¶åˆ°å­˜å‚¨åœ¨åˆ—ä¸­çš„æ•°æ®çš„æ—¶é—´</li>
<li>tRCDï¼šRAS to CAS Delay RAS-CASå»¶è¿Ÿï¼Œæ¿€æ´»æ—¶é—´ã€‚æŒ‡çš„æ˜¯åœ¨å­—çº¿å…¨éƒ¨å…³é—­ï¼Œä½çº¿è¢«é¢„å……ç”µçš„æƒ…å†µä¸‹ï¼Œæ‰“å¼€ä¸€è¡Œæ‰€éœ€è¦çš„æ—¶é—´</li>
<li>tRPï¼šRAS Precharge Time ï¼Œè¡Œé¢„å……ç”µæ—¶é—´ã€‚æŒ‡çš„æ˜¯å†æ‰“å¼€ä¸€è¡Œä¹‹å‰å¯¹ä½çº¿è¿›è¡Œé¢„å……ç”µçš„æ—¶é—´</li>
<li>tRASï¼šæ¿€æ´»ä¸€è¡Œå’Œæ¥ä¸‹æ¥é¢„å……ç”µä¹‹é—´çš„æ—¶é—´</li>
</ul>
<p><img src="/images/computerSystem/storage/ddr-4.png" alt="image"></p>
<h1 id="ä¼˜åŒ–-x2F-è®¿å­˜åŠ é€Ÿ"><a href="#ä¼˜åŒ–-x2F-è®¿å­˜åŠ é€Ÿ" class="headerlink" title="ä¼˜åŒ–/è®¿å­˜åŠ é€Ÿ"></a>ä¼˜åŒ–/è®¿å­˜åŠ é€Ÿ</h1><h2 id="è¡Œå‘½ä¸­"><a href="#è¡Œå‘½ä¸­" class="headerlink" title="è¡Œå‘½ä¸­"></a>è¡Œå‘½ä¸­</h2><p>åœ¨DRAMçš„è¯»å†™è¿‡ç¨‹ä¸­ï¼Œå…¶ä¸­æ¯”è¾ƒè€—æ—¶çš„æ­¥éª¤åº”è¯¥å°±æ˜¯è¡Œæ‰“å¼€ã€‚</p>
<p>å¯ä»¥è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šCPUç¬¬ä¸€æ¬¡è®¿å­˜æ˜¯åœ¨249è¡Œï¼Œç¬¬äºŒæ¬¡æ‰€éœ€è¦çš„æ•°æ®å¤§æ¦‚ç‡ä¹Ÿå¯èƒ½åœ¨249è¡Œï¼Œå› æ­¤åœ¨ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡è®¿å­˜ä¸­é—´æˆ‘ä»¬å°±å¯ä»¥ä¸å…³é—­è¡Œäº†ï¼Œè€Œæ˜¯ç­‰åˆ°æ–°çš„è¡Œè®¿å­˜å†è¿›è¡Œæ•´ä¸ªè¯»å†™æ­¥éª¤ã€‚è¿›è€Œå°†ä¸€ä¸ªbankå†…çš„æƒ…å†µæ¨å¹¿åˆ°æ•´ä¸ªå†…å­˜é¢—ç²’ï¼Œæ¯ä¸€ä¸ªbankä¸Šéƒ½å­˜åœ¨ä¸€è¡Œæœªå…³é—­ï¼ˆå³ä¸Šæ¬¡è®¿å­˜æ•°æ®æ‰€åœ¨çš„è¡Œï¼‰ï¼Œè€Œå½“ä¸‹æ¬¡è®¿å­˜æ‰€åœ¨çš„è¡Œå¦‚æœæ‰“å¼€åˆ™æˆä¸ºRow Hitè¡Œå‘½ä¸­ï¼Œå¦‚æœæ²¡æœ‰ç§°ä¸ºRow Missï¼ˆå‚è€ƒã€5å‚æ•°ã€‘ç« èŠ‚çš„å›¾ç‰‡ï¼‰</p>
<h2 id="Burst-Buffer"><a href="#Burst-Buffer" class="headerlink" title="Burst Buffer"></a>Burst Buffer</h2><p>Burstï¼šçªå‘ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€è¡Œä¸­ç›¸é‚»çš„å­˜å‚¨å•å…ƒè¿ç»­è¿›è¡Œæ•°æ®ä¼ è¾“çš„æ–¹å¼ï¼Œè¿ç»­ä¼ è¾“æ‰€æ¶‰åŠåˆ°å­˜å‚¨å•å…ƒï¼ˆåˆ—ï¼‰çš„æ•°é‡å°±æ˜¯çªå‘é•¿åº¦ï¼ˆBurst Lengthsï¼Œç®€ç§° BLï¼‰ã€‚ </p>
<p>å¦‚æœæ‰€ç¤ºå°±æ˜¯ä¸¤ä¸ª128bitçš„burst bufferï¼Œä¸Šç«¯è¿æ¥åˆ—é€‰æ‹©å³æ•°æ®æ®µï¼Œä¸‹é¢è¿æ¥è¯»å†™é©±åŠ¨å™¨ã€‚äººä»¬åªè¦æŒ‡å®šèµ·å§‹åˆ—åœ°å€ä¸çªå‘é•¿åº¦ï¼Œå†…å­˜å°±ä¼šä¾æ¬¡åœ°è‡ªåŠ¨å¯¹åé¢ ç›¸åº”æ•°é‡çš„å­˜å‚¨å•å…ƒè¿›è¡Œè¯»/å†™æ“ä½œè€Œä¸å†éœ€è¦æ§åˆ¶å™¨è¿ç»­åœ°æä¾›åˆ—åœ°å€ã€‚è¿™æ ·ï¼Œé™¤äº†ç¬¬ä¸€ç¬”æ•°æ®çš„ä¼ è¾“éœ€è¦è‹¥å¹²ä¸ªå‘¨æœŸï¼ˆä¸»è¦æ˜¯ä¹‹å‰çš„å»¶è¿Ÿï¼Œä¸€èˆ¬çš„æ˜¯ tRCD+CLï¼‰å¤–ï¼Œå…¶åæ¯ä¸ªæ•°æ®åªéœ€ä¸€ä¸ªå‘¨æœŸçš„å³å¯è·å¾—ã€‚</p>
<p>è‡³äº BL çš„æ•°å€¼ï¼Œä¹Ÿæ˜¯ä¸èƒ½éšä¾¿è®¾æˆ–åœ¨æ•°æ®è¿›è¡Œä¼ è¾“å‰ä¸´æ—¶å†³å®šã€‚ä¸€å®šè¦å‚è€ƒç›¸åº”çš„æ•°æ®æ‰‹å†Œè¿›è¡Œè®¾ç½®ï¼Œæ¯”è¾ƒå¸¸è§çš„è®¾å®šæ˜¯ 4 å’Œ 8ã€‚</p>
<p><img src="/images/computerSystem/storage/ddr-5.png" alt="image"></p>
<h2 id="æ„Ÿåº”æ”¾å¤§å™¨"><a href="#æ„Ÿåº”æ”¾å¤§å™¨" class="headerlink" title="æ„Ÿåº”æ”¾å¤§å™¨"></a>æ„Ÿåº”æ”¾å¤§å™¨</h2><ul>
<li><p>ä¼˜åŒ–æ–¹å¼</p>
<p>è®©æ¯ä¸€ä¸ªæ„Ÿåº”æ”¾å¤§å™¨ä¸Šç”±ä¸¤ä¸ªä½çº¿è¿æ¥åˆ°å…¶ä¸Šï¼Œè®©äº¤æ›¿æ’åˆ—çš„å­˜å‚¨å•å…ƒåˆ†åˆ«è¿æ¥åœ¨å·¦ä¾§å’Œå³ä¾§çš„ä½çº¿ã€‚äº¤å‰è€¦åˆåç›¸å™¨çš„å­˜åœ¨ä½¿å¾—ä¸€åŠçš„ä½çº¿å¤„äº1ï¼Œå¦ä¸€åŠå¤„äº0ï¼Œè¿™è¢«ç§°ä¸ºå·®åˆ†å¯¹</p>
</li>
<li><p>å¥½å¤„ï¼š</p>
<ol>
<li>é¢„å……ç”µæ—¶ï¼Œç”±äºå·®åˆ†å¯¹ä¸¤ä¾§ä¸€è¾¹æ˜¯0ï¼Œä¸€è¾¹æ˜¯1ï¼Œæ‰€ä»¥æ–­å¼€ä¸¤ä¸ªåç›¸å™¨ç„¶åé€šè¿‡ä¸‰æç®¡å°†ä¸¤ä¸ªä½çº¿è¿æ¥ï¼Œç”µå‹å°†é™ä½åˆ°ä¸­å€¼</li>
<li>æŠ—å™ªéŸ³</li>
<li>å‡å°‘ä½çº¿å¯„ç”Ÿç”µå®¹</li>
</ol>
</li>
</ul>
<p><img src="/images/computerSystem/storage/ddr-6.png" alt="image"></p>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><blockquote>
<p>1ã€2é“¾æ¥ä¸ºåŒä¸€è§†é¢‘ï¼ŒåŒºåˆ«åœ¨äº1æ˜¯Youtubeè‹±æ–‡ç‰ˆï¼Œ2æ˜¯Bç«™ä¸­æ–‡è¯‘ç‰ˆ</p>
</blockquote>
<ol>
<li><a href="https://www.youtube.com/watch?v=7J7X7aZvMXQ&amp;t=831s">How does Computer Memory Work?</a></li>
<li><a href="https://www.bilibili.com/video/BV1vP411c7pt/?s">è®¡ç®—æœºå¦‚ä½•å·¥ä½œï¼Ÿ</a></li>
<li><a href="https://www.bilibili.com/video/BV1ZZ4y1M79G/">SDRAMä¸DDR2å­˜å‚¨å™¨åŸç†è¯¦è§£ã€FPGAåº”ç”¨åœºæ™¯ã€‘</a></li>
<li><a href="http://www.bdtic.com/datasheet/Micron/64Mb_x4_x8_x16SDRAM.pdf">ç¾å…‰SDRAM MT48LC2M32B2TG-7 æ•°æ®æ‰‹å†Œ</a></li>
</ol>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Storage</category>
      </categories>
      <tags>
        <tag>storage system</tag>
        <tag>DDR</tag>
      </tags>
  </entry>
  <entry>
    <title>Flash</title>
    <url>/2023/05/08/computerSystem/storage/Flash/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Flash Memoryé—ªå­˜ï¼Œä¸€ç§éæ˜“å¤±æ€§å­˜å‚¨å™¨ï¼Œæ–­ç”µæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ—©æœŸçš„é—ªå­˜è¿›è¡Œä¸€æ¬¡æŠ¹é™¤ï¼Œå°±ä¼šæ¸…é™¤æ‰æ•´é¢—èŠ¯ç‰‡ä¸Šçš„æ•°æ®ï¼Œä½†ç›®å‰å·²å¯ä»¥ç²¾ç¡®åˆ°å¯¹æŒ‡å®šçš„åŒºåŸŸè¿›è¡Œåˆ é™¤ã€‚é—ªå­˜å…è®¸åœ¨æ“ä½œä¸­è¢«å¤šæ¬¡æ“¦æˆ–å†™çš„å­˜å‚¨å™¨ï¼Œè¿™ç§ç§‘æŠ€ä¸»è¦ç”¨äºä¸€èˆ¬æ€§æ•°æ®å­˜å‚¨ï¼Œä»¥åŠåœ¨è®¡ç®—æœºä¸å…¶ä»–æ•°å­—äº§å“é—´äº¤æ¢ä¼ è¾“æ•°æ®ã€‚SmartMediaï¼ˆSMå¡ï¼‰ã€Compact Flashï¼ˆCFå¡)ï¼‰ã€MultiMediaCardï¼ˆMMCå¡ï¼‰ã€Secure Digitalï¼ˆSDå¡ï¼‰éƒ½å±äºé—ªå­˜</p>
<p>é—ªå­˜Flashä¹Ÿè¢«è®¤ä¸ºæ˜¯ä¸€ç§EEPROMï¼ˆç”µå¯æ“¦é™¤å¯ç¼–ç¨‹åªè¯»å­˜å‚¨å™¨ï¼‰ï¼Œè€ŒåŒºåˆ«åœ¨äºä¼ ç»Ÿçš„EEPROMä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œæ“¦å†™ï¼Œè€ŒFlashåˆ™å®ç°äº†ä»¥å—ä¸ºå•ä½è¿›è¡Œæ“¦å†™ã€‚</p>
<h2 id="å‰ä¸–ä»Šç”Ÿ"><a href="#å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="å‰ä¸–ä»Šç”Ÿ"></a>å‰ä¸–ä»Šç”Ÿ</h2><blockquote>
<p>NOR NANDå‘½åï¼šå–ç”¨äº†ç”µè·¯é€»è¾‘è¿ç®—ä¸­çš„æˆ–éï¼ˆNot ORï¼‰å’Œä¸éï¼ˆNot ANDï¼‰</p>
</blockquote>
<p>Flashåœ¨å¤§ç±»ä¸ŠåŒºåˆ†å¯ä»¥è®¤ä¸ºæœ‰ä¸¤ç§è§„æ ¼ï¼šNOR Flashå’ŒNAND Flash</p>
<p>1984å¹´ï¼Œä¸œèŠå…¬å¸çš„å‘æ˜äººèˆ›å†ˆå¯Œå£«é›„é¦–å…ˆæå‡ºäº†é—ªå­˜çš„æ¦‚å¿µã€‚è€Œåœ¨å››å¹´å1988å¹´ï¼Œåšå­˜å‚¨èµ·å®¶çš„Intelæ¨å‡ºäº†ä¸–ç•Œç¬¬ä¸€æ¬¾Nor FlashèŠ¯ç‰‡ï¼Œå®ƒç»“åˆEPROM(å¯æ“¦é™¤å¯ç¼–ç¨‹åªè¯»å­˜å‚¨å™¨)å’ŒEEPROM(ç”µå¯æ“¦é™¤å¯ç¼–ç¨‹åªè¯»å­˜å‚¨å™¨)ä¸¤é¡¹æŠ€æœ¯ï¼Œå¹¶æ‹¥æœ‰ä¸€ä¸ªSRAMæ¥å£ï¼Œä»æ­¤ä¹Ÿå½»åº•æ‰“ç ´äº†EPPRONå’ŒEPROMä¸€ç»Ÿå¤©ä¸‹çš„å±€é¢ã€‚</p>
<p>1989å¹´ï¼Œä¸œèŠå…¬å¸å‘è¡¨äº†NAND Flash ç»“æ„ï¼Œå¼ºè°ƒé™ä½æ¯æ¯”ç‰¹çš„æˆæœ¬ï¼Œæœ‰æ›´é«˜çš„æ€§èƒ½ï¼Œå¹¶ä¸”åƒç£ç›˜ä¸€æ ·å¯ä»¥é€šè¿‡æ¥å£è½»æ¾å‡çº§ã€‚å› æ­¤NAND Flashå¹¶è¢«è®¤ä¸ºæ˜¯NORé—ªå­˜çš„ç†æƒ³æ›¿ä»£è€…ã€‚é‰´äºå…¶å‡ºè‰²çš„æ€§ä»·æ¯”ï¼Œå®ƒå¸¸å¸¸è¢«åº”ç”¨äºè¯¸å¦‚CompactFlashã€SmartMediaã€ SDã€ MMCç­‰å­˜å‚¨å¡ä¸Šã€‚</p>
<p>1997å¹´è¥¿é—¨å­å’Œ Sandisk æ¨å‡ºMMCï¼ˆMulti Media Cardï¼Œå¤šåª’ä½“å¡ï¼‰ ï¼Œè€Œåœ¨1999å¹´åŸºäºMMCå‘å±•è€Œæ¥çš„SDï¼ˆSecure Digital Memory Cardï¼‰å¡é¦–æ¬¡ç”±æ¾ä¸‹ã€ä¸œèŠå’Œ Sandisk å…¬å¼€å‘å¸ƒï¼ŒäºŒè€…æœ€åˆçš„å¤–è§‚å°ºå¯¸ä¹Ÿå¾ˆç±»ä¼¼ï¼ŒSD å¡æ¯” MMC å¡åš 0.7mmã€‚ä½†æ˜¯éšç€ç§»åŠ¨äº’è”ç½‘æ—¶ä»£çš„åˆ°æ¥ï¼Œå¯¹çš„å­˜å‚¨èŠ¯ç‰‡æå‡ºäº†æ›´é«˜çš„è¦æ±‚ï¼šé«˜å®¹é‡ã€é«˜ç¨³å®šæ€§å’Œé«˜è¯»å†™é€Ÿåº¦çš„åŒæ—¶è¦æ±‚æ‹¥æœ‰æ›´å°å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤eMMCï¼ˆEmbedded Multi Media Cardï¼‰åº”è¿è€Œç”Ÿã€‚ç®€å•æ¥ç†è§£ <em><strong>eMMC = NAND Flash + é—ªå­˜æ§åˆ¶èŠ¯ç‰‡ + æ ‡å‡†æ¥å£å°è£…</strong></em></p>
<h2 id="NAND-Flashåˆ†ç±»"><a href="#NAND-Flashåˆ†ç±»" class="headerlink" title="NAND Flashåˆ†ç±»"></a>NAND Flashåˆ†ç±»</h2><ul>
<li>ä¸å¸¦æ§åˆ¶å™¨<ul>
<li>RAW NANDï¼Œå¯ç„Šæ¥åœ¨PCBä¸Š</li>
</ul>
</li>
<li>å¸¦æ§åˆ¶å™¨<ul>
<li>æ¨¡ç»„ï¼ˆå¯æ’æ‹”ï¼‰<ul>
<li>TF / SD</li>
<li>SSD</li>
</ul>
</li>
<li>èŠ¯ç‰‡ï¼ˆå¯ç„Šæ¥ï¼‰<ul>
<li>SD NAND</li>
<li>eMMC</li>
<li>SPI NAND</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p><img src="/images/computerSystem/storage/flash.png" alt="image"></p>
<p>â€‹																		ï¼ˆå›¾ç‰‡æ¥è‡ª <a href="https://www.bilibili.com/video/BV1hV411H76e/">éƒ­å¤©ç¥¥è€å¸ˆBç«™è¯¾ç¨‹</a>ï¼‰</p>
<p>NOR Flash ä¸ NAND Flashéƒ½æ˜¯ç”¨ä¸‰ç«¯å™¨ä»¶ä½œä¸ºå­˜å‚¨å•å…ƒï¼Œåˆ†åˆ«ä¸ºæºæã€æ¼æå’Œæ …æï¼Œä¸åœºæ•ˆåº”ç®¡çš„å·¥ä½œåŸç† ç›¸åŒï¼Œä¸»è¦æ˜¯åˆ©ç”¨ç”µåœºçš„æ•ˆåº”æ¥æ§åˆ¶æºæä¸æ¼æä¹‹é—´çš„é€šæ–­ï¼Œæ …æçš„ ç”µæµæ¶ˆè€—æå°ï¼Œä¸åŒ çš„æ˜¯åœºæ•ˆåº”ç®¡ä¸ºå•æ …æç»“æ„ï¼Œè€Œ FLASH ä¸ºåŒæ …æç»“æ„ï¼Œåœ¨æ …æä¸ç¡…è¡¬åº•ä¹‹é—´å¢åŠ äº†ä¸€ä¸ªæµ®ç½®æ …æã€‚</p>
<p>å†™å…¥ï¼šSæ¥0Vï¼ˆåœ°ï¼‰ï¼ŒDæ¥6Vï¼Œå½“PNç»“è¶…è¿‡ä¸€å®šç”µå‹å‡ºç°é›ªå´©å‡»ç©¿ï¼Œç”µå­ä»Sæµå‘Dã€‚Gcç«¯æœ‰12Vè„‰å†²ï¼Œä¸æ­¤åŒæ—¶Gcä¸è¡¬åº•ä¹‹é—´ä¹Ÿæœ‰åœºå¼ºï¼Œç”µå­ä¹Ÿä¼šç©¿è¿‡æ°§åŒ–å±‚åˆ°æµ®æ …åŒºã€‚ï¼ˆæ°§åŒ–éš§é“åŒºçš„å­˜åœ¨ä¿è¯äº†æ•°æ®ä¸å®¹æ˜“æµå¤±ï¼‰</p>
<p>æ“¦é™¤ï¼šS æ¥12Vï¼ŒGc æ¥0vï¼Œæ­¤æ—¶æºææ …æä¸¤ç«¯å½¢æˆåœºå¼ºï¼Œç”µå­ä»æµ®æ …åŒºç»è¿‡éš§é“åŒºæµå‘è¡¬åº•</p>
<p>é€šè¿‡ä¸Šè¿°æè¿°å¯ä»¥å‘ç°æ•°æ®å­˜å‚¨çš„å…³é”®åœ¨äºæµ®æ …å±‚ï¼Œå½“å…¶ä¸­å……æ»¡ç”µå­ä»£è¡¨å†™å…¥çŠ¶æ€ï¼Œä»£è¡¨äºŒè¿›åˆ¶0ï¼›ç›¸åï¼Œæ²¡æœ‰ç”µå­ä»£è¡¨æ“¦é™¤çŠ¶æ€ï¼Œä»£è¡¨äºŒè¿›åˆ¶1ï¼ˆSâ€”-&gt;Dæ²¡æœ‰ç”µæµ0ï¼Œè¯´æ˜æœ‰ç”µå­ï¼›Sâ€”â€“&gt;Dæœ‰ç”µæµ1ï¼Œè¯´æ˜æ²¡æœ‰ç”µå­ï¼‰</p>
<h1 id="NOR-x2F-NANDç‰¹ç‚¹"><a href="#NOR-x2F-NANDç‰¹ç‚¹" class="headerlink" title="NOR/NANDç‰¹ç‚¹"></a>NOR/NANDç‰¹ç‚¹</h1><table>
<thead>
<tr>
<th></th>
<th>NOR</th>
<th>NAND</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>æ¥å£</td>
<td>æ•°æ®çº¿åœ°å€çº¿åˆ†å¼€</td>
<td>æ•°æ®çº¿åœ°å€çº¿å…±ç”¨</td>
<td>æœ€å¤§åŒºåˆ«</td>
</tr>
<tr>
<td>ä»‹è´¨ç±»å‹</td>
<td>éšæœºå­˜å‚¨</td>
<td>è¿ç»­å­˜å‚¨</td>
<td></td>
</tr>
<tr>
<td>è¯»å†™å•å…ƒ</td>
<td>åŸºäºå­—èŠ‚</td>
<td>åŸºäºé¡µ</td>
<td></td>
</tr>
<tr>
<td>æ“¦é™¤å•ä½</td>
<td>æ‰‡åŒº</td>
<td>å—</td>
<td></td>
</tr>
<tr>
<td>è¯»é€Ÿåº¦</td>
<td>ç¨å¿«</td>
<td>ç¨æ…¢</td>
<td></td>
</tr>
<tr>
<td>å†™é€Ÿåº¦</td>
<td>æ…¢</td>
<td>å¿«</td>
<td></td>
</tr>
<tr>
<td>å•ä¸ªcellæˆæœ¬</td>
<td>é«˜</td>
<td>ä½</td>
<td></td>
</tr>
<tr>
<td>åå—</td>
<td>è¾ƒå°‘</td>
<td>è¾ƒå¤š</td>
<td></td>
</tr>
<tr>
<td>å¯¿å‘½</td>
<td>é•¿</td>
<td>çŸ­</td>
<td></td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒXIPç‰‡å†…æ‰§è¡Œ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td></td>
</tr>
</tbody></table>
<h2 id="å…±æ€§"><a href="#å…±æ€§" class="headerlink" title="å…±æ€§"></a>å…±æ€§</h2><ul>
<li>å…ˆæ“¦åå†™ï¼Œå³å†™æ•°æ®å‰å¿…é¡»å°†èŠ¯ç‰‡å¯¹åº”å†…å®¹æ¸…ç©ºã€‚åªä¸è¿‡NOR FlashèŠ¯ç‰‡åªç”¨æ“¦å†™ä¸€ä¸ªå­—ï¼Œè€ŒNANDéœ€è¦æ“¦å†™æ•´ä¸ªå—</li>
<li>é—ªå­˜å­˜æ”¾æ•°æ®å¿…é¡»ä½¿ç”¨ç®—æ³•å®ç°</li>
<li>æ“¦é™¤æ¬¡æ•°æœ‰é™</li>
</ul>
<h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><h3 id="æ¥å£ï¼ˆè¯»æ€§èƒ½ï¼‰"><a href="#æ¥å£ï¼ˆè¯»æ€§èƒ½ï¼‰" class="headerlink" title="æ¥å£ï¼ˆè¯»æ€§èƒ½ï¼‰"></a>æ¥å£ï¼ˆè¯»æ€§èƒ½ï¼‰</h3><p>NOR Flashå¸¦æœ‰SRAMæ¥å£ï¼Œæœ‰è¶³å¤Ÿçš„åœ°å€å¼•è„šæ¥å¯»å€ï¼Œå¯ä»¥ç›´æ¥å’ŒCPUç›¸è¿ï¼ŒCPUå¯ä»¥ç›´æ¥é€šè¿‡åœ°å€æ€»çº¿å¯¹NOR Flashè¿›è¡Œè®¿é—®ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å­˜å–å…¶å†…éƒ¨çš„æ¯ä¸€ä¸ªå­—èŠ‚ã€‚å› æ­¤ä½¿ç”¨NOR Flashä¸éœ€è¦å»ºç«‹æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºå¯ä»¥ç›´æ¥ç”¨åœ°å€è®¿é—®åˆ°æ•°æ®</p>
<p>NAND Flashå™¨ä»¶ä½¿ç”¨å¤æ‚çš„I/Oå£æ¥ä¸²è¡Œåœ°å­˜å–æ•°æ®ï¼Œåªèƒ½é€šè¿‡I/Oæ¥å£å‘é€å‘½ä»¤å’Œåœ°å€ï¼Œå¯¹NAND Flashå†…éƒ¨æ•°æ®è¿›è¡Œè®¿é—®ï¼Œå½“ç„¶å„ä¸ªäº§å“æˆ–å‚å•†çš„æ–¹æ³•å¯èƒ½å„ä¸ç›¸åŒã€‚</p>
<p>ç”±äºå…·æœ‰è¿™æ ·çš„æ¥å£å°±å¯¼è‡´NOR Flashçš„è¯»æ€§èƒ½æ˜¯è¦ç¨é«˜äºNAND Flashçš„</p>
<h3 id="æ“¦é™¤é€Ÿåº¦ï¼ˆå†™æ€§èƒ½ï¼‰"><a href="#æ“¦é™¤é€Ÿåº¦ï¼ˆå†™æ€§èƒ½ï¼‰" class="headerlink" title="æ“¦é™¤é€Ÿåº¦ï¼ˆå†™æ€§èƒ½ï¼‰"></a>æ“¦é™¤é€Ÿåº¦ï¼ˆå†™æ€§èƒ½ï¼‰</h3><p>ä»»ä½•flashå™¨ä»¶çš„å†™å…¥æ“ä½œåªèƒ½åœ¨ç©ºæˆ–å·²æ“¦é™¤çš„å•å…ƒå†…è¿›è¡Œï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨è¿›è¡Œå†™å…¥æ“ä½œä¹‹å‰å¿…é¡»å…ˆæ‰§è¡Œæ“¦é™¤ã€‚</p>
<p>NANDå™¨ä»¶æ‰§è¡Œæ“¦é™¤æ“ä½œæ˜¯ååˆ†ç®€å•çš„ï¼Œè€ŒNORåˆ™è¦æ±‚åœ¨è¿›è¡Œæ“¦é™¤å‰å…ˆè¦å°†ç›®æ ‡å—å†…æ‰€æœ‰çš„ä½éƒ½å†™ä¸º0ã€‚ç”±äºæ“¦é™¤NORå™¨ä»¶æ—¶æ˜¯ä»¥64ï½128KBçš„å—è¿›è¡Œçš„ï¼Œæ‰§è¡Œä¸€ä¸ªå†™å…¥/æ“¦é™¤æ“ä½œçš„æ—¶é—´ä¸º5sï¼Œä¸æ­¤ç›¸åï¼Œæ“¦é™¤NANDå™¨ä»¶æ˜¯ä»¥8ï½32KBçš„å—è¿›è¡Œçš„ï¼Œæ‰§è¡Œç›¸åŒçš„æ“ä½œæœ€å¤šåªéœ€è¦4msã€‚NANDé—ªå­˜çš„å†™å‘¨æœŸæ¯”NORé—ªå­˜çŸ­90%ï¼Œå®ƒçš„ä¿å­˜ä¸åˆ é™¤å¤„ç†çš„é€Ÿåº¦ä¹Ÿç›¸å¯¹è¾ƒå¿«ã€‚</p>
<h3 id="å®¹é‡åŠæˆæœ¬"><a href="#å®¹é‡åŠæˆæœ¬" class="headerlink" title="å®¹é‡åŠæˆæœ¬"></a>å®¹é‡åŠæˆæœ¬</h3><p>NOR flashå æ®äº†å®¹é‡ä¸º1ï½16MBé—ªå­˜å¸‚åœºçš„å¤§éƒ¨åˆ†ï¼Œè€ŒNAND flashåªæ˜¯ç”¨åœ¨8ï½128MBçš„äº§å“å½“ä¸­</p>
<p>NOR Flashçš„æˆæœ¬ç›¸å¯¹é«˜ï¼Œå®¹é‡ç›¸å¯¹å°ï¼›NAND flashçš„å•å…ƒå°ºå¯¸å‡ ä¹æ˜¯NORå™¨ä»¶çš„ä¸€åŠï¼Œç”±äºç”Ÿäº§è¿‡ç¨‹æ›´ä¸ºç®€å•ï¼ŒNANDç»“æ„å¯ä»¥åœ¨ç»™å®šçš„æ¨¡å…·å°ºå¯¸å†…æä¾›æ›´é«˜çš„å®¹é‡ï¼Œä¹Ÿå°±ç›¸åº”åœ°é™ä½äº†ä»·æ ¼ã€‚</p>
<h3 id="å¯¿å‘½ï¼ˆè€ç”¨æ€§ï¼‰"><a href="#å¯¿å‘½ï¼ˆè€ç”¨æ€§ï¼‰" class="headerlink" title="å¯¿å‘½ï¼ˆè€ç”¨æ€§ï¼‰"></a>å¯¿å‘½ï¼ˆè€ç”¨æ€§ï¼‰</h3><p>åœ¨NANDé—ªå­˜ä¸­æ¯ä¸ªå—çš„æœ€å¤§æ“¦å†™æ¬¡æ•°æ˜¯ä¸€ç™¾ä¸‡æ¬¡ï¼Œè€ŒNORçš„æ“¦å†™æ¬¡æ•°æ˜¯åä¸‡æ¬¡ã€‚NANDå­˜å‚¨å™¨é™¤äº†å…·æœ‰10æ¯”1çš„å—æ“¦é™¤å‘¨æœŸä¼˜åŠ¿ï¼Œå…¸å‹çš„NANDå—å°ºå¯¸è¦æ¯”NORå™¨ä»¶å°8å€ï¼Œæ¯ä¸ªNANDå­˜å‚¨å™¨å—åœ¨ç»™å®šçš„æ—¶é—´å†…çš„åˆ é™¤æ¬¡æ•°è¦å°‘ä¸€äº›ã€‚</p>
<p>ç”±äºNAND Flashé€šå¸¸æ˜¯æ•´å—æ“¦å†™ï¼Œå—å†…çš„é¡µé¢ä¸­å¦‚æœæœ‰ä¸€ä½å¤±æ•ˆæ•´ä¸ªå—å°±ä¼šå¤±æ•ˆï¼Œè€Œä¸”ç”±äºæ“¦å†™è¿‡ç¨‹å¤æ‚ï¼Œå¤±è´¥çš„æ¦‚ç‡ç›¸å¯¹è¾ƒé«˜ï¼Œæ‰€ä»¥ä»æ•´ä½“ä¸Šæ¥è¯´NORçš„å¯¿å‘½è¾ƒé•¿ã€‚</p>
<h3 id="æ•°æ®æ­£ç¡®æ€§"><a href="#æ•°æ®æ­£ç¡®æ€§" class="headerlink" title="æ•°æ®æ­£ç¡®æ€§"></a>æ•°æ®æ­£ç¡®æ€§</h3><p>æ‰€æœ‰flashå™¨ä»¶éƒ½å—<em><strong>ä½äº¤æ¢ç°è±¡</strong></em>çš„å›°æ‰°ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ¯”ç‰¹ä½ä¼šå‘ç”Ÿåè½¬æˆ–è¢«æŠ¥å‘Šåè½¬äº†ã€‚è¿™ä¸ªé—®é¢˜å¯¹äºç”¨NANDå­˜å‚¨å¤šåª’ä½“ä¿¡æ¯æ—¶å€’ä¸æ˜¯è‡´å‘½çš„ã€‚å½“ç„¶ï¼Œå¦‚æœç”¨æœ¬åœ°å­˜å‚¨è®¾å¤‡æ¥å­˜å‚¨æ“ä½œç³»ç»Ÿã€é…ç½®æ–‡ä»¶æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯æ—¶ï¼Œå°†å¯èƒ½å¯¼è‡´åœæœºã€‚å¦‚æœåªæ˜¯æŠ¥å‘Šæœ‰é—®é¢˜ï¼Œå¤šè¯»å‡ æ¬¡å°±å¯èƒ½è§£å†³äº†ã€‚å½“ç„¶ï¼Œå¦‚æœè¿™ä¸ªä½çœŸçš„æ”¹å˜äº†ï¼Œå°±å¿…é¡»é‡‡ç”¨é”™è¯¯æ¢æµ‹/é”™è¯¯æ›´æ­£(EDC/ECC)ç®—æ³•ã€‚</p>
<p>è¿™äº›é—®é¢˜å¸¸å‘ç”Ÿåœ¨NAND Flashä¸­ï¼Œé™¤æ­¤ä¹‹å¤–å®ƒè¿˜éœ€è¦å§‹ç»ˆè¿›è¡Œåå—æ‰«æï¼Œä¸€æ—¦å‘ç°æ ‡è®°ä¸ºä¸å¯ç”¨</p>
<h3 id="è½¯ä»¶æ”¯æŒ"><a href="#è½¯ä»¶æ”¯æŒ" class="headerlink" title="è½¯ä»¶æ”¯æŒ"></a>è½¯ä»¶æ”¯æŒ</h3><p>NANDå’ŒNORå™¨ä»¶åœ¨è¿›è¡Œå†™å…¥å’Œæ“¦é™¤æ“ä½œæ—¶é€šå¸¸éƒ½éœ€è¦MTDï¼ˆMemory Technology Driversï¼‰é©±åŠ¨ï¼Œåªæ˜¯NORä½¿ç”¨çš„è¾ƒå°‘ä¸€äº›ã€‚è®¸å¤šå‚å•†éƒ½æä¾›ç”¨äºNORå™¨ä»¶çš„æ›´é«˜çº§è½¯ä»¶ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬M-Systemçš„TrueFFSé©±åŠ¨ã€‚</p>
<p>å…¶ä½œç”¨è¿˜åŒ…æ‹¬NANDé—ªå­˜çš„ç®¡ç†ï¼ŒåŒ…æ‹¬çº é”™ã€åå—å¤„ç†å’ŒæŸè€—å¹³è¡¡ã€‚</p>
<h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>ä¸€èˆ¬ä½¿ç”¨åŸåˆ™æ˜¯ï¼šåœ¨å¤§å®¹é‡çš„å¤šåª’ä½“åº”ç”¨ä¸­é€‰ç”¨NANDå‹ï¼Œè€Œåœ¨æ•°æ®/ç¨‹åºå­˜è´®åº”ç”¨ä¸­é€‰ç”¨NORã€‚NOR flashå æ®äº†å®¹é‡ä¸º1ï½16MBé—ªå­˜å¸‚åœºçš„å¤§éƒ¨åˆ†ï¼ˆåµŒå…¥å¼é¢†åŸŸï¼‰ï¼Œè€ŒNAND flashåªæ˜¯ç”¨åœ¨8ï½128MBçš„äº§å“å½“ä¸­ï¼ˆè§†é¢‘ç›‘æ§ã€ç½‘ç»œç›‘æ§ã€ç½‘ç»œç»ˆç«¯ç­‰ç­‰å¤§å®¹é‡åœºæ™¯ï¼‰</p>
<h1 id="eMMCç‰¹ç‚¹"><a href="#eMMCç‰¹ç‚¹" class="headerlink" title="eMMCç‰¹ç‚¹"></a>eMMCç‰¹ç‚¹</h1><p>eMMC é‡‡ç”¨ç»Ÿä¸€çš„MMCæ ‡å‡†æ¥å£ï¼Œ æŠŠé«˜å¯†åº¦NAND Flashä»¥åŠMMC Controllerå°è£…åœ¨ä¸€é¢—BGAèŠ¯ç‰‡ä¸­ï¼ˆåœ¨åŸæœ‰å†…ç½®å­˜å‚¨å™¨çš„åŸºç¡€ä¸Šï¼Œåˆé¢å¤–åŠ äº†ä¸€ä¸ªæ§åˆ¶èŠ¯ç‰‡ï¼Œæœ€åå†ä»¥ç»Ÿä¸€çš„æ–¹å¼å°è£…ï¼Œå¹¶é¢„ç•™ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œä»¥ä¾¿å®¢æˆ·æ‹¿æ¥ç›´æ¥ä½¿ç”¨ï¼‰ã€‚é’ˆå¯¹Flashçš„ç‰¹æ€§ï¼Œäº§å“å†…éƒ¨å·²ç»åŒ…å«äº†Flashç®¡ç†æŠ€æœ¯ï¼ŒåŒ…æ‹¬é”™è¯¯æ¢æµ‹å’Œçº æ­£ï¼Œflashå¹³å‡æ“¦å†™ï¼Œåå—ç®¡ç†ï¼Œæ‰ç”µä¿æŠ¤ç­‰æŠ€æœ¯ã€‚ç”¨æˆ·æ— éœ€æ‹…å¿ƒäº§å“å†…éƒ¨flashæ™¶åœ†åˆ¶ç¨‹å’Œå·¥è‰ºçš„å˜åŒ–ã€‚åŒæ—¶eMMCå•é¢—èŠ¯ç‰‡ä¸ºä¸»æ¿å†…éƒ¨èŠ‚çœæ›´å¤šçš„ç©ºé—´ã€‚</p>
<h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul>
<li>å®¹é‡å¤§</li>
<li>é€Ÿåº¦å¿«</li>
<li>å…¼å®¹æ€§å¥½</li>
</ul>
<h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ul>
<li>æˆæœ¬é«˜ã€‚eMMCä¸»æµèµ·è·³å®¹é‡16GBï¼Œå®¢æˆ·å³ä½¿åªç”¨128MBï¼Œä¹Ÿéœ€è¦ä»˜å‡º16GBçš„æˆæœ¬ã€‚</li>
<li>å°ºå¯¸å¤§ã€‚11.5*13çš„å°ºå¯¸å¯¹äºå¾ˆå¤šç©¿æˆ´å¼æˆ–è€…ç‰©è”ç½‘è®¾å¤‡æ¥è¯´è¿˜æ˜¯å¤ªå¤§äº†ã€‚</li>
<li>Pinè„šå¤šï¼Œä¸æ–¹ä¾¿ç„Šæ¥ã€‚eMMCæ˜¯BGA153å°è£…ï¼Œ153ä¸ªpinè„šï¼Œpiné—´è·0.5mmã€‚ç„Šæ¥æ˜¯ä¸ªé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯PCBæ¿æ¯”è¾ƒå°çš„æ—¶å€™ã€‚å¦å¤–ä½¿eMMCå¿…é¡»è¦ç”¨4å±‚æ¿ã€‚</li>
<li>é€šç”¨æ€§ã€‚å¯¹äºæ–°æ¨å‡ºçš„å¤§æ ¸CPUæ¥è¯´ï¼ŒåŸºæœ¬éƒ½æ”¯æŒeMMCã€‚ä½†ç‰©è”ç½‘ç”±äºä½¿ç”¨åœºæ™¯é™åˆ¶ï¼Œå¾ˆå¤šè¿˜æ˜¯é‡‡ç”¨MCUå¹³å°ã€‚è€Œè¿™äº›å¹³å°åŸºæœ¬éƒ½ä¸æ”¯æŒeMMCæ¥å£ã€‚</li>
<li>æ“¦å†™å¯¿å‘½ã€‚ä¸»æµeMMCå†…éƒ¨é‡‡ç”¨éƒ½æ˜¯TLC NAND, æ“¦å†™å¯¿å‘½åªæœ‰500æ¬¡å·¦å³ã€‚åœ¨éœ€è¦é¢‘ç¹æ“¦å†™çš„åº”ç”¨åœºæ™¯ä¼šæ¯”è¾ƒåƒåŠ›ã€‚</li>
</ul>
<h2 id="æœªæ¥å‘å±•"><a href="#æœªæ¥å‘å±•" class="headerlink" title="æœªæ¥å‘å±•"></a>æœªæ¥å‘å±•</h2><ul>
<li>å¤§å°ï¼šç‰©è”ç½‘åµŒå…¥å¼çš„æ›´é«˜éœ€æ±‚å¯¼è‡´eMMCéœ€è¦åšçš„æ›´å°</li>
<li>å®¹é‡ï¼š128GBç®—æ˜¯eMMCæœ€å¤§å®¹é‡äº†ã€‚æ›´é«˜å®¹é‡äº§å“ä¼šåˆ‡æ¢åˆ°UFSã€‚</li>
<li>æ¥å£ï¼šeMMC æ˜¯é’ˆå¯¹æ‰‹æœºæˆ–å¹³æ¿ç”µè„‘ç­‰äº§å“çš„å†…åµŒå¼å­˜å‚¨å™¨æ ‡å‡†è§„æ ¼ï¼Œç›®å‰å¸‚åœºä¸Šä¸»æµæ‰‹æœºéƒ½é‡‡ç”¨eMMC 5.0è§„æ ¼çš„é—ªå­˜æ ‡å‡†ã€‚ä½†æ˜¯æœªæ¥eMMCæ¥å£æ…¢æ…¢ä¼šåˆ‡æ¢åˆ°UFSæ¥å£ã€‚UFSçš„æ¥å£æœ‰ç€æ›´å¿«çš„è¯»å†™æ€§èƒ½ã€‚ç›®å‰æ–°æ¨å‡ºçš„ä¸»æµæ‰‹æœºå’Œå¹³æ¿äº§å“éƒ½å·²ç»é‡‡ç”¨äº†UFSæ¥å£å†…éƒ¨æè´¨ï¼šå¸‚é¢ä¸Šè¿˜æ˜¯å°‘é‡æœ‰MLCæ™¶åœ†çš„eMMCï¼Œä¸»è¦é’ˆå¯¹è¡Œä¸šå¸‚åœºã€‚</li>
</ul>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p>Qï¼šåˆ†åˆ«æ“¦é™¤NANDã€eMMCè¯»æ•°æ®åˆ†åˆ«æ˜¯1ï¼Œ0ï¼›eMMCå±äºNANDï¼Œä¸ºä»€ä¹ˆè¯»å‡ºçš„æ•°æ®ä¸ä¸€è‡´å‘¢</p>
<p>Aï¼šåŸå› å°±åœ¨äºeMMCå†…éƒ¨å­˜åœ¨æ§åˆ¶å™¨</p>
</li>
<li><p>Qï¼šflashæ•°æ®æ‰ç”µä¸¢å¤±ï¼Ÿ</p>
<p>Aï¼šflashåœ¨æ‰ç”µæ—¶ï¼Œä¼šå­˜åœ¨ä¸€æ®µç”µå‹åŒºé—´ï¼Œå·¥ä½œä¸ç¨³å®šï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚å†™ä¿æŠ¤æ˜¯noræä¾›çš„åŠŸèƒ½ï¼Œå³å¯ä»¥é€šè¿‡é…ç½®ä¸€äº›å¯„å­˜å™¨ï¼Œå°†æŸäº›åŒºåŸŸä¿æŠ¤èµ·æ¥ã€‚å¦‚æœæ²¡æœ‰è§£é™¤ä¿æŠ¤ï¼Œé‚£å¯¹è¿™ä¸ªåŒºåŸŸçš„å†™å…¥å’Œæ“¦é™¤ï¼Œéƒ½ä¼šè¢«ç›´æ¥å¿½ç•¥æ‰ã€‚</p>
</li>
<li><p>æ¢nor flashä¹‹åæ— æ³•æ­£å¸¸å¯åŠ¨ï¼Ÿ</p>
<p>å¯¹äºä¸²å£æ²¡æœ‰æ‰“å°çš„æƒ…å†µï¼šé€šä¿¡ä¸¤ç«¯çš„æ³¢ç‰¹ç‡ä¸ä¸€è‡´</p>
<p>æ‰“å°å‡ºç°ä¹±ç æˆ–è€…è¯»å‡ºçš„æ•°æ®ä¸æ­£ç¡®ï¼šflashçš„æ•°æ®æ²¡æœ‰å†™å…¥æˆ–è€…æ²¡æœ‰é‡å¯è¿˜ä¸èƒ½è¯»ï¼Œå¯¼è‡´è¯»å‡ºçš„é”™è¯¯ï¼Œå»¶é•¿resetçš„delayæ—¶é—´</p>
</li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><p><a href="https://www.21ic.com/a/916024.html">é—ªå­˜çš„å‘å±•å†å²</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_38880380/article/details/78884522">NAND flashå’ŒNOR flashçš„åŒºåˆ«è¯¦è§£</a></p>
</li>
<li><p><a href="https://www.sohu.com/a/483186780_121149658">å¿…çœ‹â€œèŠ¯â€çŸ¥è¯†ï¼šæœ€å…¨NAND flashä¸NOR flashè¯¦æƒ…è§£è¯»</a> </p>
</li>
<li><p><a href="http://www.longsto.com/news/28.html">è¯¦è§£eMMCçš„å‰ä¸–ä»Šç”Ÿå’Œä¼˜åŠ£åŠ¿</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Storage</category>
      </categories>
      <tags>
        <tag>storage system</tag>
        <tag>Flash</tag>
      </tags>
  </entry>
  <entry>
    <title>MESIåè®®çš„ä¼˜åŒ–ä¸å†…å­˜å±éšœ</title>
    <url>/2023/03/06/computerSystem/storage/MESI%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<p>æ— è®ºæ˜¯è®¡ç®—æœºç¡¬ä»¶è¿˜æ˜¯è½¯ä»¶ï¼Œæ–°çš„æŠ€æœ¯çš„å‡ºç°çš„åˆè¡·ä¸€å®šæ˜¯ä¸ºäº†è§£å†³æŸé¡¹éœ€æ±‚ï¼Œè€Œéšä¹‹è€Œæ¥çš„å¯èƒ½ä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼Œæ— æ‰€è°“è§£å†³å°±æ˜¯äº†ï¼</p>
<h1 id="MESIå¸¦æ¥çš„æ€§èƒ½é—®é¢˜"><a href="#MESIå¸¦æ¥çš„æ€§èƒ½é—®é¢˜" class="headerlink" title="MESIå¸¦æ¥çš„æ€§èƒ½é—®é¢˜"></a>MESIå¸¦æ¥çš„æ€§èƒ½é—®é¢˜</h1><p>ä»æœ¬è´¨ä¸Šæ¥è®²MESIåè®®è§£å†³çš„æ˜¯æ•°æ®çš„æ ¸é—´åŒæ­¥é—®é¢˜ï¼Œä½†æ˜¯ä¸¥æ ¼éµå®ˆMESIåè®®ä¸€å®šåˆä¼šå¸¦æ¥æ–°çš„é—®é¢˜ã€‚ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šå†æ¬¡å¸¦æ¥æ€§èƒ½é—®é¢˜ï¼š</p>
<ol>
<li>æ›´æ–°SharedçŠ¶æ€çš„Cacheã€‚å½“æŸä¸ªç¼“å­˜è¡Œçš„çŠ¶æ€æ˜¯Sharedæ—¶ï¼ŒCPUæƒ³è¦ä¿®æ”¹è¯¥ç¼“å­˜è¡Œçš„æ•°æ®ï¼Œä¸€å®šä¼šäº§ç”Ÿæ€»çº¿äº‹ä»¶é€šçŸ¥å…¶å®ƒCPUå°†è¯¥ç¼“å­˜è¡Œå‰¯æœ¬çŠ¶æ€ç½®Invalidï¼Œå½“æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œå‰¯æœ¬çš„CPUç¡®è®¤å¹¶å›å¤å®ƒâ€œInvalid acknowledgementâ€ä»¥åï¼Œå®ƒæ‰èƒ½è¿›è¡Œæ•°æ®æ›´æ–°ã€‚</li>
<li>æ›´æ–°InvalidçŠ¶æ€çš„Cacheã€‚å½“æŸä¸ªç¼“å­˜è¡Œçš„çŠ¶æ€æ˜¯Invalidæ—¶ï¼ŒCPUæƒ³è¦ä¿®æ”¹è¯¥ç¼“å­˜è¡Œçš„æ•°æ®ï¼Œä¸€å®šä¼šäº§ç”Ÿæ€»çº¿äº‹ä»¶ä»å…¶å®ƒCPUç”šè‡³æ˜¯ä¸»å­˜ä¸­åŠ è½½è¿›æœ€æ–°æ•°æ®ï¼Œè¿›è€ŒåŸºäºæœ€æ–°æ•°æ®è¿›è¡Œæ›´æ–°ã€‚</li>
</ol>
<h1 id="MESIåè®®ä¼˜åŒ–"><a href="#MESIåè®®ä¼˜åŒ–" class="headerlink" title="MESIåè®®ä¼˜åŒ–"></a>MESIåè®®ä¼˜åŒ–</h1><p>MESIåè®®ä»¥ä¸Šä¸¤ä¸ªç—›ç‚¹å¯ä»¥å‘ç°æ˜¯ç”±äºäº‹åŠ¡ä¸²è¡ŒåŒ–æ‰€å¸¦æ¥çš„è´Ÿé¢å½±å“ã€‚æ‰€ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„å…³é”®å°±æ˜¯ä½¿MESIåè®®çš„è¯·æ±‚å¼‚æ­¥åŒ–ï¼Œé‡Šæ”¾æ€»çº¿æé«˜å¹¶è¡Œåº¦ã€‚å› è€Œå°±æœ‰äº†åœ¨ç¡¬ä»¶ä¸Šå¢åŠ å†™ç¼“å­˜åŒºå’Œå¤±æ•ˆé˜Ÿåˆ—ä¸¤ç§æ–¹æ³•ã€‚</p>
<h2 id="å†™ç¼“å†²-Store-Buffer"><a href="#å†™ç¼“å†²-Store-Buffer" class="headerlink" title="å†™ç¼“å†² Store Buffer"></a>å†™ç¼“å†² Store Buffer</h2><p><img src="/images/computerSystem/storage/cache-9.png" alt="image"></p>
<p>åŸºäºä¹‹å‰çš„ç¼“å­˜ç»“æ„ï¼Œå¢åŠ å®ŒStore Bufferä¹‹åçš„ç»“æœå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>
<p>æ•´ä¸ªåŒæ­¥è¿‡ç¨‹ï¼šCPUæƒ³è¦ä¿®æ”¹æŸä¸ªç¼“å­˜æ•°æ®ï¼Œé¦–å…ˆé€šè¿‡æ€»çº¿å¹¿æ’­è·å¾—æ€»çº¿æ‰€æœ‰æƒï¼Œå‘å‡ºä¿¡å·é€šçŸ¥å…¶å®ƒCPUéœ€è¦å°†è¯¥ç¼“å­˜å—æ•°æ®ç½®æ— æ•ˆï¼Œç„¶åå°†éœ€è¦æ›´æ–°çš„æ•°æ®æ”¾å…¥åˆ°Store Bufferã€‚è€Œæ­¤æ—¶å°±å¯ä»¥é‡Šæ”¾æ€»çº¿æ‰€æœ‰æƒå»åšå…¶å®ƒçš„äº‹æƒ…ä¸ç”¨ç­‰å¾…æ”¶åˆ°ACKï¼ˆæ•ˆç‡æé«˜åœ¨æ­¤ï¼‰ï¼Œç­‰å…¶å®ƒcpuéƒ½æ”¶åˆ°å†ç”±Store Bufferæ…¢æ…¢åšæ ¸é—´åŒæ­¥ï¼Œåˆ·å…¥Cacheçš„å€¼å³å¯</p>
<p>å½“CPUè¯»æ•°æ®æ—¶ï¼Œé¦–å…ˆä¼šå…ˆåœ¨Store Bufferä¸­æŸ¥è¯¢è®°å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¼šä»å†™ç¼“å†²åŒºä¸­ç›´æ¥è·å–ï¼Œè¿™ä¸€æœºåˆ¶å³æ˜¯ Store Fowardingã€‚</p>
<h2 id="å¤±æ•ˆé˜Ÿåˆ—-Invalid-Queue"><a href="#å¤±æ•ˆé˜Ÿåˆ—-Invalid-Queue" class="headerlink" title="å¤±æ•ˆé˜Ÿåˆ— Invalid Queue"></a>å¤±æ•ˆé˜Ÿåˆ— Invalid Queue</h2><p><img src="/images/computerSystem/storage/cache-10.png" alt="image"></p>
<p>åœ¨Store BufferåŸºç¡€ä¹‹ä¸Šï¼Œå¢åŠ å®ŒInvalid Queueä¹‹åçš„ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤º</p>
<p>å¤±æ•ˆé˜Ÿåˆ—çš„å­˜åœ¨å¯ä»¥è¯´æ˜¯æ›´å¥½çš„ä½¿Store Bufferå·¥ä½œã€‚å½“CPUæ”¶åˆ°ä½¿æŸä¸ªç¼“å­˜è¡Œå¤±æ•ˆçš„è¯·æ±‚æ—¶ï¼Œå¦‚æœè¿Ÿè¿Ÿä¸å›å¤ACKåˆ™å¯èƒ½å¯¼è‡´Store Bufferé‡Œæ•°æ®è¶Šæ¥è¶Šå¤šæœ€ç»ˆæº¢å‡ºï¼Œå› æ­¤Invalid Queueçš„å­˜åœ¨å¯ä»¥è¯´æ˜¯ä¸ºäº†å¹³è¡¡Store Bufferå†™å…¥é€Ÿåº¦å’Œæ”¶åˆ°ACKé€Ÿåº¦</p>
<p>è¿‡ç¨‹ï¼šå½“CPU Coreæ”¶åˆ°ä½¿æŸä¸ªcacheå¤±æ•ˆçš„æ¶ˆæ¯æ—¶ï¼Œå…ˆå›å¤ç¡®è®¤æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œç„¶åå°†å¤±æ•ˆçš„æ•°æ®åŠ å…¥åˆ°Invalidate Queueä¸­ã€‚è€Œé˜Ÿåˆ—çš„å®å¤±æ•ˆçš„æ“ä½œç­‰å¾…ç©ºé—²æ—¶å€™åœ¨è¿›è¡Œå¤„ç†ã€‚</p>
<h1 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h1><h2 id="MESIä¼˜åŒ–ä¹‹åå¸¦æ¥çš„é—®é¢˜"><a href="#MESIä¼˜åŒ–ä¹‹åå¸¦æ¥çš„é—®é¢˜" class="headerlink" title="MESIä¼˜åŒ–ä¹‹åå¸¦æ¥çš„é—®é¢˜"></a>MESIä¼˜åŒ–ä¹‹åå¸¦æ¥çš„é—®é¢˜</h2><p>MESIåè®®æœ¬èº«å±äºå¼ºä¸€è‡´æ€§åè®®ï¼Œä½†æ˜¯ç»è¿‡æ€§èƒ½çš„ä¼˜åŒ–å˜æˆäº†å¼±ä¸€è‡´æ€§åè®®ï¼Œè¿™å°±å¯¼è‡´åœ¨æŸäº›ä¸­é—´çŠ¶æ€ä¸‹å¤šæ ¸CPUçš„æ•°æ®å¯èƒ½å¹¶ä¸ä¸€è‡´ã€‚</p>
<h3 id="Store-Buffer"><a href="#Store-Buffer" class="headerlink" title="Store Buffer"></a>Store Buffer</h3><p>ç”±äºStore Bufferçš„å¼•å…¥å°†éƒ¨åˆ†äº‹åŠ¡å˜æˆå¹¶è¡Œï¼Œè¿™å°±å°†å¯¼è‡´æ•°æ®çš„æ›´æ–°é¡ºåºå°†ä¸ä¼šä¸¥æ ¼æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œï¼Œè¿›è€Œå¯¼è‡´å…¶å®ƒCPUæ‹¿åˆ°æ­£ç¡®æ•°æ®çš„æ—¶æœºå»¶åã€‚ä¾‹å¦‚ï¼šCPUéœ€è¦é¡ºåºæ‰§è¡ŒAã€Bä¸¤æ¡å†™æŒ‡ä»¤ï¼ŒAåœ¨CPU0çš„ç¼“å­˜è¡ŒçŠ¶æ€æ˜¯Sï¼ŒBåœ¨CPU0çš„ç¼“å­˜è¡ŒçŠ¶æ€æ˜¯Eï¼Œæœ€ç»ˆçš„cacheå¯¹äºä¸¤æ¡æŒ‡ä»¤æ‰€å¯¹åº”çš„ä¸¤ä¸ªæ•°æ®çš„æ›´æ–°çš„é¡ºåºå¯èƒ½ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„</p>
<h3 id="Invalid-Queue"><a href="#Invalid-Queue" class="headerlink" title="Invalid Queue"></a>Invalid Queue</h3><p>CPU1åœ¨å›å¤ACKä¹‹åå®é™…å¹¶æ²¡æœ‰å¯¹æ•°æ®æ‰€åœ¨çš„ç¼“å­˜è¡Œç½®Invalidï¼Œè€Œæ˜¯æ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚å‡å¦‚æ­¤åˆ»CPU0æ›´æ–°äº†ç¼“å­˜è¡Œè¿™å°†å¯¼è‡´è¯¥æ•°æ®åœ¨ä¸¤ä¸ªæ ¸çš„cacheä¸Šè¡¨ç°ä¸ä¸€è‡´</p>
<h3 id="Reorder"><a href="#Reorder" class="headerlink" title="Reorder"></a>Reorder</h3><p>æŒ‡ä»¤é‡æ’åºä»æºå¤´ä¸Šå°±é€ æˆäº†æŒ‡ä»¤å®é™…æ‰§è¡Œçš„é¡ºåºä¸æˆ‘ä»¬ä»£ç æ‰€æœŸæœ›æ‰§è¡Œçš„é¡ºåºå­˜åœ¨å·®åˆ«ã€‚è€ŒReorderè®¾è®¡çš„æœ¬è´¨å®é™…ä¸Šæ˜¯ä¸ºäº†å¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæé«˜cacheå‘½ä»¤ç‡ä»è€Œæé«˜æ‰§è¡Œæ•ˆç‡</p>
<ul>
<li>ç¼–è¯‘å™¨é‡æ’åº</li>
<li>CPUä¹±åºæ‰§è¡Œ</li>
</ul>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å…¶å®å¯¹äºä»¥ä¸ŠMESIä¼˜åŒ–å¸¦æ¥çš„é—®é¢˜å½’æ ¹ç»“åº•æ˜¯åœ¨å¤šæ ¸CPUä¸Šå¯¼è‡´æœ€ç»ˆç»“æœçš„åå·®ã€‚è¿›ä¸€æ­¥æ€è€ƒæ˜¯å¤šæ ¸CPUåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªå˜é‡æ—¶è€Œå¼•å‘çš„é—®é¢˜ï¼Œè€Œåœ¨å®é™…è¿‡ç¨‹ä¸­è¿™ç§æƒ…å†µæ˜¯æ¯”è¾ƒå°‘çš„ã€‚åœ¨æ•ˆç‡å’Œæå°‘æ•°æ•°æ®ä¸æ­£ç¡®ä¸¤è€…çš„è€ƒé‡ä¸‹ï¼Œç»§ç»­åŸºäºæ­¤è¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯ä¸æ˜¯ç¡¬ä»¶ä¼˜åŒ–è€Œæ˜¯é€šè¿‡è½¯ä»¶ç”±ç¨‹åºå‘˜ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚å› æ­¤åœ¨éœ€è¦æ ¸é—´çš„åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå¤šçº¿ç¨‹å¯¹äºæ•°æ®çš„ä¿®æ”¹å’Œå¯¹äºæ•°æ®çš„ä½¿ç”¨éœ€è¦å¼•èµ·æ³¨æ„ï¼Œåœ¨é€‚å½“çš„åœ°æ–¹æ·»åŠ å†…å­˜å±éšœ</p>
<p>å†…å­˜å±éšœï¼ˆMemory Barriersï¼‰å…¶å®å¯ä»¥ç†è§£ä¸ºä¸€é“å¢™ï¼Œå‰é¢çš„è¯»å†™æ“ä½œæ²¡æœ‰å®Œæˆåé¢çš„è¯»å†™æ“ä½œä¸èƒ½å‘ç”Ÿ</p>
<h2 id="è¯»å±éšœ"><a href="#è¯»å±éšœ" class="headerlink" title="è¯»å±éšœ"></a>è¯»å±éšœ</h2><p>æœ¬è´¨ï¼šè¯»å±éšœå‰åæŒ‡ä»¤çš„è¯»æ“ä½œä¸èƒ½ç¿»è¶Šå±éšœï¼å¼ºåˆ¶CPUåœ¨å±éšœå‰çš„è¯»æ“ä½œå¤„ç†åˆ°æ‰€æœ‰Invalid Queueä¸­çš„æ•°æ®ï¼Œè·å–åˆ°æœ€æ–°çš„æ•°æ®ã€‚</p>
<h2 id="å†™å±éšœ"><a href="#å†™å±éšœ" class="headerlink" title="å†™å±éšœ"></a>å†™å±éšœ</h2><p>æœ¬è´¨ï¼šå†™å±éšœå‰åæŒ‡ä»¤çš„å†™æ“ä½œä¸èƒ½ç¿»é˜…å±éšœï¼å¼ºåˆ¶CPUåœ¨å±éšœå‰çš„å†™æ“ä½œæ¸…ç©ºStore Bufferå†…å®¹ï¼Œå°†æ•°æ®æ›´æ–°è‡³cacheç”šè‡³ä¸»å­˜</p>
<h2 id="è¯»å†™å±éšœ"><a href="#è¯»å†™å±éšœ" class="headerlink" title="è¯»å†™å±éšœ"></a>è¯»å†™å±éšœ</h2><p>ä»¥ä¸Šä¸¤ç§å±éšœåªæœ‰åœ¨åŒºåˆ†è¯»å†™å±éšœçš„ä½“ç³»ç»“æ„é‡Œæ‰ä¼šæœ‰ä½œç”¨ï¼Œæ¯”å¦‚ alpha ç»“æ„ã€‚è€Œåœ¨ X86 å’Œ Arm ä¸­æ˜¯æ²¡æœ‰ä½œç”¨çš„ï¼Œè¿™æ˜¯å› ä¸º X86 é‡‡ç”¨çš„ TSO æ¨¡å‹ä¸å­˜åœ¨ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œè€Œ Arm åˆ™æ˜¯é‡‡ç”¨äº†å¦ä¸€ç§ç§°ä¸ºå•å‘å±éšœçš„åˆ†ç±»æ–¹å¼ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://zhuanlan.zhihu.com/p/375706879">ç¼“å­˜ä¸€è‡´æ€§ç¡¬æ ¸è®²è§£</a></li>
<li>ç¼–ç¨‹é«˜å¿…å­¦çš„å†…å­˜çŸ¥è¯†ï¼ˆæå®¢æ—¶é—´ æµ·çº³ï¼‰</li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Storage</category>
        <category>Cache</category>
      </categories>
      <tags>
        <tag>storage system</tag>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¼“å­˜ä¸€è‡´æ€§åè®®</title>
    <url>/2023/03/06/computerSystem/storage/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h1 id="å¯¼è¯­-cacheã€ä¸»å­˜ä¸CPUçš„é€šä¿¡"><a href="#å¯¼è¯­-cacheã€ä¸»å­˜ä¸CPUçš„é€šä¿¡" class="headerlink" title="å¯¼è¯­ - cacheã€ä¸»å­˜ä¸CPUçš„é€šä¿¡"></a>å¯¼è¯­ - cacheã€ä¸»å­˜ä¸CPUçš„é€šä¿¡</h1><p><img src="/images/computerSystem/storage/cache-6.png" alt="image"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œç§æœ‰Cacheæ˜¯æ¯ä¸ªå¤„ç†å™¨æ ¸å¿ƒæ‰€ç‰¹æœ‰çš„æ¯”å¦‚L1ã€L2ï¼Œå…±äº« Cacheæ˜¯æ‰€æœ‰å¤„ç†å™¨æ ¸å¿ƒçš„å…±äº«ç¼“å­˜æ¯”å¦‚L3ï¼Œè€Œæ•´ä½“Cacheä¸ä¸»å­˜çš„æ•°æ®äº¤äº’æ˜¯è¦é€šè¿‡æ€»çº¿è¿›è¡Œçš„ã€‚å½“ä¸¤ä¸ªæ ¸åŠ è½½äº†ä¸»å­˜çš„åŒä¸€å—ç¼“å­˜å‰¯æœ¬ï¼Œå…¶ä¸­ä¸€ä¸ªæ ¸è¿›è¡Œäº†æ•°æ®çš„æ›´æ”¹ï¼Œæ˜¯å¦è¦å†™å…¥ä¸»å­˜ï¼Ÿæ˜¯å¦è¦é€šçŸ¥ç»™å…¶å®ƒCPUæ ¸å¿ƒè¿›è¡Œä¿®æ”¹ï¼Ÿå› æ­¤å¯¹äºå¤šæ ¸CPUæ¥è®²ï¼Œç¼“å­˜åœ¨æé«˜æ•ˆç‡çš„åŒæ—¶ä¹Ÿå¸¦æ¥äº†ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œè€Œè¿™ä¸ªé—®é¢˜æ˜¯éœ€è¦è¿›è¡Œè§£å†³çš„</p>
<h1 id="æ ¸å¿ƒéœ€æ±‚"><a href="#æ ¸å¿ƒéœ€æ±‚" class="headerlink" title="æ ¸å¿ƒéœ€æ±‚"></a>æ ¸å¿ƒéœ€æ±‚</h1><p>ç¼“å­˜ä¸€è‡´æ€§æ ¸å¿ƒæ ¸å¿ƒéœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯ï¼š<strong>å°†æœ¬CPUæ›´æ–°çš„æ•°æ®æœ‰æ•ˆçš„ä¼ æ’­åˆ°å…¶å®ƒCPUæœ¬åœ°ç¼“å­˜ä¸­</strong></p>
<p>è¿›ä¸€æ­¥å¯ä»¥æ€»ç»“æˆéœ€è¦éµä»ä¸¤ä¸ªç‰¹æ€§</p>
<ol>
<li>å†™ä¼ æ’­ï¼šCPU Coreçš„å¯¹å†…å­˜çš„å†™æ“ä½œï¼Œå…¶å®ƒCPU Coreå¯è§</li>
<li>äº‹åŠ¡ä¸²è¡ŒåŒ–ï¼šå…¶å®ƒCPU Coreçœ‹åˆ°çš„å†…å­˜çš„å†™æ“ä½œçš„é¡ºåºæ˜¯ä¸€è‡´çš„</li>
</ol>
<p>å†™ä¼ æ’­å¯ä»¥ä¿è¯ä¿®æ”¹çš„æ•°æ®èƒ½å¤Ÿä¼ æ’­ç»™å…¶å®ƒCPUï¼Œè€Œäº‹ç‰©ä¸²è¡ŒåŒ–åˆ™ä¿è¯æ•°æ®åœ¨å…¶å®ƒCPUå†…çš„æ­£ç¡®æ€§ã€‚æ¯”å¦‚CPUæœ‰3ä¸ªCoreï¼ŒCore1å°†xä¿®æ”¹ä¸º3ï¼ŒCore2å°†æ•°æ®ä¿®æ”¹ä¸º5ï¼Œä¸¤ä¸ªäº‹åŠ¡éœ€è¦åŒæ­¥åˆ°Core3åŒæ—¶Core1 Core2äº’ç›¸åŒæ­¥ï¼Œå¦‚æœä¸ä¿è¯ä¸²è¡Œï¼Œæœ€ç»ˆçš„æ•°æ®å¾ˆå¤§æ¦‚ç‡æ˜¯é”™è¯¯çš„</p>
<h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><h2 id="æ€»çº¿å—…æ¢"><a href="#æ€»çº¿å—…æ¢" class="headerlink" title="æ€»çº¿å—…æ¢"></a>æ€»çº¿å—…æ¢</h2><p><a href="https://www.inf.ed.ac.uk/teaching/courses/pa/Notes/lecture05-snooping.pdf">å—…æ¢ä¸€è‡´æ€§åè®®</a></p>
<p> æ€»çº¿é™¤äº†èƒ½åœ¨ä¸€ä¸ªä¸»æ¨¡å—å’Œä¸€ä¸ªä»æ¨¡å—ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œè¿˜æ”¯æŒä¸€ä¸ªä¸»æ¨¡å—å¯¹å¤šä¸ªä»æ¨¡å—å†™å…¥æ•°æ®ï¼Œè¿™ç§æ“ä½œå°±æ˜¯å¹¿æ’­ã€‚</p>
<p>å†™ä¼ æ’­çš„åŸåˆ™å°±æ˜¯å½“æŸä¸ª CPU æ ¸å¿ƒæ›´æ–°äº† Cache ä¸­çš„æ•°æ®ï¼Œè¦æŠŠè¯¥äº‹ä»¶å¹¿æ’­é€šçŸ¥åˆ°å…¶ä»–æ ¸å¿ƒï¼Œæœ€å¸¸â»…å®ç°çš„æ–¹å¼æ˜¯æ€»çº¿å—…æ¢(<strong>Bus Snooping</strong>)ã€‚å½“æŸä¸ªCPU Coreçš„ç¼“å­˜è¡Œæœ‰æ›´æ–°æ—¶ï¼Œéœ€è¦å°†æ‰€æœ‰çš„è¯»å†™æ“ä½œå¹¿æ’­åˆ°æ‰€æœ‰ CPU Coreï¼Œè€Œè™½ç„¶æ€»çº¿ä¸Šå…¶å®ƒCPU Coreçš„ç§æœ‰ç¼“å­˜ä¸ä¸€å®šæœ‰å¯¹åº”çš„ç¼“å­˜è¡Œï¼Œä½†ä¹Ÿè¦æ—¶åˆ»ç›‘è§†æˆ–ä¾¦å¬æ€»çº¿ï¼Œä»¥éªŒè¯å®ƒæ˜¯å¦å…·æœ‰æ‰€è¯·æ±‚æ•°æ®å—çš„å‰¯æœ¬ï¼Œå¦‚æœå­˜åœ¨ä½¿å¯¹åº”çš„ç¼“å­˜å‰¯æœ¬å¤±æ•ˆæˆ–æ›´æ–°ã€‚ä½¿ç”¨å¹¿æ’­çš„æ–¹å¼çœ‹ä¼¼ä¸€è§†åŒä»ï¼Œå®é™…è¿™æ ·åšå¤§å¤§å¢åŠ äº†æ€»çº¿çš„è´Ÿæ‹…ã€‚</p>
<h2 id="Directory-based-æœºåˆ¶"><a href="#Directory-based-æœºåˆ¶" class="headerlink" title="Directory-based æœºåˆ¶"></a>Directory-based æœºåˆ¶</h2><p><a href="https://courses.cs.washington.edu/courses/cse471/00au/Lectures/luke_directories.pdf">åŸºäºç›®å½•çš„ç¼“å­˜ä¸€è‡´æ€§åè®®</a></p>
<p>é’ˆå¯¹æ€»çº¿å—…æ¢çš„ç¼ºç‚¹ï¼Œ<strong>Directory-based æœºåˆ¶</strong>é‡‡ç‚¹å¯¹ç‚¹çš„ä¼ æ’­ï¼ŒåŸºäºç›®å½•æœºåˆ¶æ€»çº¿äº‹ä»¶åªä¼šä¼ ç»™è‡ªå·±æ„Ÿå…´è¶£çš„CPUã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰ç¼“å­˜è¡Œçš„ä¿¡æ¯ï¼Œéƒ½è¢«è®°å½•åœ¨ directory ä¸­ã€‚æ¯”å¦‚ä¼šè®°å½•æ¯ä¸ªç¼“å­˜è¡Œå½“å‰éƒ½åœ¨é‚£äº›æ ¸çš„ç¼“å­˜ä¸­ï¼Œç›´æ¥å°†ç¼“å­˜è¡Œä¿®æ”¹çš„æ¶ˆæ¯å‘é€åˆ°é‚£äº›æ ¸ã€‚è¿™ä¹ˆåšçš„ä¹Ÿæœ‰ä¸ªç¼ºç‚¹æ˜¯æ¯æ¬¡æ€»çº¿çš„ä¼ è¾“éƒ½åˆ° directory åšä¸€æ¬¡æ£€æŸ¥ï¼Œäº§ç”Ÿè€—æ—¶ã€‚</p>
<h2 id="æ€»çº¿ä»²è£"><a href="#æ€»çº¿ä»²è£" class="headerlink" title="æ€»çº¿ä»²è£"></a>æ€»çº¿ä»²è£</h2><p>æ€»çº¿çš„ç‹¬å æ€§è¦æ±‚åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªä¸»æ¨¡å—å ç”¨æ€»çº¿ï¼Œå¤©ç„¶åœ°ä¼šå°†æ‰€æœ‰æ ¸å¿ƒå¯¹å†…å­˜çš„è¯»å†™æ“ä½œä¸²è¡ŒåŒ–ã€‚å¦‚æœå¤šä¸ªæ ¸å¿ƒåŒæ—¶å‘èµ·æ€»çº¿äº‹åŠ¡ï¼Œæ­¤æ—¶æ€»çº¿ä»²è£å•å…ƒä¼šå¯¹ç«äº‰åšå‡ºä»²è£ï¼Œæœªè·èƒœçš„äº‹åŠ¡åªèƒ½ç­‰å¾…è·èƒœçš„äº‹åŠ¡å¤„ç†å®Œæˆåæ‰èƒ½æ‰§è¡Œã€‚å¯¹äºå†™ç¼“å­˜æ¥è®²ï¼Œå¤šæ ¸å¹¶å‘çš„å†™äº‹ä»¶ä¼šé€šè¿‡<strong>æ€»çº¿ä»²è£æœºåˆ¶</strong>è½¬æ¢æˆä¸²è¡ŒåŒ–çš„å†™äº‹ä»¶åºåˆ—</p>
<h2 id="ç¼“å­˜å†™ç­–ç•¥"><a href="#ç¼“å­˜å†™ç­–ç•¥" class="headerlink" title="ç¼“å­˜å†™ç­–ç•¥"></a>ç¼“å­˜å†™ç­–ç•¥</h2><ul>
<li>å†™åˆ†é… Write Allocateï¼šè¦å†™å…¥çš„æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œéœ€è¦å°†è¯¥æ•°æ®å¯¹åº”çš„å†…å­˜å—è¯»å…¥ç¼“å­˜ï¼›</li>
<li>å†™ä¸åˆ†é… Write Not Allocateï¼šè¦å†™å…¥çš„æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œæ— éœ€å°†è¯¥æ•°æ®å¯¹åº”çš„å†…å­˜å—è¯»å…¥ç¼“å­˜ï¼Œè€Œæ˜¯ç›´æ¥å†™å…¥ä¸»å­˜ï¼›</li>
<li>å†™ç©¿ Write Throughï¼šå†™å…¥ç¼“å­˜åˆ°çš„æ•°æ®ç«‹é©¬ä¼ æ’­åˆ°ä¸»å­˜ï¼›</li>
<li>å†™å› Write Backï¼šå†™å…¥ç¼“å­˜çš„æ•°æ®ä¸ä¼šç«‹é©¬ä¼ æ’­åˆ°ä¸»å­˜ï¼Œè€Œæ˜¯è¯¥ç¼“å­˜å—è¢«æ›¿æ¢æ—¶æ‰æ›´æ–°ï¼›</li>
<li>å†™æ›´æ–° Write Updateï¼šæ¯æ¬¡ç¼“å­˜å†™å…¥æ–°å€¼ï¼Œå‘èµ·ä¸€æ¬¡æ€»çº¿è¯·æ±‚ï¼Œé€šçŸ¥å…¶å®ƒCPUå¦‚æœæ‹¥æœ‰è¯¥ç¼“å­˜å—çš„å‰¯æœ¬å°±æ›´æ–°ä¸ºæ–°çš„å€¼ï¼ˆéœ€è¦ä¼ æ–°çš„å€¼ï¼‰</li>
<li>å†™æ— æ•ˆ Write Invalidï¼šæ¯æ¬¡ç¼“å­˜å†™å…¥æ–°å€¼ï¼Œå‘èµ·ä¸€æ¬¡æ€»çº¿è¯·æ±‚ï¼Œé€šçŸ¥å…¶å®ƒCPUå¦‚æœæ‹¥æœ‰è¯¥ç¼“å­˜å—å‰¯æœ¬ç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå¦‚æœæœªæ¥éœ€è¦åœ¨æ¥è¦æ–°çš„å€¼ï¼ˆä¸éœ€è¦ä¼ æ–°çš„å€¼ï¼‰</li>
</ul>
<h1 id="ç¼“å­˜ä¸€è‡´æ€§åè®®ç§ç±»"><a href="#ç¼“å­˜ä¸€è‡´æ€§åè®®ç§ç±»" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§åè®®ç§ç±»"></a>ç¼“å­˜ä¸€è‡´æ€§åè®®ç§ç±»</h1><blockquote>
<p> è¯¥è¡¨æ ¼ç¿»è¯‘è‡ª <a href="https://people.eecs.berkeley.edu/~pattrsn/252F96/Lecture18.pdf">Snooping vs. Directory Based Coherency</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>åå­—</th>
<th>åè®®ç±»å‹</th>
<th>å†…å­˜å†™ç­–ç•¥</th>
<th>åº”ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>Write Once</td>
<td>å†™æ— æ•ˆ</td>
<td>ç¬¬ä¸€æ¬¡å†™ä¹‹åå†™å›</td>
<td>First snoopy protocol</td>
</tr>
<tr>
<td>Synapse N+1</td>
<td>å†™æ— æ•ˆ</td>
<td>å†™å›</td>
<td>1st cache-coherent MPs</td>
</tr>
<tr>
<td>Berkeley</td>
<td>å†™æ— æ•ˆ</td>
<td>å†™å›</td>
<td>ä¼¯å…‹åˆ© SPUR</td>
</tr>
<tr>
<td>Illinois</td>
<td>å†™æ— æ•ˆ</td>
<td>å†™å›</td>
<td>SGI Power and Challenge</td>
</tr>
<tr>
<td>â€œFireflyâ€</td>
<td>å†™å¹¿æ’­ï¼ˆå†™æ›´æ–°)</td>
<td>å†™å›ç§æœ‰ï¼Œå†™ç©¿å…±äº«</td>
<td>SPARCCenter 2000</td>
</tr>
<tr>
<td>MESI</td>
<td>å†™æ— æ•ˆ</td>
<td>å†™å›</td>
<td>å¥”è…¾ï¼ŒPowerPC</td>
</tr>
</tbody></table>
<h1 id="MESIåè®®"><a href="#MESIåè®®" class="headerlink" title="MESIåè®®"></a>MESIåè®®</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>é€šè¿‡ç¼“å­˜ä¸€è‡´æ€§åè®®çš„ç§ç±»æ ¸åº”ç”¨åœºæ™¯æ¥çœ‹ï¼ŒMESIåº”ç”¨åœ¨Intelå¥”è…¾å¤„ç†å™¨å’ŒPowerPCä¸Šï¼Œå¯ä»¥è¯´æœ‰ç€å¾ˆå¹¿æ³›çš„åº”ç”¨äº†ã€‚</p>
<p>MESIæ˜¯å››ä¸ªå•è¯çš„é¦–å­—æ¯ç¼©å†™ï¼ˆModifiedï¼ŒExclusiveï¼ŒSharedï¼Œ Invalidï¼‰ï¼Œè¿™å››ä¸ªå•è¯ä»£è¡¨äº†å››ç§çŠ¶æ€ã€‚å› æ­¤å¯ä»¥ç¼“å­˜è¡Œå¯ä»¥ç”¨2bitæ¥å”¯ä¸€è¡¨å¾è¿™å››ç§çŠ¶æ€çš„æŸä¸€ç§çŠ¶æ€ã€‚</p>
<ul>
<li>Mï¼šModifiedï¼Œè¢«ä¿®æ”¹çš„ï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºDirty è„çš„ï¼‰ã€‚å½“å‰CPUå¯¹åº”çš„è¯¥ç¼“å­˜è¡Œæ•°æ®è¢«ä¿®æ”¹ï¼Œæ‹¥æœ‰æœ€æ–°æ•°æ®ï¼ˆprivate, != Memoryï¼‰</li>
<li>Eï¼šExclusiveï¼Œç‹¬äº«çš„ã€‚è¯¥ç¼“å­˜è¡Œåªå­˜åœ¨äºå½“å‰CPUä¸­ï¼Œå¹¶ä¸”æ•°æ®æœ‰æ•ˆï¼ˆå¹²å‡€ï¼‰(private, =Memory))</li>
<li>Sï¼šSharedï¼Œå…±äº«çš„ã€‚è¯¥ç¼“å­˜è¡Œä¹Ÿå­˜åœ¨äºå…¶å®ƒCPUä¸­ï¼Œå¹¶ä¸”æ•°æ®æœ‰æ•ˆï¼ˆå¹²å‡€ï¼‰(shared, =Memory)</li>
<li>Iï¼šInvalidï¼Œæ— æ•ˆçš„ã€‚å½“å‰CPUå†…çš„è¯¥ç¼“å­˜è¡Œæ•°æ®å¤±æ•ˆ(NULL)</li>
</ul>
<h2 id="çŠ¶æ€æœº"><a href="#çŠ¶æ€æœº" class="headerlink" title="çŠ¶æ€æœº"></a>çŠ¶æ€æœº</h2><blockquote>
<p>æœ¬éƒ¨åˆ†åŸºäºè¿›è¡Œé‡æ–°æ¢³ç†</p>
</blockquote>
<h3 id="æ¥è‡ªå¤„ç†å™¨çš„è¯·æ±‚"><a href="#æ¥è‡ªå¤„ç†å™¨çš„è¯·æ±‚" class="headerlink" title="æ¥è‡ªå¤„ç†å™¨çš„è¯·æ±‚"></a>æ¥è‡ªå¤„ç†å™¨çš„è¯·æ±‚</h3><ul>
<li>PrRdï¼šå¤„ç†å™¨è¯·æ±‚è¯»ä¸€ä¸ªç¼“å­˜å—</li>
<li>PrWt ï¼šå¤„ç†å™¨è¯·æ±‚å†™ä¸€ä¸ªç¼“å­˜å—</li>
</ul>
<p><img src="/images/computerSystem/storage/cache-7.png" alt="image"></p>
<ul>
<li><p>Mï¼šå”¯ä¸€ä¸”æ•°æ®ï¼=memoryï¼ˆæœ€æ–°æ•°æ®ï¼‰ã€‚è¯»å†™ä¾ç„¶æ˜¯æœ€æ–°æ•°æ®ï¼ˆï¼= memoryï¼‰</p>
</li>
<li><p>Eï¼šå”¯ä¸€ä¸”æ•°æ®=memoryã€‚è¯»ä¸å½±å“çŠ¶æ€ï¼Œå†™åˆ™ä¸ä¸»å­˜æ•°æ®ä¸ä¸€è‡´ç½®M</p>
</li>
<li><p>Sï¼šå…±äº«ä¸”æ•°æ®=memoryã€‚è¯»ä¸å½±å“çŠ¶æ€ï¼Œå†™åˆ™å°†æ‹¥æœ‰æœ€æ–°æ•°æ®ç½®Mï¼ŒåŒæ—¶äº§ç”Ÿæ€»çº¿äº‹åŠ¡é€šçŸ¥å…¶å®ƒå¤„ç†å™¨è¦å†™è¯¥ç¼“å­˜</p>
</li>
<li><p>Iï¼šæ— æ•ˆçš„ï¼Œä¸€å®šCache Missã€‚è¯»é¦–å…ˆå°†æ•°æ®åŠ è½½è¿›ç¼“å­˜ï¼Œäº§ç”ŸBusRdçš„æ€»çº¿äº‹åŠ¡ï¼Œå†…å­˜æ§åˆ¶å™¨å“åº”è¯·æ±‚ï¼ŒåŒæ—¶å¦‚æœå‘ç°å…¶å®ƒå¤„ç†å™¨ä¹Ÿæ‹¥æœ‰è¯¥ç¼“å­˜å—å‰¯æœ¬åˆ™ç½®Sï¼Œå¦‚æœæ²¡æœ‰ç½®Eï¼›å†™åˆ™äº§ç”ŸBusRdxçš„æ€»çº¿äº‹åŠ¡ï¼Œç”±äºæ‹¥æœ‰æœ€æ–°æ•°æ®çŠ¶æ€ç½®M</p>
</li>
</ul>
<h3 id="æ¥è‡ªæ€»çº¿ï¼ˆå…¶å®ƒå¤„ç†å™¨ï¼‰çš„è¯·æ±‚"><a href="#æ¥è‡ªæ€»çº¿ï¼ˆå…¶å®ƒå¤„ç†å™¨ï¼‰çš„è¯·æ±‚" class="headerlink" title="æ¥è‡ªæ€»çº¿ï¼ˆå…¶å®ƒå¤„ç†å™¨ï¼‰çš„è¯·æ±‚"></a>æ¥è‡ªæ€»çº¿ï¼ˆå…¶å®ƒå¤„ç†å™¨ï¼‰çš„è¯·æ±‚</h3><ul>
<li><p>BusRdï¼šæ€»çº¿ä¾¦å¬åˆ°å…¶å®ƒå¤„ç†å™¨è¯·æ±‚è¯»ä¸€ä¸ªç¼“å­˜å—</p>
</li>
<li><p>BusRdXï¼šæ€»çº¿ä¾¦å¬åˆ°å…¶å®ƒå¤„ç†å™¨è¯·æ±‚å†™ä¸€ä¸ªè‡ªå·±æ²¡æœ‰ç¼“å­˜å‰¯æœ¬çš„ç¼“å­˜å—</p>
</li>
<li><p>BusUpgrï¼šæ€»çº¿ä¾¦å¬åˆ°å…¶å®ƒå¤„ç†å™¨è¯·æ±‚å†™æœ¬åœ°ç¼“å­˜ï¼ˆè¯¥å¤„ç†å™¨æ‹¥æœ‰çš„ç¼“å­˜å—ï¼‰</p>
</li>
<li><p>Flushï¼šæ€»çº¿ä¾¦å¬åˆ°å…¶å®ƒå¤„ç†å™¨è¯·æ±‚å†™å›ä¸€ä¸ªç¼“å­˜å—åˆ°ä¸»å­˜ï¼ˆcache to memoryï¼‰</p>
</li>
<li><p>FlushOptï¼šæ€»çº¿ä¾¦å¬åˆ°å…¶å®ƒå¤„ç†å™¨è¯·æ±‚å°†ä¸€ä¸ªç¼“å­˜å—é€šè¿‡æ€»çº¿çš„æ–¹å¼å‘é€å¦å¤–ä¸€ä¸ªå¤„ç†å™¨ï¼ˆcache to cacheï¼‰</p>
<p><img src="/images/computerSystem/storage/cache-8.png" alt="image"></p>
</li>
<li><p>Mï¼šå”¯ä¸€ä¸”æ•°æ®ï¼=memoryï¼ˆæœ€æ–°æ•°æ®ï¼‰ã€‚ BusRdè¯´æ˜å…¶å®ƒå¤„ç†å™¨è¦è¯»ï¼Œåˆ™éœ€è¦å†™ä¼ æ’­å°†æ•°æ®å†™åˆ°ä¸»å­˜ï¼Œå› ä¸ºå…¶å®ƒå¤„ç†å™¨è¯»æ‰€ä»¥æ•°æ®=memoryä¸”å…±äº«ç½®çŠ¶æ€Sï¼›å½“BusRdxæˆ–BusUpgrè¯´æ˜å…¶å®ƒå¤„ç†å™¨è¦å†™ï¼Œè¿™ä¸¤ç§æƒ…å†µæ— è®ºå‘èµ·è¯·æ±‚çš„å¤„ç†å™¨æœ‰æ²¡æœ‰ç¼“å­˜ä¸€å®šä¸æ˜¯æœ€æ–°çš„æ‰€ä»¥ä¸€å®šäº§ç”ŸFlushçš„æ€»çº¿äº‹åŠ¡ï¼Œå¹¶ä¸”å…¶å®ƒå¤„ç†å™¨å†™å®Œå°±ä¸æ˜¯æœ€æ–°çš„äº†ç½®I</p>
</li>
<li><p>Eï¼šå”¯ä¸€ä¸”æ•°æ®=memoryã€‚BusRdè¯´æ˜å…¶å®ƒå¤„ç†å™¨è¦è¯»ï¼Œæˆ‘çš„æ•°æ®å·²ç»æ˜¯æœ€æ–°çš„äº†æ‰€ä»¥äº§ç”ŸFlushOptæ€»çº¿äº‹åŠ¡ï¼Œå°†è¯¥ç¼“å­˜å—ä¼ èµ°å¹¶ç½®çŠ¶æ€Sï¼›å…¶å®ƒå¤„ç†å™¨å†™æœ€ç»ˆç»“æœä¸€å®šæ˜¯æˆ‘çš„ç§æœ‰ç¼“å­˜æ— æ•ˆç½®Iï¼Œä½†æ˜¯å¦‚æœå‘èµ·æ€»çº¿äº‹åŠ¡çš„å¤„ç†å™¨æ²¡æœ‰è¯¥ç¼“å­˜æˆ‘éœ€è¦äº§ç”ŸFlushOptçš„æ€»çº¿äº‹åŠ¡å°†æ•°æ®ä¼ è¾“ï¼Œå¦åˆ™ä¸äº§ç”Ÿæ€»çº¿äº‹åŠ¡</p>
</li>
<li><p>Sï¼šå…±äº«ä¸”æ•°æ®=memoryã€‚BusRdè¯´æ˜å…¶å®ƒå¤„ç†å™¨è¦è¯»ï¼Œæˆ‘çš„æ•°æ®æ˜¯æœ€æ–°çš„äº†æ‰€ä»¥äº§ç”ŸFlushOptæ€»çº¿äº‹åŠ¡ï¼Œå°†è¯¥ç¼“å­˜å—ä¼ èµ°ä¿æŒSçŠ¶æ€ï¼›å…¶å®ƒå¤„ç†å™¨å†™æœ€ç»ˆç»“æœä¸€å®šæ˜¯æˆ‘çš„ç§æœ‰ç¼“å­˜æ— æ•ˆç½®Iï¼Œä½†æ˜¯å¦‚æœå‘èµ·æ€»çº¿äº‹åŠ¡çš„å¤„ç†å™¨æ²¡æœ‰è¯¥ç¼“å­˜æˆ‘éœ€è¦äº§ç”ŸFlushOptçš„æ€»çº¿äº‹åŠ¡å°†æ•°æ®ä¼ è¾“ï¼Œå¦åˆ™ä¸äº§ç”Ÿæ€»çº¿äº‹åŠ¡</p>
</li>
<li><p>Iï¼šæ— æ•ˆçš„ã€‚å„ç§è¯»å†™æƒ…å†µéƒ½ä¸ä¼šå½±å“ï¼Œç»§ç»­ä¿æŒçŠ¶æ€</p>
</li>
</ul>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li>ã€Šç¼–ç¨‹é«˜æ‰‹å¿…å­¦çš„å†…å­˜çŸ¥è¯†ã€‹æå®¢æ—¶é—´æµ·çº³</li>
<li><a href="https://juejin.cn/post/6844903965696458765">cacheä¸€è‡´æ€§é‡Œçš„MESIåè®®</a></li>
<li><a href="https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESIHelp.htm">MESIåŠ¨ç”»</a></li>
</ul>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Storage</category>
        <category>Cache</category>
      </categories>
      <tags>
        <tag>storage system</tag>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title>CacheåŸç†</title>
    <url>/2023/02/15/computerSystem/storage/%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><h2 id="å±€éƒ¨æ€§åŸç†"><a href="#å±€éƒ¨æ€§åŸç†" class="headerlink" title="å±€éƒ¨æ€§åŸç†"></a>å±€éƒ¨æ€§åŸç†</h2><p>åœ¨å¤§å¤šæ•°ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒCPUå¯¹äºå†…å­˜çš„è®¿é—®ä¼šè¡¨ç°å‡ºæ˜æ˜¾çš„å€¾å‘æ€§ï¼Œå…·ä½“ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>æ—¶é—´å±€éƒ¨æ€§ï¼šæ—¶é—´ç»´åº¦çœ‹ï¼Œè¢«å¼•ç”¨è¿‡çš„å†…å­˜ä½ç½®ï¼Œä¸è¿œçš„å°†æ¥å°†å¤§æ¦‚ç‡å†æ¬¡è¢«è®¿é—®</li>
<li>ç©ºé—´å±€éƒ¨æ€§ï¼šç©ºé—´ç»´åº¦çœ‹ï¼Œè¢«å¼•ç”¨è¿‡çš„å†…å­˜ä½ç½®ï¼Œä¸è¿œçš„å°†æ¥å®ƒé™„è¿‘çš„å†…å­˜ä½ç½®å°†å¤§æ¦‚ç‡è¢«è®¿é—®</li>
</ul>
<h2 id="ç¼“å­˜å—"><a href="#ç¼“å­˜å—" class="headerlink" title="ç¼“å­˜å—"></a>ç¼“å­˜å—</h2><blockquote>
<p>linuxæŸ¥çœ‹ç¼“å­˜ä¿¡æ¯å‘½ä»¤ï¼šgetconf -a | grep CACHE</p>
</blockquote>
<h3 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>æ ¹æ®cacheçš„ä½œç”¨å¯çŸ¥cacheå½“ä¸­å­˜å‚¨çš„æ˜¯ä¸»å­˜çš„å‰¯æœ¬ï¼Œå…¶å¿…é¡»æ˜¯è¦å’Œä¸»å­˜è¿›è¡Œæ•°æ®äº¤æ¢çš„ã€‚åŸºäºæ•ˆç‡è§’åº¦è€ƒé‡ï¼Œæ ¹æ®ç¨‹åºå±€éƒ¨æ€§åŸç†ï¼ŒCPUæ˜¯ä¸ä¼šæŒ‰ç…§ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚è¿›è¡Œæ•°æ®çš„åŠ è½½è‡³ç¼“å­˜ä¸­ï¼Œè€Œæ˜¯æŒ‰å—è¿›è¡ŒåŠ è½½ï¼Œè€Œè¿™æ¯ä¸€å—å°±å«åšcache lineï¼Œä¹Ÿç§°ç¼“å­˜å—</p>
<ul>
<li>ç¼“å­˜å—ï¼ˆcache lineï¼‰ï¼Œç®¡ç†ç¼“å­˜ç»“æ„çš„æœ€å°å­˜å‚¨å•å…ƒï¼Œç›®å‰å¸¸ç”¨çš„æ˜¯64Bytesï¼ˆå†…å­˜ç³»ç»Ÿæ”¯æŒBurstè¯»/å†™æ•ˆç‡æ›´é«˜ï¼‰</li>
</ul>
<h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p><img src="/images/computerSystem/storage/cache-3.png" alt="image"></p>
<ul>
<li>æ ‡è¯†ä½Vï¼šè¡¨ç¤ºè¯¥ç¼“å­˜å—æ˜¯å¦æœ‰æ•ˆ</li>
<li>æ ‡è¯†ä½Mï¼šè¡¨ç¤ºè¿™ä¸ªç¼“å­˜å—æ˜¯å¦è¢«ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯è„ä½</li>
<li>Tagï¼šå’Œå†…å­˜å—åŒ¹é…çš„æ ‡è¯†</li>
<li>Dataï¼šç¼“å­˜æ•°æ®å†…å®¹</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ Vã€Mã€Tagè¿™å‡ ä½æ˜¯ç”±ç¡¬ä»¶é—¨ç”µè·¯å®ç°çš„ï¼Œå¹¶ä¸å ç¼“å­˜ç©ºé—´ã€‚è€ŒDataæ‰æ˜¯çœŸæ­£çš„æ•°æ®éƒ¨åˆ†</p>
<h2 id="ç¼“å­˜å‘½ä¸­-x2F-ç¼ºå¤±"><a href="#ç¼“å­˜å‘½ä¸­-x2F-ç¼ºå¤±" class="headerlink" title="ç¼“å­˜å‘½ä¸­/ç¼ºå¤±"></a>ç¼“å­˜å‘½ä¸­/ç¼ºå¤±</h2><ul>
<li>Cache Hitï¼šè®¿å­˜æ—¶ï¼Œå¦‚æœæ‰€éœ€è¦çš„æ•°æ®åœ¨cacheä¸­åˆ™æˆä¸ºç¼“å­˜å‘½ä¸­</li>
<li>Cache Missï¼šè®¿å­˜æ—¶ï¼Œå¦‚æœæ‰€éœ€è¦çš„æ•°æ®ä¸åœ¨cacheä¸­åˆ™æˆä¸ºç¼“å­˜ç¼ºå¤±</li>
</ul>
<h1 id="ç¼“å­˜æ˜ å°„æ–¹å¼"><a href="#ç¼“å­˜æ˜ å°„æ–¹å¼" class="headerlink" title="ç¼“å­˜æ˜ å°„æ–¹å¼"></a>ç¼“å­˜æ˜ å°„æ–¹å¼</h1><blockquote>
<p>è§†é¢‘é“¾æ¥ï¼š<a href="https://www.bilibili.com/video/BV1Qd4y1J7XA">click here</a></p>
</blockquote>
<p>ä»æ¦‚å¿µä¸Šè®²ï¼Œé«˜é€Ÿç¼“å­˜æ˜¯ä¸€ä¸ªç›¸è”å­˜å‚¨å™¨ï¼ˆAssociative Memoryï¼‰ã€‚ç¡¬ä»¶ç”µè·¯å®ç°æ–¹å¼åŠæ˜ å°„ç­–ç•¥çš„ä¸åŒï¼Œç¼“å­˜çš„æ˜ å°„æ–¹å¼åˆ†ä¸ºä¸‰ç§ï¼š</p>
<ul>
<li>å…¨ç›¸è¿æ˜ å°„ï¼šä¸»å­˜å—å¯ä»¥æ˜ å°„åˆ°ä»»ä¸€ç¼“å­˜è¡Œï¼ˆç¼“å­˜åªæœ‰ä¸€ä¸ªç»„ï¼Œæ‰€æœ‰çš„å†…å­˜å—éƒ½æ”¾åœ¨è¿™ä¸€ä¸ªç»„çš„ä¸åŒè·¯ä¸Š)</li>
<li>ç›´æ¥ç›¸è¿æ˜ å°„ï¼šä¸»å­˜å—åªèƒ½æ˜ å°„åˆ°å›ºå®šçš„ç¼“å­˜è¡Œï¼ˆç¼“å­˜åªæœ‰ä¸€ä¸ªè·¯ï¼Œä¸€ä¸ªå†…å­˜å—åªèƒ½æ”¾ç½®åœ¨ç‰¹å®šçš„ç»„ä¸Šï¼‰</li>
<li>ç»„ç»„ç›¸è¿æ˜ å°„ï¼šä¸»å­˜å—åªèƒ½æ˜ å°„åˆ°å›ºå®šçš„ç¼“å­˜ç»„ï¼Œç»„å†…ä»»ä¸€ç¼“å­˜è¡Œï¼ˆç¼“å­˜åŒæ—¶ç”±å¤šä¸ªç»„å’Œå¤šä¸ªè·¯ï¼‰</li>
</ul>
<p>ç‰‡å¤–çš„é«˜é€Ÿç¼“å­˜é€šå¸¸æ˜¯ç›´æ¥æ˜ å°„çš„ï¼Œå› ä¸ºç»„ç›¸è”éœ€è¦æ›´å®½çš„æ¥å£ï¼Œå¯ä»¥å–å¾—å¤šä¸ªæ ‡ç­¾ï¼Œå¹¶å‘åŒ¹é…</p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><table>
<thead>
<tr>
<th>ç»„ç»‡æ–¹å¼</th>
<th>ç‰¹ç‚¹</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>å…¨ç›¸è”æ˜ å°„</td>
<td>cacheåˆ©ç”¨ç‡é«˜<br>å—å†²çªä½<br>æ·˜æ±°ç®—æ³•å¤æ‚</td>
<td>å°å®¹é‡cache</td>
</tr>
<tr>
<td>ç›´æ¥ç›¸è¿æ˜ å°„</td>
<td>cacheåˆ©ç”¨ç‡ä½<br>å—å†²çªé«˜<br>æ·˜æ±°ç®—æ³•ç®€å•</td>
<td>å¤§å®¹é‡cache</td>
</tr>
<tr>
<td>ç»„ç›¸è”æ˜ å°„</td>
<td>cacheåˆ©ç”¨ç‡è¾ƒé«˜<br>å—å†²çªç‡è¾ƒä½<br>ç¡¬ä»¶å®ç°å¤æ‚</td>
<td>ä¸­ç­‰å®¹é‡cache</td>
</tr>
</tbody></table>
<h2 id="æ˜ å°„ç®—æ³•"><a href="#æ˜ å°„ç®—æ³•" class="headerlink" title="æ˜ å°„ç®—æ³•"></a>æ˜ å°„ç®—æ³•</h2><ul>
<li>å…¨ç›¸è”ï¼šcacheè¡Œå· = random</li>
<li>ç›´æ¥ç›¸è”ï¼šcacheè¡Œå· = å†…å­˜å—å· % cacheè¡Œæ•°</li>
<li>ç»„ç›¸è”ï¼šä¸»å­˜çš„æ•°æ®å—æ˜ å°„åˆ°Cacheç‰¹å®šç»„çš„ä»»æ„è¡Œï¼Œcacheç»„å·=ä¸»å­˜å—å· % cacheç»„æ•°</li>
</ul>
<h1 id="ç¼“å­˜å—æ›¿æ¢ç­–ç•¥"><a href="#ç¼“å­˜å—æ›¿æ¢ç­–ç•¥" class="headerlink" title="ç¼“å­˜å—æ›¿æ¢ç­–ç•¥"></a>ç¼“å­˜å—æ›¿æ¢ç­–ç•¥</h1><ul>
<li><p>éšæœºæ³•ï¼ˆRANDï¼‰</p>
<p>æ–¹æ³•ç®€å•ã€æ˜“äºå®ç°ï¼Œä½†å‘½ä¸­ç‡æ¯”è¾ƒä½ã€‚</p>
</li>
<li><p>å…ˆè¿›å…ˆå‡ºç®—æ³•ï¼ˆFIFOï¼‰</p>
<p>å…ˆè¿›å…ˆå‡ºæ–¹æ³•æ˜“äºå®ç°ï¼Œå‘½ä¸­ç‡æ¯”éšæœºæ³•å¥½äº›ã€‚</p>
</li>
<li><p>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç®—æ³•ï¼ˆLRUï¼ŒLeast Recently Usedï¼‰</p>
<p>å¯ä»¥æ¯”è¾ƒå¥½åœ°éµå¾ªç¨‹åºå±€éƒ¨æ€§åŸç†</p>
</li>
</ul>
<h1 id="ç¼“å­˜å†™ç­–ç•¥"><a href="#ç¼“å­˜å†™ç­–ç•¥" class="headerlink" title="ç¼“å­˜å†™ç­–ç•¥"></a>ç¼“å­˜å†™ç­–ç•¥</h1><h2 id="write-back-å†™å›"><a href="#write-back-å†™å›" class="headerlink" title="write back å†™å›"></a>write back å†™å›</h2><p>å°†è¦å†™å…¥çš„æ•°æ®ä¿ç•™åœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œå¹¶è¿›è¡Œæ ‡è®°ï¼ˆDirty / Modifiedï¼‰ã€‚åªæœ‰ç¼“å­˜å—è¢«æ›¿æ¢çš„æ—¶å€™æ‰ä¼šå°†æ•°æ®å†™å…¥ä¸»å­˜</p>
<p><img src="/images/computerSystem/storage/cache-4.png" alt="image"></p>
<h2 id="write-through-å†™é€-x2F-å†™ç©¿-x2F-å†™ç›´è¾¾"><a href="#write-through-å†™é€-x2F-å†™ç©¿-x2F-å†™ç›´è¾¾" class="headerlink" title="write through å†™é€/å†™ç©¿/å†™ç›´è¾¾"></a>write through å†™é€/å†™ç©¿/å†™ç›´è¾¾</h2><p>CPUæ€»æ˜¯å°†æ•°æ®ç›´æ¥å†™åˆ°ä¸»å†…å­˜ä¸­</p>
<blockquote>
<p>noteï¼šå¦‚æœç­‰å¾…å†™å†…å­˜å®Œæˆå¤„ç†å™¨çš„æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œé€šè¿‡å†™ç¼“å†²ï¼ˆWrite Bufferï¼‰ç¡¬ä»¶å¯ä»¥å¼¥è¡¥è¿™ä¸€é—®é¢˜ã€‚å°†éœ€è¦å†™å…¥çš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªFIFOé˜Ÿåˆ—ä¸­ï¼ˆWrite Bufferï¼‰ï¼Œç”±å†…å­˜æ§åˆ¶å™¨è¿›è¡Œå†™å…¥æ“ä½œ</p>
</blockquote>
<p><img src="/images/computerSystem/storage/cache-5.png" alt="image"></p>
<h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><blockquote>
<p>ç”±äºæ•ˆç‡åŸå› ï¼Œå†™æ›´æ–°å’Œå†™ä¸åˆ†é…è¿™ä¸¤ç§ç­–ç•¥åœ¨ç°å®ä¸­æ¯”è¾ƒå°‘å‡ºç°</p>
</blockquote>
<ol>
<li><p>CPU ä¹‹é—´çš„æ›´æ–°ç­–ç•¥</p>
<p>å½“æŸä¸ª CPU çš„ç¼“å­˜ä¸­æ‰§è¡Œå†™æ“ä½œï¼Œä¿®æ”¹å…¶ä¸­çš„æŸä¸ªå€¼æ—¶ï¼Œå…¶ä»– CPU çš„ç¼“å­˜æ‰€ä¿æœ‰è¯¥æ•°æ®å‰¯æœ¬çš„æ›´æ–°ç­–ç•¥åˆ†ä¸ºï¼šå†™æ›´æ–°ï¼ˆWrite Updateï¼‰å’Œå†™æ— æ•ˆï¼ˆWrite Invalidateï¼‰ã€‚</p>
</li>
<li><p>å†™ç¼“å­˜æ—¶æ•°æ®æ˜¯å¦è¢«åŠ è½½</p>
<p>å½“å‰è¦å†™å…¥çš„æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­æ—¶ï¼Œæ ¹æ®æ˜¯å¦è¦å…ˆå°†æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œå†™ç­–ç•¥åˆ†ä¸ºï¼šå†™åˆ†é…ï¼ˆWrite Allocateï¼‰å’Œå†™ä¸åˆ†é…ï¼ˆNot Write Allocateï¼‰ã€‚</p>
</li>
</ol>
<h1 id="ç¼“å­˜æ•ˆç‡"><a href="#ç¼“å­˜æ•ˆç‡" class="headerlink" title="ç¼“å­˜æ•ˆç‡"></a>ç¼“å­˜æ•ˆç‡</h1><h2 id="è¡¡é‡æ ‡å‡†"><a href="#è¡¡é‡æ ‡å‡†" class="headerlink" title="è¡¡é‡æ ‡å‡†"></a>è¡¡é‡æ ‡å‡†</h2><p>ä¸¤ä¸ªå‚æ•°çš„ä¹˜ç§¯ï¼š</p>
<ol>
<li><strong>é«˜é€Ÿç¼“å­˜ç¼ºå¤±ç‡</strong>ï¼šcache miss / è¢«æ‰§è¡Œçš„æŒ‡ä»¤æ¬¡æ•°</li>
<li><strong>é«˜é€Ÿç¼“å­˜ç¼ºå¤±é‡å¡«çš„å¼€é”€</strong>ï¼šcpuæµæ°´çº¿é‡æ–°è®¡ç®—ä»ä¸»å­˜å–æ•°åˆ°ç¼“å­˜ä¸­çš„æ—¶é—´</li>
</ol>
<h2 id="cache-missçš„åŸå› ï¼Ÿ"><a href="#cache-missçš„åŸå› ï¼Ÿ" class="headerlink" title="cache missçš„åŸå› ï¼Ÿ"></a>cache missçš„åŸå› ï¼Ÿ</h2><blockquote>
<p>ã€Šsee mips runã€‹å¯¹äºä»¥ä¸‹ç¼ºå¤±ç±»å‹åˆ†åˆ«ç§°ä¸ºï¼šç¬¬ä¸€æ¬¡è®¿é—®ï¼›æŠ–åŠ¨ï¼›æ›¿æ¢</p>
</blockquote>
<ol>
<li>å¼ºåˆ¶ç¼ºå¤±ã€‚ç¬¬ä¸€æ¬¡å°†æ•°æ®å—è¯»å…¥åˆ°ç¼“å­˜æ‰€äº§ç”Ÿçš„ç¼ºå¤±ï¼Œä¹Ÿè¢«ç§°ä¸ºå†·ç¼ºå¤±ï¼ˆcold missï¼‰ï¼Œå› ä¸ºå½“å‘ç”Ÿç¼“å­˜ç¼ºå¤±æ—¶ï¼Œç¼“å­˜æ˜¯ç©ºçš„ï¼ˆå†·çš„ï¼‰ï¼›</li>
<li>å†²çªç¼ºå¤±ã€‚ç”±äºç¼“å­˜çš„ç›¸è¿åº¦æœ‰é™å¯¼è‡´çš„ç¼ºå¤±ï¼ˆæŒ‡åœ¨åŒä¸€ç»„å†…çš„ç¼ºå¤±ï¼‰ï¼›</li>
<li>å®¹é‡ç¼ºå¤±ã€‚ç”±äºç¼“å­˜å¤§å°æœ‰é™å¯¼è‡´çš„ç¼ºå¤±ï¼ˆæè¿°èŒƒå›´æ˜¯æ•´ä¸ªç¼“å­˜ï¼‰</li>
</ol>
<h2 id="å¦‚ä½•æé«˜åˆ©ç”¨ç‡ï¼Ÿ"><a href="#å¦‚ä½•æé«˜åˆ©ç”¨ç‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•æé«˜åˆ©ç”¨ç‡ï¼Ÿ"></a>å¦‚ä½•æé«˜åˆ©ç”¨ç‡ï¼Ÿ</h2><ul>
<li>è½¯ä»¶<ol>
<li>ç¨‹åºæ›´å°ï¼›</li>
<li>è®©ç¨‹åºç»å¸¸æ‰§è¡Œçš„éƒ¨åˆ†æ›´å°ã€‚å¯¹äºä¸€ä¸ªç¨‹åºé”™è¯¯å¤„ç†/åˆå§‹åŒ–ä»£ç ç­‰éƒ¨åˆ†ä»£ç å‰¥ç¦»å‡ºæ¥ï¼Œæé«˜å‰©ä½™ç¨‹åºçš„ç¼“å­˜å‘½ä¸­ç‡ï¼›</li>
<li>å®‰æ’ç¨‹åºå°½é‡ä¸å‘ç”Ÿå†²çªç¼ºå¤±ï¼ˆæŠ–åŠ¨ï¼‰</li>
<li>ç›´åˆ°å¿…é¡»ç”¨åˆ°æ•°æ®æ—¶æ‰åœæ­¢CPUã€‚éé˜»å¡è¯»ã€‚å–æ•°æ“ä½œæ‰§è¡Œå®Œï¼Œç»§ç»­æ‰§è¡Œä¸ä¾èµ–è¯¥æ•°æ®çš„ä»£ç ï¼ˆæµæ°´çº¿ä¹±åº/åˆ†æ”¯æŒ‡ä»¤ç­‰ç­‰ï¼‰</li>
<li>å¤šçº¿ç¨‹CPU</li>
</ol>
</li>
<li>ç¡¬ä»¶<ol>
<li>ï¼ˆ1ï¼‰è®©é«˜é€Ÿç¼“å­˜å˜çš„æ›´å¤§ï¼ˆä»£ä»·ï¼‰</li>
<li>ï¼ˆ1ï¼‰å¢åŠ ç¼“å­˜ç›¸è¿åº¦ï¼ˆ4è·¯ä»¥ä¸Šæ•ˆæœå°±ä¸æ˜æ˜¾äº†ï¼Œæ›´é«˜è·¯ç›¸è¿ç¼“å­˜è®¾è®¡ç›®çš„åœ¨äºå…¶å®ƒåŸå› ï¼ˆé™ä½åŠŸè€—ï¼Œä¸ä½¿ç”¨æ—¶å…³æ‰æ•´è·¯ï¼‰ï¼‰</li>
<li>ï¼ˆ1ï¼‰å¢åŠ é¢å¤–å±‚æ¬¡çš„é«˜é€Ÿç¼“å­˜ï¼ˆL2 L3 cacheï¼‰</li>
<li>ï¼ˆ2ï¼‰å¢åŠ å¸¦å®½ï¼Œcpuä¸ä¸»å­˜ç‰©ç†ä½ç½®æ›´è¿‘ï¼ˆä»£ä»·ï¼‰</li>
<li>ï¼ˆ2ï¼‰å¢åŠ å†…å­˜burstå¸¦å®½ï¼ˆç°åœ¨å¾ˆå°‘ä½¿ç”¨ï¼‰</li>
<li>ï¼ˆ2ï¼‰å°½æ—©åœ°é‡å¯CPU</li>
<li>ï¼ˆ2ï¼‰<a href="https://oscpu.github.io/NutShell-doc/%E5%8A%9F%E8%83%BD%E9%83%A8%E4%BB%B6/cache.html">å…³é”®å­—ä¼˜å…ˆ</a></li>
</ol>
</li>
</ul>
<h1 id="ç®¡ç†ç¼“å­˜"><a href="#ç®¡ç†ç¼“å­˜" class="headerlink" title="ç®¡ç†ç¼“å­˜"></a>ç®¡ç†ç¼“å­˜</h1><blockquote>
<p>å¯¹äºMIPS CPUï¼ŒsynciæŒ‡ä»¤åšäº†ä»¥ä¸‹æ‰€æœ‰å·¥ä½œï¼ˆç”¨æˆ·ç‰¹æƒçº§ï¼‰</p>
</blockquote>
<p>ä¸Šç”µä¹‹åCPUçš„é«˜é€Ÿç¼“å­˜é˜µåˆ—å†…å®¹é€šå¸¸æ˜¯éšæœºçš„ã€‚å¼•å¯¼è½¯ä»¶è´Ÿè´£åˆå§‹åŒ–é«˜é€Ÿç¼“å­˜ï¼Œç³»ç»Ÿå¯åŠ¨å¹¶æ­£å¸¸è¿è¡Œåï¼Œåªæœ‰ä¸‰ç§æƒ…å†µCPUå¿…é¡»è¿›è¡Œå¹²é¢„ï¼š</p>
<ol>
<li><strong>DMAè®¾å¤‡ä»å†…å­˜å–æ•°æ®ä¹‹å‰</strong>ã€‚å¦‚æœæ˜¯Write Backå¼å†™ç­–ç•¥ï¼Œéœ€è¦å°†åœ¨é«˜é€Ÿç¼“å­˜ä¸­æœªå†™å…¥åˆ°ä¸»å­˜çš„æ•°æ®å†™å…¥å¾—åˆ°æ­£ç¡®æ•°æ®</li>
<li><strong>DMAè®¾å¤‡å†™æ•°æ®åˆ°å†…å­˜ä¹‹å‰</strong>ã€‚éœ€è¦å°†é«˜é€Ÿç¼“å­˜ä¸­å¯¹åº”çš„ç¼“å­˜è¡Œçš„æ ‡å¿—ä½ç½®Invalidï¼ˆæ— æ•ˆçš„ï¼‰</li>
<li><strong>å†™æŒ‡ä»¤</strong>ã€‚å½“cpuè‡ªèº«å†™ä¸€éƒ¨åˆ†æŒ‡ä»¤åˆ°å†…å­˜ç”¨äºç¨åæ‰§è¡Œæ—¶ï¼Œé¦–å…ˆéœ€è¦ä¿è¯æŒ‡ä»¤å†™å…¥åˆ°å†…å­˜ä¸­ï¼Œå…¶æ¬¡ä¿è¯ I-Cache ä¸­å¯¹åº”çš„æŒ‡ä»¤æ— æ•ˆ</li>
</ol>
<blockquote>
<p>è§†é¢‘æ¨èï¼š</p>
<p><a href="https://www.bilibili.com/video/BV1QA411t7Uv">Cacheåœ°å€æ˜ å°„ä¸å˜æ¢æ–¹æ³•</a></p>
<p><a href="https://www.bilibili.com/video/BV1h3411h7kV">ä¸€å¼ å›¾è§£å†³ä¸»å­˜å’Œcacheçš„æ˜ å°„é—®é¢˜</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Storage</category>
        <category>Cache</category>
      </categories>
      <tags>
        <tag>storage system</tag>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title>Cacheç®€ä»‹</title>
    <url>/2023/02/15/computerSystem/storage/%E7%BC%93%E5%AD%98%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<p>éšç€æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥ï¼ŒèŠ¯ç‰‡åˆ¶ç¨‹å’Œå·¥è‰ºæœ‰äº†æå¤§çš„å‘å±•ï¼Œç›¸åº”çš„CPUçš„è®¡ç®—èƒ½åŠ›è¶Šæ¥è¶Šå¼ºã€‚ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰æ— çº¿èµ„æºçš„å¿«é€Ÿå­˜å‚¨å™¨å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¿«é€Ÿå­˜å‚¨å™¨çš„æˆæœ¬éå¸¸é«˜æ˜‚ï¼Œå› æ­¤è®¿å­˜å˜æˆäº†è®¡ç®—æœºç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆã€‚ä¸ºäº†å¹³è¡¡cpuè¿è¡Œé€Ÿåº¦ä¸è®¿å­˜é€Ÿåº¦ä¹‹é—´çš„å·®å¼‚ç¼“å­˜è¢«è®¾è®¡å‡ºæ¥ï¼</p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ç¼“å†²å­˜å‚¨å™¨ï¼Œç®€ç§°ç¼“å­˜(cache)ï¼Œç”¨äºå­˜å‚¨å¯èƒ½é¢‘ç¹è®¿é—®çš„æ•°æ®ã€‚</p>
<p>ç¼“å­˜ç»“åˆäº†å¯„å­˜å™¨é€Ÿåº¦å¿«å’Œå†…å­˜é€ ä»·ä½çš„ä¼˜ç‚¹ï¼Œå› æ­¤é€šè¿‡ç¼“å­˜çš„è®¾è®¡ä½¿æ•´ä¸ªå­˜å‚¨ç³»ç»Ÿçš„æ€§èƒ½æ¥è¿‘å¯„å­˜å™¨ï¼Œå¹¶ä¸”æ¯å­—èŠ‚çš„æˆæœ¬éƒ½æ¥è¿‘å†…å­˜ï¼Œç”šè‡³æ˜¯ç£ç›˜ã€‚</p>
<p>é«˜é€Ÿç¼“å­˜çš„å·¥ä½œå°±æ˜¯å°†å†…å­˜ä¸­æœ€è¿‘è¯»å†™è¿‡çš„æ•°æ®åœ¨é«˜é€Ÿç¼“å­˜ä¸­ä¿ç•™ä¸€ä¸ª<strong>å¤‡ä»½</strong>ï¼Œä½¿è¿™äº›æ•°æ®èƒ½å¤Ÿå¿«é€Ÿåœ°è¿”å›ç»™CPU</p>
<h1 id="ç¡¬ä»¶å®ç°"><a href="#ç¡¬ä»¶å®ç°" class="headerlink" title="ç¡¬ä»¶å®ç°"></a>ç¡¬ä»¶å®ç°</h1><blockquote>
<p>æœ¬èŠ‚å†…å®¹å¤§å¤šå–è‡ªæå®¢æ—¶é—´ï¼Œã€Šç¼–ç¨‹é«˜æ‰‹å¿…å­¦çš„å†…å­˜çŸ¥è¯†ã€‹æµ·çº³</p>
</blockquote>
<p>ç¼“å­˜çš„ç»„æˆå•å…ƒæ˜¯SRAMï¼Œè€Œç›®å‰SRAMé€šå¸¸é‡‡ç”¨äº†6ç®¡å¼çš„å­˜å‚¨ç”µè·¯</p>
<p>ç®€å•æ¥è®²ï¼ŒSRAM å­˜å‚¨å•å…ƒçš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨ 6 ä¸ªæ™¶ä½“ç®¡æ¥å®ç°ã€‚å…¶ä¸­ä¸¤ä¸ª P å‹ MOS ç®¡å’Œä¸¤ä¸ª N å‹ MOS ç®¡ç»„æˆä¸¤ä¸ªåç›¸å™¨ç”¨äºå­˜å‚¨ä¿¡æ¯ã€‚è¿˜æœ‰ä¸¤ä¸ªç”¨äºæ§åˆ¶å­˜å‚¨å•å…ƒæ˜¯å¦é€‰é€šã€‚6 ç®¡ SRAM çš„ç»“æ„æ¯”è§¦å‘å™¨ç®€å•ï¼Œé€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«</p>
<h2 id="è¿æ¥å›¾"><a href="#è¿æ¥å›¾" class="headerlink" title="è¿æ¥å›¾"></a>è¿æ¥å›¾</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒM1 å’Œ M3 ä¸¤ä¸ª MOS ç®¡ï¼Œæ˜¯ N æ²Ÿé“åœºæ•ˆåº”ç®¡ï¼Œåœ¨é«˜ç”µå‹æ—¶å¯¼é€šï¼›è€Œ M2 å’Œ M4 è¿™ä¸¤ä¸ª MOSï¼Œåˆ™æ˜¯ P æ²Ÿé“åœºæ•ˆåº”ç®¡ï¼Œåœ¨ä½ç”µå‹æ—¶å¯¼é€šã€‚æœ¬è´¨ä¸Šï¼ŒM1 å’Œ M2 ä¸€èµ·ç»„æˆäº†ä¸€ä¸ªéé—¨ï¼ŒM3 å’Œ M4 ä¸€èµ·ç»„æˆäº†å¦ä¸€ä¸ªéé—¨ï¼Œè¿™ä¸¤ä¸ªéé—¨çš„è¾“å‡ºäº’ä¸ºå¯¹æ–¹çš„è¾“å…¥ï¼Œè¿™æ ·ï¼Œä¸¤ä¸ªéé—¨å°±ç»„æˆäº†ä¸€ç§å¯ä»¥å­˜å‚¨æ¯”ç‰¹å€¼çš„ç”µè·¯ã€‚</p>
<p><img src="/images/computerSystem/storage/cache-0.png" alt="image"></p>
<h2 id="ç­‰æ•ˆå›¾"><a href="#ç­‰æ•ˆå›¾" class="headerlink" title="ç­‰æ•ˆå›¾"></a>ç­‰æ•ˆå›¾</h2><p><img src="/images/computerSystem/storage/cache-1.png" alt="image"></p>
<h2 id="è¯»å†™åŸç†"><a href="#è¯»å†™åŸç†" class="headerlink" title="è¯»å†™åŸç†"></a>è¯»å†™åŸç†</h2><p>å½“è¦è¯»å…¥SRAMæ•°æ®æ—¶ï¼Œå­—çº¿ (Word Line, WL) åŠ é«˜ç”µå¹³ï¼Œä½¿å¾—æ¯ä¸ªåŸºæœ¬å•å…ƒçš„ä¸¤ä¸ªæ§åˆ¶å¼€å…³M5ã€M6å¯¼é€šï¼Œå­˜å‚¨å•å…ƒä¸ä½çº¿ (Bit Line, BL) è¿é€šã€‚ä½çº¿ç”¨äºè¯»å–æˆ–å†™å…¥åŸºæœ¬å•å…ƒçš„ä¿å­˜çŠ¶æ€ã€‚</p>
<p>æˆ‘ä»¬å‡å®šå‚¨å­˜çš„å†…å®¹ä¸º 1ï¼Œå³åœ¨ Q å¤„çš„ç”µå¹³ä¸ºé«˜ã€‚è¯»å–å‘¨æœŸå¼€å§‹æ—¶ï¼Œä¸¤æ¡ä½çº¿é¢„å…ˆè®¾æˆé«˜ç”µå¹³ï¼Œéšåå­—çº¿ WL å˜æˆé«˜ç”µå¹³ï¼Œä½¿å¾—ä¸¤ä¸ªè®¿é—®æ§åˆ¶æ™¶ä½“ç®¡ M5 ä¸ M6 å¯¼é€šã€‚Q çš„é«˜ç”µå¹³ä½¿å¾—æ™¶ä½“ç®¡ M1 å¯¼é€šï¼Œè€Œ Q åä¸ BL åçš„é¢„å……å€¼ä¸åŒï¼Œä½¿å¾— BL åç»ç”± M1 ä¸ M5 æ”¾ç”µè€Œå˜æˆé€»è¾‘ 0ã€‚åœ¨ä½çº¿ BL ä¸€ä¾§ï¼ŒQ åçš„ä½ç”µå¹³ä½¿å¾— M4 å¯¼é€šï¼Œå†åŠ ä¸Š M6 é€šè·¯ï¼Œä½çº¿å°±è¿æ¥åˆ° VDD çš„é«˜ç”µå‹ã€‚</p>
<p>å¦‚æœå‚¨å­˜çš„å†…å®¹ä¸º 0ï¼Œç›¸åçš„ç”µè·¯çŠ¶æ€å°†ä¼šä½¿ BL åä¸º 1ï¼Œè€Œ BL ä¸º 0ã€‚è¿™æ—¶ï¼Œåªéœ€è¦ BL ä¸ BL åæœ‰ä¸€ä¸ªå¾ˆå°çš„ç”µä½å·®ï¼Œè¯»å–çš„æ”¾å¤§ç”µè·¯å°±ä¼šè¾¨è¯†å‡ºå“ªæ¡ä½çº¿æ˜¯ 1ï¼Œå“ªæ¡æ˜¯ 0ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ•æ„Ÿåº¦è¶Šé«˜æ—¶ï¼Œè¯»å–çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚</p>
<p>åœ¨å†™å…¥å‘¨æœŸå¼€å§‹æ—¶ï¼ŒæŠŠè¦å†™å…¥çš„çŠ¶æ€åŠ è½½åˆ°ä½çº¿ã€‚å¦‚æœè¦å†™å…¥ 0ï¼Œåˆ™è®¾ç½® BL åä¸º 1 ä¸” BL ä¸º 0ã€‚éšåå­—çº¿ WL åŠ è½½ä¸ºé«˜ç”µå¹³ï¼Œä½çº¿çš„çŠ¶æ€è¢«åŠ è½½è¿› SRAM çš„åŸºæœ¬å•å…ƒã€‚</p>
<h1 id="ç¼“å­˜åŸºç¡€"><a href="#ç¼“å­˜åŸºç¡€" class="headerlink" title="ç¼“å­˜åŸºç¡€"></a>ç¼“å­˜åŸºç¡€</h1><h2 id="é›†æˆæ–¹å¼"><a href="#é›†æˆæ–¹å¼" class="headerlink" title="é›†æˆæ–¹å¼"></a>é›†æˆæ–¹å¼</h2><ul>
<li>åˆ†å¸ƒå¼ç¼“å­˜ï¼šä¸€ä¸ªå¤„ç†å™¨å¯¹åº”ä¸€ä¸ªç¼“å­˜ï¼›</li>
<li>é›†ä¸­å¼ç¼“å­˜ï¼šå¤šä¸ªå¤„ç†å™¨ï¼ˆæ ¸ï¼‰å…±äº«ä¸€ä¸ªå†…å­˜ï¼›</li>
<li>æ··åˆå¼ç¼“å­˜ï¼šåœ¨ L3 é‡‡ç”¨é›†ä¸­å¼ç¼“å­˜ï¼Œåœ¨ L1 å’Œ L2 é‡‡ç”¨åˆ†å¸ƒå¼ç¼“å­˜ã€‚</li>
</ul>
<p><img src="/images/computerSystem/storage/cache-2.png" alt="image"></p>
<h2 id="ç¼“å­˜ç»“æ„"><a href="#ç¼“å­˜ç»“æ„" class="headerlink" title="ç¼“å­˜ç»“æ„"></a>ç¼“å­˜ç»“æ„</h2><blockquote>
<p>å†¯è¯ºä¾æ›¼æ¶æ„ï¼šæŒ‡ä»¤å’Œæ•°æ®æ··åˆå­˜å‚¨åœ¨åŒä¸€å­˜å‚¨å™¨</p>
<p>å“ˆå¼—æ¶æ„ï¼šæŒ‡ä»¤å’Œæ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œåˆ†åˆ«æ”¾åœ¨ç¨‹åºå­˜å‚¨å™¨å’Œæ•°æ®å­˜å‚¨å™¨</p>
</blockquote>
<p>åœ¨cacheè®¾è®¡ä¹‹åˆï¼Œcpuä¸å†…å­˜ä¹‹é—´åªæœ‰ä¸€ä¸ªcacheã€‚éšç€èŠ¯ç‰‡å·¥è‰ºçš„æé«˜ï¼Œç°ä»£CPUé€šå¸¸é‡‡ç”¨äºŒçº§/ä¸‰çº§å¤šçº§ç¼“å­˜ç»“æ„ã€‚</p>
<ul>
<li>ä¸€çº§ç¼“å­˜ï¼ˆL1 Cacheï¼‰ï¼šåœ¨Coreå†…éƒ¨ï¼Œåˆ†ä¸ºæŒ‡ä»¤ç¼“å­˜ï¼ˆI-cacheï¼‰å’Œæ•°æ®ç¼“å­˜ï¼ˆD-cacheï¼‰ï¼ˆå†¯è¯ºä¾æ›¼æ¶æ„ï¼‰ã€‚å®¹é‡é€šå¸¸åœ¨32~256KBï¼Œé€Ÿåº¦3 cycles</li>
<li>äºŒçº§ç¼“å­˜ï¼ˆL2 Cacheï¼‰ï¼šå…·ä½“èŠ¯ç‰‡Coreå†…å¤–ä¸åŒã€‚å®¹é‡256KB~3MBä¸ç­‰ï¼Œé€Ÿåº¦11cyclesï¼ˆå“ˆå¼—æ¶æ„ï¼‰</li>
<li>ä¸‰çº§ç¼“å­˜ï¼ˆL3 Cacheï¼‰ï¼šåœ¨Coreå¤–éƒ¨ï¼Œæ‰€æœ‰CPUæ ¸å¿ƒå…±äº«ã€‚å®¹é‡æ›´å¤§ï¼Œé€Ÿåº¦25cyclesï¼ˆå“ˆå¼—æ¶æ„ï¼‰</li>
</ul>
<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><blockquote>
<p><strong>ç»Ÿä¸€ç¼“å­˜ï¼š</strong> æŒ‡ä»¤å’Œæ•°æ®ç»Ÿä¸€å­˜æ”¾åœ¨ä¸€ä¸ªç¼“å­˜ä¸­</p>
<p><strong>åˆ†ç¦»ç¼“å­˜ï¼š</strong> æŒ‡ä»¤å’Œæ•°æ®åˆ†åˆ«å­˜æ”¾åœ¨ä¸åŒç¼“å­˜ä¸­</p>
</blockquote>
<h3 id="L1-é‡‡ç”¨åˆ†ç¦»ç¼“å­˜çš„åŸå› ï¼Ÿ"><a href="#L1-é‡‡ç”¨åˆ†ç¦»ç¼“å­˜çš„åŸå› ï¼Ÿ" class="headerlink" title="L1 é‡‡ç”¨åˆ†ç¦»ç¼“å­˜çš„åŸå› ï¼Ÿ"></a>L1 é‡‡ç”¨åˆ†ç¦»ç¼“å­˜çš„åŸå› ï¼Ÿ</h3><ol>
<li>æµæ°´çº¿è§’åº¦ã€‚å¯é¿å…å–æŒ‡å’Œæ‰§è¡Œæ—¶æœŸçš„è®¿å­˜å†²çªã€‚ åœ¨ CPU å†…æ ¸ä¸­ï¼Œå–æŒ‡å’Œè®¿å­˜æ˜¯ç”±ä¸¤ä¸ªä¸åŒçš„ç¡¬ä»¶å•å…ƒå®Œæˆçš„ã€‚å¦‚æœä½¿ç”¨ç»Ÿä¸€ç¼“å­˜ï¼Œå½“ CPU ä½¿ç”¨è¶…å‰æ§åˆ¶æˆ–æµæ°´çº¿æ§åˆ¶ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰çš„æ§åˆ¶æ–¹å¼æ—¶ï¼Œä¼šå­˜åœ¨å–æŒ‡ä½œå’Œè®¿å­˜åŒæ—¶äº‰ç”¨åŒä¸€ä¸ªç¼“å­˜çš„æƒ…å†µï¼Œé™ä½ CPU è¿è¡Œæ•ˆç‡</li>
<li>cacheè¡Œä¸ºè§’åº¦ã€‚I-cacheå¤§å¤šæ˜¯é¡ºåºå–æŒ‡ï¼ŒæŒ‡ä»¤åªæœ‰è¯»æ²¡æœ‰å†™ï¼›D-cacheæ˜¯å–æ•°æ®å˜åŒ–è¾ƒå¤§ï¼Œæ•°æ®å¯è¯»å¯å†™ï¼Œæœ€é‡è¦çš„æ˜¯å†¯è¯ºä¾æ›¼çš„ç»“æ„æ˜¯æŒ‡ä»¤å’Œæ•°æ®åˆ†ç¦»ï¼ŒIå’ŒDåœ¨ä¸€èµ·åªæœ‰ç›¸äº’å¹²æ‰°</li>
<li>ç‰©ç†è®¾è®¡è§’åº¦ã€‚ä¸€å—cacheï¼ŒåŒæ—¶éœ€è¦æ•°æ®å’ŒæŒ‡ä»¤çš„è®¿é—®ï¼Œç«¯å£ä¸Šæ˜¯å¾ˆéš¾å®ç°çš„</li>
</ol>
<h3 id="L1åˆ†ç¦»ç¼“å­˜ã€L2ç»Ÿä¸€ç¼“å­˜ï¼Ÿ"><a href="#L1åˆ†ç¦»ç¼“å­˜ã€L2ç»Ÿä¸€ç¼“å­˜ï¼Ÿ" class="headerlink" title="L1åˆ†ç¦»ç¼“å­˜ã€L2ç»Ÿä¸€ç¼“å­˜ï¼Ÿ"></a>L1åˆ†ç¦»ç¼“å­˜ã€L2ç»Ÿä¸€ç¼“å­˜ï¼Ÿ</h3><ol>
<li>æˆæœ¬è§’åº¦ã€‚L1 cache miss æ€§èƒ½æŸå¤±ä¸å¢åŠ L2åˆ†ç¦»ç¼“å­˜çš„æˆæœ¬çš„å¹³è¡¡</li>
<li>ç‰©ç†è®¾è®¡è§’åº¦ã€‚åˆ†ç¦»å¼è®¾è®¡ä¼šå ç”¨é€»è¾‘ç”µè·¯çš„é¢ç§¯ä¸è®¾è®¡éš¾åº¦ï¼Œå¯¹äºL1è¿™ç§sizeæ¯”è¾ƒå°çš„é‡‡ç”¨åˆ†ç¦»å¼è®¾è®¡å¯ä»¥æ‰¿å—ï¼Œä½†æ˜¯å¯¹äºæ›´å¤§çš„Cacheå…¨é‡‡ç”¨åˆ†ç¦»è®¾è®¡ï¼Œæ— ç–‘è®¾è®¡éš¾åº¦å’Œé¢ç§¯éƒ½ä¼šåŠ å¤§</li>
<li>æ•ˆç‡è§’åº¦ã€‚åˆ†ç¦»ç¼“å­˜ä¸é€‚ç”¨æ‰€æœ‰æƒ…å†µï¼Œå¯¹äºæŒ‡ä»¤å’Œæ•°æ®å­˜æ”¾å¤§å°çš„éœ€æ±‚ä¸åŒï¼Œæ— æ³•åšåˆ°åŠ¨æ€è°ƒèŠ‚cacheçš„å¤§å°ï¼Œå¯èƒ½ä¼šæœ‰æµªè´¹</li>
</ol>
<h3 id="cacheæ”¾åœ¨ç‰‡å†…çš„ä¼˜åŠ¿ï¼Ÿ"><a href="#cacheæ”¾åœ¨ç‰‡å†…çš„ä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="cacheæ”¾åœ¨ç‰‡å†…çš„ä¼˜åŠ¿ï¼Ÿ"></a>cacheæ”¾åœ¨ç‰‡å†…çš„ä¼˜åŠ¿ï¼Ÿ</h3><ol>
<li>ç‰‡å†…ç¼“å­˜ç‰©ç†è·ç¦»æ›´çŸ­ï¼Œç‰‡å†…ç¼“å­˜ä¸å–æŒ‡ä»¤å•å…ƒå’Œå–æ•°æ®å•å…ƒçš„ç‰©ç†è·ç¦»æ›´çŸ­ï¼Œé€Ÿåº¦æ›´å¿«ï¼›</li>
<li>ç‰‡å†…ç¼“å­˜ä¸å ç”¨ç³»ç»Ÿæ€»çº¿ï¼Œ ç‰‡å†…ç¼“å­˜ä½¿ç”¨ç‹¬ç«‹çš„ CPU ç‰‡å†…æ€»çº¿ï¼Œå¯ä»¥å‡è½»ç³»ç»Ÿæ€»çº¿çš„è´Ÿæ‹…ã€‚</li>
</ol>
<h3 id="ä¸éœ€è¦cacheçš„åœºæ™¯ï¼Ÿ"><a href="#ä¸éœ€è¦cacheçš„åœºæ™¯ï¼Ÿ" class="headerlink" title="ä¸éœ€è¦cacheçš„åœºæ™¯ï¼Ÿ"></a>ä¸éœ€è¦cacheçš„åœºæ™¯ï¼Ÿ</h3><p>51å•ç‰‡æœºã€cortex-M0ï¼ˆâ€“M4ï¼‰ç³»åˆ—ARMå¤„ç†å™¨éƒ½æ²¡æœ‰cache</p>
<ol>
<li>ä½åŠŸè€—ã€ä½æˆæœ¬å¤„ç†å™¨å¹¶ä¸”å·¥ä½œé¢‘ç‡ä¸é«˜ï¼ˆå‡ åå…†åˆ°å‡ ç™¾å…†ï¼‰çš„å¤„ç†å™¨ä¸éœ€è¦ï¼Œå¯èƒ½ç”šè‡³ä¸éœ€è¦SRAM</li>
<li>cacheæ— æ³•ä¿è¯å®æ—¶æ€§ï¼Œç¼“å­˜ç¼ºå¤±æ—¶å‘RAMåŠ è½½æ•°æ®çš„æ—¶é—´æ˜¯ä¸ç­‰çš„</li>
</ol>
]]></content>
      <categories>
        <category>Computure System</category>
        <category>Storage</category>
        <category>Cache</category>
      </categories>
      <tags>
        <tag>storage system</tag>
        <tag>Cache</tag>
      </tags>
  </entry>
</search>
